62972f32fcae63fe8a9b1ac8d050810b
"use strict";

var __spreadArrays = this && this.__spreadArrays || function () {
  for (var s = 0, i = 0, il = arguments.length; i < il; i++) {
    s += arguments[i].length;
  }

  for (var r = Array(s), k = 0, i = 0; i < il; i++) {
    for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++) {
      r[k] = a[j];
    }
  }

  return r;
};

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.isTraversal = void 0;
var reName = /^[^\\#]?(?:\\(?:[\da-f]{1,6}\s?|.)|[\w\-\u00b0-\uFFFF])+/;
var reEscape = /\\([\da-f]{1,6}\s?|(\s)|.)/gi;
var reAttr = /^\s*(?:(\*|[-\w]*)\|)?((?:\\.|[\w\u00b0-\uFFFF-])+)\s*(?:(\S?)=\s*(?:(['"])((?:[^\\]|\\[^])*?)\4|(#?(?:\\.|[\w\u00b0-\uFFFF-])*)|)|)\s*([iI])?\]/;
var actionTypes = {
  undefined: "exists",
  "": "equals",
  "~": "element",
  "^": "start",
  $: "end",
  "*": "any",
  "!": "not",
  "|": "hyphen"
};
var Traversals = {
  ">": "child",
  "<": "parent",
  "~": "sibling",
  "+": "adjacent"
};
var attribSelectors = {
  "#": ["id", "equals"],
  ".": ["class", "element"]
};
var unpackPseudos = new Set(["has", "not", "matches", "is", "host", "host-context"]);
var traversalNames = new Set(__spreadArrays(["descendant"], Object.keys(Traversals).map(function (k) {
  return Traversals[k];
})));

function isTraversal(selector) {
  return traversalNames.has(selector.type);
}

exports.isTraversal = isTraversal;
var stripQuotesFromPseudos = new Set(["contains", "icontains"]);
var quotes = new Set(['"', "'"]);

function funescape(_, escaped, escapedWhitespace) {
  var high = parseInt(escaped, 16) - 0x10000;
  return high !== high || escapedWhitespace ? escaped : high < 0 ? String.fromCharCode(high + 0x10000) : String.fromCharCode(high >> 10 | 0xd800, high & 0x3ff | 0xdc00);
}

function unescapeCSS(str) {
  return str.replace(reEscape, funescape);
}

function isWhitespace(c) {
  return c === " " || c === "\n" || c === "\t" || c === "\f" || c === "\r";
}

function parse(selector, options) {
  var subselects = [];
  var endIndex = parseSelector(subselects, "" + selector, options, 0);

  if (endIndex < selector.length) {
    throw new Error("Unmatched selector: " + selector.slice(endIndex));
  }

  return subselects;
}

exports.default = parse;

function parseSelector(subselects, selector, options, selectorIndex) {
  var _a, _b;

  if (options === void 0) {
    options = {};
  }

  var tokens = [];
  var sawWS = false;

  function getName(offset) {
    var match = selector.slice(selectorIndex + offset).match(reName);

    if (!match) {
      throw new Error("Expected name, found " + selector.slice(selectorIndex));
    }

    var name = match[0];
    selectorIndex += offset + name.length;
    return unescapeCSS(name);
  }

  function stripWhitespace(offset) {
    while (isWhitespace(selector.charAt(selectorIndex + offset))) {
      offset++;
    }

    selectorIndex += offset;
  }

  function isEscaped(pos) {
    var slashCount = 0;

    while (selector.charAt(--pos) === "\\") {
      slashCount++;
    }

    return (slashCount & 1) === 1;
  }

  function ensureNotTraversal() {
    if (tokens.length > 0 && isTraversal(tokens[tokens.length - 1])) {
      throw new Error("Did not expect successive traversals.");
    }
  }

  stripWhitespace(0);

  while (selector !== "") {
    var firstChar = selector.charAt(selectorIndex);

    if (isWhitespace(firstChar)) {
      sawWS = true;
      stripWhitespace(1);
    } else if (firstChar in Traversals) {
      ensureNotTraversal();
      tokens.push({
        type: Traversals[firstChar]
      });
      sawWS = false;
      stripWhitespace(1);
    } else if (firstChar === ",") {
      if (tokens.length === 0) {
        throw new Error("Empty sub-selector");
      }

      subselects.push(tokens);
      tokens = [];
      sawWS = false;
      stripWhitespace(1);
    } else {
      if (sawWS) {
        ensureNotTraversal();
        tokens.push({
          type: "descendant"
        });
        sawWS = false;
      }

      if (firstChar in attribSelectors) {
        var _c = attribSelectors[firstChar],
            name_1 = _c[0],
            action = _c[1];
        tokens.push({
          type: "attribute",
          name: name_1,
          action: action,
          value: getName(1),
          ignoreCase: false,
          namespace: null
        });
      } else if (firstChar === "[") {
        var attributeMatch = selector.slice(selectorIndex + 1).match(reAttr);

        if (!attributeMatch) {
          throw new Error("Malformed attribute selector: " + selector.slice(selectorIndex));
        }

        var completeSelector = attributeMatch[0],
            _d = attributeMatch[1],
            namespace = _d === void 0 ? null : _d,
            baseName = attributeMatch[2],
            actionType = attributeMatch[3],
            _e = attributeMatch[5],
            quotedValue = _e === void 0 ? "" : _e,
            _f = attributeMatch[6],
            value = _f === void 0 ? quotedValue : _f,
            ignoreCase = attributeMatch[7];
        selectorIndex += completeSelector.length + 1;
        var name_2 = unescapeCSS(baseName);

        if ((_a = options.lowerCaseAttributeNames) !== null && _a !== void 0 ? _a : !options.xmlMode) {
          name_2 = name_2.toLowerCase();
        }

        tokens.push({
          type: "attribute",
          name: name_2,
          action: actionTypes[actionType],
          value: unescapeCSS(value),
          namespace: namespace,
          ignoreCase: !!ignoreCase
        });
      } else if (firstChar === ":") {
        if (selector.charAt(selectorIndex + 1) === ":") {
          tokens.push({
            type: "pseudo-element",
            name: getName(2).toLowerCase()
          });
          continue;
        }

        var name_3 = getName(1).toLowerCase();
        var data = null;

        if (selector.charAt(selectorIndex) === "(") {
          if (unpackPseudos.has(name_3)) {
            if (quotes.has(selector.charAt(selectorIndex + 1))) {
              throw new Error("Pseudo-selector " + name_3 + " cannot be quoted");
            }

            data = [];
            selectorIndex = parseSelector(data, selector, options, selectorIndex + 1);

            if (selector.charAt(selectorIndex) !== ")") {
              throw new Error("Missing closing parenthesis in :" + name_3 + " (" + selector + ")");
            }

            selectorIndex += 1;
          } else {
            selectorIndex += 1;
            var start = selectorIndex;
            var counter = 1;

            for (; counter > 0 && selectorIndex < selector.length; selectorIndex++) {
              if (selector.charAt(selectorIndex) === "(" && !isEscaped(selectorIndex)) {
                counter++;
              } else if (selector.charAt(selectorIndex) === ")" && !isEscaped(selectorIndex)) {
                counter--;
              }
            }

            if (counter) {
              throw new Error("Parenthesis not matched");
            }

            data = selector.slice(start, selectorIndex - 1);

            if (stripQuotesFromPseudos.has(name_3)) {
              var quot = data.charAt(0);

              if (quot === data.slice(-1) && quotes.has(quot)) {
                data = data.slice(1, -1);
              }

              data = unescapeCSS(data);
            }
          }
        }

        tokens.push({
          type: "pseudo",
          name: name_3,
          data: data
        });
      } else {
        var namespace = null;
        var name_4 = void 0;

        if (firstChar === "*") {
          selectorIndex += 1;
          name_4 = "*";
        } else if (reName.test(selector.slice(selectorIndex))) {
          name_4 = getName(0);
        } else {
          if (tokens.length && tokens[tokens.length - 1].type === "descendant") {
            tokens.pop();
          }

          addToken(subselects, tokens);
          return selectorIndex;
        }

        if (selector.charAt(selectorIndex) === "|") {
          namespace = name_4;

          if (selector.charAt(selectorIndex + 1) === "*") {
            name_4 = "*";
            selectorIndex += 2;
          } else {
            name_4 = getName(1);
          }
        }

        if (name_4 === "*") {
          tokens.push({
            type: "universal",
            namespace: namespace
          });
        } else {
          if ((_b = options.lowerCaseTags) !== null && _b !== void 0 ? _b : !options.xmlMode) {
            name_4 = name_4.toLowerCase();
          }

          tokens.push({
            type: "tag",
            name: name_4,
            namespace: namespace
          });
        }
      }
    }
  }

  addToken(subselects, tokens);
  return selectorIndex;
}

function addToken(subselects, tokens) {
  if (subselects.length > 0 && tokens.length === 0) {
    throw new Error("Empty sub-selector");
  }

  subselects.push(tokens);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInBhcnNlLmpzIl0sIm5hbWVzIjpbIl9fc3ByZWFkQXJyYXlzIiwicyIsImkiLCJpbCIsImFyZ3VtZW50cyIsImxlbmd0aCIsInIiLCJBcnJheSIsImsiLCJhIiwiaiIsImpsIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJleHBvcnRzIiwidmFsdWUiLCJpc1RyYXZlcnNhbCIsInJlTmFtZSIsInJlRXNjYXBlIiwicmVBdHRyIiwiYWN0aW9uVHlwZXMiLCJ1bmRlZmluZWQiLCIkIiwiVHJhdmVyc2FscyIsImF0dHJpYlNlbGVjdG9ycyIsInVucGFja1BzZXVkb3MiLCJTZXQiLCJ0cmF2ZXJzYWxOYW1lcyIsImtleXMiLCJtYXAiLCJzZWxlY3RvciIsImhhcyIsInR5cGUiLCJzdHJpcFF1b3Rlc0Zyb21Qc2V1ZG9zIiwicXVvdGVzIiwiZnVuZXNjYXBlIiwiXyIsImVzY2FwZWQiLCJlc2NhcGVkV2hpdGVzcGFjZSIsImhpZ2giLCJwYXJzZUludCIsIlN0cmluZyIsImZyb21DaGFyQ29kZSIsInVuZXNjYXBlQ1NTIiwic3RyIiwicmVwbGFjZSIsImlzV2hpdGVzcGFjZSIsImMiLCJwYXJzZSIsIm9wdGlvbnMiLCJzdWJzZWxlY3RzIiwiZW5kSW5kZXgiLCJwYXJzZVNlbGVjdG9yIiwiRXJyb3IiLCJzbGljZSIsImRlZmF1bHQiLCJzZWxlY3RvckluZGV4IiwiX2EiLCJfYiIsInRva2VucyIsInNhd1dTIiwiZ2V0TmFtZSIsIm9mZnNldCIsIm1hdGNoIiwibmFtZSIsInN0cmlwV2hpdGVzcGFjZSIsImNoYXJBdCIsImlzRXNjYXBlZCIsInBvcyIsInNsYXNoQ291bnQiLCJlbnN1cmVOb3RUcmF2ZXJzYWwiLCJmaXJzdENoYXIiLCJwdXNoIiwiX2MiLCJuYW1lXzEiLCJhY3Rpb24iLCJpZ25vcmVDYXNlIiwibmFtZXNwYWNlIiwiYXR0cmlidXRlTWF0Y2giLCJjb21wbGV0ZVNlbGVjdG9yIiwiX2QiLCJiYXNlTmFtZSIsImFjdGlvblR5cGUiLCJfZSIsInF1b3RlZFZhbHVlIiwiX2YiLCJuYW1lXzIiLCJsb3dlckNhc2VBdHRyaWJ1dGVOYW1lcyIsInhtbE1vZGUiLCJ0b0xvd2VyQ2FzZSIsIm5hbWVfMyIsImRhdGEiLCJzdGFydCIsImNvdW50ZXIiLCJxdW90IiwibmFtZV80IiwidGVzdCIsInBvcCIsImFkZFRva2VuIiwibG93ZXJDYXNlVGFncyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBQ0EsSUFBSUEsY0FBYyxHQUFJLFFBQVEsS0FBS0EsY0FBZCxJQUFpQyxZQUFZO0FBQzlELE9BQUssSUFBSUMsQ0FBQyxHQUFHLENBQVIsRUFBV0MsQ0FBQyxHQUFHLENBQWYsRUFBa0JDLEVBQUUsR0FBR0MsU0FBUyxDQUFDQyxNQUF0QyxFQUE4Q0gsQ0FBQyxHQUFHQyxFQUFsRCxFQUFzREQsQ0FBQyxFQUF2RDtBQUEyREQsSUFBQUEsQ0FBQyxJQUFJRyxTQUFTLENBQUNGLENBQUQsQ0FBVCxDQUFhRyxNQUFsQjtBQUEzRDs7QUFDQSxPQUFLLElBQUlDLENBQUMsR0FBR0MsS0FBSyxDQUFDTixDQUFELENBQWIsRUFBa0JPLENBQUMsR0FBRyxDQUF0QixFQUF5Qk4sQ0FBQyxHQUFHLENBQWxDLEVBQXFDQSxDQUFDLEdBQUdDLEVBQXpDLEVBQTZDRCxDQUFDLEVBQTlDO0FBQ0ksU0FBSyxJQUFJTyxDQUFDLEdBQUdMLFNBQVMsQ0FBQ0YsQ0FBRCxDQUFqQixFQUFzQlEsQ0FBQyxHQUFHLENBQTFCLEVBQTZCQyxFQUFFLEdBQUdGLENBQUMsQ0FBQ0osTUFBekMsRUFBaURLLENBQUMsR0FBR0MsRUFBckQsRUFBeURELENBQUMsSUFBSUYsQ0FBQyxFQUEvRDtBQUNJRixNQUFBQSxDQUFDLENBQUNFLENBQUQsQ0FBRCxHQUFPQyxDQUFDLENBQUNDLENBQUQsQ0FBUjtBQURKO0FBREo7O0FBR0EsU0FBT0osQ0FBUDtBQUNILENBTkQ7O0FBT0FNLE1BQU0sQ0FBQ0MsY0FBUCxDQUFzQkMsT0FBdEIsRUFBK0IsWUFBL0IsRUFBNkM7QUFBRUMsRUFBQUEsS0FBSyxFQUFFO0FBQVQs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QUFlZ0MsWUFBQUEsSUFBSSxFQUFFK0IsTUFBckI7QUFBNkJsQixZQUFBQSxTQUFTLEVBQUVBO0FBQXhDLFdBQVo7QUFDSDtBQUNKO0FBQ0o7QUFDSjs7QUFDRHFCLEVBQUFBLFFBQVEsQ0FBQ2hELFVBQUQsRUFBYVMsTUFBYixDQUFSO0FBQ0EsU0FBT0gsYUFBUDtBQUNIOztBQUNELFNBQVMwQyxRQUFULENBQWtCaEQsVUFBbEIsRUFBOEJTLE1BQTlCLEVBQXNDO0FBQ2xDLE1BQUlULFVBQVUsQ0FBQzdDLE1BQVgsR0FBb0IsQ0FBcEIsSUFBeUJzRCxNQUFNLENBQUN0RCxNQUFQLEtBQWtCLENBQS9DLEVBQWtEO0FBQzlDLFVBQU0sSUFBSWdELEtBQUosQ0FBVSxvQkFBVixDQUFOO0FBQ0g7O0FBQ0RILEVBQUFBLFVBQVUsQ0FBQ3NCLElBQVgsQ0FBZ0JiLE1BQWhCO0FBQ0giLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbnZhciBfX3NwcmVhZEFycmF5cyA9ICh0aGlzICYmIHRoaXMuX19zcHJlYWRBcnJheXMpIHx8IGZ1bmN0aW9uICgpIHtcbiAgICBmb3IgKHZhciBzID0gMCwgaSA9IDAsIGlsID0gYXJndW1lbnRzLmxlbmd0aDsgaSA8IGlsOyBpKyspIHMgKz0gYXJndW1lbnRzW2ldLmxlbmd0aDtcbiAgICBmb3IgKHZhciByID0gQXJyYXkocyksIGsgPSAwLCBpID0gMDsgaSA8IGlsOyBpKyspXG4gICAgICAgIGZvciAodmFyIGEgPSBhcmd1bWVudHNbaV0sIGogPSAwLCBqbCA9IGEubGVuZ3RoOyBqIDwgamw7IGorKywgaysrKVxuICAgICAgICAgICAgcltrXSA9IGFbal07XG4gICAgcmV0dXJuIHI7XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5pc1RyYXZlcnNhbCA9IHZvaWQgMDtcbnZhciByZU5hbWUgPSAvXlteXFxcXCNdPyg/OlxcXFwoPzpbXFxkYS1mXXsxLDZ9XFxzP3wuKXxbXFx3XFwtXFx1MDBiMC1cXHVGRkZGXSkrLztcbnZhciByZUVzY2FwZSA9IC9cXFxcKFtcXGRhLWZdezEsNn1cXHM/fChcXHMpfC4pL2dpO1xuLy8gTW9kaWZpZWQgdmVyc2lvbiBvZiBodHRwczovL2dpdGh1Yi5jb20vanF1ZXJ5L3NpenpsZS9ibG9iL21hc3Rlci9zcmMvc2l6emxlLmpzI0w4N1xudmFyIHJlQXR0ciA9IC9eXFxzKig/OihcXCp8Wy1cXHddKilcXHwpPygoPzpcXFxcLnxbXFx3XFx1MDBiMC1cXHVGRkZGLV0pKylcXHMqKD86KFxcUz8pPVxccyooPzooWydcIl0pKCg/OlteXFxcXF18XFxcXFteXSkqPylcXDR8KCM/KD86XFxcXC58W1xcd1xcdTAwYjAtXFx1RkZGRi1dKSopfCl8KVxccyooW2lJXSk/XFxdLztcbnZhciBhY3Rpb25UeXBlcyA9IHtcbiAgICB1bmRlZmluZWQ6IFwiZXhpc3RzXCIsXG4gICAgXCJcIjogXCJlcXVhbHNcIixcbiAgICBcIn5cIjogXCJlbGVtZW50XCIsXG4gICAgXCJeXCI6IFwic3RhcnRcIixcbiAgICAkOiBcImVuZFwiLFxuICAgIFwiKlwiOiBcImFueVwiLFxuICAgIFwiIVwiOiBcIm5vdFwiLFxuICAgIFwifFwiOiBcImh5cGhlblwiLFxufTtcbnZhciBUcmF2ZXJzYWxzID0ge1xuICAgIFwiPlwiOiBcImNoaWxkXCIsXG4gICAgXCI8XCI6IFwicGFyZW50XCIsXG4gICAgXCJ+XCI6IFwic2libGluZ1wiLFxuICAgIFwiK1wiOiBcImFkamFjZW50XCIsXG59O1xudmFyIGF0dHJpYlNlbGVjdG9ycyA9IHtcbiAgICBcIiNcIjogW1wiaWRcIiwgXCJlcXVhbHNcIl0sXG4gICAgXCIuXCI6IFtcImNsYXNzXCIsIFwiZWxlbWVudFwiXSxcbn07XG4vLyBQc2V1ZG9zLCB3aG9zZSBkYXRhIHByb3BlcnR5IGlzIHBhcnNlZCBhcyB3ZWxsLlxudmFyIHVucGFja1BzZXVkb3MgPSBuZXcgU2V0KFtcbiAgICBcImhhc1wiLFxuICAgIFwibm90XCIsXG4gICAgXCJtYXRjaGVzXCIsXG4gICAgXCJpc1wiLFxuICAgIFwiaG9zdFwiLFxuICAgIFwiaG9zdC1jb250ZXh0XCIsXG5dKTtcbnZhciB0cmF2ZXJzYWxOYW1lcyA9IG5ldyBTZXQoX19zcHJlYWRBcnJheXMoW1xuICAgIFwiZGVzY2VuZGFudFwiXG5dLCBPYmplY3Qua2V5cyhUcmF2ZXJzYWxzKS5tYXAoZnVuY3Rpb24gKGspIHsgcmV0dXJuIFRyYXZlcnNhbHNba107IH0pKSk7XG4vKipcbiAqIENoZWNrcyB3aGV0aGVyIGEgc3BlY2lmaWMgc2VsZWN0b3IgaXMgYSB0cmF2ZXJzYWwuXG4gKiBUaGlzIGlzIHVzZWZ1bCBlZy4gaW4gc3dhcHBpbmcgdGhlIG9yZGVyIG9mIGVsZW1lbnRzIHRoYXRcbiAqIGFyZSBub3QgdHJhdmVyc2Fscy5cbiAqXG4gKiBAcGFyYW0gc2VsZWN0b3IgU2VsZWN0b3IgdG8gY2hlY2suXG4gKi9cbmZ1bmN0aW9uIGlzVHJhdmVyc2FsKHNlbGVjdG9yKSB7XG4gICAgcmV0dXJuIHRyYXZlcnNhbE5hbWVzLmhhcyhzZWxlY3Rvci50eXBlKTtcbn1cbmV4cG9ydHMuaXNUcmF2ZXJzYWwgPSBpc1RyYXZlcnNhbDtcbnZhciBzdHJpcFF1b3Rlc0Zyb21Qc2V1ZG9zID0gbmV3IFNldChbXCJjb250YWluc1wiLCBcImljb250YWluc1wiXSk7XG52YXIgcXVvdGVzID0gbmV3IFNldChbJ1wiJywgXCInXCJdKTtcbi8vIFVuZXNjYXBlIGZ1bmN0aW9uIHRha2VuIGZyb20gaHR0cHM6Ly9naXRodWIuY29tL2pxdWVyeS9zaXp6bGUvYmxvYi9tYXN0ZXIvc3JjL3NpenpsZS5qcyNMMTUyXG5mdW5jdGlvbiBmdW5lc2NhcGUoXywgZXNjYXBlZCwgZXNjYXBlZFdoaXRlc3BhY2UpIHtcbiAgICB2YXIgaGlnaCA9IHBhcnNlSW50KGVzY2FwZWQsIDE2KSAtIDB4MTAwMDA7XG4gICAgLy8gTmFOIG1lYW5zIG5vbi1jb2RlcG9pbnRcbiAgICByZXR1cm4gaGlnaCAhPT0gaGlnaCB8fCBlc2NhcGVkV2hpdGVzcGFjZVxuICAgICAgICA/IGVzY2FwZWRcbiAgICAgICAgOiBoaWdoIDwgMFxuICAgICAgICAgICAgPyAvLyBCTVAgY29kZXBvaW50XG4gICAgICAgICAgICAgICAgU3RyaW5nLmZyb21DaGFyQ29kZShoaWdoICsgMHgxMDAwMClcbiAgICAgICAgICAgIDogLy8gU3VwcGxlbWVudGFsIFBsYW5lIGNvZGVwb2ludCAoc3Vycm9nYXRlIHBhaXIpXG4gICAgICAgICAgICAgICAgU3RyaW5nLmZyb21DaGFyQ29kZSgoaGlnaCA+PiAxMCkgfCAweGQ4MDAsIChoaWdoICYgMHgzZmYpIHwgMHhkYzAwKTtcbn1cbmZ1bmN0aW9uIHVuZXNjYXBlQ1NTKHN0cikge1xuICAgIHJldHVybiBzdHIucmVwbGFjZShyZUVzY2FwZSwgZnVuZXNjYXBlKTtcbn1cbmZ1bmN0aW9uIGlzV2hpdGVzcGFjZShjKSB7XG4gICAgcmV0dXJuIGMgPT09IFwiIFwiIHx8IGMgPT09IFwiXFxuXCIgfHwgYyA9PT0gXCJcXHRcIiB8fCBjID09PSBcIlxcZlwiIHx8IGMgPT09IFwiXFxyXCI7XG59XG4vKipcbiAqIFBhcnNlcyBgc2VsZWN0b3JgLCBvcHRpb25hbGx5IHdpdGggdGhlIHBhc3NlZCBgb3B0aW9uc2AuXG4gKlxuICogQHBhcmFtIHNlbGVjdG9yIFNlbGVjdG9yIHRvIHBhcnNlLlxuICogQHBhcmFtIG9wdGlvbnMgT3B0aW9ucyBmb3IgcGFyc2luZy5cbiAqIEByZXR1cm5zIFJldHVybnMgYSB0d28tZGltZW5zaW9uYWwgYXJyYXkuXG4gKiBUaGUgZmlyc3QgZGltZW5zaW9uIHJlcHJlc2VudHMgc2VsZWN0b3JzIHNlcGFyYXRlZCBieSBjb21tYXMgKGVnLiBgc3ViMSwgc3ViMmApLFxuICogdGhlIHNlY29uZCBjb250YWlucyB0aGUgcmVsZXZhbnQgdG9rZW5zIGZvciB0aGF0IHNlbGVjdG9yLlxuICovXG5mdW5jdGlvbiBwYXJzZShzZWxlY3Rvciwgb3B0aW9ucykge1xuICAgIHZhciBzdWJzZWxlY3RzID0gW107XG4gICAgdmFyIGVuZEluZGV4ID0gcGFyc2VTZWxlY3RvcihzdWJzZWxlY3RzLCBcIlwiICsgc2VsZWN0b3IsIG9wdGlvbnMsIDApO1xuICAgIGlmIChlbmRJbmRleCA8IHNlbGVjdG9yLmxlbmd0aCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJVbm1hdGNoZWQgc2VsZWN0b3I6IFwiICsgc2VsZWN0b3Iuc2xpY2UoZW5kSW5kZXgpKTtcbiAgICB9XG4gICAgcmV0dXJuIHN1YnNlbGVjdHM7XG59XG5leHBvcnRzLmRlZmF1bHQgPSBwYXJzZTtcbmZ1bmN0aW9uIHBhcnNlU2VsZWN0b3Ioc3Vic2VsZWN0cywgc2VsZWN0b3IsIG9wdGlvbnMsIHNlbGVjdG9ySW5kZXgpIHtcbiAgICB2YXIgX2EsIF9iO1xuICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsgb3B0aW9ucyA9IHt9OyB9XG4gICAgdmFyIHRva2VucyA9IFtdO1xuICAgIHZhciBzYXdXUyA9IGZhbHNlO1xuICAgIGZ1bmN0aW9uIGdldE5hbWUob2Zmc2V0KSB7XG4gICAgICAgIHZhciBtYXRjaCA9IHNlbGVjdG9yLnNsaWNlKHNlbGVjdG9ySW5kZXggKyBvZmZzZXQpLm1hdGNoKHJlTmFtZSk7XG4gICAgICAgIGlmICghbWF0Y2gpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkV4cGVjdGVkIG5hbWUsIGZvdW5kIFwiICsgc2VsZWN0b3Iuc2xpY2Uoc2VsZWN0b3JJbmRleCkpO1xuICAgICAgICB9XG4gICAgICAgIHZhciBuYW1lID0gbWF0Y2hbMF07XG4gICAgICAgIHNlbGVjdG9ySW5kZXggKz0gb2Zmc2V0ICsgbmFtZS5sZW5ndGg7XG4gICAgICAgIHJldHVybiB1bmVzY2FwZUNTUyhuYW1lKTtcbiAgICB9XG4gICAgZnVuY3Rpb24gc3RyaXBXaGl0ZXNwYWNlKG9mZnNldCkge1xuICAgICAgICB3aGlsZSAoaXNXaGl0ZXNwYWNlKHNlbGVjdG9yLmNoYXJBdChzZWxlY3RvckluZGV4ICsgb2Zmc2V0KSkpXG4gICAgICAgICAgICBvZmZzZXQrKztcbiAgICAgICAgc2VsZWN0b3JJbmRleCArPSBvZmZzZXQ7XG4gICAgfVxuICAgIGZ1bmN0aW9uIGlzRXNjYXBlZChwb3MpIHtcbiAgICAgICAgdmFyIHNsYXNoQ291bnQgPSAwO1xuICAgICAgICB3aGlsZSAoc2VsZWN0b3IuY2hhckF0KC0tcG9zKSA9PT0gXCJcXFxcXCIpXG4gICAgICAgICAgICBzbGFzaENvdW50Kys7XG4gICAgICAgIHJldHVybiAoc2xhc2hDb3VudCAmIDEpID09PSAxO1xuICAgIH1cbiAgICBmdW5jdGlvbiBlbnN1cmVOb3RUcmF2ZXJzYWwoKSB7XG4gICAgICAgIGlmICh0b2tlbnMubGVuZ3RoID4gMCAmJiBpc1RyYXZlcnNhbCh0b2tlbnNbdG9rZW5zLmxlbmd0aCAtIDFdKSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRGlkIG5vdCBleHBlY3Qgc3VjY2Vzc2l2ZSB0cmF2ZXJzYWxzLlwiKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBzdHJpcFdoaXRlc3BhY2UoMCk7XG4gICAgd2hpbGUgKHNlbGVjdG9yICE9PSBcIlwiKSB7XG4gICAgICAgIHZhciBmaXJzdENoYXIgPSBzZWxlY3Rvci5jaGFyQXQoc2VsZWN0b3JJbmRleCk7XG4gICAgICAgIGlmIChpc1doaXRlc3BhY2UoZmlyc3RDaGFyKSkge1xuICAgICAgICAgICAgc2F3V1MgPSB0cnVlO1xuICAgICAgICAgICAgc3RyaXBXaGl0ZXNwYWNlKDEpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGZpcnN0Q2hhciBpbiBUcmF2ZXJzYWxzKSB7XG4gICAgICAgICAgICBlbnN1cmVOb3RUcmF2ZXJzYWwoKTtcbiAgICAgICAgICAgIHRva2Vucy5wdXNoKHsgdHlwZTogVHJhdmVyc2Fsc1tmaXJzdENoYXJdIH0pO1xuICAgICAgICAgICAgc2F3V1MgPSBmYWxzZTtcbiAgICAgICAgICAgIHN0cmlwV2hpdGVzcGFjZSgxKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChmaXJzdENoYXIgPT09IFwiLFwiKSB7XG4gICAgICAgICAgICBpZiAodG9rZW5zLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkVtcHR5IHN1Yi1zZWxlY3RvclwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHN1YnNlbGVjdHMucHVzaCh0b2tlbnMpO1xuICAgICAgICAgICAgdG9rZW5zID0gW107XG4gICAgICAgICAgICBzYXdXUyA9IGZhbHNlO1xuICAgICAgICAgICAgc3RyaXBXaGl0ZXNwYWNlKDEpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgaWYgKHNhd1dTKSB7XG4gICAgICAgICAgICAgICAgZW5zdXJlTm90VHJhdmVyc2FsKCk7XG4gICAgICAgICAgICAgICAgdG9rZW5zLnB1c2goeyB0eXBlOiBcImRlc2NlbmRhbnRcIiB9KTtcbiAgICAgICAgICAgICAgICBzYXdXUyA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGZpcnN0Q2hhciBpbiBhdHRyaWJTZWxlY3RvcnMpIHtcbiAgICAgICAgICAgICAgICB2YXIgX2MgPSBhdHRyaWJTZWxlY3RvcnNbZmlyc3RDaGFyXSwgbmFtZV8xID0gX2NbMF0sIGFjdGlvbiA9IF9jWzFdO1xuICAgICAgICAgICAgICAgIHRva2Vucy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJhdHRyaWJ1dGVcIixcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogbmFtZV8xLFxuICAgICAgICAgICAgICAgICAgICBhY3Rpb246IGFjdGlvbixcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGdldE5hbWUoMSksXG4gICAgICAgICAgICAgICAgICAgIGlnbm9yZUNhc2U6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICBuYW1lc3BhY2U6IG51bGwsXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChmaXJzdENoYXIgPT09IFwiW1wiKSB7XG4gICAgICAgICAgICAgICAgdmFyIGF0dHJpYnV0ZU1hdGNoID0gc2VsZWN0b3JcbiAgICAgICAgICAgICAgICAgICAgLnNsaWNlKHNlbGVjdG9ySW5kZXggKyAxKVxuICAgICAgICAgICAgICAgICAgICAubWF0Y2gocmVBdHRyKTtcbiAgICAgICAgICAgICAgICBpZiAoIWF0dHJpYnV0ZU1hdGNoKSB7XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIk1hbGZvcm1lZCBhdHRyaWJ1dGUgc2VsZWN0b3I6IFwiICsgc2VsZWN0b3Iuc2xpY2Uoc2VsZWN0b3JJbmRleCkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB2YXIgY29tcGxldGVTZWxlY3RvciA9IGF0dHJpYnV0ZU1hdGNoWzBdLCBfZCA9IGF0dHJpYnV0ZU1hdGNoWzFdLCBuYW1lc3BhY2UgPSBfZCA9PT0gdm9pZCAwID8gbnVsbCA6IF9kLCBiYXNlTmFtZSA9IGF0dHJpYnV0ZU1hdGNoWzJdLCBhY3Rpb25UeXBlID0gYXR0cmlidXRlTWF0Y2hbM10sIF9lID0gYXR0cmlidXRlTWF0Y2hbNV0sIHF1b3RlZFZhbHVlID0gX2UgPT09IHZvaWQgMCA/IFwiXCIgOiBfZSwgX2YgPSBhdHRyaWJ1dGVNYXRjaFs2XSwgdmFsdWUgPSBfZiA9PT0gdm9pZCAwID8gcXVvdGVkVmFsdWUgOiBfZiwgaWdub3JlQ2FzZSA9IGF0dHJpYnV0ZU1hdGNoWzddO1xuICAgICAgICAgICAgICAgIHNlbGVjdG9ySW5kZXggKz0gY29tcGxldGVTZWxlY3Rvci5sZW5ndGggKyAxO1xuICAgICAgICAgICAgICAgIHZhciBuYW1lXzIgPSB1bmVzY2FwZUNTUyhiYXNlTmFtZSk7XG4gICAgICAgICAgICAgICAgaWYgKChfYSA9IG9wdGlvbnMubG93ZXJDYXNlQXR0cmlidXRlTmFtZXMpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6ICFvcHRpb25zLnhtbE1vZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgbmFtZV8yID0gbmFtZV8yLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRva2Vucy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJhdHRyaWJ1dGVcIixcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogbmFtZV8yLFxuICAgICAgICAgICAgICAgICAgICBhY3Rpb246IGFjdGlvblR5cGVzW2FjdGlvblR5cGVdLFxuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogdW5lc2NhcGVDU1ModmFsdWUpLFxuICAgICAgICAgICAgICAgICAgICBuYW1lc3BhY2U6IG5hbWVzcGFjZSxcbiAgICAgICAgICAgICAgICAgICAgaWdub3JlQ2FzZTogISFpZ25vcmVDYXNlLFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoZmlyc3RDaGFyID09PSBcIjpcIikge1xuICAgICAgICAgICAgICAgIGlmIChzZWxlY3Rvci5jaGFyQXQoc2VsZWN0b3JJbmRleCArIDEpID09PSBcIjpcIikge1xuICAgICAgICAgICAgICAgICAgICB0b2tlbnMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcInBzZXVkby1lbGVtZW50XCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBnZXROYW1lKDIpLnRvTG93ZXJDYXNlKCksXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdmFyIG5hbWVfMyA9IGdldE5hbWUoMSkudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICAgICAgICB2YXIgZGF0YSA9IG51bGw7XG4gICAgICAgICAgICAgICAgaWYgKHNlbGVjdG9yLmNoYXJBdChzZWxlY3RvckluZGV4KSA9PT0gXCIoXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHVucGFja1BzZXVkb3MuaGFzKG5hbWVfMykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChxdW90ZXMuaGFzKHNlbGVjdG9yLmNoYXJBdChzZWxlY3RvckluZGV4ICsgMSkpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiUHNldWRvLXNlbGVjdG9yIFwiICsgbmFtZV8zICsgXCIgY2Fubm90IGJlIHF1b3RlZFwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdG9ySW5kZXggPSBwYXJzZVNlbGVjdG9yKGRhdGEsIHNlbGVjdG9yLCBvcHRpb25zLCBzZWxlY3RvckluZGV4ICsgMSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2VsZWN0b3IuY2hhckF0KHNlbGVjdG9ySW5kZXgpICE9PSBcIilcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIk1pc3NpbmcgY2xvc2luZyBwYXJlbnRoZXNpcyBpbiA6XCIgKyBuYW1lXzMgKyBcIiAoXCIgKyBzZWxlY3RvciArIFwiKVwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdG9ySW5kZXggKz0gMTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdG9ySW5kZXggKz0gMTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzdGFydCA9IHNlbGVjdG9ySW5kZXg7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgY291bnRlciA9IDE7XG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKDsgY291bnRlciA+IDAgJiYgc2VsZWN0b3JJbmRleCA8IHNlbGVjdG9yLmxlbmd0aDsgc2VsZWN0b3JJbmRleCsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNlbGVjdG9yLmNoYXJBdChzZWxlY3RvckluZGV4KSA9PT0gXCIoXCIgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIWlzRXNjYXBlZChzZWxlY3RvckluZGV4KSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3VudGVyKys7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHNlbGVjdG9yLmNoYXJBdChzZWxlY3RvckluZGV4KSA9PT0gXCIpXCIgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIWlzRXNjYXBlZChzZWxlY3RvckluZGV4KSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3VudGVyLS07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvdW50ZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJQYXJlbnRoZXNpcyBub3QgbWF0Y2hlZFwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEgPSBzZWxlY3Rvci5zbGljZShzdGFydCwgc2VsZWN0b3JJbmRleCAtIDEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN0cmlwUXVvdGVzRnJvbVBzZXVkb3MuaGFzKG5hbWVfMykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcXVvdCA9IGRhdGEuY2hhckF0KDApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChxdW90ID09PSBkYXRhLnNsaWNlKC0xKSAmJiBxdW90ZXMuaGFzKHF1b3QpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGEgPSBkYXRhLnNsaWNlKDEsIC0xKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YSA9IHVuZXNjYXBlQ1NTKGRhdGEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRva2Vucy5wdXNoKHsgdHlwZTogXCJwc2V1ZG9cIiwgbmFtZTogbmFtZV8zLCBkYXRhOiBkYXRhIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdmFyIG5hbWVzcGFjZSA9IG51bGw7XG4gICAgICAgICAgICAgICAgdmFyIG5hbWVfNCA9IHZvaWQgMDtcbiAgICAgICAgICAgICAgICBpZiAoZmlyc3RDaGFyID09PSBcIipcIikge1xuICAgICAgICAgICAgICAgICAgICBzZWxlY3RvckluZGV4ICs9IDE7XG4gICAgICAgICAgICAgICAgICAgIG5hbWVfNCA9IFwiKlwiO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmIChyZU5hbWUudGVzdChzZWxlY3Rvci5zbGljZShzZWxlY3RvckluZGV4KSkpIHtcbiAgICAgICAgICAgICAgICAgICAgbmFtZV80ID0gZ2V0TmFtZSgwKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIC8qXG4gICAgICAgICAgICAgICAgICAgICAqIFdlIGhhdmUgZmluaXNoZWQgcGFyc2luZyB0aGUgc2VsZWN0b3IuXG4gICAgICAgICAgICAgICAgICAgICAqIFJlbW92ZSBkZXNjZW5kYW50IHRva2VucyBhdCB0aGUgZW5kIGlmIHRoZXkgZXhpc3QsXG4gICAgICAgICAgICAgICAgICAgICAqIGFuZCByZXR1cm4gdGhlIGxhc3QgaW5kZXgsIHNvIHRoYXQgcGFyc2luZyBjYW4gYmVcbiAgICAgICAgICAgICAgICAgICAgICogcGlja2VkIHVwIGZyb20gaGVyZS5cbiAgICAgICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgICAgIGlmICh0b2tlbnMubGVuZ3RoICYmXG4gICAgICAgICAgICAgICAgICAgICAgICB0b2tlbnNbdG9rZW5zLmxlbmd0aCAtIDFdLnR5cGUgPT09IFwiZGVzY2VuZGFudFwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0b2tlbnMucG9wKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgYWRkVG9rZW4oc3Vic2VsZWN0cywgdG9rZW5zKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGVjdG9ySW5kZXg7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChzZWxlY3Rvci5jaGFyQXQoc2VsZWN0b3JJbmRleCkgPT09IFwifFwiKSB7XG4gICAgICAgICAgICAgICAgICAgIG5hbWVzcGFjZSA9IG5hbWVfNDtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNlbGVjdG9yLmNoYXJBdChzZWxlY3RvckluZGV4ICsgMSkgPT09IFwiKlwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lXzQgPSBcIipcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdG9ySW5kZXggKz0gMjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWVfNCA9IGdldE5hbWUoMSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKG5hbWVfNCA9PT0gXCIqXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgdG9rZW5zLnB1c2goeyB0eXBlOiBcInVuaXZlcnNhbFwiLCBuYW1lc3BhY2U6IG5hbWVzcGFjZSB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICgoX2IgPSBvcHRpb25zLmxvd2VyQ2FzZVRhZ3MpICE9PSBudWxsICYmIF9iICE9PSB2b2lkIDAgPyBfYiA6ICFvcHRpb25zLnhtbE1vZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWVfNCA9IG5hbWVfNC50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHRva2Vucy5wdXNoKHsgdHlwZTogXCJ0YWdcIiwgbmFtZTogbmFtZV80LCBuYW1lc3BhY2U6IG5hbWVzcGFjZSB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgYWRkVG9rZW4oc3Vic2VsZWN0cywgdG9rZW5zKTtcbiAgICByZXR1cm4gc2VsZWN0b3JJbmRleDtcbn1cbmZ1bmN0aW9uIGFkZFRva2VuKHN1YnNlbGVjdHMsIHRva2Vucykge1xuICAgIGlmIChzdWJzZWxlY3RzLmxlbmd0aCA+IDAgJiYgdG9rZW5zLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJFbXB0eSBzdWItc2VsZWN0b3JcIik7XG4gICAgfVxuICAgIHN1YnNlbGVjdHMucHVzaCh0b2tlbnMpO1xufVxuIl19