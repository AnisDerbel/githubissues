{"version":3,"sources":["helpers.js"],"names":["Object","defineProperty","exports","value","composeProviders","applyProviders","coalesceProviders","DYNAMIC_PROVIDER","_lodash","_interopRequireDefault","require","_lodash2","_provideValue","_helpers","_parseEffect","_object","obj","__esModule","default","isDynamicallyProvidedValue","providers","effect","next","i","l","length","provider","result","NEXT","providerFns","collected","addToCollected","key","push","forEach","providersObject","Array","isArray","expectedEffect","providedValue","parsedEffect","comparer","isPartialMatcher","providerKey","actualEffect","pass","fn","keys","mapValues"],"mappings":"AAAA;;;;;;;;AAEAA,MAAM,CAACC,cAAP,CAAsBC,OAAtB,EAA+B,YAA/B,EAA6C;AAC3CC,EAAAA,KAAK,EAAE;AADoC,CAA7C;AAGAD,OAAO,CAACE,gBAAR,GAA2BA,gBAA3B;AACAF,OAAO,CAACG,cAAR,GAAyBA,cAAzB;AACAH,OAAO,CAACI,iBAAR,GAA4BA,iBAA5B;AACAJ,OAAO,CAACK,gBAAR,GAA2B,KAAK,CAAhC;;AAEA,IAAIC,OAAO,GAAGC,sBAAsB,CAACC,OAAO,CAAC,gBAAD,CAAR,CAApC;;AAEA,IAAIC,QAAQ,GAAGF,sBAAsB,CAACC,OAAO,CAAC,gBAAD,CAAR,CAArC;;AAEA,IAAIE,aAAa,GAAGF,OAAO,CAAC,iBAAD,CAA3B;;AAEA,IAAIG,QAAQ,GAAGH,OAAO,CAAC,qBAAD,CAAtB;;AAEA,IAAII,YAAY,GAAGL,sBAAsB,CAACC,OAAO,CAAC,gBAAD,CAAR,CAAzC;;AAEA,IAAIK,OAAO,GAAGL,OAAO,CAAC,oBAAD,CAArB;;AAEA,SAASD,sBAAT,CAAgCO,GAAhC,EAAqC;AAAE,SAAOA,GAAG,IAAIA,GAAG,CAACC,UAAX,GAAwBD,GAAxB,GAA8B;AAAEE,IAAAA,OAAO,EAAEF;AAAX,GAArC;AAAwD;;AAE/F,IAAMT,gBAAgB,GAAG,yCAAzB;AACAL,OAAO,CAACK,gBAAR,GAA2BA,gBAA3B;;AAEA,SAASY,0BAAT,CAAoChB,KAApC,EAA2C;AACzC,SAAO,CAAC,CAACA,KAAF,IAAW,OAAOA,KAAP,KAAiB,QAA5B,IAAwCI,gBAAgB,IAAIJ,KAAnE;AACD;;AAED,SAASC,gBAAT,GAAwC;AAAA,oCAAXgB,SAAW;AAAXA,IAAAA,SAAW;AAAA;;AACtC,SAAO,UAACC,MAAD,EAASC,IAAT,EAAkB;AACvB,SAAK,IAAIC,CAAC,GAAG,CAAR,EAAWC,CAAC,GAAGJ,SAAS,CAACK,MAA9B,EAAsCF,CAAC,GAAGC,CAA1C,EAA6CD,CAAC,EAA9C,EAAkD;AAChD,UAAMG,QAAQ,GAAGN,SAAS,CAACG,CAAD,CAA1B;AACA,UAAMI,MAAM,GAAGD,QAAQ,CAACL,MAAD,EAASC,IAAT,CAAvB;;AAEA,UAAIK,MAAM,KAAKf,aAAa,CAACgB,IAA7B,EAAmC;AACjC,eAAOD,MAAP;AACD;AACF;;AAED,WAAOf,aAAa,CAACgB,IAArB;AACD,GAXD;AAYD;;AAED,SAASvB,cAAT,CAAwBwB,WAAxB,EAAqC;AACnC,SAAOzB,gBAAgB,MAAhB,0CAAoByB,WAApB,EAAP;AACD;;AAED,SAASvB,iBAAT,CAA2Bc,SAA3B,EAAsC;AACpC,MAAMU,SAAS,GAAG,EAAlB;;AAEA,WAASC,cAAT,CAAwBC,GAAxB,EAA6B7B,KAA7B,EAAoC;AAClC,QAAI6B,GAAG,IAAIF,SAAX,EAAsB;AACpBA,MAAAA,SAAS,CAACE,GAAD,CAAT,CAAeC,IAAf,CAAoB9B,KAApB;AACD,KAFD,MAEO;AACL2B,MAAAA,SAAS,CAACE,GAAD,CAAT,GAAiB,CAAC7B,KAAD,CAAjB;AACD;AACF;;AAEDiB,EAAAA,SAAS,CAACc,OAAV,CAAkB,UAAAC,eAAe,EAAI;AACnC,QAAIC,KAAK,CAACC,OAAN,CAAcF,eAAd,CAAJ,EAAoC;AAAA,0DACMA,eADN;AAAA,UAC3BG,cAD2B;AAAA,UACXC,aADW;;AAElC,UAAIC,YAAJ;AACA,UAAIC,QAAJ;;AAEA,UAAI,CAAC,GAAG5B,QAAQ,CAAC6B,gBAAb,EAA+BJ,cAA/B,CAAJ,EAAoD;AAClDE,QAAAA,YAAY,GAAGF,cAAf;AACAG,QAAAA,QAAQ,GAAG9B,QAAQ,CAACO,OAApB;AACD,OAHD,MAGO;AACLsB,QAAAA,YAAY,GAAG,CAAC,GAAG1B,YAAY,CAACI,OAAjB,EAA0BoB,cAA1B,CAAf;AACAG,QAAAA,QAAQ,GAAGjC,OAAO,CAACU,OAAnB;AACD;;AAED,UAAIsB,YAAY,CAACG,WAAb,IAA4BH,YAAY,CAACnB,MAA7C,EAAqD;AACnDU,QAAAA,cAAc,CAACS,YAAY,CAACG,WAAd,EAA2B,UAACC,YAAD,EAAetB,IAAf,EAAwB;AAC/D,cAAMuB,IAAI,GAAGJ,QAAQ,CAACG,YAAD,EAAeJ,YAAY,CAACnB,MAA5B,CAArB;;AAEA,cAAIF,0BAA0B,CAACoB,aAAD,CAA1B,IAA6CM,IAAjD,EAAuD;AACrD,mBAAON,aAAa,CAACO,EAAd,CAAiBF,YAAjB,EAA+BtB,IAA/B,CAAP;AACD;;AAED,iBAAOuB,IAAI,GAAGN,aAAH,GAAmBjB,IAAI,EAAlC;AACD,SARa,CAAd;AASD;AACF,KAxBD,MAwBO;AACLtB,MAAAA,MAAM,CAAC+C,IAAP,CAAYZ,eAAZ,EAA6BD,OAA7B,CAAqC,UAAAS,WAAW,EAAI;AAElD,YAAMjB,QAAQ,GAAGS,eAAe,CAACQ,WAAD,CAAhC;AACAZ,QAAAA,cAAc,CAACY,WAAD,EAAcjB,QAAd,CAAd;AACD,OAJD;AAKD;AACF,GAhCD;AAiCA,SAAO,CAAC,GAAGX,OAAO,CAACiC,SAAZ,EAAuBlB,SAAvB,EAAkCzB,cAAlC,CAAP;AACD","sourcesContent":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.composeProviders = composeProviders;\nexports.applyProviders = applyProviders;\nexports.coalesceProviders = coalesceProviders;\nexports.DYNAMIC_PROVIDER = void 0;\n\nvar _lodash = _interopRequireDefault(require(\"lodash.isequal\"));\n\nvar _lodash2 = _interopRequireDefault(require(\"lodash.ismatch\"));\n\nvar _provideValue = require(\"../provideValue\");\n\nvar _helpers = require(\"../matchers/helpers\");\n\nvar _parseEffect = _interopRequireDefault(require(\"../parseEffect\"));\n\nvar _object = require(\"../../utils/object\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nconst DYNAMIC_PROVIDER = '@@redux-saga-test-plan/dynamic-provider';\nexports.DYNAMIC_PROVIDER = DYNAMIC_PROVIDER;\n\nfunction isDynamicallyProvidedValue(value) {\n  return !!value && typeof value === 'object' && DYNAMIC_PROVIDER in value;\n}\n\nfunction composeProviders(...providers) {\n  return (effect, next) => {\n    for (let i = 0, l = providers.length; i < l; i++) {\n      const provider = providers[i];\n      const result = provider(effect, next);\n\n      if (result !== _provideValue.NEXT) {\n        return result;\n      }\n    }\n\n    return _provideValue.NEXT;\n  };\n}\n\nfunction applyProviders(providerFns) {\n  return composeProviders(...providerFns);\n}\n\nfunction coalesceProviders(providers) {\n  const collected = {};\n\n  function addToCollected(key, value) {\n    if (key in collected) {\n      collected[key].push(value);\n    } else {\n      collected[key] = [value];\n    }\n  }\n\n  providers.forEach(providersObject => {\n    if (Array.isArray(providersObject)) {\n      const [expectedEffect, providedValue] = providersObject;\n      let parsedEffect;\n      let comparer;\n\n      if ((0, _helpers.isPartialMatcher)(expectedEffect)) {\n        parsedEffect = expectedEffect;\n        comparer = _lodash2.default;\n      } else {\n        parsedEffect = (0, _parseEffect.default)(expectedEffect);\n        comparer = _lodash.default;\n      }\n\n      if (parsedEffect.providerKey && parsedEffect.effect) {\n        addToCollected(parsedEffect.providerKey, (actualEffect, next) => {\n          const pass = comparer(actualEffect, parsedEffect.effect);\n\n          if (isDynamicallyProvidedValue(providedValue) && pass) {\n            return providedValue.fn(actualEffect, next);\n          }\n\n          return pass ? providedValue : next();\n        });\n      }\n    } else {\n      Object.keys(providersObject).forEach(providerKey => {\n        // $FlowFixMe\n        const provider = providersObject[providerKey];\n        addToCollected(providerKey, provider);\n      });\n    }\n  });\n  return (0, _object.mapValues)(collected, applyProviders);\n}"]}