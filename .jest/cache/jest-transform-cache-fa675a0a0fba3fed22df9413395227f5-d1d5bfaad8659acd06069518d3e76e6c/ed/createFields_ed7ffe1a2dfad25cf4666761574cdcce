a0dfe25f37c1ac1b513f28111030f8cf
"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

exports.__esModule = true;
exports["default"] = createFields;

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _inheritsLoose2 = _interopRequireDefault(require("@babel/runtime/helpers/inheritsLoose"));

var _react = require("react");

var _propTypes = _interopRequireDefault(require("prop-types"));

var _invariant = _interopRequireDefault(require("invariant"));

var _get = _interopRequireDefault(require("lodash/get"));

var _ConnectedFields = _interopRequireDefault(require("./ConnectedFields"));

var _shallowCompare = _interopRequireDefault(require("./util/shallowCompare"));

var _plain = _interopRequireDefault(require("./structure/plain"));

var _prefixName = _interopRequireDefault(require("./util/prefixName"));

var _ReduxFormContext = require("./ReduxFormContext");

var _validateComponentProp = _interopRequireDefault(require("./util/validateComponentProp"));

var validateNameProp = function validateNameProp(prop) {
  if (!prop) {
    return new Error('No "names" prop was specified <Fields/>');
  }

  if (!Array.isArray(prop) && !prop._isFieldArray) {
    return new Error('Invalid prop "names" supplied to <Fields/>. Must be either an array of strings or the fields array generated by FieldArray.');
  }
};

var warnAndValidatePropType = _propTypes["default"].oneOfType([_propTypes["default"].func, _propTypes["default"].arrayOf(_propTypes["default"].func), _propTypes["default"].objectOf(_propTypes["default"].oneOfType([_propTypes["default"].func, _propTypes["default"].arrayOf(_propTypes["default"].func)]))]);

var fieldsPropTypes = {
  component: _validateComponentProp["default"],
  format: _propTypes["default"].func,
  parse: _propTypes["default"].func,
  props: _propTypes["default"].object,
  forwardRef: _propTypes["default"].bool,
  validate: warnAndValidatePropType,
  warn: warnAndValidatePropType
};

var getFieldWarnAndValidate = function getFieldWarnAndValidate(prop, name) {
  return Array.isArray(prop) || typeof prop === 'function' ? prop : (0, _get["default"])(prop, name, undefined);
};

function createFields(structure) {
  var ConnectedFields = (0, _ConnectedFields["default"])(structure);

  var Fields = function (_Component) {
    (0, _inheritsLoose2["default"])(Fields, _Component);

    function Fields(props) {
      var _this;

      _this = _Component.call(this, props) || this;
      _this.connected = (0, _react.createRef)();

      if (!props._reduxForm) {
        throw new Error('Fields must be inside a component decorated with reduxForm()');
      }

      var error = validateNameProp(props.names);

      if (error) {
        throw error;
      }

      return _this;
    }

    var _proto = Fields.prototype;

    _proto.shouldComponentUpdate = function shouldComponentUpdate(nextProps) {
      return (0, _shallowCompare["default"])(this, nextProps);
    };

    _proto.componentDidMount = function componentDidMount() {
      this.registerFields(this.props.names);
    };

    _proto.UNSAFE_componentWillReceiveProps = function UNSAFE_componentWillReceiveProps(nextProps) {
      if (!_plain["default"].deepEqual(this.props.names, nextProps.names)) {
        var props = this.props;
        var unregister = props._reduxForm.unregister;
        this.props.names.forEach(function (name) {
          return unregister((0, _prefixName["default"])(props, name));
        });
        this.registerFields(nextProps.names);
      }
    };

    _proto.componentWillUnmount = function componentWillUnmount() {
      var props = this.props;
      var unregister = props._reduxForm.unregister;
      this.props.names.forEach(function (name) {
        return unregister((0, _prefixName["default"])(props, name));
      });
    };

    _proto.registerFields = function registerFields(names) {
      var _this2 = this;

      var props = this.props;
      var register = props._reduxForm.register;
      names.forEach(function (name) {
        return register((0, _prefixName["default"])(props, name), 'Field', function () {
          return getFieldWarnAndValidate(_this2.props.validate, name);
        }, function () {
          return getFieldWarnAndValidate(_this2.props.warn, name);
        });
      });
    };

    _proto.getRenderedComponent = function getRenderedComponent() {
      (0, _invariant["default"])(this.props.forwardRef, 'If you want to access getRenderedComponent(), ' + 'you must specify a forwardRef prop to Fields');
      return this.connected.current ? this.connected.current.getRenderedComponent() : null;
    };

    _proto.render = function render() {
      var props = this.props;
      return (0, _react.createElement)(ConnectedFields, (0, _extends2["default"])({}, this.props, {
        names: this.props.names.map(function (name) {
          return (0, _prefixName["default"])(props, name);
        }),
        ref: this.connected
      }));
    };

    (0, _createClass2["default"])(Fields, [{
      key: "names",
      get: function get() {
        var props = this.props;
        return this.props.names.map(function (name) {
          return (0, _prefixName["default"])(props, name);
        });
      }
    }, {
      key: "dirty",
      get: function get() {
        return this.connected.current ? this.connected.current.isDirty() : false;
      }
    }, {
      key: "pristine",
      get: function get() {
        return !this.dirty;
      }
    }, {
      key: "values",
      get: function get() {
        return this.connected.current ? this.connected.current.getValues() : {};
      }
    }]);
    return Fields;
  }(_react.Component);

  Fields.propTypes = (0, _extends2["default"])({
    names: function names(props, propName) {
      return validateNameProp(props[propName]);
    }
  }, fieldsPropTypes);
  return (0, _ReduxFormContext.withReduxForm)(Fields);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNyZWF0ZUZpZWxkcy5qcyJdLCJuYW1lcyI6WyJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsImV4cG9ydHMiLCJfX2VzTW9kdWxlIiwiY3JlYXRlRmllbGRzIiwiX2V4dGVuZHMyIiwiX2NyZWF0ZUNsYXNzMiIsIl9pbmhlcml0c0xvb3NlMiIsIl9yZWFjdCIsIl9wcm9wVHlwZXMiLCJfaW52YXJpYW50IiwiX2dldCIsIl9Db25uZWN0ZWRGaWVsZHMiLCJfc2hhbGxvd0NvbXBhcmUiLCJfcGxhaW4iLCJfcHJlZml4TmFtZSIsIl9SZWR1eEZvcm1Db250ZXh0IiwiX3ZhbGlkYXRlQ29tcG9uZW50UHJvcCIsInZhbGlkYXRlTmFtZVByb3AiLCJwcm9wIiwiRXJyb3IiLCJBcnJheSIsImlzQXJyYXkiLCJfaXNGaWVsZEFycmF5Iiwid2FybkFuZFZhbGlkYXRlUHJvcFR5cGUiLCJvbmVPZlR5cGUiLCJmdW5jIiwiYXJyYXlPZiIsIm9iamVjdE9mIiwiZmllbGRzUHJvcFR5cGVzIiwiY29tcG9uZW50IiwiZm9ybWF0IiwicGFyc2UiLCJwcm9wcyIsIm9iamVjdCIsImZvcndhcmRSZWYiLCJib29sIiwidmFsaWRhdGUiLCJ3YXJuIiwiZ2V0RmllbGRXYXJuQW5kVmFsaWRhdGUiLCJuYW1lIiwidW5kZWZpbmVkIiwic3RydWN0dXJlIiwiQ29ubmVjdGVkRmllbGRzIiwiRmllbGRzIiwiX0NvbXBvbmVudCIsIl90aGlzIiwiY2FsbCIsImNvbm5lY3RlZCIsImNyZWF0ZVJlZiIsIl9yZWR1eEZvcm0iLCJlcnJvciIsIm5hbWVzIiwiX3Byb3RvIiwicHJvdG90eXBlIiwic2hvdWxkQ29tcG9uZW50VXBkYXRlIiwibmV4dFByb3BzIiwiY29tcG9uZW50RGlkTW91bnQiLCJyZWdpc3RlckZpZWxkcyIsIlVOU0FGRV9jb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzIiwiZGVlcEVxdWFsIiwidW5yZWdpc3RlciIsImZvckVhY2giLCJjb21wb25lbnRXaWxsVW5tb3VudCIsIl90aGlzMiIsInJlZ2lzdGVyIiwiZ2V0UmVuZGVyZWRDb21wb25lbnQiLCJjdXJyZW50IiwicmVuZGVyIiwiY3JlYXRlRWxlbWVudCIsIm1hcCIsInJlZiIsImtleSIsImdldCIsImlzRGlydHkiLCJkaXJ0eSIsImdldFZhbHVlcyIsIkNvbXBvbmVudCIsInByb3BUeXBlcyIsInByb3BOYW1lIiwid2l0aFJlZHV4Rm9ybSJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUEsSUFBSUEsc0JBQXNCLEdBQUdDLE9BQU8sQ0FBQyw4Q0FBRCxDQUFwQzs7QUFFQUMsT0FBTyxDQUFDQyxVQUFSLEdBQXFCLElBQXJCO0FBQ0FELE9BQU8sQ0FBQyxTQUFELENBQVAsR0FBcUJFLFlBQXJCOztBQUVBLElBQUlDLFNBQVMsR0FBR0wsc0JBQXNCLENBQUNDLE9BQU8sQ0FBQyxnQ0FBRCxDQUFSLENBQXRDOztBQUVBLElBQUlLLGFBQWEsR0FBR04sc0JBQXNCLENBQUNDLE9BQU8sQ0FBQyxvQ0FBRCxDQUFSLENBQTFDOztBQUVBLElBQUlNLGVBQWUsR0FBR1Asc0JBQXNCLENBQUNDLE9BQU8sQ0FBQyxzQ0FBRCxDQUFSLENBQTVDOztBQUVBLElBQUlPLE1BQU0sR0FBR1AsT0FBTyxDQUFDLE9BQUQsQ0FBcEI7O0FBRUEsSUFBSVEsVUFBVSxHQUFHVCxzQkFBc0IsQ0FBQ0MsT0FBTyxDQUFDLFlBQUQsQ0FBUixDQUF2Qzs7QUFFQSxJQUFJUyxVQUFVLEdBQUdWLHNCQUFzQixDQUFDQyxPQUFPLENBQUMsV0FBRCxDQUFSLENBQXZDOztBQUVBLElBQUlVLElBQUksR0FBR1gsc0JBQXNCLENBQUNDLE9BQU8sQ0FBQyxZQUFELENBQVIsQ0FBakM7O0FBRUEsSUFBSVcsZ0JBQWdCLEdBQUdaLHNCQUFzQixDQUFDQyxPQUFPLENBQUMsbUJBQUQsQ0FBUixDQUE3Qzs7QUFFQSxJQUFJWSxlQUFlLEdBQUdiLHNCQUFzQixDQUFDQyxPQUFPLENBQUMsdUJBQUQsQ0FBUixDQUE1Qzs7QUFFQSxJQUFJYSxNQUFNLEdBQUdkLHNC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R3lCLENBMkd4QnBDLE1BQU0sQ0FBQ3FFLFNBM0dpQixDQUExQjs7QUE2R0FqQyxFQUFBQSxNQUFNLENBQUNrQyxTQUFQLEdBQW1CLENBQUMsR0FBR3pFLFNBQVMsQ0FBQyxTQUFELENBQWIsRUFBMEI7QUFDM0MrQyxJQUFBQSxLQUFLLEVBQUUsU0FBU0EsS0FBVCxDQUFlbkIsS0FBZixFQUFzQjhDLFFBQXRCLEVBQWdDO0FBQ3JDLGFBQU83RCxnQkFBZ0IsQ0FBQ2UsS0FBSyxDQUFDOEMsUUFBRCxDQUFOLENBQXZCO0FBQ0Q7QUFIMEMsR0FBMUIsRUFJaEJsRCxlQUpnQixDQUFuQjtBQUtBLFNBQU8sQ0FBQyxHQUFHYixpQkFBaUIsQ0FBQ2dFLGFBQXRCLEVBQXFDcEMsTUFBckMsQ0FBUDtBQUNEIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5cbnZhciBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0ID0gcmVxdWlyZShcIkBiYWJlbC9ydW50aW1lL2hlbHBlcnMvaW50ZXJvcFJlcXVpcmVEZWZhdWx0XCIpO1xuXG5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlO1xuZXhwb3J0c1tcImRlZmF1bHRcIl0gPSBjcmVhdGVGaWVsZHM7XG5cbnZhciBfZXh0ZW5kczIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoXCJAYmFiZWwvcnVudGltZS9oZWxwZXJzL2V4dGVuZHNcIikpO1xuXG52YXIgX2NyZWF0ZUNsYXNzMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZShcIkBiYWJlbC9ydW50aW1lL2hlbHBlcnMvY3JlYXRlQ2xhc3NcIikpO1xuXG52YXIgX2luaGVyaXRzTG9vc2UyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKFwiQGJhYmVsL3J1bnRpbWUvaGVscGVycy9pbmhlcml0c0xvb3NlXCIpKTtcblxudmFyIF9yZWFjdCA9IHJlcXVpcmUoXCJyZWFjdFwiKTtcblxudmFyIF9wcm9wVHlwZXMgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoXCJwcm9wLXR5cGVzXCIpKTtcblxudmFyIF9pbnZhcmlhbnQgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoXCJpbnZhcmlhbnRcIikpO1xuXG52YXIgX2dldCA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZShcImxvZGFzaC9nZXRcIikpO1xuXG52YXIgX0Nvbm5lY3RlZEZpZWxkcyA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZShcIi4vQ29ubmVjdGVkRmllbGRzXCIpKTtcblxudmFyIF9zaGFsbG93Q29tcGFyZSA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZShcIi4vdXRpbC9zaGFsbG93Q29tcGFyZVwiKSk7XG5cbnZhciBfcGxhaW4gPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoXCIuL3N0cnVjdHVyZS9wbGFpblwiKSk7XG5cbnZhciBfcHJlZml4TmFtZSA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZShcIi4vdXRpbC9wcmVmaXhOYW1lXCIpKTtcblxudmFyIF9SZWR1eEZvcm1Db250ZXh0ID0gcmVxdWlyZShcIi4vUmVkdXhGb3JtQ29udGV4dFwiKTtcblxudmFyIF92YWxpZGF0ZUNvbXBvbmVudFByb3AgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoXCIuL3V0aWwvdmFsaWRhdGVDb21wb25lbnRQcm9wXCIpKTtcblxudmFyIHZhbGlkYXRlTmFtZVByb3AgPSBmdW5jdGlvbiB2YWxpZGF0ZU5hbWVQcm9wKHByb3ApIHtcbiAgaWYgKCFwcm9wKSB7XG4gICAgcmV0dXJuIG5ldyBFcnJvcignTm8gXCJuYW1lc1wiIHByb3Agd2FzIHNwZWNpZmllZCA8RmllbGRzLz4nKTtcbiAgfVxuXG4gIGlmICghQXJyYXkuaXNBcnJheShwcm9wKSAmJiAhcHJvcC5faXNGaWVsZEFycmF5KSB7XG4gICAgcmV0dXJuIG5ldyBFcnJvcignSW52YWxpZCBwcm9wIFwibmFtZXNcIiBzdXBwbGllZCB0byA8RmllbGRzLz4uIE11c3QgYmUgZWl0aGVyIGFuIGFycmF5IG9mIHN0cmluZ3Mgb3IgdGhlIGZpZWxkcyBhcnJheSBnZW5lcmF0ZWQgYnkgRmllbGRBcnJheS4nKTtcbiAgfVxufTtcblxudmFyIHdhcm5BbmRWYWxpZGF0ZVByb3BUeXBlID0gX3Byb3BUeXBlc1tcImRlZmF1bHRcIl0ub25lT2ZUeXBlKFtfcHJvcFR5cGVzW1wiZGVmYXVsdFwiXS5mdW5jLCBfcHJvcFR5cGVzW1wiZGVmYXVsdFwiXS5hcnJheU9mKF9wcm9wVHlwZXNbXCJkZWZhdWx0XCJdLmZ1bmMpLCBfcHJvcFR5cGVzW1wiZGVmYXVsdFwiXS5vYmplY3RPZihfcHJvcFR5cGVzW1wiZGVmYXVsdFwiXS5vbmVPZlR5cGUoW19wcm9wVHlwZXNbXCJkZWZhdWx0XCJdLmZ1bmMsIF9wcm9wVHlwZXNbXCJkZWZhdWx0XCJdLmFycmF5T2YoX3Byb3BUeXBlc1tcImRlZmF1bHRcIl0uZnVuYyldKSldKTtcblxudmFyIGZpZWxkc1Byb3BUeXBlcyA9IHtcbiAgY29tcG9uZW50OiBfdmFsaWRhdGVDb21wb25lbnRQcm9wW1wiZGVmYXVsdFwiXSxcbiAgZm9ybWF0OiBfcHJvcFR5cGVzW1wiZGVmYXVsdFwiXS5mdW5jLFxuICBwYXJzZTogX3Byb3BUeXBlc1tcImRlZmF1bHRcIl0uZnVuYyxcbiAgcHJvcHM6IF9wcm9wVHlwZXNbXCJkZWZhdWx0XCJdLm9iamVjdCxcbiAgZm9yd2FyZFJlZjogX3Byb3BUeXBlc1tcImRlZmF1bHRcIl0uYm9vbCxcbiAgdmFsaWRhdGU6IHdhcm5BbmRWYWxpZGF0ZVByb3BUeXBlLFxuICB3YXJuOiB3YXJuQW5kVmFsaWRhdGVQcm9wVHlwZVxufTtcblxudmFyIGdldEZpZWxkV2FybkFuZFZhbGlkYXRlID0gZnVuY3Rpb24gZ2V0RmllbGRXYXJuQW5kVmFsaWRhdGUocHJvcCwgbmFtZSkge1xuICByZXR1cm4gQXJyYXkuaXNBcnJheShwcm9wKSB8fCB0eXBlb2YgcHJvcCA9PT0gJ2Z1bmN0aW9uJyA/IHByb3AgOiAoMCwgX2dldFtcImRlZmF1bHRcIl0pKHByb3AsIG5hbWUsIHVuZGVmaW5lZCk7XG59O1xuXG5mdW5jdGlvbiBjcmVhdGVGaWVsZHMoc3RydWN0dXJlKSB7XG4gIHZhciBDb25uZWN0ZWRGaWVsZHMgPSAoMCwgX0Nvbm5lY3RlZEZpZWxkc1tcImRlZmF1bHRcIl0pKHN0cnVjdHVyZSk7XG5cbiAgdmFyIEZpZWxkcyA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoX0NvbXBvbmVudCkge1xuICAgICgwLCBfaW5oZXJpdHNMb29zZTJbXCJkZWZhdWx0XCJdKShGaWVsZHMsIF9Db21wb25lbnQpO1xuXG4gICAgZnVuY3Rpb24gRmllbGRzKHByb3BzKSB7XG4gICAgICB2YXIgX3RoaXM7XG5cbiAgICAgIF90aGlzID0gX0NvbXBvbmVudC5jYWxsKHRoaXMsIHByb3BzKSB8fCB0aGlzO1xuICAgICAgX3RoaXMuY29ubmVjdGVkID0gKDAsIF9yZWFjdC5jcmVhdGVSZWYpKCk7XG5cbiAgICAgIGlmICghcHJvcHMuX3JlZHV4Rm9ybSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ZpZWxkcyBtdXN0IGJlIGluc2lkZSBhIGNvbXBvbmVudCBkZWNvcmF0ZWQgd2l0aCByZWR1eEZvcm0oKScpO1xuICAgICAgfVxuXG4gICAgICB2YXIgZXJyb3IgPSB2YWxpZGF0ZU5hbWVQcm9wKHByb3BzLm5hbWVzKTtcblxuICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgIHRocm93IGVycm9yO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gX3RoaXM7XG4gICAgfVxuXG4gICAgdmFyIF9wcm90byA9IEZpZWxkcy5wcm90b3R5cGU7XG5cbiAgICBfcHJvdG8uc2hvdWxkQ29tcG9uZW50VXBkYXRlID0gZnVuY3Rpb24gc2hvdWxkQ29tcG9uZW50VXBkYXRlKG5leHRQcm9wcykge1xuICAgICAgcmV0dXJuICgwLCBfc2hhbGxvd0NvbXBhcmVbXCJkZWZhdWx0XCJdKSh0aGlzLCBuZXh0UHJvcHMpO1xuICAgIH07XG5cbiAgICBfcHJvdG8uY29tcG9uZW50RGlkTW91bnQgPSBmdW5jdGlvbiBjb21wb25lbnREaWRNb3VudCgpIHtcbiAgICAgIHRoaXMucmVnaXN0ZXJGaWVsZHModGhpcy5wcm9wcy5uYW1lcyk7XG4gICAgfTtcblxuICAgIF9wcm90by5VTlNBRkVfY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyA9IGZ1bmN0aW9uIFVOU0FGRV9jb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzKG5leHRQcm9wcykge1xuICAgICAgaWYgKCFfcGxhaW5bXCJkZWZhdWx0XCJdLmRlZXBFcXVhbCh0aGlzLnByb3BzLm5hbWVzLCBuZXh0UHJvcHMubmFtZXMpKSB7XG4gICAgICAgIHZhciBwcm9wcyA9IHRoaXMucHJvcHM7XG4gICAgICAgIHZhciB1bnJlZ2lzdGVyID0gcHJvcHMuX3JlZHV4Rm9ybS51bnJlZ2lzdGVyOyAvLyB1bnJlZ2lzdGVyIG9sZCBuYW1lXG5cbiAgICAgICAgdGhpcy5wcm9wcy5uYW1lcy5mb3JFYWNoKGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICAgICAgcmV0dXJuIHVucmVnaXN0ZXIoKDAsIF9wcmVmaXhOYW1lW1wiZGVmYXVsdFwiXSkocHJvcHMsIG5hbWUpKTtcbiAgICAgICAgfSk7IC8vIHJlZ2lzdGVyIG5ldyBuYW1lXG5cbiAgICAgICAgdGhpcy5yZWdpc3RlckZpZWxkcyhuZXh0UHJvcHMubmFtZXMpO1xuICAgICAgfVxuICAgIH07XG5cbiAgICBfcHJvdG8uY29tcG9uZW50V2lsbFVubW91bnQgPSBmdW5jdGlvbiBjb21wb25lbnRXaWxsVW5tb3VudCgpIHtcbiAgICAgIHZhciBwcm9wcyA9IHRoaXMucHJvcHM7XG4gICAgICB2YXIgdW5yZWdpc3RlciA9IHByb3BzLl9yZWR1eEZvcm0udW5yZWdpc3RlcjtcbiAgICAgIHRoaXMucHJvcHMubmFtZXMuZm9yRWFjaChmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICByZXR1cm4gdW5yZWdpc3RlcigoMCwgX3ByZWZpeE5hbWVbXCJkZWZhdWx0XCJdKShwcm9wcywgbmFtZSkpO1xuICAgICAgfSk7XG4gICAgfTtcblxuICAgIF9wcm90by5yZWdpc3RlckZpZWxkcyA9IGZ1bmN0aW9uIHJlZ2lzdGVyRmllbGRzKG5hbWVzKSB7XG4gICAgICB2YXIgX3RoaXMyID0gdGhpcztcblxuICAgICAgdmFyIHByb3BzID0gdGhpcy5wcm9wcztcbiAgICAgIHZhciByZWdpc3RlciA9IHByb3BzLl9yZWR1eEZvcm0ucmVnaXN0ZXI7XG4gICAgICBuYW1lcy5mb3JFYWNoKGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICAgIHJldHVybiByZWdpc3RlcigoMCwgX3ByZWZpeE5hbWVbXCJkZWZhdWx0XCJdKShwcm9wcywgbmFtZSksICdGaWVsZCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICByZXR1cm4gZ2V0RmllbGRXYXJuQW5kVmFsaWRhdGUoX3RoaXMyLnByb3BzLnZhbGlkYXRlLCBuYW1lKTtcbiAgICAgICAgfSwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgIHJldHVybiBnZXRGaWVsZFdhcm5BbmRWYWxpZGF0ZShfdGhpczIucHJvcHMud2FybiwgbmFtZSk7XG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgfTtcblxuICAgIF9wcm90by5nZXRSZW5kZXJlZENvbXBvbmVudCA9IGZ1bmN0aW9uIGdldFJlbmRlcmVkQ29tcG9uZW50KCkge1xuICAgICAgKDAsIF9pbnZhcmlhbnRbXCJkZWZhdWx0XCJdKSh0aGlzLnByb3BzLmZvcndhcmRSZWYsICdJZiB5b3Ugd2FudCB0byBhY2Nlc3MgZ2V0UmVuZGVyZWRDb21wb25lbnQoKSwgJyArICd5b3UgbXVzdCBzcGVjaWZ5IGEgZm9yd2FyZFJlZiBwcm9wIHRvIEZpZWxkcycpO1xuICAgICAgcmV0dXJuIHRoaXMuY29ubmVjdGVkLmN1cnJlbnQgPyB0aGlzLmNvbm5lY3RlZC5jdXJyZW50LmdldFJlbmRlcmVkQ29tcG9uZW50KCkgOiBudWxsO1xuICAgIH07XG5cbiAgICBfcHJvdG8ucmVuZGVyID0gZnVuY3Rpb24gcmVuZGVyKCkge1xuICAgICAgdmFyIHByb3BzID0gdGhpcy5wcm9wcztcbiAgICAgIHJldHVybiAoMCwgX3JlYWN0LmNyZWF0ZUVsZW1lbnQpKENvbm5lY3RlZEZpZWxkcywgKDAsIF9leHRlbmRzMltcImRlZmF1bHRcIl0pKHt9LCB0aGlzLnByb3BzLCB7XG4gICAgICAgIG5hbWVzOiB0aGlzLnByb3BzLm5hbWVzLm1hcChmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICAgIHJldHVybiAoMCwgX3ByZWZpeE5hbWVbXCJkZWZhdWx0XCJdKShwcm9wcywgbmFtZSk7XG4gICAgICAgIH0pLFxuICAgICAgICByZWY6IHRoaXMuY29ubmVjdGVkXG4gICAgICB9KSk7XG4gICAgfTtcblxuICAgICgwLCBfY3JlYXRlQ2xhc3MyW1wiZGVmYXVsdFwiXSkoRmllbGRzLCBbe1xuICAgICAga2V5OiBcIm5hbWVzXCIsXG4gICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHtcbiAgICAgICAgdmFyIHByb3BzID0gdGhpcy5wcm9wcztcbiAgICAgICAgcmV0dXJuIHRoaXMucHJvcHMubmFtZXMubWFwKGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICAgICAgcmV0dXJuICgwLCBfcHJlZml4TmFtZVtcImRlZmF1bHRcIl0pKHByb3BzLCBuYW1lKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSwge1xuICAgICAga2V5OiBcImRpcnR5XCIsXG4gICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY29ubmVjdGVkLmN1cnJlbnQgPyB0aGlzLmNvbm5lY3RlZC5jdXJyZW50LmlzRGlydHkoKSA6IGZhbHNlO1xuICAgICAgfVxuICAgIH0sIHtcbiAgICAgIGtleTogXCJwcmlzdGluZVwiLFxuICAgICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7XG4gICAgICAgIHJldHVybiAhdGhpcy5kaXJ0eTtcbiAgICAgIH1cbiAgICB9LCB7XG4gICAgICBrZXk6IFwidmFsdWVzXCIsXG4gICAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY29ubmVjdGVkLmN1cnJlbnQgPyB0aGlzLmNvbm5lY3RlZC5jdXJyZW50LmdldFZhbHVlcygpIDoge307XG4gICAgICB9XG4gICAgfV0pO1xuICAgIHJldHVybiBGaWVsZHM7XG4gIH0oX3JlYWN0LkNvbXBvbmVudCk7XG5cbiAgRmllbGRzLnByb3BUeXBlcyA9ICgwLCBfZXh0ZW5kczJbXCJkZWZhdWx0XCJdKSh7XG4gICAgbmFtZXM6IGZ1bmN0aW9uIG5hbWVzKHByb3BzLCBwcm9wTmFtZSkge1xuICAgICAgcmV0dXJuIHZhbGlkYXRlTmFtZVByb3AocHJvcHNbcHJvcE5hbWVdKTtcbiAgICB9XG4gIH0sIGZpZWxkc1Byb3BUeXBlcyk7XG4gIHJldHVybiAoMCwgX1JlZHV4Rm9ybUNvbnRleHQud2l0aFJlZHV4Rm9ybSkoRmllbGRzKTtcbn0iXX0=