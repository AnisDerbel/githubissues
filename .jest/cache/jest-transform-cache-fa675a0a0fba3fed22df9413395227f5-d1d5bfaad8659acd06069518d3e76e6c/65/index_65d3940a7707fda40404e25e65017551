b8cd4fefc3aa6ddef94b1f6e7241e69a
'use strict';

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var doctype = require('parse5/lib/common/doctype');

var _require = require('parse5/lib/common/html'),
    DOCUMENT_MODE = _require.DOCUMENT_MODE;

var nodeTypes = {
  element: 1,
  text: 3,
  cdata: 4,
  comment: 8
};
var nodePropertyShorthands = {
  tagName: 'name',
  childNodes: 'children',
  parentNode: 'parent',
  previousSibling: 'prev',
  nextSibling: 'next',
  nodeValue: 'data'
};

var Node = function () {
  function Node(props) {
    (0, _classCallCheck2.default)(this, Node);

    for (var _i = 0, _Object$keys = Object.keys(props); _i < _Object$keys.length; _i++) {
      var key = _Object$keys[_i];
      this[key] = props[key];
    }
  }

  (0, _createClass2.default)(Node, [{
    key: "firstChild",
    get: function get() {
      var children = this.children;
      return children && children[0] || null;
    }
  }, {
    key: "lastChild",
    get: function get() {
      var children = this.children;
      return children && children[children.length - 1] || null;
    }
  }, {
    key: "nodeType",
    get: function get() {
      return nodeTypes[this.type] || nodeTypes.element;
    }
  }]);
  return Node;
}();

Object.keys(nodePropertyShorthands).forEach(function (key) {
  var shorthand = nodePropertyShorthands[key];
  Object.defineProperty(Node.prototype, key, {
    get: function get() {
      return this[shorthand] || null;
    },
    set: function set(val) {
      this[shorthand] = val;
      return val;
    }
  });
});

exports.createDocument = function () {
  return new Node({
    type: 'root',
    name: 'root',
    parent: null,
    prev: null,
    next: null,
    children: [],
    'x-mode': DOCUMENT_MODE.NO_QUIRKS
  });
};

exports.createDocumentFragment = function () {
  return new Node({
    type: 'root',
    name: 'root',
    parent: null,
    prev: null,
    next: null,
    children: []
  });
};

exports.createElement = function (tagName, namespaceURI, attrs) {
  var attribs = Object.create(null);
  var attribsNamespace = Object.create(null);
  var attribsPrefix = Object.create(null);

  for (var i = 0; i < attrs.length; i++) {
    var attrName = attrs[i].name;
    attribs[attrName] = attrs[i].value;
    attribsNamespace[attrName] = attrs[i].namespace;
    attribsPrefix[attrName] = attrs[i].prefix;
  }

  return new Node({
    type: tagName === 'script' || tagName === 'style' ? tagName : 'tag',
    name: tagName,
    namespace: namespaceURI,
    attribs: attribs,
    'x-attribsNamespace': attribsNamespace,
    'x-attribsPrefix': attribsPrefix,
    children: [],
    parent: null,
    prev: null,
    next: null
  });
};

exports.createCommentNode = function (data) {
  return new Node({
    type: 'comment',
    data: data,
    parent: null,
    prev: null,
    next: null
  });
};

var createTextNode = function createTextNode(value) {
  return new Node({
    type: 'text',
    data: value,
    parent: null,
    prev: null,
    next: null
  });
};

var appendChild = exports.appendChild = function (parentNode, newNode) {
  var prev = parentNode.children[parentNode.children.length - 1];

  if (prev) {
    prev.next = newNode;
    newNode.prev = prev;
  }

  parentNode.children.push(newNode);
  newNode.parent = parentNode;
};

var insertBefore = exports.insertBefore = function (parentNode, newNode, referenceNode) {
  var insertionIdx = parentNode.children.indexOf(referenceNode);
  var prev = referenceNode.prev;

  if (prev) {
    prev.next = newNode;
    newNode.prev = prev;
  }

  referenceNode.prev = newNode;
  newNode.next = referenceNode;
  parentNode.children.splice(insertionIdx, 0, newNode);
  newNode.parent = parentNode;
};

exports.setTemplateContent = function (templateElement, contentElement) {
  appendChild(templateElement, contentElement);
};

exports.getTemplateContent = function (templateElement) {
  return templateElement.children[0];
};

exports.setDocumentType = function (document, name, publicId, systemId) {
  var data = doctype.serializeContent(name, publicId, systemId);
  var doctypeNode = null;

  for (var i = 0; i < document.children.length; i++) {
    if (document.children[i].type === 'directive' && document.children[i].name === '!doctype') {
      doctypeNode = document.children[i];
      break;
    }
  }

  if (doctypeNode) {
    doctypeNode.data = data;
    doctypeNode['x-name'] = name;
    doctypeNode['x-publicId'] = publicId;
    doctypeNode['x-systemId'] = systemId;
  } else {
    appendChild(document, new Node({
      type: 'directive',
      name: '!doctype',
      data: data,
      'x-name': name,
      'x-publicId': publicId,
      'x-systemId': systemId
    }));
  }
};

exports.setDocumentMode = function (document, mode) {
  document['x-mode'] = mode;
};

exports.getDocumentMode = function (document) {
  return document['x-mode'];
};

exports.detachNode = function (node) {
  if (node.parent) {
    var idx = node.parent.children.indexOf(node);
    var prev = node.prev;
    var next = node.next;
    node.prev = null;
    node.next = null;

    if (prev) {
      prev.next = next;
    }

    if (next) {
      next.prev = prev;
    }

    node.parent.children.splice(idx, 1);
    node.parent = null;
  }
};

exports.insertText = function (parentNode, text) {
  var lastChild = parentNode.children[parentNode.children.length - 1];

  if (lastChild && lastChild.type === 'text') {
    lastChild.data += text;
  } else {
    appendChild(parentNode, createTextNode(text));
  }
};

exports.insertTextBefore = function (parentNode, text, referenceNode) {
  var prevNode = parentNode.children[parentNode.children.indexOf(referenceNode) - 1];

  if (prevNode && prevNode.type === 'text') {
    prevNode.data += text;
  } else {
    insertBefore(parentNode, createTextNode(text), referenceNode);
  }
};

exports.adoptAttributes = function (recipient, attrs) {
  for (var i = 0; i < attrs.length; i++) {
    var attrName = attrs[i].name;

    if (typeof recipient.attribs[attrName] === 'undefined') {
      recipient.attribs[attrName] = attrs[i].value;
      recipient['x-attribsNamespace'][attrName] = attrs[i].namespace;
      recipient['x-attribsPrefix'][attrName] = attrs[i].prefix;
    }
  }
};

exports.getFirstChild = function (node) {
  return node.children[0];
};

exports.getChildNodes = function (node) {
  return node.children;
};

exports.getParentNode = function (node) {
  return node.parent;
};

exports.getAttrList = function (element) {
  var attrList = [];

  for (var name in element.attribs) {
    attrList.push({
      name: name,
      value: element.attribs[name],
      namespace: element['x-attribsNamespace'][name],
      prefix: element['x-attribsPrefix'][name]
    });
  }

  return attrList;
};

exports.getTagName = function (element) {
  return element.name;
};

exports.getNamespaceURI = function (element) {
  return element.namespace;
};

exports.getTextNodeContent = function (textNode) {
  return textNode.data;
};

exports.getCommentNodeContent = function (commentNode) {
  return commentNode.data;
};

exports.getDocumentTypeNodeName = function (doctypeNode) {
  return doctypeNode['x-name'];
};

exports.getDocumentTypeNodePublicId = function (doctypeNode) {
  return doctypeNode['x-publicId'];
};

exports.getDocumentTypeNodeSystemId = function (doctypeNode) {
  return doctypeNode['x-systemId'];
};

exports.isTextNode = function (node) {
  return node.type === 'text';
};

exports.isCommentNode = function (node) {
  return node.type === 'comment';
};

exports.isDocumentTypeNode = function (node) {
  return node.type === 'directive' && node.name === '!doctype';
};

exports.isElementNode = function (node) {
  return !!node.attribs;
};

exports.setNodeSourceCodeLocation = function (node, location) {
  node.sourceCodeLocation = location;
};

exports.getNodeSourceCodeLocation = function (node) {
  return node.sourceCodeLocation;
};

exports.updateNodeSourceCodeLocation = function (node, endLocation) {
  node.sourceCodeLocation = (0, _extends2.default)(node.sourceCodeLocation, endLocation);
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbImRvY3R5cGUiLCJyZXF1aXJlIiwiRE9DVU1FTlRfTU9ERSIsIm5vZGVUeXBlcyIsImVsZW1lbnQiLCJ0ZXh0IiwiY2RhdGEiLCJjb21tZW50Iiwibm9kZVByb3BlcnR5U2hvcnRoYW5kcyIsInRhZ05hbWUiLCJjaGlsZE5vZGVzIiwicGFyZW50Tm9kZSIsInByZXZpb3VzU2libGluZyIsIm5leHRTaWJsaW5nIiwibm9kZVZhbHVlIiwiTm9kZSIsInByb3BzIiwiT2JqZWN0Iiwia2V5cyIsImtleSIsImNoaWxkcmVuIiwibGVuZ3RoIiwidHlwZSIsImZvckVhY2giLCJzaG9ydGhhbmQiLCJkZWZpbmVQcm9wZXJ0eSIsInByb3RvdHlwZSIsImdldCIsInNldCIsInZhbCIsImV4cG9ydHMiLCJjcmVhdGVEb2N1bWVudCIsIm5hbWUiLCJwYXJlbnQiLCJwcmV2IiwibmV4dCIsIk5PX1FVSVJLUyIsImNyZWF0ZURvY3VtZW50RnJhZ21lbnQiLCJjcmVhdGVFbGVtZW50IiwibmFtZXNwYWNlVVJJIiwiYXR0cnMiLCJhdHRyaWJzIiwiY3JlYXRlIiwiYXR0cmlic05hbWVzcGFjZSIsImF0dHJpYnNQcmVmaXgiLCJpIiwiYXR0ck5hbWUiLCJ2YWx1ZSIsIm5hbWVzcGFjZSIsInByZWZpeCIsImNyZWF0ZUNvbW1lbnROb2RlIiwiZGF0YSIsImNyZWF0ZVRleHROb2RlIiwiYXBwZW5kQ2hpbGQiLCJuZXdOb2RlIiwicHVzaCIsImluc2VydEJlZm9yZSIsInJlZmVyZW5jZU5vZGUiLCJpbnNlcnRpb25JZHgiLCJpbmRleE9mIiwic3BsaWNlIiwic2V0VGVtcGxhdGVDb250ZW50IiwidGVtcGxhdGVFbGVtZW50IiwiY29udGVudEVsZW1lbnQiLCJnZXRUZW1wbGF0ZUNvbnRlbnQiLCJzZXREb2N1bWVudFR5cGUiLCJkb2N1bWVudCIsInB1YmxpY0lkIiwic3lzdGVtSWQiLCJzZXJpYWxpemVDb250ZW50IiwiZG9jdHlwZU5vZGUiLCJzZXREb2N1bWVudE1vZGUiLCJtb2RlIiwiZ2V0RG9jdW1lbnRNb2RlIiwiZGV0YWNoTm9kZSIsIm5vZGUiLCJpZHgiLCJpbnNlcnRUZXh0IiwibGFzdENoaWxkIiwiaW5zZXJ0VGV4dEJlZm9yZSIsInByZXZOb2RlIiwiYWRvcHRBdHRyaWJ1dGVzIiwicmVjaXBpZW50IiwiZ2V0Rmlyc3RDaGlsZCIsImdldENoaWxkTm9kZXMiLCJnZXRQYXJlbnROb2RlIiwiZ2V0QXR0ckxpc3QiLCJhdHRyTGlzdCIsImdldFRhZ05hbWUiLCJnZXROYW1lc3BhY2VVUkkiLCJnZXRUZXh0Tm9kZUNvbnRlbnQiLCJ0ZXh0Tm9kZSIsImdldENvbW1lbnROb2RlQ29udGVudCIsImNvbW1lbnROb2RlIiwiZ2V0RG9jdW1lbnRUeXBlTm9kZU5hbWUiLCJnZXREb2N1bWVudFR5cGVOb2RlUHVibGljSWQiLCJnZXREb2N1bWVudFR5cGVOb2RlU3lzdGVtSWQiLCJpc1RleHROb2RlIiwiaXNDb21tZW50Tm9kZSIsImlzRG9jdW1lbnRUeXBlTm9kZSIsImlzRWxlbWVudE5vZGUiLCJzZXROb2RlU291cmNlQ29kZUxvY2F0aW9uIiwibG9jYXRpb24iLCJzb3VyY2VDb2RlTG9jYXRpb24iLCJnZXROb2RlU291cmNlQ29kZUxvY2F0aW9uIiwidXBkYXRlTm9kZVNvdXJjZUNvZGVMb2NhdGlvbiIsImVuZExvY2F0aW9uIl0sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7Ozs7OztBQUVBLElBQU1BLE9BQU8sR0FBR0MsT0FBTyxDQUFDLDJCQUFELENBQXZCOztlQUMwQkEsT0FBTyxDQUFDLHdCQUFELEM7SUFBekJDLGEsWUFBQUEsYTs7QUFHUixJQUFNQyxTQUFTLEdBQUc7QUFDZEMsRUFBQUEsT0FBTyxFQUFFLENBREs7QUFFZEMsRUFBQUEsSUFBSSxFQUFFLENBRlE7QUFHZEMsRUFBQUEsS0FBSyxFQUFFLENBSE87QUFJZEMsRUFBQUEsT0FBTyxFQUFFO0FBSkssQ0FBbEI7QUFPQSxJQUFNQyxzQkFBc0IsR0FBRztBQUMzQkMsRUFBQUEsT0FB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TyxDQUFDdUUseUJBQVIsR0FBb0MsVUFBUzFCLElBQVQsRUFBZTJCLFFBQWYsRUFBeUI7QUFDekQzQixFQUFBQSxJQUFJLENBQUM0QixrQkFBTCxHQUEwQkQsUUFBMUI7QUFDSCxDQUZEOztBQUlBeEUsT0FBTyxDQUFDMEUseUJBQVIsR0FBb0MsVUFBUzdCLElBQVQsRUFBZTtBQUMvQyxTQUFPQSxJQUFJLENBQUM0QixrQkFBWjtBQUNILENBRkQ7O0FBSUF6RSxPQUFPLENBQUMyRSw0QkFBUixHQUF1QyxVQUFTOUIsSUFBVCxFQUFlK0IsV0FBZixFQUE0QjtBQUMvRC9CLEVBQUFBLElBQUksQ0FBQzRCLGtCQUFMLEdBQTBCLHVCQUFjNUIsSUFBSSxDQUFDNEIsa0JBQW5CLEVBQXVDRyxXQUF2QyxDQUExQjtBQUNILENBRkQiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbmNvbnN0IGRvY3R5cGUgPSByZXF1aXJlKCdwYXJzZTUvbGliL2NvbW1vbi9kb2N0eXBlJyk7XG5jb25zdCB7IERPQ1VNRU5UX01PREUgfSA9IHJlcXVpcmUoJ3BhcnNlNS9saWIvY29tbW9uL2h0bWwnKTtcblxuLy9Db252ZXJzaW9uIHRhYmxlcyBmb3IgRE9NIExldmVsMSBzdHJ1Y3R1cmUgZW11bGF0aW9uXG5jb25zdCBub2RlVHlwZXMgPSB7XG4gICAgZWxlbWVudDogMSxcbiAgICB0ZXh0OiAzLFxuICAgIGNkYXRhOiA0LFxuICAgIGNvbW1lbnQ6IDhcbn07XG5cbmNvbnN0IG5vZGVQcm9wZXJ0eVNob3J0aGFuZHMgPSB7XG4gICAgdGFnTmFtZTogJ25hbWUnLFxuICAgIGNoaWxkTm9kZXM6ICdjaGlsZHJlbicsXG4gICAgcGFyZW50Tm9kZTogJ3BhcmVudCcsXG4gICAgcHJldmlvdXNTaWJsaW5nOiAncHJldicsXG4gICAgbmV4dFNpYmxpbmc6ICduZXh0JyxcbiAgICBub2RlVmFsdWU6ICdkYXRhJ1xufTtcblxuLy9Ob2RlXG5jbGFzcyBOb2RlIHtcbiAgICBjb25zdHJ1Y3Rvcihwcm9wcykge1xuICAgICAgICBmb3IgKGNvbnN0IGtleSBvZiBPYmplY3Qua2V5cyhwcm9wcykpIHtcbiAgICAgICAgICAgIHRoaXNba2V5XSA9IHByb3BzW2tleV07XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBnZXQgZmlyc3RDaGlsZCgpIHtcbiAgICAgICAgY29uc3QgY2hpbGRyZW4gPSB0aGlzLmNoaWxkcmVuO1xuXG4gICAgICAgIHJldHVybiAoY2hpbGRyZW4gJiYgY2hpbGRyZW5bMF0pIHx8IG51bGw7XG4gICAgfVxuXG4gICAgZ2V0IGxhc3RDaGlsZCgpIHtcbiAgICAgICAgY29uc3QgY2hpbGRyZW4gPSB0aGlzLmNoaWxkcmVuO1xuXG4gICAgICAgIHJldHVybiAoY2hpbGRyZW4gJiYgY2hpbGRyZW5bY2hpbGRyZW4ubGVuZ3RoIC0gMV0pIHx8IG51bGw7XG4gICAgfVxuXG4gICAgZ2V0IG5vZGVUeXBlKCkge1xuICAgICAgICByZXR1cm4gbm9kZVR5cGVzW3RoaXMudHlwZV0gfHwgbm9kZVR5cGVzLmVsZW1lbnQ7XG4gICAgfVxufVxuXG5PYmplY3Qua2V5cyhub2RlUHJvcGVydHlTaG9ydGhhbmRzKS5mb3JFYWNoKGtleSA9PiB7XG4gICAgY29uc3Qgc2hvcnRoYW5kID0gbm9kZVByb3BlcnR5U2hvcnRoYW5kc1trZXldO1xuXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KE5vZGUucHJvdG90eXBlLCBrZXksIHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzW3Nob3J0aGFuZF0gfHwgbnVsbDtcbiAgICAgICAgfSxcbiAgICAgICAgc2V0OiBmdW5jdGlvbih2YWwpIHtcbiAgICAgICAgICAgIHRoaXNbc2hvcnRoYW5kXSA9IHZhbDtcbiAgICAgICAgICAgIHJldHVybiB2YWw7XG4gICAgICAgIH1cbiAgICB9KTtcbn0pO1xuXG4vL05vZGUgY29uc3RydWN0aW9uXG5leHBvcnRzLmNyZWF0ZURvY3VtZW50ID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIG5ldyBOb2RlKHtcbiAgICAgICAgdHlwZTogJ3Jvb3QnLFxuICAgICAgICBuYW1lOiAncm9vdCcsXG4gICAgICAgIHBhcmVudDogbnVsbCxcbiAgICAgICAgcHJldjogbnVsbCxcbiAgICAgICAgbmV4dDogbnVsbCxcbiAgICAgICAgY2hpbGRyZW46IFtdLFxuICAgICAgICAneC1tb2RlJzogRE9DVU1FTlRfTU9ERS5OT19RVUlSS1NcbiAgICB9KTtcbn07XG5cbmV4cG9ydHMuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBuZXcgTm9kZSh7XG4gICAgICAgIHR5cGU6ICdyb290JyxcbiAgICAgICAgbmFtZTogJ3Jvb3QnLFxuICAgICAgICBwYXJlbnQ6IG51bGwsXG4gICAgICAgIHByZXY6IG51bGwsXG4gICAgICAgIG5leHQ6IG51bGwsXG4gICAgICAgIGNoaWxkcmVuOiBbXVxuICAgIH0pO1xufTtcblxuZXhwb3J0cy5jcmVhdGVFbGVtZW50ID0gZnVuY3Rpb24odGFnTmFtZSwgbmFtZXNwYWNlVVJJLCBhdHRycykge1xuICAgIGNvbnN0IGF0dHJpYnMgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuICAgIGNvbnN0IGF0dHJpYnNOYW1lc3BhY2UgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuICAgIGNvbnN0IGF0dHJpYnNQcmVmaXggPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBhdHRycy5sZW5ndGg7IGkrKykge1xuICAgICAgICBjb25zdCBhdHRyTmFtZSA9IGF0dHJzW2ldLm5hbWU7XG5cbiAgICAgICAgYXR0cmlic1thdHRyTmFtZV0gPSBhdHRyc1tpXS52YWx1ZTtcbiAgICAgICAgYXR0cmlic05hbWVzcGFjZVthdHRyTmFtZV0gPSBhdHRyc1tpXS5uYW1lc3BhY2U7XG4gICAgICAgIGF0dHJpYnNQcmVmaXhbYXR0ck5hbWVdID0gYXR0cnNbaV0ucHJlZml4O1xuICAgIH1cblxuICAgIHJldHVybiBuZXcgTm9kZSh7XG4gICAgICAgIHR5cGU6IHRhZ05hbWUgPT09ICdzY3JpcHQnIHx8IHRhZ05hbWUgPT09ICdzdHlsZScgPyB0YWdOYW1lIDogJ3RhZycsXG4gICAgICAgIG5hbWU6IHRhZ05hbWUsXG4gICAgICAgIG5hbWVzcGFjZTogbmFtZXNwYWNlVVJJLFxuICAgICAgICBhdHRyaWJzOiBhdHRyaWJzLFxuICAgICAgICAneC1hdHRyaWJzTmFtZXNwYWNlJzogYXR0cmlic05hbWVzcGFjZSxcbiAgICAgICAgJ3gtYXR0cmlic1ByZWZpeCc6IGF0dHJpYnNQcmVmaXgsXG4gICAgICAgIGNoaWxkcmVuOiBbXSxcbiAgICAgICAgcGFyZW50OiBudWxsLFxuICAgICAgICBwcmV2OiBudWxsLFxuICAgICAgICBuZXh0OiBudWxsXG4gICAgfSk7XG59O1xuXG5leHBvcnRzLmNyZWF0ZUNvbW1lbnROb2RlID0gZnVuY3Rpb24oZGF0YSkge1xuICAgIHJldHVybiBuZXcgTm9kZSh7XG4gICAgICAgIHR5cGU6ICdjb21tZW50JyxcbiAgICAgICAgZGF0YTogZGF0YSxcbiAgICAgICAgcGFyZW50OiBudWxsLFxuICAgICAgICBwcmV2OiBudWxsLFxuICAgICAgICBuZXh0OiBudWxsXG4gICAgfSk7XG59O1xuXG5jb25zdCBjcmVhdGVUZXh0Tm9kZSA9IGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgcmV0dXJuIG5ldyBOb2RlKHtcbiAgICAgICAgdHlwZTogJ3RleHQnLFxuICAgICAgICBkYXRhOiB2YWx1ZSxcbiAgICAgICAgcGFyZW50OiBudWxsLFxuICAgICAgICBwcmV2OiBudWxsLFxuICAgICAgICBuZXh0OiBudWxsXG4gICAgfSk7XG59O1xuXG4vL1RyZWUgbXV0YXRpb25cbmNvbnN0IGFwcGVuZENoaWxkID0gKGV4cG9ydHMuYXBwZW5kQ2hpbGQgPSBmdW5jdGlvbihwYXJlbnROb2RlLCBuZXdOb2RlKSB7XG4gICAgY29uc3QgcHJldiA9IHBhcmVudE5vZGUuY2hpbGRyZW5bcGFyZW50Tm9kZS5jaGlsZHJlbi5sZW5ndGggLSAxXTtcblxuICAgIGlmIChwcmV2KSB7XG4gICAgICAgIHByZXYubmV4dCA9IG5ld05vZGU7XG4gICAgICAgIG5ld05vZGUucHJldiA9IHByZXY7XG4gICAgfVxuXG4gICAgcGFyZW50Tm9kZS5jaGlsZHJlbi5wdXNoKG5ld05vZGUpO1xuICAgIG5ld05vZGUucGFyZW50ID0gcGFyZW50Tm9kZTtcbn0pO1xuXG5jb25zdCBpbnNlcnRCZWZvcmUgPSAoZXhwb3J0cy5pbnNlcnRCZWZvcmUgPSBmdW5jdGlvbihwYXJlbnROb2RlLCBuZXdOb2RlLCByZWZlcmVuY2VOb2RlKSB7XG4gICAgY29uc3QgaW5zZXJ0aW9uSWR4ID0gcGFyZW50Tm9kZS5jaGlsZHJlbi5pbmRleE9mKHJlZmVyZW5jZU5vZGUpO1xuICAgIGNvbnN0IHByZXYgPSByZWZlcmVuY2VOb2RlLnByZXY7XG5cbiAgICBpZiAocHJldikge1xuICAgICAgICBwcmV2Lm5leHQgPSBuZXdOb2RlO1xuICAgICAgICBuZXdOb2RlLnByZXYgPSBwcmV2O1xuICAgIH1cblxuICAgIHJlZmVyZW5jZU5vZGUucHJldiA9IG5ld05vZGU7XG4gICAgbmV3Tm9kZS5uZXh0ID0gcmVmZXJlbmNlTm9kZTtcblxuICAgIHBhcmVudE5vZGUuY2hpbGRyZW4uc3BsaWNlKGluc2VydGlvbklkeCwgMCwgbmV3Tm9kZSk7XG4gICAgbmV3Tm9kZS5wYXJlbnQgPSBwYXJlbnROb2RlO1xufSk7XG5cbmV4cG9ydHMuc2V0VGVtcGxhdGVDb250ZW50ID0gZnVuY3Rpb24odGVtcGxhdGVFbGVtZW50LCBjb250ZW50RWxlbWVudCkge1xuICAgIGFwcGVuZENoaWxkKHRlbXBsYXRlRWxlbWVudCwgY29udGVudEVsZW1lbnQpO1xufTtcblxuZXhwb3J0cy5nZXRUZW1wbGF0ZUNvbnRlbnQgPSBmdW5jdGlvbih0ZW1wbGF0ZUVsZW1lbnQpIHtcbiAgICByZXR1cm4gdGVtcGxhdGVFbGVtZW50LmNoaWxkcmVuWzBdO1xufTtcblxuZXhwb3J0cy5zZXREb2N1bWVudFR5cGUgPSBmdW5jdGlvbihkb2N1bWVudCwgbmFtZSwgcHVibGljSWQsIHN5c3RlbUlkKSB7XG4gICAgY29uc3QgZGF0YSA9IGRvY3R5cGUuc2VyaWFsaXplQ29udGVudChuYW1lLCBwdWJsaWNJZCwgc3lzdGVtSWQpO1xuICAgIGxldCBkb2N0eXBlTm9kZSA9IG51bGw7XG5cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGRvY3VtZW50LmNoaWxkcmVuLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGlmIChkb2N1bWVudC5jaGlsZHJlbltpXS50eXBlID09PSAnZGlyZWN0aXZlJyAmJiBkb2N1bWVudC5jaGlsZHJlbltpXS5uYW1lID09PSAnIWRvY3R5cGUnKSB7XG4gICAgICAgICAgICBkb2N0eXBlTm9kZSA9IGRvY3VtZW50LmNoaWxkcmVuW2ldO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoZG9jdHlwZU5vZGUpIHtcbiAgICAgICAgZG9jdHlwZU5vZGUuZGF0YSA9IGRhdGE7XG4gICAgICAgIGRvY3R5cGVOb2RlWyd4LW5hbWUnXSA9IG5hbWU7XG4gICAgICAgIGRvY3R5cGVOb2RlWyd4LXB1YmxpY0lkJ10gPSBwdWJsaWNJZDtcbiAgICAgICAgZG9jdHlwZU5vZGVbJ3gtc3lzdGVtSWQnXSA9IHN5c3RlbUlkO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIGFwcGVuZENoaWxkKFxuICAgICAgICAgICAgZG9jdW1lbnQsXG4gICAgICAgICAgICBuZXcgTm9kZSh7XG4gICAgICAgICAgICAgICAgdHlwZTogJ2RpcmVjdGl2ZScsXG4gICAgICAgICAgICAgICAgbmFtZTogJyFkb2N0eXBlJyxcbiAgICAgICAgICAgICAgICBkYXRhOiBkYXRhLFxuICAgICAgICAgICAgICAgICd4LW5hbWUnOiBuYW1lLFxuICAgICAgICAgICAgICAgICd4LXB1YmxpY0lkJzogcHVibGljSWQsXG4gICAgICAgICAgICAgICAgJ3gtc3lzdGVtSWQnOiBzeXN0ZW1JZFxuICAgICAgICAgICAgfSlcbiAgICAgICAgKTtcbiAgICB9XG59O1xuXG5leHBvcnRzLnNldERvY3VtZW50TW9kZSA9IGZ1bmN0aW9uKGRvY3VtZW50LCBtb2RlKSB7XG4gICAgZG9jdW1lbnRbJ3gtbW9kZSddID0gbW9kZTtcbn07XG5cbmV4cG9ydHMuZ2V0RG9jdW1lbnRNb2RlID0gZnVuY3Rpb24oZG9jdW1lbnQpIHtcbiAgICByZXR1cm4gZG9jdW1lbnRbJ3gtbW9kZSddO1xufTtcblxuZXhwb3J0cy5kZXRhY2hOb2RlID0gZnVuY3Rpb24obm9kZSkge1xuICAgIGlmIChub2RlLnBhcmVudCkge1xuICAgICAgICBjb25zdCBpZHggPSBub2RlLnBhcmVudC5jaGlsZHJlbi5pbmRleE9mKG5vZGUpO1xuICAgICAgICBjb25zdCBwcmV2ID0gbm9kZS5wcmV2O1xuICAgICAgICBjb25zdCBuZXh0ID0gbm9kZS5uZXh0O1xuXG4gICAgICAgIG5vZGUucHJldiA9IG51bGw7XG4gICAgICAgIG5vZGUubmV4dCA9IG51bGw7XG5cbiAgICAgICAgaWYgKHByZXYpIHtcbiAgICAgICAgICAgIHByZXYubmV4dCA9IG5leHQ7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAobmV4dCkge1xuICAgICAgICAgICAgbmV4dC5wcmV2ID0gcHJldjtcbiAgICAgICAgfVxuXG4gICAgICAgIG5vZGUucGFyZW50LmNoaWxkcmVuLnNwbGljZShpZHgsIDEpO1xuICAgICAgICBub2RlLnBhcmVudCA9IG51bGw7XG4gICAgfVxufTtcblxuZXhwb3J0cy5pbnNlcnRUZXh0ID0gZnVuY3Rpb24ocGFyZW50Tm9kZSwgdGV4dCkge1xuICAgIGNvbnN0IGxhc3RDaGlsZCA9IHBhcmVudE5vZGUuY2hpbGRyZW5bcGFyZW50Tm9kZS5jaGlsZHJlbi5sZW5ndGggLSAxXTtcblxuICAgIGlmIChsYXN0Q2hpbGQgJiYgbGFzdENoaWxkLnR5cGUgPT09ICd0ZXh0Jykge1xuICAgICAgICBsYXN0Q2hpbGQuZGF0YSArPSB0ZXh0O1xuICAgIH0gZWxzZSB7XG4gICAgICAgIGFwcGVuZENoaWxkKHBhcmVudE5vZGUsIGNyZWF0ZVRleHROb2RlKHRleHQpKTtcbiAgICB9XG59O1xuXG5leHBvcnRzLmluc2VydFRleHRCZWZvcmUgPSBmdW5jdGlvbihwYXJlbnROb2RlLCB0ZXh0LCByZWZlcmVuY2VOb2RlKSB7XG4gICAgY29uc3QgcHJldk5vZGUgPSBwYXJlbnROb2RlLmNoaWxkcmVuW3BhcmVudE5vZGUuY2hpbGRyZW4uaW5kZXhPZihyZWZlcmVuY2VOb2RlKSAtIDFdO1xuXG4gICAgaWYgKHByZXZOb2RlICYmIHByZXZOb2RlLnR5cGUgPT09ICd0ZXh0Jykge1xuICAgICAgICBwcmV2Tm9kZS5kYXRhICs9IHRleHQ7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgaW5zZXJ0QmVmb3JlKHBhcmVudE5vZGUsIGNyZWF0ZVRleHROb2RlKHRleHQpLCByZWZlcmVuY2VOb2RlKTtcbiAgICB9XG59O1xuXG5leHBvcnRzLmFkb3B0QXR0cmlidXRlcyA9IGZ1bmN0aW9uKHJlY2lwaWVudCwgYXR0cnMpIHtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGF0dHJzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGNvbnN0IGF0dHJOYW1lID0gYXR0cnNbaV0ubmFtZTtcblxuICAgICAgICBpZiAodHlwZW9mIHJlY2lwaWVudC5hdHRyaWJzW2F0dHJOYW1lXSA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIHJlY2lwaWVudC5hdHRyaWJzW2F0dHJOYW1lXSA9IGF0dHJzW2ldLnZhbHVlO1xuICAgICAgICAgICAgcmVjaXBpZW50Wyd4LWF0dHJpYnNOYW1lc3BhY2UnXVthdHRyTmFtZV0gPSBhdHRyc1tpXS5uYW1lc3BhY2U7XG4gICAgICAgICAgICByZWNpcGllbnRbJ3gtYXR0cmlic1ByZWZpeCddW2F0dHJOYW1lXSA9IGF0dHJzW2ldLnByZWZpeDtcbiAgICAgICAgfVxuICAgIH1cbn07XG5cbi8vVHJlZSB0cmF2ZXJzaW5nXG5leHBvcnRzLmdldEZpcnN0Q2hpbGQgPSBmdW5jdGlvbihub2RlKSB7XG4gICAgcmV0dXJuIG5vZGUuY2hpbGRyZW5bMF07XG59O1xuXG5leHBvcnRzLmdldENoaWxkTm9kZXMgPSBmdW5jdGlvbihub2RlKSB7XG4gICAgcmV0dXJuIG5vZGUuY2hpbGRyZW47XG59O1xuXG5leHBvcnRzLmdldFBhcmVudE5vZGUgPSBmdW5jdGlvbihub2RlKSB7XG4gICAgcmV0dXJuIG5vZGUucGFyZW50O1xufTtcblxuZXhwb3J0cy5nZXRBdHRyTGlzdCA9IGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICBjb25zdCBhdHRyTGlzdCA9IFtdO1xuXG4gICAgZm9yIChjb25zdCBuYW1lIGluIGVsZW1lbnQuYXR0cmlicykge1xuICAgICAgICBhdHRyTGlzdC5wdXNoKHtcbiAgICAgICAgICAgIG5hbWU6IG5hbWUsXG4gICAgICAgICAgICB2YWx1ZTogZWxlbWVudC5hdHRyaWJzW25hbWVdLFxuICAgICAgICAgICAgbmFtZXNwYWNlOiBlbGVtZW50Wyd4LWF0dHJpYnNOYW1lc3BhY2UnXVtuYW1lXSxcbiAgICAgICAgICAgIHByZWZpeDogZWxlbWVudFsneC1hdHRyaWJzUHJlZml4J11bbmFtZV1cbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGF0dHJMaXN0O1xufTtcblxuLy9Ob2RlIGRhdGFcbmV4cG9ydHMuZ2V0VGFnTmFtZSA9IGZ1bmN0aW9uKGVsZW1lbnQpIHtcbiAgICByZXR1cm4gZWxlbWVudC5uYW1lO1xufTtcblxuZXhwb3J0cy5nZXROYW1lc3BhY2VVUkkgPSBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgcmV0dXJuIGVsZW1lbnQubmFtZXNwYWNlO1xufTtcblxuZXhwb3J0cy5nZXRUZXh0Tm9kZUNvbnRlbnQgPSBmdW5jdGlvbih0ZXh0Tm9kZSkge1xuICAgIHJldHVybiB0ZXh0Tm9kZS5kYXRhO1xufTtcblxuZXhwb3J0cy5nZXRDb21tZW50Tm9kZUNvbnRlbnQgPSBmdW5jdGlvbihjb21tZW50Tm9kZSkge1xuICAgIHJldHVybiBjb21tZW50Tm9kZS5kYXRhO1xufTtcblxuZXhwb3J0cy5nZXREb2N1bWVudFR5cGVOb2RlTmFtZSA9IGZ1bmN0aW9uKGRvY3R5cGVOb2RlKSB7XG4gICAgcmV0dXJuIGRvY3R5cGVOb2RlWyd4LW5hbWUnXTtcbn07XG5cbmV4cG9ydHMuZ2V0RG9jdW1lbnRUeXBlTm9kZVB1YmxpY0lkID0gZnVuY3Rpb24oZG9jdHlwZU5vZGUpIHtcbiAgICByZXR1cm4gZG9jdHlwZU5vZGVbJ3gtcHVibGljSWQnXTtcbn07XG5cbmV4cG9ydHMuZ2V0RG9jdW1lbnRUeXBlTm9kZVN5c3RlbUlkID0gZnVuY3Rpb24oZG9jdHlwZU5vZGUpIHtcbiAgICByZXR1cm4gZG9jdHlwZU5vZGVbJ3gtc3lzdGVtSWQnXTtcbn07XG5cbi8vTm9kZSB0eXBlc1xuZXhwb3J0cy5pc1RleHROb2RlID0gZnVuY3Rpb24obm9kZSkge1xuICAgIHJldHVybiBub2RlLnR5cGUgPT09ICd0ZXh0Jztcbn07XG5cbmV4cG9ydHMuaXNDb21tZW50Tm9kZSA9IGZ1bmN0aW9uKG5vZGUpIHtcbiAgICByZXR1cm4gbm9kZS50eXBlID09PSAnY29tbWVudCc7XG59O1xuXG5leHBvcnRzLmlzRG9jdW1lbnRUeXBlTm9kZSA9IGZ1bmN0aW9uKG5vZGUpIHtcbiAgICByZXR1cm4gbm9kZS50eXBlID09PSAnZGlyZWN0aXZlJyAmJiBub2RlLm5hbWUgPT09ICchZG9jdHlwZSc7XG59O1xuXG5leHBvcnRzLmlzRWxlbWVudE5vZGUgPSBmdW5jdGlvbihub2RlKSB7XG4gICAgcmV0dXJuICEhbm9kZS5hdHRyaWJzO1xufTtcblxuLy8gU291cmNlIGNvZGUgbG9jYXRpb25cbmV4cG9ydHMuc2V0Tm9kZVNvdXJjZUNvZGVMb2NhdGlvbiA9IGZ1bmN0aW9uKG5vZGUsIGxvY2F0aW9uKSB7XG4gICAgbm9kZS5zb3VyY2VDb2RlTG9jYXRpb24gPSBsb2NhdGlvbjtcbn07XG5cbmV4cG9ydHMuZ2V0Tm9kZVNvdXJjZUNvZGVMb2NhdGlvbiA9IGZ1bmN0aW9uKG5vZGUpIHtcbiAgICByZXR1cm4gbm9kZS5zb3VyY2VDb2RlTG9jYXRpb247XG59O1xuXG5leHBvcnRzLnVwZGF0ZU5vZGVTb3VyY2VDb2RlTG9jYXRpb24gPSBmdW5jdGlvbihub2RlLCBlbmRMb2NhdGlvbikge1xuICAgIG5vZGUuc291cmNlQ29kZUxvY2F0aW9uID0gT2JqZWN0LmFzc2lnbihub2RlLnNvdXJjZUNvZGVMb2NhdGlvbiwgZW5kTG9jYXRpb24pO1xufTtcbiJdfQ==