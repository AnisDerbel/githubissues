128f9967d71b96f950550f87adaa1392
"use strict";

var _interopRequireDefault2 = require("@babel/runtime/helpers/interopRequireDefault");

var _extends2 = _interopRequireDefault2(require("@babel/runtime/helpers/extends"));

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _omitBy = _interopRequireDefault(require("lodash/omitBy"));

var _isNil = _interopRequireDefault(require("lodash/isNil"));

var _reactIs = require("react-is");

var _RSTTraversal = require("enzyme/build/RSTTraversal");

var _utils = require("./utils");

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : {
    default: obj
  };
}

function getChildren(node, options) {
  var children = (0, _utils.compact)((0, _RSTTraversal.childrenOfNode)(node).map(function (n) {
    return internalNodeToJson(n, options);
  }));

  if (children.length > 0) {
    return children;
  }

  return null;
}

function getProps(node, options) {
  var props = (0, _omitBy.default)((0, _extends2.default)({}, (0, _RSTTraversal.propsOfNode)(node)), function (val, key) {
    if (key === 'children' || val === undefined) {
      return true;
    }

    if (options.ignoreDefaultProps === true && (0, _reactIs.isValidElementType)(node.type) && node.type.defaultProps && key in node.type.defaultProps && node.type.defaultProps[key] === val) {
      return true;
    }
  });

  if (!(0, _isNil.default)(node.key) && options.noKey !== true) {
    props.key = node.key;
  }

  return props;
}

function internalNodeToJson(node, options) {
  if (typeof node === 'string' || typeof node === 'number') {
    return node;
  }

  if ((0, _isNil.default)(node) || node === false) {
    return '';
  }

  var json = (0, _utils.applyMap)({
    node: node,
    type: (0, _utils.extractTypeName)(node),
    props: getProps(node, options),
    children: getChildren(node, options),
    $$typeof: Symbol.for('react.test.json')
  }, options);

  if (!(0, _isNil.default)(json) && !(0, _isNil.default)(json.type)) {
    return json;
  }
}

var shallowToJson = function shallowToJson(wrapper) {
  var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};

  if ((0, _isNil.default)(wrapper) || wrapper.length === 0) {
    return null;
  }

  if (wrapper.length > 1 && typeof wrapper.getNodesInternal === 'function') {
    var nodes = wrapper.getNodesInternal();
    return nodes.map(function (node) {
      return internalNodeToJson(node, options);
    });
  }

  if (typeof wrapper.getNodeInternal === 'function') {
    var node = wrapper.getNodeInternal();
    return internalNodeToJson(node, options);
  }

  return null;
};

var _default = shallowToJson;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNoYWxsb3cuanMiXSwibmFtZXMiOlsiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJleHBvcnRzIiwidmFsdWUiLCJkZWZhdWx0IiwiX29taXRCeSIsIl9pbnRlcm9wUmVxdWlyZURlZmF1bHQiLCJyZXF1aXJlIiwiX2lzTmlsIiwiX3JlYWN0SXMiLCJfUlNUVHJhdmVyc2FsIiwiX3V0aWxzIiwib2JqIiwiX19lc01vZHVsZSIsImdldENoaWxkcmVuIiwibm9kZSIsIm9wdGlvbnMiLCJjaGlsZHJlbiIsImNvbXBhY3QiLCJjaGlsZHJlbk9mTm9kZSIsIm1hcCIsIm4iLCJpbnRlcm5hbE5vZGVUb0pzb24iLCJsZW5ndGgiLCJnZXRQcm9wcyIsInByb3BzIiwicHJvcHNPZk5vZGUiLCJ2YWwiLCJrZXkiLCJ1bmRlZmluZWQiLCJpZ25vcmVEZWZhdWx0UHJvcHMiLCJpc1ZhbGlkRWxlbWVudFR5cGUiLCJ0eXBlIiwiZGVmYXVsdFByb3BzIiwibm9LZXkiLCJqc29uIiwiYXBwbHlNYXAiLCJleHRyYWN0VHlwZU5hbWUiLCIkJHR5cGVvZiIsIlN5bWJvbCIsImZvciIsInNoYWxsb3dUb0pzb24iLCJ3cmFwcGVyIiwiZ2V0Tm9kZXNJbnRlcm5hbCIsIm5vZGVzIiwiZ2V0Tm9kZUludGVybmFsIiwiX2RlZmF1bHQiXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7QUFFQUEsTUFBTSxDQUFDQyxjQUFQLENBQXNCQyxPQUF0QixFQUErQixZQUEvQixFQUE2QztBQUMzQ0MsRUFBQUEsS0FBSyxFQUFFO0FBRG9DLENBQTdDO0FBR0FELE9BQU8sQ0FBQ0UsT0FBUixHQUFrQixLQUFLLENBQXZCOztBQUVBLElBQUlDLE9BQU8sR0FBR0Msc0JBQXNCLENBQUNDLE9BQU8sQ0FBQyxlQUFELENBQVIsQ0FBcEM7O0FBRUEsSUFBSUMsTUFBTSxHQUFHRixzQkFBc0IsQ0FBQ0MsT0FBTyxDQUFDLGNBQUQsQ0FBUixDQUFuQzs7QUFFQSxJQUFJRSxRQUFRLEdBQUdGLE9BQU8sQ0FBQyxV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OztBQUVELFNBQU8sSUFBUDtBQUNELENBaEJEOztBQWtCQSxJQUFJOEIsUUFBUSxHQUFHTCxhQUFmO0FBQ0F2QyxPQUFPLENBQUNFLE9BQVIsR0FBa0IwQyxRQUFsQiIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHtcbiAgdmFsdWU6IHRydWVcbn0pO1xuZXhwb3J0cy5kZWZhdWx0ID0gdm9pZCAwO1xuXG52YXIgX29taXRCeSA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZShcImxvZGFzaC9vbWl0QnlcIikpO1xuXG52YXIgX2lzTmlsID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKFwibG9kYXNoL2lzTmlsXCIpKTtcblxudmFyIF9yZWFjdElzID0gcmVxdWlyZShcInJlYWN0LWlzXCIpO1xuXG52YXIgX1JTVFRyYXZlcnNhbCA9IHJlcXVpcmUoXCJlbnp5bWUvYnVpbGQvUlNUVHJhdmVyc2FsXCIpO1xuXG52YXIgX3V0aWxzID0gcmVxdWlyZShcIi4vdXRpbHNcIik7XG5cbmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7IGRlZmF1bHQ6IG9iaiB9OyB9XG5cbmZ1bmN0aW9uIGdldENoaWxkcmVuKG5vZGUsIG9wdGlvbnMpIHtcbiAgY29uc3QgY2hpbGRyZW4gPSAoMCwgX3V0aWxzLmNvbXBhY3QpKCgwLCBfUlNUVHJhdmVyc2FsLmNoaWxkcmVuT2ZOb2RlKShub2RlKS5tYXAobiA9PiBpbnRlcm5hbE5vZGVUb0pzb24obiwgb3B0aW9ucykpKTtcblxuICBpZiAoY2hpbGRyZW4ubGVuZ3RoID4gMCkge1xuICAgIHJldHVybiBjaGlsZHJlbjtcbiAgfVxuXG4gIHJldHVybiBudWxsO1xufVxuXG5mdW5jdGlvbiBnZXRQcm9wcyhub2RlLCBvcHRpb25zKSB7XG4gIGNvbnN0IHByb3BzID0gKDAsIF9vbWl0QnkuZGVmYXVsdCkoT2JqZWN0LmFzc2lnbih7fSwgKDAsIF9SU1RUcmF2ZXJzYWwucHJvcHNPZk5vZGUpKG5vZGUpKSwgKHZhbCwga2V5KSA9PiB7XG4gICAgaWYgKGtleSA9PT0gJ2NoaWxkcmVuJyB8fCB2YWwgPT09IHVuZGVmaW5lZCkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgaWYgKG9wdGlvbnMuaWdub3JlRGVmYXVsdFByb3BzID09PSB0cnVlICYmICgwLCBfcmVhY3RJcy5pc1ZhbGlkRWxlbWVudFR5cGUpKG5vZGUudHlwZSkgJiYgbm9kZS50eXBlLmRlZmF1bHRQcm9wcyAmJiBrZXkgaW4gbm9kZS50eXBlLmRlZmF1bHRQcm9wcyAmJiBub2RlLnR5cGUuZGVmYXVsdFByb3BzW2tleV0gPT09IHZhbCkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICB9KTtcblxuICBpZiAoISgwLCBfaXNOaWwuZGVmYXVsdCkobm9kZS5rZXkpICYmIG9wdGlvbnMubm9LZXkgIT09IHRydWUpIHtcbiAgICBwcm9wcy5rZXkgPSBub2RlLmtleTtcbiAgfVxuXG4gIHJldHVybiBwcm9wcztcbn1cblxuZnVuY3Rpb24gaW50ZXJuYWxOb2RlVG9Kc29uKG5vZGUsIG9wdGlvbnMpIHtcbiAgaWYgKHR5cGVvZiBub2RlID09PSAnc3RyaW5nJyB8fCB0eXBlb2Ygbm9kZSA9PT0gJ251bWJlcicpIHtcbiAgICByZXR1cm4gbm9kZTtcbiAgfVxuXG4gIGlmICgoMCwgX2lzTmlsLmRlZmF1bHQpKG5vZGUpIHx8IG5vZGUgPT09IGZhbHNlKSB7XG4gICAgcmV0dXJuICcnO1xuICB9XG5cbiAgY29uc3QganNvbiA9ICgwLCBfdXRpbHMuYXBwbHlNYXApKHtcbiAgICBub2RlLFxuICAgIHR5cGU6ICgwLCBfdXRpbHMuZXh0cmFjdFR5cGVOYW1lKShub2RlKSxcbiAgICBwcm9wczogZ2V0UHJvcHMobm9kZSwgb3B0aW9ucyksXG4gICAgY2hpbGRyZW46IGdldENoaWxkcmVuKG5vZGUsIG9wdGlvbnMpLFxuICAgICQkdHlwZW9mOiBTeW1ib2wuZm9yKCdyZWFjdC50ZXN0Lmpzb24nKVxuICB9LCBvcHRpb25zKTtcblxuICBpZiAoISgwLCBfaXNOaWwuZGVmYXVsdCkoanNvbikgJiYgISgwLCBfaXNOaWwuZGVmYXVsdCkoanNvbi50eXBlKSkge1xuICAgIHJldHVybiBqc29uO1xuICB9XG59XG5cbmNvbnN0IHNoYWxsb3dUb0pzb24gPSAod3JhcHBlciwgb3B0aW9ucyA9IHt9KSA9PiB7XG4gIGlmICgoMCwgX2lzTmlsLmRlZmF1bHQpKHdyYXBwZXIpIHx8IHdyYXBwZXIubGVuZ3RoID09PSAwKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICBpZiAod3JhcHBlci5sZW5ndGggPiAxICYmIHR5cGVvZiB3cmFwcGVyLmdldE5vZGVzSW50ZXJuYWwgPT09ICdmdW5jdGlvbicpIHtcbiAgICBjb25zdCBub2RlcyA9IHdyYXBwZXIuZ2V0Tm9kZXNJbnRlcm5hbCgpO1xuICAgIHJldHVybiBub2Rlcy5tYXAobm9kZSA9PiBpbnRlcm5hbE5vZGVUb0pzb24obm9kZSwgb3B0aW9ucykpO1xuICB9XG5cbiAgaWYgKHR5cGVvZiB3cmFwcGVyLmdldE5vZGVJbnRlcm5hbCA9PT0gJ2Z1bmN0aW9uJykge1xuICAgIGNvbnN0IG5vZGUgPSB3cmFwcGVyLmdldE5vZGVJbnRlcm5hbCgpO1xuICAgIHJldHVybiBpbnRlcm5hbE5vZGVUb0pzb24obm9kZSwgb3B0aW9ucyk7XG4gIH1cblxuICByZXR1cm4gbnVsbDtcbn07XG5cbnZhciBfZGVmYXVsdCA9IHNoYWxsb3dUb0pzb247XG5leHBvcnRzLmRlZmF1bHQgPSBfZGVmYXVsdDsiXX0=