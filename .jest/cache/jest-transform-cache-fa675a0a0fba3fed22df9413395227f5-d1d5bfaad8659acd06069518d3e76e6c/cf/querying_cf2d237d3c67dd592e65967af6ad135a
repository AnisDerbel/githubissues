043aa6fc772dca335a02b5360b15cbf7
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.findAll = exports.existsOne = exports.findOne = exports.findOneChild = exports.find = exports.filter = void 0;

var tagtypes_1 = require("./tagtypes");

function filter(test, node, recurse, limit) {
  if (recurse === void 0) {
    recurse = true;
  }

  if (limit === void 0) {
    limit = Infinity;
  }

  if (!Array.isArray(node)) node = [node];
  return find(test, node, recurse, limit);
}

exports.filter = filter;

function find(test, nodes, recurse, limit) {
  var result = [];

  for (var _i = 0, nodes_1 = nodes; _i < nodes_1.length; _i++) {
    var elem = nodes_1[_i];

    if (test(elem)) {
      result.push(elem);
      if (--limit <= 0) break;
    }

    if (recurse && tagtypes_1.hasChildren(elem) && elem.children.length > 0) {
      var children = find(test, elem.children, recurse, limit);
      result.push.apply(result, children);
      limit -= children.length;
      if (limit <= 0) break;
    }
  }

  return result;
}

exports.find = find;

function findOneChild(test, nodes) {
  return nodes.find(test);
}

exports.findOneChild = findOneChild;

function findOne(test, nodes, recurse) {
  if (recurse === void 0) {
    recurse = true;
  }

  var elem = null;

  for (var i = 0; i < nodes.length && !elem; i++) {
    var checked = nodes[i];

    if (!tagtypes_1.isTag(checked)) {
      continue;
    } else if (test(checked)) {
      elem = checked;
    } else if (recurse && checked.children.length > 0) {
      elem = findOne(test, checked.children);
    }
  }

  return elem;
}

exports.findOne = findOne;

function existsOne(test, nodes) {
  return nodes.some(function (checked) {
    return tagtypes_1.isTag(checked) && (test(checked) || checked.children.length > 0 && existsOne(test, checked.children));
  });
}

exports.existsOne = existsOne;

function findAll(test, nodes) {
  var _a;

  var result = [];
  var stack = nodes.filter(tagtypes_1.isTag);
  var elem;

  while (elem = stack.shift()) {
    var children = (_a = elem.children) === null || _a === void 0 ? void 0 : _a.filter(tagtypes_1.isTag);

    if (children && children.length > 0) {
      stack.unshift.apply(stack, children);
    }

    if (test(elem)) result.push(elem);
  }

  return result;
}

exports.findAll = findAll;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInF1ZXJ5aW5nLmpzIl0sIm5hbWVzIjpbIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZXhwb3J0cyIsInZhbHVlIiwiZmluZEFsbCIsImV4aXN0c09uZSIsImZpbmRPbmUiLCJmaW5kT25lQ2hpbGQiLCJmaW5kIiwiZmlsdGVyIiwidGFndHlwZXNfMSIsInJlcXVpcmUiLCJ0ZXN0Iiwibm9kZSIsInJlY3Vyc2UiLCJsaW1pdCIsIkluZmluaXR5IiwiQXJyYXkiLCJpc0FycmF5Iiwibm9kZXMiLCJyZXN1bHQiLCJfaSIsIm5vZGVzXzEiLCJsZW5ndGgiLCJlbGVtIiwicHVzaCIsImhhc0NoaWxkcmVuIiwiY2hpbGRyZW4iLCJhcHBseSIsImkiLCJjaGVja2VkIiwiaXNUYWciLCJzb21lIiwiX2EiLCJzdGFjayIsInNoaWZ0IiwidW5zaGlmdCJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBQ0FBLE1BQU0sQ0FBQ0MsY0FBUCxDQUFzQkMsT0FBdEIsRUFBK0IsWUFBL0IsRUFBNkM7QUFBRUMsRUFBQUEsS0FBSyxFQUFFO0FBQVQsQ0FBN0M7QUFDQUQsT0FBTyxDQUFDRSxPQUFSLEdBQWtCRixPQUFPLENBQUNHLFNBQVIsR0FBb0JILE9BQU8sQ0FBQ0ksT0FBUixHQUFrQkosT0FBTyxDQUFDSyxZQUFSLEdBQXVCTCxPQUFPLENBQUNNLElBQVIsR0FBZU4sT0FBTyxDQUFDTyxNQUFSLEdBQWlCLEtBQUssQ0FBcEg7O0FBQ0EsSUFBSUMsVUFBVSxHQUFHQyxPQUFPLENBQUMsWUFBRCxDQUF4Qjs7QUFVQSxTQUFTRixNQUFULENBQWdCRyxJQUFoQixFQUFzQkMsSUFBdEIsRUFBNEJDLE9BQTVCLEVBQXFDQyxLQUFyQyxFQUE0QztBQUN4QyxNQUFJRCxPQUFPLEtBQUssS0FBSyxDQUFyQixFQUF3QjtBQUFFQSxJQUFBQSxPQUFPLEdBQUcsSUFBVjtBQUFpQjs7QUFDM0MsTUFBSUMsS0FBSyxLQUFLLEtBQUssQ0FBbkIsRUFBc0I7QUFBRUEsSUFBQUEsS0FBSyxHQUFHQyxR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QVAsQ0FBWUQsSUFBWjtBQUNQOztBQUNELFNBQU9KLE1BQVA7QUFDSDs7QUFDRGxCLE9BQU8sQ0FBQ0UsT0FBUixHQUFrQkEsT0FBbEIiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuZmluZEFsbCA9IGV4cG9ydHMuZXhpc3RzT25lID0gZXhwb3J0cy5maW5kT25lID0gZXhwb3J0cy5maW5kT25lQ2hpbGQgPSBleHBvcnRzLmZpbmQgPSBleHBvcnRzLmZpbHRlciA9IHZvaWQgMDtcbnZhciB0YWd0eXBlc18xID0gcmVxdWlyZShcIi4vdGFndHlwZXNcIik7XG4vKipcbiAqIFNlYXJjaCBhIG5vZGUgYW5kIGl0cyBjaGlsZHJlbiBmb3Igbm9kZXMgcGFzc2luZyBhIHRlc3QgZnVuY3Rpb24uXG4gKlxuICogQHBhcmFtIHRlc3QgRnVuY3Rpb24gdG8gdGVzdCBub2RlcyBvbi5cbiAqIEBwYXJhbSBub2RlIE5vZGUgdG8gc2VhcmNoLiBXaWxsIGJlIGluY2x1ZGVkIGluIHRoZSByZXN1bHQgc2V0IGlmIGl0IG1hdGNoZXMuXG4gKiBAcGFyYW0gcmVjdXJzZSBBbHNvIGNvbnNpZGVyIGNoaWxkIG5vZGVzLlxuICogQHBhcmFtIGxpbWl0IE1heGltdW0gbnVtYmVyIG9mIG5vZGVzIHRvIHJldHVybi5cbiAqIEByZXR1cm5zIEFsbCBub2RlcyBwYXNzaW5nIGB0ZXN0YC5cbiAqL1xuZnVuY3Rpb24gZmlsdGVyKHRlc3QsIG5vZGUsIHJlY3Vyc2UsIGxpbWl0KSB7XG4gICAgaWYgKHJlY3Vyc2UgPT09IHZvaWQgMCkgeyByZWN1cnNlID0gdHJ1ZTsgfVxuICAgIGlmIChsaW1pdCA9PT0gdm9pZCAwKSB7IGxpbWl0ID0gSW5maW5pdHk7IH1cbiAgICBpZiAoIUFycmF5LmlzQXJyYXkobm9kZSkpXG4gICAgICAgIG5vZGUgPSBbbm9kZV07XG4gICAgcmV0dXJuIGZpbmQodGVzdCwgbm9kZSwgcmVjdXJzZSwgbGltaXQpO1xufVxuZXhwb3J0cy5maWx0ZXIgPSBmaWx0ZXI7XG4vKipcbiAqIFNlYXJjaCBhbiBhcnJheSBvZiBub2RlIGFuZCBpdHMgY2hpbGRyZW4gZm9yIG5vZGVzIHBhc3NpbmcgYSB0ZXN0IGZ1bmN0aW9uLlxuICpcbiAqIEBwYXJhbSB0ZXN0IEZ1bmN0aW9uIHRvIHRlc3Qgbm9kZXMgb24uXG4gKiBAcGFyYW0gbm9kZXMgQXJyYXkgb2Ygbm9kZXMgdG8gc2VhcmNoLlxuICogQHBhcmFtIHJlY3Vyc2UgQWxzbyBjb25zaWRlciBjaGlsZCBub2Rlcy5cbiAqIEBwYXJhbSBsaW1pdCBNYXhpbXVtIG51bWJlciBvZiBub2RlcyB0byByZXR1cm4uXG4gKiBAcmV0dXJucyBBbGwgbm9kZXMgcGFzc2luZyBgdGVzdGAuXG4gKi9cbmZ1bmN0aW9uIGZpbmQodGVzdCwgbm9kZXMsIHJlY3Vyc2UsIGxpbWl0KSB7XG4gICAgdmFyIHJlc3VsdCA9IFtdO1xuICAgIGZvciAodmFyIF9pID0gMCwgbm9kZXNfMSA9IG5vZGVzOyBfaSA8IG5vZGVzXzEubGVuZ3RoOyBfaSsrKSB7XG4gICAgICAgIHZhciBlbGVtID0gbm9kZXNfMVtfaV07XG4gICAgICAgIGlmICh0ZXN0KGVsZW0pKSB7XG4gICAgICAgICAgICByZXN1bHQucHVzaChlbGVtKTtcbiAgICAgICAgICAgIGlmICgtLWxpbWl0IDw9IDApXG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHJlY3Vyc2UgJiYgdGFndHlwZXNfMS5oYXNDaGlsZHJlbihlbGVtKSAmJiBlbGVtLmNoaWxkcmVuLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIHZhciBjaGlsZHJlbiA9IGZpbmQodGVzdCwgZWxlbS5jaGlsZHJlbiwgcmVjdXJzZSwgbGltaXQpO1xuICAgICAgICAgICAgcmVzdWx0LnB1c2guYXBwbHkocmVzdWx0LCBjaGlsZHJlbik7XG4gICAgICAgICAgICBsaW1pdCAtPSBjaGlsZHJlbi5sZW5ndGg7XG4gICAgICAgICAgICBpZiAobGltaXQgPD0gMClcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xufVxuZXhwb3J0cy5maW5kID0gZmluZDtcbi8qKlxuICogRmluZHMgdGhlIGZpcnN0IGVsZW1lbnQgaW5zaWRlIG9mIGFuIGFycmF5IHRoYXQgbWF0Y2hlcyBhIHRlc3QgZnVuY3Rpb24uXG4gKlxuICogQHBhcmFtIHRlc3QgRnVuY3Rpb24gdG8gdGVzdCBub2RlcyBvbi5cbiAqIEBwYXJhbSBub2RlcyBBcnJheSBvZiBub2RlcyB0byBzZWFyY2guXG4gKiBAcmV0dXJucyBUaGUgZmlyc3Qgbm9kZSBpbiB0aGUgYXJyYXkgdGhhdCBwYXNzZXMgYHRlc3RgLlxuICovXG5mdW5jdGlvbiBmaW5kT25lQ2hpbGQodGVzdCwgbm9kZXMpIHtcbiAgICByZXR1cm4gbm9kZXMuZmluZCh0ZXN0KTtcbn1cbmV4cG9ydHMuZmluZE9uZUNoaWxkID0gZmluZE9uZUNoaWxkO1xuLyoqXG4gKiBGaW5kcyBvbmUgZWxlbWVudCBpbiBhIHRyZWUgdGhhdCBwYXNzZXMgYSB0ZXN0LlxuICpcbiAqIEBwYXJhbSB0ZXN0IEZ1bmN0aW9uIHRvIHRlc3Qgbm9kZXMgb24uXG4gKiBAcGFyYW0gbm9kZXMgQXJyYXkgb2Ygbm9kZXMgdG8gc2VhcmNoLlxuICogQHBhcmFtIHJlY3Vyc2UgQWxzbyBjb25zaWRlciBjaGlsZCBub2Rlcy5cbiAqIEByZXR1cm5zIFRoZSBmaXJzdCBjaGlsZCBub2RlIHRoYXQgcGFzc2VzIGB0ZXN0YC5cbiAqL1xuZnVuY3Rpb24gZmluZE9uZSh0ZXN0LCBub2RlcywgcmVjdXJzZSkge1xuICAgIGlmIChyZWN1cnNlID09PSB2b2lkIDApIHsgcmVjdXJzZSA9IHRydWU7IH1cbiAgICB2YXIgZWxlbSA9IG51bGw7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBub2Rlcy5sZW5ndGggJiYgIWVsZW07IGkrKykge1xuICAgICAgICB2YXIgY2hlY2tlZCA9IG5vZGVzW2ldO1xuICAgICAgICBpZiAoIXRhZ3R5cGVzXzEuaXNUYWcoY2hlY2tlZCkpIHtcbiAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHRlc3QoY2hlY2tlZCkpIHtcbiAgICAgICAgICAgIGVsZW0gPSBjaGVja2VkO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHJlY3Vyc2UgJiYgY2hlY2tlZC5jaGlsZHJlbi5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBlbGVtID0gZmluZE9uZSh0ZXN0LCBjaGVja2VkLmNoaWxkcmVuKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gZWxlbTtcbn1cbmV4cG9ydHMuZmluZE9uZSA9IGZpbmRPbmU7XG4vKipcbiAqIEBwYXJhbSB0ZXN0IEZ1bmN0aW9uIHRvIHRlc3Qgbm9kZXMgb24uXG4gKiBAcGFyYW0gbm9kZXMgQXJyYXkgb2Ygbm9kZXMgdG8gc2VhcmNoLlxuICogQHJldHVybnMgV2hldGhlciBhIHRyZWUgb2Ygbm9kZXMgY29udGFpbnMgYXQgbGVhc3Qgb25lIG5vZGUgcGFzc2luZyBhIHRlc3QuXG4gKi9cbmZ1bmN0aW9uIGV4aXN0c09uZSh0ZXN0LCBub2Rlcykge1xuICAgIHJldHVybiBub2Rlcy5zb21lKGZ1bmN0aW9uIChjaGVja2VkKSB7XG4gICAgICAgIHJldHVybiB0YWd0eXBlc18xLmlzVGFnKGNoZWNrZWQpICYmXG4gICAgICAgICAgICAodGVzdChjaGVja2VkKSB8fFxuICAgICAgICAgICAgICAgIChjaGVja2VkLmNoaWxkcmVuLmxlbmd0aCA+IDAgJiZcbiAgICAgICAgICAgICAgICAgICAgZXhpc3RzT25lKHRlc3QsIGNoZWNrZWQuY2hpbGRyZW4pKSk7XG4gICAgfSk7XG59XG5leHBvcnRzLmV4aXN0c09uZSA9IGV4aXN0c09uZTtcbi8qKlxuICogU2VhcmNoIGFuZCBhcnJheSBvZiBub2RlcyBhbmQgaXRzIGNoaWxkcmVuIGZvciBub2RlcyBwYXNzaW5nIGEgdGVzdCBmdW5jdGlvbi5cbiAqXG4gKiBTYW1lIGFzIGBmaW5kYCwgb25seSB3aXRoIGxlc3Mgb3B0aW9ucywgbGVhZGluZyB0byByZWR1Y2VkIGNvbXBsZXhpdHkuXG4gKlxuICogQHBhcmFtIHRlc3QgRnVuY3Rpb24gdG8gdGVzdCBub2RlcyBvbi5cbiAqIEBwYXJhbSBub2RlcyBBcnJheSBvZiBub2RlcyB0byBzZWFyY2guXG4gKiBAcmV0dXJucyBBbGwgbm9kZXMgcGFzc2luZyBgdGVzdGAuXG4gKi9cbmZ1bmN0aW9uIGZpbmRBbGwodGVzdCwgbm9kZXMpIHtcbiAgICB2YXIgX2E7XG4gICAgdmFyIHJlc3VsdCA9IFtdO1xuICAgIHZhciBzdGFjayA9IG5vZGVzLmZpbHRlcih0YWd0eXBlc18xLmlzVGFnKTtcbiAgICB2YXIgZWxlbTtcbiAgICB3aGlsZSAoKGVsZW0gPSBzdGFjay5zaGlmdCgpKSkge1xuICAgICAgICB2YXIgY2hpbGRyZW4gPSAoX2EgPSBlbGVtLmNoaWxkcmVuKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZmlsdGVyKHRhZ3R5cGVzXzEuaXNUYWcpO1xuICAgICAgICBpZiAoY2hpbGRyZW4gJiYgY2hpbGRyZW4ubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgc3RhY2sudW5zaGlmdC5hcHBseShzdGFjaywgY2hpbGRyZW4pO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0ZXN0KGVsZW0pKVxuICAgICAgICAgICAgcmVzdWx0LnB1c2goZWxlbSk7XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG59XG5leHBvcnRzLmZpbmRBbGwgPSBmaW5kQWxsO1xuIl19