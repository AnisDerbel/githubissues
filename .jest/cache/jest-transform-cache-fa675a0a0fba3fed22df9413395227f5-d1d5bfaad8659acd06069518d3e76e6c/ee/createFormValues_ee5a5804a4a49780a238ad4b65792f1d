4792b8c45c448abbdc0c20ef427b9724
"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

exports.__esModule = true;
exports["default"] = createValues;

var _objectWithoutPropertiesLoose2 = _interopRequireDefault(require("@babel/runtime/helpers/objectWithoutPropertiesLoose"));

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _inheritsLoose2 = _interopRequireDefault(require("@babel/runtime/helpers/inheritsLoose"));

var _mapValues2 = _interopRequireDefault(require("lodash/mapValues"));

var _isEqual2 = _interopRequireDefault(require("lodash/isEqual"));

var _isEmpty2 = _interopRequireDefault(require("lodash/isEmpty"));

var _react = _interopRequireDefault(require("react"));

var _reactRedux = require("react-redux");

var _prefixName = _interopRequireDefault(require("./util/prefixName"));

var _ReduxFormContext = require("./ReduxFormContext");

function createValues(_ref) {
  var getIn = _ref.getIn;
  return function (firstArg) {
    for (var _len = arguments.length, rest = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {
      rest[_key - 1] = arguments[_key];
    }

    return function (Component) {
      var FormValues = function (_React$Component) {
        (0, _inheritsLoose2["default"])(FormValues, _React$Component);

        function FormValues(props) {
          var _this;

          _this = _React$Component.call(this, props) || this;

          if (!props._reduxForm) {
            throw new Error('formValues() must be used inside a React tree decorated with reduxForm()');
          }

          _this.updateComponent(props);

          return _this;
        }

        var _proto = FormValues.prototype;

        _proto.UNSAFE_componentWillReceiveProps = function UNSAFE_componentWillReceiveProps(props) {
          if (typeof firstArg === 'function') {
            this.updateComponent(props);
          }
        };

        _proto.render = function render() {
          var Component = this.Component;
          return _react["default"].createElement(Component, (0, _extends2["default"])({
            sectionPrefix: this.props._reduxForm.sectionPrefix
          }, this.props));
        };

        _proto.updateComponent = function updateComponent(props) {
          var valuesMap;
          var resolvedFirstArg = typeof firstArg === 'function' ? firstArg(props) : firstArg;

          if (typeof resolvedFirstArg === 'string') {
            var _rest$reduce;

            valuesMap = rest.reduce(function (result, k) {
              result[k] = k;
              return result;
            }, (_rest$reduce = {}, _rest$reduce[resolvedFirstArg] = resolvedFirstArg, _rest$reduce));
          } else {
            valuesMap = resolvedFirstArg;
          }

          if ((0, _isEmpty2["default"])(valuesMap)) {
            throw new Error('formValues(): You must specify values to get as formValues(name1, name2, ...) or formValues({propName1: propPath1, ...}) or formValues((props) => name) or formValues((props) => ({propName1: propPath1, ...}))');
          }

          if ((0, _isEqual2["default"])(valuesMap, this._valuesMap)) {
            return;
          }

          this._valuesMap = valuesMap;
          this.setComponent();
        };

        _proto.setComponent = function setComponent() {
          var _this2 = this;

          var formValuesSelector = function formValuesSelector(_, _ref2) {
            var sectionPrefix = _ref2.sectionPrefix;
            var getValues = _this2.props._reduxForm.getValues;
            var values = getValues();
            return (0, _mapValues2["default"])(_this2._valuesMap, function (path) {
              return getIn(values, (0, _prefixName["default"])(_this2.props, path));
            });
          };

          this.Component = (0, _reactRedux.connect)(formValuesSelector, function () {
            return {};
          })(function (_ref3) {
            var sectionPrefix = _ref3.sectionPrefix,
                otherProps = (0, _objectWithoutPropertiesLoose2["default"])(_ref3, ["sectionPrefix"]);
            return _react["default"].createElement(Component, otherProps);
          });
        };

        return FormValues;
      }(_react["default"].Component);

      return (0, _ReduxFormContext.withReduxForm)(FormValues);
    };
  };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNyZWF0ZUZvcm1WYWx1ZXMuanMiXSwibmFtZXMiOlsiX2ludGVyb3BSZXF1aXJlRGVmYXVsdCIsInJlcXVpcmUiLCJleHBvcnRzIiwiX19lc01vZHVsZSIsImNyZWF0ZVZhbHVlcyIsIl9vYmplY3RXaXRob3V0UHJvcGVydGllc0xvb3NlMiIsIl9leHRlbmRzMiIsIl9pbmhlcml0c0xvb3NlMiIsIl9tYXBWYWx1ZXMyIiwiX2lzRXF1YWwyIiwiX2lzRW1wdHkyIiwiX3JlYWN0IiwiX3JlYWN0UmVkdXgiLCJfcHJlZml4TmFtZSIsIl9SZWR1eEZvcm1Db250ZXh0IiwiX3JlZiIsImdldEluIiwiZmlyc3RBcmciLCJfbGVuIiwiYXJndW1lbnRzIiwibGVuZ3RoIiwicmVzdCIsIkFycmF5IiwiX2tleSIsIkNvbXBvbmVudCIsIkZvcm1WYWx1ZXMiLCJfUmVhY3QkQ29tcG9uZW50IiwicHJvcHMiLCJfdGhpcyIsImNhbGwiLCJfcmVkdXhGb3JtIiwiRXJyb3IiLCJ1cGRhdGVDb21wb25lbnQiLCJfcHJvdG8iLCJwcm90b3R5cGUiLCJVTlNBRkVfY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyIsInJlbmRlciIsImNyZWF0ZUVsZW1lbnQiLCJzZWN0aW9uUHJlZml4IiwidmFsdWVzTWFwIiwicmVzb2x2ZWRGaXJzdEFyZyIsIl9yZXN0JHJlZHVjZSIsInJlZHVjZSIsInJlc3VsdCIsImsiLCJfdmFsdWVzTWFwIiwic2V0Q29tcG9uZW50IiwiX3RoaXMyIiwiZm9ybVZhbHVlc1NlbGVjdG9yIiwiXyIsIl9yZWYyIiwiZ2V0VmFsdWVzIiwidmFsdWVzIiwicGF0aCIsImNvbm5lY3QiLCJfcmVmMyIsIm90aGVyUHJvcHMiLCJ3aXRoUmVkdXhGb3JtIl0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQSxJQUFJQSxzQkFBc0IsR0FBR0MsT0FBTyxDQUFDLDhDQUFELENBQXBDOztBQUVBQyxPQUFPLENBQUNDLFVBQVIsR0FBcUIsSUFBckI7QUFDQUQsT0FBTyxDQUFDLFNBQUQs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UDtBQUNELE9BekY2QixDQXlGNUJkLE1BQU0sQ0FBQyxTQUFELENBQU4sQ0FBa0JhLFNBekZVLENBQTlCOztBQTJGQSxhQUFPLENBQUMsR0FBR1YsaUJBQWlCLENBQUMyQyxhQUF0QixFQUFxQ2hDLFVBQXJDLENBQVA7QUFDRCxLQTdGRDtBQThGRCxHQXJHRDtBQXNHRCIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuXG52YXIgX2ludGVyb3BSZXF1aXJlRGVmYXVsdCA9IHJlcXVpcmUoXCJAYmFiZWwvcnVudGltZS9oZWxwZXJzL2ludGVyb3BSZXF1aXJlRGVmYXVsdFwiKTtcblxuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTtcbmV4cG9ydHNbXCJkZWZhdWx0XCJdID0gY3JlYXRlVmFsdWVzO1xuXG52YXIgX29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzTG9vc2UyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKFwiQGJhYmVsL3J1bnRpbWUvaGVscGVycy9vYmplY3RXaXRob3V0UHJvcGVydGllc0xvb3NlXCIpKTtcblxudmFyIF9leHRlbmRzMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZShcIkBiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXh0ZW5kc1wiKSk7XG5cbnZhciBfaW5oZXJpdHNMb29zZTIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoXCJAYmFiZWwvcnVudGltZS9oZWxwZXJzL2luaGVyaXRzTG9vc2VcIikpO1xuXG52YXIgX21hcFZhbHVlczIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoXCJsb2Rhc2gvbWFwVmFsdWVzXCIpKTtcblxudmFyIF9pc0VxdWFsMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZShcImxvZGFzaC9pc0VxdWFsXCIpKTtcblxudmFyIF9pc0VtcHR5MiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZShcImxvZGFzaC9pc0VtcHR5XCIpKTtcblxudmFyIF9yZWFjdCA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZShcInJlYWN0XCIpKTtcblxudmFyIF9yZWFjdFJlZHV4ID0gcmVxdWlyZShcInJlYWN0LXJlZHV4XCIpO1xuXG52YXIgX3ByZWZpeE5hbWUgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoXCIuL3V0aWwvcHJlZml4TmFtZVwiKSk7XG5cbnZhciBfUmVkdXhGb3JtQ29udGV4dCA9IHJlcXVpcmUoXCIuL1JlZHV4Rm9ybUNvbnRleHRcIik7XG5cbmZ1bmN0aW9uIGNyZWF0ZVZhbHVlcyhfcmVmKSB7XG4gIHZhciBnZXRJbiA9IF9yZWYuZ2V0SW47XG4gIHJldHVybiBmdW5jdGlvbiAoZmlyc3RBcmcpIHtcbiAgICBmb3IgKHZhciBfbGVuID0gYXJndW1lbnRzLmxlbmd0aCwgcmVzdCA9IG5ldyBBcnJheShfbGVuID4gMSA/IF9sZW4gLSAxIDogMCksIF9rZXkgPSAxOyBfa2V5IDwgX2xlbjsgX2tleSsrKSB7XG4gICAgICByZXN0W19rZXkgLSAxXSA9IGFyZ3VtZW50c1tfa2V5XTtcbiAgICB9XG5cbiAgICAvLyBjcmVhdGUgYSBjbGFzcyB0aGF0IHJlYWRzIGN1cnJlbnQgZm9ybSBuYW1lIGFuZCBjcmVhdGVzIGEgc2VsZWN0b3JcbiAgICAvLyByZXR1cm5cbiAgICByZXR1cm4gZnVuY3Rpb24gKENvbXBvbmVudCkge1xuICAgICAgdmFyIEZvcm1WYWx1ZXMgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKF9SZWFjdCRDb21wb25lbnQpIHtcbiAgICAgICAgKDAsIF9pbmhlcml0c0xvb3NlMltcImRlZmF1bHRcIl0pKEZvcm1WYWx1ZXMsIF9SZWFjdCRDb21wb25lbnQpO1xuXG4gICAgICAgIGZ1bmN0aW9uIEZvcm1WYWx1ZXMocHJvcHMpIHtcbiAgICAgICAgICB2YXIgX3RoaXM7XG5cbiAgICAgICAgICBfdGhpcyA9IF9SZWFjdCRDb21wb25lbnQuY2FsbCh0aGlzLCBwcm9wcykgfHwgdGhpcztcblxuICAgICAgICAgIGlmICghcHJvcHMuX3JlZHV4Rm9ybSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdmb3JtVmFsdWVzKCkgbXVzdCBiZSB1c2VkIGluc2lkZSBhIFJlYWN0IHRyZWUgZGVjb3JhdGVkIHdpdGggcmVkdXhGb3JtKCknKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBfdGhpcy51cGRhdGVDb21wb25lbnQocHJvcHMpO1xuXG4gICAgICAgICAgcmV0dXJuIF90aGlzO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIF9wcm90byA9IEZvcm1WYWx1ZXMucHJvdG90eXBlO1xuXG4gICAgICAgIF9wcm90by5VTlNBRkVfY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyA9IGZ1bmN0aW9uIFVOU0FGRV9jb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzKHByb3BzKSB7XG4gICAgICAgICAgaWYgKHR5cGVvZiBmaXJzdEFyZyA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICAgICAgdGhpcy51cGRhdGVDb21wb25lbnQocHJvcHMpO1xuICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICBfcHJvdG8ucmVuZGVyID0gZnVuY3Rpb24gcmVuZGVyKCkge1xuICAgICAgICAgIHZhciBDb21wb25lbnQgPSB0aGlzLkNvbXBvbmVudDtcbiAgICAgICAgICByZXR1cm4gLyojX19QVVJFX18qL19yZWFjdFtcImRlZmF1bHRcIl0uY3JlYXRlRWxlbWVudChDb21wb25lbnQgLy8gc28gdGhhdCB0aGUgY29ubmVjdGVkIGNvbXBvbmVudCB1cGRhdGVzIHByb3BzIHdoZW4gc2VjdGlvblByZWZpeCBoYXMgY2hhbmdlZFxuICAgICAgICAgICwgKDAsIF9leHRlbmRzMltcImRlZmF1bHRcIl0pKHtcbiAgICAgICAgICAgIHNlY3Rpb25QcmVmaXg6IHRoaXMucHJvcHMuX3JlZHV4Rm9ybS5zZWN0aW9uUHJlZml4XG4gICAgICAgICAgfSwgdGhpcy5wcm9wcykpO1xuICAgICAgICB9O1xuXG4gICAgICAgIF9wcm90by51cGRhdGVDb21wb25lbnQgPSBmdW5jdGlvbiB1cGRhdGVDb21wb25lbnQocHJvcHMpIHtcbiAgICAgICAgICB2YXIgdmFsdWVzTWFwO1xuICAgICAgICAgIHZhciByZXNvbHZlZEZpcnN0QXJnID0gdHlwZW9mIGZpcnN0QXJnID09PSAnZnVuY3Rpb24nID8gZmlyc3RBcmcocHJvcHMpIDogZmlyc3RBcmc7XG5cbiAgICAgICAgICBpZiAodHlwZW9mIHJlc29sdmVkRmlyc3RBcmcgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICB2YXIgX3Jlc3QkcmVkdWNlO1xuXG4gICAgICAgICAgICB2YWx1ZXNNYXAgPSByZXN0LnJlZHVjZShmdW5jdGlvbiAocmVzdWx0LCBrKSB7XG4gICAgICAgICAgICAgIHJlc3VsdFtrXSA9IGs7XG4gICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgICAgICB9LCAoX3Jlc3QkcmVkdWNlID0ge30sIF9yZXN0JHJlZHVjZVtyZXNvbHZlZEZpcnN0QXJnXSA9IHJlc29sdmVkRmlyc3RBcmcsIF9yZXN0JHJlZHVjZSkpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB2YWx1ZXNNYXAgPSByZXNvbHZlZEZpcnN0QXJnO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGlmICgoMCwgX2lzRW1wdHkyW1wiZGVmYXVsdFwiXSkodmFsdWVzTWFwKSkge1xuICAgICAgICAgICAgLy8gbWF5YmUgdGhhdCBlbXB0eSB2YWx1ZXNNYXAgaXMgb2sgaWYgZmlyc3RBcmcgaXMgYSBmdW5jdGlvbj9cbiAgICAgICAgICAgIC8vIGlmIHRoaXMgaXMgdGhlIGNhc2UsIHdlIHByb2JhYmx5IHNob3VsZCBzZXQgdGhpcy5Db21wb25lbnQgPSBDb21wb25lbnRcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignZm9ybVZhbHVlcygpOiBZb3UgbXVzdCBzcGVjaWZ5IHZhbHVlcyB0byBnZXQgYXMgZm9ybVZhbHVlcyhuYW1lMSwgbmFtZTIsIC4uLikgb3IgZm9ybVZhbHVlcyh7cHJvcE5hbWUxOiBwcm9wUGF0aDEsIC4uLn0pIG9yIGZvcm1WYWx1ZXMoKHByb3BzKSA9PiBuYW1lKSBvciBmb3JtVmFsdWVzKChwcm9wcykgPT4gKHtwcm9wTmFtZTE6IHByb3BQYXRoMSwgLi4ufSkpJyk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgaWYgKCgwLCBfaXNFcXVhbDJbXCJkZWZhdWx0XCJdKSh2YWx1ZXNNYXAsIHRoaXMuX3ZhbHVlc01hcCkpIHtcbiAgICAgICAgICAgIC8vIG5vIGNoYW5nZSBpbiB2YWx1ZXNNYXBcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICB0aGlzLl92YWx1ZXNNYXAgPSB2YWx1ZXNNYXA7XG4gICAgICAgICAgdGhpcy5zZXRDb21wb25lbnQoKTtcbiAgICAgICAgfTtcblxuICAgICAgICBfcHJvdG8uc2V0Q29tcG9uZW50ID0gZnVuY3Rpb24gc2V0Q29tcG9uZW50KCkge1xuICAgICAgICAgIHZhciBfdGhpczIgPSB0aGlzO1xuXG4gICAgICAgICAgdmFyIGZvcm1WYWx1ZXNTZWxlY3RvciA9IGZ1bmN0aW9uIGZvcm1WYWx1ZXNTZWxlY3RvcihfLCBfcmVmMikge1xuICAgICAgICAgICAgdmFyIHNlY3Rpb25QcmVmaXggPSBfcmVmMi5zZWN0aW9uUHJlZml4O1xuICAgICAgICAgICAgLy8gWWVzLCB3ZSdyZSBvbmx5IHVzaW5nIGNvbm5lY3QoKSBmb3IgbGlzdGVuaW5nIHRvIHVwZGF0ZXMuXG4gICAgICAgICAgICAvLyBUaGUgc2Vjb25kIGFyZ3VtZW50IG5lZWRzIHRvIGJlIHRoZXJlIHNvIHRoYXQgY29ubmVjdCBjYWxsc1xuICAgICAgICAgICAgLy8gdGhlIHNlbGVjdG9yIHdoZW4gcHJvcHMgY2hhbmdlXG4gICAgICAgICAgICB2YXIgZ2V0VmFsdWVzID0gX3RoaXMyLnByb3BzLl9yZWR1eEZvcm0uZ2V0VmFsdWVzO1xuICAgICAgICAgICAgdmFyIHZhbHVlcyA9IGdldFZhbHVlcygpO1xuICAgICAgICAgICAgcmV0dXJuICgwLCBfbWFwVmFsdWVzMltcImRlZmF1bHRcIl0pKF90aGlzMi5fdmFsdWVzTWFwLCBmdW5jdGlvbiAocGF0aCkge1xuICAgICAgICAgICAgICByZXR1cm4gZ2V0SW4odmFsdWVzLCAoMCwgX3ByZWZpeE5hbWVbXCJkZWZhdWx0XCJdKShfdGhpczIucHJvcHMsIHBhdGgpKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH07XG5cbiAgICAgICAgICB0aGlzLkNvbXBvbmVudCA9ICgwLCBfcmVhY3RSZWR1eC5jb25uZWN0KShmb3JtVmFsdWVzU2VsZWN0b3IsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiB7fTtcbiAgICAgICAgICB9IC8vIGlnbm9yZSBkaXNwYXRjaFxuICAgICAgICAgICkoZnVuY3Rpb24gKF9yZWYzKSB7XG4gICAgICAgICAgICB2YXIgc2VjdGlvblByZWZpeCA9IF9yZWYzLnNlY3Rpb25QcmVmaXgsXG4gICAgICAgICAgICAgICAgb3RoZXJQcm9wcyA9ICgwLCBfb2JqZWN0V2l0aG91dFByb3BlcnRpZXNMb29zZTJbXCJkZWZhdWx0XCJdKShfcmVmMywgW1wic2VjdGlvblByZWZpeFwiXSk7XG4gICAgICAgICAgICByZXR1cm4gLyojX19QVVJFX18qL19yZWFjdFtcImRlZmF1bHRcIl0uY3JlYXRlRWxlbWVudChDb21wb25lbnQsIG90aGVyUHJvcHMpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiBGb3JtVmFsdWVzO1xuICAgICAgfShfcmVhY3RbXCJkZWZhdWx0XCJdLkNvbXBvbmVudCk7XG5cbiAgICAgIHJldHVybiAoMCwgX1JlZHV4Rm9ybUNvbnRleHQud2l0aFJlZHV4Rm9ybSkoRm9ybVZhbHVlcyk7XG4gICAgfTtcbiAgfTtcbn0iXX0=