30ae01526f145e7d25952ea773be4cd9
var select = require('cheerio-select-tmp');

var utils = require('../utils');

var domEach = utils.domEach;

var uniqueSort = require('htmlparser2').DomUtils.uniqueSort;

var isTag = utils.isTag;

exports.find = function (selectorOrHaystack) {
  var elems = this.toArray().reduce(function (newElems, elem) {
    return newElems.concat(elem.children.filter(isTag));
  }, []);
  var contains = this.constructor.contains;
  var haystack;

  if (selectorOrHaystack && typeof selectorOrHaystack !== 'string') {
    if (selectorOrHaystack.cheerio) {
      haystack = selectorOrHaystack.get();
    } else {
      haystack = [selectorOrHaystack];
    }

    return this._make(haystack.filter(function (elem) {
      var idx;
      var len;

      for (idx = 0, len = this.length; idx < len; ++idx) {
        if (contains(this[idx], elem)) {
          return true;
        }
      }
    }, this));
  }

  var options = {
    __proto__: this.options,
    context: this.toArray()
  };
  return this._make(select.select(selectorOrHaystack || '', elems, options));
};

exports.parent = function (selector) {
  var set = [];
  domEach(this, function (idx, elem) {
    var parentElem = elem.parent;

    if (parentElem && parentElem.type !== 'root' && set.indexOf(parentElem) < 0) {
      set.push(parentElem);
    }
  });

  if (arguments.length) {
    set = exports.filter.call(set, selector, this);
  }

  return this._make(set);
};

exports.parents = function (selector) {
  var parentNodes = [];
  this.get().reverse().forEach(function (elem) {
    traverseParents(this, elem.parent, selector, Infinity).forEach(function (node) {
      if (parentNodes.indexOf(node) === -1) {
        parentNodes.push(node);
      }
    });
  }, this);
  return this._make(parentNodes);
};

exports.parentsUntil = function (selector, filter) {
  var parentNodes = [];
  var untilNode;
  var untilNodes;

  if (typeof selector === 'string') {
    untilNode = select.select(selector, this.parents().toArray(), this.options)[0];
  } else if (selector && selector.cheerio) {
    untilNodes = selector.toArray();
  } else if (selector) {
    untilNode = selector;
  }

  this.toArray().reverse().forEach(function (elem) {
    while (elem = elem.parent) {
      if (untilNode && elem !== untilNode || untilNodes && untilNodes.indexOf(elem) === -1 || !untilNode && !untilNodes) {
        if (isTag(elem) && parentNodes.indexOf(elem) === -1) {
          parentNodes.push(elem);
        }
      } else {
        break;
      }
    }
  }, this);
  return this._make(filter ? select.select(filter, parentNodes, this.options) : parentNodes);
};

exports.closest = function (selector) {
  var set = [];

  if (!selector) {
    return this._make(set);
  }

  domEach(this, function (idx, elem) {
    var closestElem = traverseParents(this, elem, selector, 1)[0];

    if (closestElem && set.indexOf(closestElem) < 0) {
      set.push(closestElem);
    }
  });
  return this._make(set);
};

exports.next = function (selector) {
  if (!this[0]) {
    return this;
  }

  var elems = [];
  this.toArray().forEach(function (elem) {
    while (elem = elem.next) {
      if (isTag(elem)) {
        elems.push(elem);
        return;
      }
    }
  });
  return selector ? exports.filter.call(elems, selector, this) : this._make(elems);
};

exports.nextAll = function (selector) {
  if (!this[0]) {
    return this;
  }

  var elems = [];
  this.toArray().forEach(function (elem) {
    while (elem = elem.next) {
      if (isTag(elem) && elems.indexOf(elem) === -1) {
        elems.push(elem);
      }
    }
  });
  return selector ? exports.filter.call(elems, selector, this) : this._make(elems);
};

exports.nextUntil = function (selector, filterSelector) {
  if (!this[0]) {
    return this;
  }

  var elems = [];
  var untilNode;
  var untilNodes;

  if (typeof selector === 'string') {
    untilNode = select.select(selector, this.nextAll().get(), this.options)[0];
  } else if (selector && selector.cheerio) {
    untilNodes = selector.get();
  } else if (selector) {
    untilNode = selector;
  }

  this.toArray().forEach(function (elem) {
    while (elem = elem.next) {
      if (untilNode && elem !== untilNode || untilNodes && untilNodes.indexOf(elem) === -1 || !untilNode && !untilNodes) {
        if (isTag(elem) && elems.indexOf(elem) === -1) {
          elems.push(elem);
        }
      } else {
        break;
      }
    }
  });
  return filterSelector ? exports.filter.call(elems, filterSelector, this) : this._make(elems);
};

exports.prev = function (selector) {
  if (!this[0]) {
    return this;
  }

  var elems = [];
  this.toArray().forEach(function (elem) {
    while (elem = elem.prev) {
      if (isTag(elem)) {
        elems.push(elem);
        return;
      }
    }
  });
  return selector ? exports.filter.call(elems, selector, this) : this._make(elems);
};

exports.prevAll = function (selector) {
  if (!this[0]) {
    return this;
  }

  var elems = [];
  this.toArray().forEach(function (elem) {
    while (elem = elem.prev) {
      if (isTag(elem) && elems.indexOf(elem) === -1) {
        elems.push(elem);
      }
    }
  });
  return selector ? exports.filter.call(elems, selector, this) : this._make(elems);
};

exports.prevUntil = function (selector, filterSelector) {
  if (!this[0]) {
    return this;
  }

  var elems = [];
  var untilNode;
  var untilNodes;

  if (typeof selector === 'string') {
    untilNode = select.select(selector, this.prevAll().get(), this.options)[0];
  } else if (selector && selector.cheerio) {
    untilNodes = selector.get();
  } else if (selector) {
    untilNode = selector;
  }

  this.toArray().forEach(function (elem) {
    while (elem = elem.prev) {
      if (untilNode && elem !== untilNode || untilNodes && untilNodes.indexOf(elem) === -1 || !untilNode && !untilNodes) {
        if (isTag(elem) && elems.indexOf(elem) === -1) {
          elems.push(elem);
        }
      } else {
        break;
      }
    }
  });
  return filterSelector ? exports.filter.call(elems, filterSelector, this) : this._make(elems);
};

exports.siblings = function (selector) {
  var parent = this.parent();
  var elems = (parent ? parent.children() : this.siblingsAndMe()).toArray().filter(function (elem) {
    return isTag(elem) && !this.is(elem);
  }, this);

  if (selector !== undefined) {
    return exports.filter.call(elems, selector, this);
  }

  return this._make(elems);
};

exports.children = function (selector) {
  var elems = this.toArray().reduce(function (newElems, elem) {
    return newElems.concat(elem.children.filter(isTag));
  }, []);
  if (selector === undefined) return this._make(elems);
  return exports.filter.call(elems, selector, this);
};

exports.contents = function () {
  var elems = this.toArray().reduce(function (newElems, elem) {
    return newElems.concat(elem.children);
  }, []);
  return this._make(elems);
};

exports.each = function (fn) {
  var i = 0;
  var len = this.length;

  while (i < len && fn.call(this[i], i, this[i]) !== false) {
    ++i;
  }

  return this;
};

exports.map = function (fn) {
  var elems = [];

  for (var i = 0; i < this.length; i++) {
    var el = this[i];
    var val = fn.call(el, i, el);

    if (val != null) {
      elems = elems.concat(val);
    }
  }

  return this._make(elems);
};

function getFilterFn(match) {
  if (typeof match === 'function') {
    return function (el, i) {
      return match.call(el, i, el);
    };
  } else if (match.cheerio) {
    return match.is.bind(match);
  }

  return function (el) {
    return match === el;
  };
}

exports.filter = function (match, container) {
  container = container || this;
  var elements = this.toArray ? this.toArray() : this;

  if (typeof match === 'string') {
    elements = select.filter(match, elements, container.options);
  } else {
    elements = elements.filter(getFilterFn(match));
  }

  return container._make(elements);
};

exports.not = function (match, container) {
  container = container || this;
  var elements = container.toArray ? container.toArray() : container;
  var matches;
  var filterFn;

  if (typeof match === 'string') {
    matches = new Set(select.filter(match, elements, this.options));
    elements = elements.filter(function (el) {
      return !matches.has(el);
    });
  } else {
    filterFn = getFilterFn(match);
    elements = elements.filter(function (el, i) {
      return !filterFn(el, i);
    });
  }

  return container._make(elements);
};

exports.has = function (selectorOrHaystack) {
  var that = this;
  return exports.filter.call(this, function () {
    return that._make(this).find(selectorOrHaystack).length > 0;
  });
};

exports.first = function () {
  return this.length > 1 ? this._make(this[0]) : this;
};

exports.last = function () {
  return this.length > 1 ? this._make(this[this.length - 1]) : this;
};

exports.eq = function (i) {
  i = +i;
  if (i === 0 && this.length <= 1) return this;
  if (i < 0) i = this.length + i;
  return this[i] ? this._make(this[i]) : this._make([]);
};

exports.get = function (i) {
  if (i == null) {
    return Array.prototype.slice.call(this);
  }

  return this[i < 0 ? this.length + i : i];
};

exports.index = function (selectorOrNeedle) {
  var $haystack;
  var needle;

  if (arguments.length === 0) {
    $haystack = this.parent().children();
    needle = this[0];
  } else if (typeof selectorOrNeedle === 'string') {
    $haystack = this._make(selectorOrNeedle);
    needle = this[0];
  } else {
    $haystack = this;
    needle = selectorOrNeedle.cheerio ? selectorOrNeedle[0] : selectorOrNeedle;
  }

  return $haystack.get().indexOf(needle);
};

exports.slice = function () {
  return this._make([].slice.apply(this, arguments));
};

function traverseParents(self, elem, selector, limit) {
  var elems = [];

  while (elem && elems.length < limit && elem.type !== 'root') {
    if (!selector || exports.filter.call([elem], selector, self).length) {
      elems.push(elem);
    }

    elem = elem.parent;
  }

  return elems;
}

exports.end = function () {
  return this.prevObject || this._make([]);
};

exports.add = function (other, context) {
  var selection = this._make(other, context);

  var contents = uniqueSort(selection.get().concat(this.get()));

  for (var i = 0; i < contents.length; ++i) {
    selection[i] = contents[i];
  }

  selection.length = contents.length;
  return selection;
};

exports.addBack = function (selector) {
  return this.add(arguments.length ? this.prevObject.filter(selector) : this.prevObject);
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRyYXZlcnNpbmcuanMiXSwibmFtZXMiOlsic2VsZWN0IiwicmVxdWlyZSIsInV0aWxzIiwiZG9tRWFjaCIsInVuaXF1ZVNvcnQiLCJEb21VdGlscyIsImlzVGFnIiwiZXhwb3J0cyIsImZpbmQiLCJzZWxlY3Rvck9ySGF5c3RhY2siLCJlbGVtcyIsInRvQXJyYXkiLCJyZWR1Y2UiLCJuZXdFbGVtcyIsImVsZW0iLCJjb25jYXQiLCJjaGlsZHJlbiIsImZpbHRlciIsImNvbnRhaW5zIiwiY29uc3RydWN0b3IiLCJoYXlzdGFjayIsImNoZWVyaW8iLCJnZXQiLCJfbWFrZSIsImlkeCIsImxlbiIsImxlbmd0aCIsIm9wdGlvbnMiLCJfX3Byb3RvX18iLCJjb250ZXh0IiwicGFyZW50Iiwic2VsZWN0b3IiLCJzZXQiLCJwYXJlbnRFbGVtIiwidHlwZSIsImluZGV4T2YiLCJwdXNoIiwiYXJndW1lbnRzIiwiY2FsbCIsInBhcmVudHMiLCJwYXJlbnROb2RlcyIsInJldmVyc2UiLCJmb3JFYWNoIiwidHJhdmVyc2VQYXJlbnRzIiwiSW5maW5pdHkiLCJub2RlIiwicGFyZW50c1VudGlsIiwidW50aWxOb2RlIiwidW50aWxOb2RlcyIsImNsb3Nlc3QiLCJjbG9zZXN0RWxlbSIsIm5leHQiLCJuZXh0QWxsIiwibmV4dFVudGlsIiwiZmlsdGVyU2VsZWN0b3IiLCJwcmV2IiwicHJldkFsbCIsInByZXZVbnRpbCIsInNpYmxpbmdzIiwic2libGluZ3NBbmRNZSIsImlzIiwidW5kZWZpbmVkIiwiY29udGVudHMiLCJlYWNoIiwiZm4iLCJpIiwibWFwIiwiZWwiLCJ2YWwiLCJnZXRGaWx0ZXJGbiIsIm1hdGNoIiwiYmluZCIsImNvbnRhaW5lciIsImVsZW1lbnRzIiwibm90IiwibWF0Y2hlcyIsImZpbHRlckZuIiwiU2V0IiwiaGFzIiwidGhhdCIsImZpcnN0IiwibGFzdCIsImVxIiwiQXJyYXkiLCJwcm90b3R5cGUiLCJzbGljZSIsImluZGV4Iiwic2VsZWN0b3JPck5lZWRsZSIsIiRoYXlzdGFjayIsIm5lZWRsZSIsImFwcGx5Iiwic2VsZiIsImxpbWl0IiwiZW5kIiwicHJldk9iamVjdCIsImFkZCIsIm90aGVyIiwic2VsZWN0aW9uIiwiYWRkQmFjayJdLCJtYXBwaW5ncyI6IkFBTUEsSUFBSUEsTUFBTSxHQUFHQyxPQUFPLENBQUMsb0JBQUQsQ0FBcEI7O0FBQ0EsSUFBSUMsS0FBSyxHQUFHRCxPQUFPLENBQUMsVUFBRCxDQUFuQjs7QUFDQSxJQUFJRSxPQUFPLEdBQUdELEtBQUssQ0FBQ0MsT0FBcEI7O0FBQ0EsSUFBSUMsVUFBVSxHQUFHSCxPQUFPLENBQUMsYUFBRCxDQUFQLENBQXVCSSxRQUF2QixDQUFnQ0QsVUFBakQ7O0FBQ0EsSUFBSUUsS0FBSyxHQUFHSixLQUFLLENBQUNJLEtBQWxCOztBQWlCQUMsT0FBTyxDQUFDQyxJQUFSLEdBQWUsVUFBVUMsa0JBQVYsRUFBOEI7QUFDM0MsTUFBSUMsS0FBSyxHQUFHLEtBQUtDLE9BQUwsR0FBZUMsTUFBZixDQUFzQixVQUFVQyxRQUFWLEVBQW9CQyxJQUFwQixFQUEwQjtBQUMxRCxXQUFPRCxRQUFRLENBQUNFLE1BQVQsQ0FBZ0JELElBQUksQ0FBQ0UsUUFBTCxDQUFjQyxNQUFkLENBQXFCWCxLQUFyQixDQUFoQixDQUFQO0FBQ0QsR0FGVyxFQUVULEVBRlMsQ0FBWjtBQUdBLE1BQUlZLFFBQVEsR0FBRyxLQUFLQyxXQUFMLENBQWlCRCxRQUFoQztBQUNBLE1BQUlFLFFBQUo7O0FBRUEsTUFBSVgsa0JBQWtCLElBQUksT0FBT0Esa0JBQVAsS0FBOEIsUUFBeEQsRUFBa0U7QUFDaEUsUUFBSUEsa0JBQWtCLENBQUNZLE9BQXZCLEVBQWdDO0FBQzlCRCxNQUFBQSxRQUFRLEdBQUdYLGtCQUFrQixDQUFDYSxHQUFuQixFQUFYO0FBQ0QsS0FGRCxNQUVPO0FBQ0xGLE1BQUFBLFFBQVEsR0FBRyxDQUFDWCxrQkFBRCxDQUFYO0FBQ0Q7O0FBRUQsV0FBTyxLQUFLYyxLQUFMLENBQ0xILFFBQVEsQ0FBQ0gsTUFBVCxDQUFn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QUFWLEVBQW9CO0FBQ3BDLFNBQU8sS0FBS2dFLEdBQUwsQ0FDTDFELFNBQVMsQ0FBQ1gsTUFBVixHQUFtQixLQUFLb0UsVUFBTCxDQUFnQjdFLE1BQWhCLENBQXVCYyxRQUF2QixDQUFuQixHQUFzRCxLQUFLK0QsVUFEdEQsQ0FBUDtBQUdELENBSkQiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIE1ldGhvZHMgZm9yIHRyYXZlcnNpbmcgdGhlIERPTSBzdHJ1Y3R1cmUuXG4gKlxuICogQG1vZHVsZSBjaGVlcmlvL3RyYXZlcnNpbmdcbiAqL1xuXG52YXIgc2VsZWN0ID0gcmVxdWlyZSgnY2hlZXJpby1zZWxlY3QtdG1wJyk7XG52YXIgdXRpbHMgPSByZXF1aXJlKCcuLi91dGlscycpO1xudmFyIGRvbUVhY2ggPSB1dGlscy5kb21FYWNoO1xudmFyIHVuaXF1ZVNvcnQgPSByZXF1aXJlKCdodG1scGFyc2VyMicpLkRvbVV0aWxzLnVuaXF1ZVNvcnQ7XG52YXIgaXNUYWcgPSB1dGlscy5pc1RhZztcblxuLyoqXG4gKiBHZXQgdGhlIGRlc2NlbmRhbnRzIG9mIGVhY2ggZWxlbWVudCBpbiB0aGUgY3VycmVudCBzZXQgb2YgbWF0Y2hlZCBlbGVtZW50cyxcbiAqIGZpbHRlcmVkIGJ5IGEgc2VsZWN0b3IsIGpRdWVyeSBvYmplY3QsIG9yIGVsZW1lbnQuXG4gKlxuICogQGV4YW1wbGVcbiAqXG4gKiAkKCcjZnJ1aXRzJykuZmluZCgnbGknKS5sZW5ndGhcbiAqIC8vPT4gM1xuICogJCgnI2ZydWl0cycpLmZpbmQoJCgnLmFwcGxlJykpLmxlbmd0aFxuICogLy89PiAxXG4gKlxuICogQHBhcmFtIHtzdHJpbmd8Y2hlZXJpb3xub2RlfSBzZWxlY3Rvck9ySGF5c3RhY2sgLSBFbGVtZW50IHRvIGxvb2sgZm9yLlxuICpcbiAqIEBzZWUge0BsaW5rIGh0dHA6Ly9hcGkuanF1ZXJ5LmNvbS9maW5kL31cbiAqL1xuZXhwb3J0cy5maW5kID0gZnVuY3Rpb24gKHNlbGVjdG9yT3JIYXlzdGFjaykge1xuICB2YXIgZWxlbXMgPSB0aGlzLnRvQXJyYXkoKS5yZWR1Y2UoZnVuY3Rpb24gKG5ld0VsZW1zLCBlbGVtKSB7XG4gICAgcmV0dXJuIG5ld0VsZW1zLmNvbmNhdChlbGVtLmNoaWxkcmVuLmZpbHRlcihpc1RhZykpO1xuICB9LCBbXSk7XG4gIHZhciBjb250YWlucyA9IHRoaXMuY29uc3RydWN0b3IuY29udGFpbnM7XG4gIHZhciBoYXlzdGFjaztcblxuICBpZiAoc2VsZWN0b3JPckhheXN0YWNrICYmIHR5cGVvZiBzZWxlY3Rvck9ySGF5c3RhY2sgIT09ICdzdHJpbmcnKSB7XG4gICAgaWYgKHNlbGVjdG9yT3JIYXlzdGFjay5jaGVlcmlvKSB7XG4gICAgICBoYXlzdGFjayA9IHNlbGVjdG9yT3JIYXlzdGFjay5nZXQoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgaGF5c3RhY2sgPSBbc2VsZWN0b3JPckhheXN0YWNrXTtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5fbWFrZShcbiAgICAgIGhheXN0YWNrLmZpbHRlcihmdW5jdGlvbiAoZWxlbSkge1xuICAgICAgICB2YXIgaWR4O1xuICAgICAgICB2YXIgbGVuO1xuICAgICAgICBmb3IgKGlkeCA9IDAsIGxlbiA9IHRoaXMubGVuZ3RoOyBpZHggPCBsZW47ICsraWR4KSB7XG4gICAgICAgICAgaWYgKGNvbnRhaW5zKHRoaXNbaWR4XSwgZWxlbSkpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSwgdGhpcylcbiAgICApO1xuICB9XG5cbiAgdmFyIG9wdGlvbnMgPSB7IF9fcHJvdG9fXzogdGhpcy5vcHRpb25zLCBjb250ZXh0OiB0aGlzLnRvQXJyYXkoKSB9O1xuXG4gIHJldHVybiB0aGlzLl9tYWtlKHNlbGVjdC5zZWxlY3Qoc2VsZWN0b3JPckhheXN0YWNrIHx8ICcnLCBlbGVtcywgb3B0aW9ucykpO1xufTtcblxuLyoqXG4gKiBHZXQgdGhlIHBhcmVudCBvZiBlYWNoIGVsZW1lbnQgaW4gdGhlIGN1cnJlbnQgc2V0IG9mIG1hdGNoZWQgZWxlbWVudHMsXG4gKiBvcHRpb25hbGx5IGZpbHRlcmVkIGJ5IGEgc2VsZWN0b3IuXG4gKlxuICogQGV4YW1wbGVcbiAqXG4gKiAkKCcucGVhcicpLnBhcmVudCgpLmF0dHIoJ2lkJylcbiAqIC8vPT4gZnJ1aXRzXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IFtzZWxlY3Rvcl0gLSBJZiBzcGVjaWZpZWQgZmlsdGVyIGZvciBwYXJlbnQuXG4gKlxuICogQHNlZSB7QGxpbmsgaHR0cDovL2FwaS5qcXVlcnkuY29tL3BhcmVudC99XG4gKi9cbmV4cG9ydHMucGFyZW50ID0gZnVuY3Rpb24gKHNlbGVjdG9yKSB7XG4gIHZhciBzZXQgPSBbXTtcblxuICBkb21FYWNoKHRoaXMsIGZ1bmN0aW9uIChpZHgsIGVsZW0pIHtcbiAgICB2YXIgcGFyZW50RWxlbSA9IGVsZW0ucGFyZW50O1xuICAgIGlmIChcbiAgICAgIHBhcmVudEVsZW0gJiZcbiAgICAgIHBhcmVudEVsZW0udHlwZSAhPT0gJ3Jvb3QnICYmXG4gICAgICBzZXQuaW5kZXhPZihwYXJlbnRFbGVtKSA8IDBcbiAgICApIHtcbiAgICAgIHNldC5wdXNoKHBhcmVudEVsZW0pO1xuICAgIH1cbiAgfSk7XG5cbiAgaWYgKGFyZ3VtZW50cy5sZW5ndGgpIHtcbiAgICBzZXQgPSBleHBvcnRzLmZpbHRlci5jYWxsKHNldCwgc2VsZWN0b3IsIHRoaXMpO1xuICB9XG5cbiAgcmV0dXJuIHRoaXMuX21ha2Uoc2V0KTtcbn07XG5cbi8qKlxuICogR2V0IGEgc2V0IG9mIHBhcmVudHMgZmlsdGVyZWQgYnkgYHNlbGVjdG9yYCBvZiBlYWNoIGVsZW1lbnQgaW4gdGhlIGN1cnJlbnRcbiAqIHNldCBvZiBtYXRjaCBlbGVtZW50cy5cbiAqXG4gKiBAZXhhbXBsZVxuICpcbiAqICQoJy5vcmFuZ2UnKS5wYXJlbnRzKCkubGVuZ3RoXG4gKiAvLyA9PiAyXG4gKiAkKCcub3JhbmdlJykucGFyZW50cygnI2ZydWl0cycpLmxlbmd0aFxuICogLy8gPT4gMVxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBbc2VsZWN0b3JdIC0gSWYgc3BlY2lmaWVkIGZpbHRlciBmb3IgcGFyZW50cy5cbiAqXG4gKiBAc2VlIHtAbGluayBodHRwOi8vYXBpLmpxdWVyeS5jb20vcGFyZW50cy99XG4gKi9cbmV4cG9ydHMucGFyZW50cyA9IGZ1bmN0aW9uIChzZWxlY3Rvcikge1xuICB2YXIgcGFyZW50Tm9kZXMgPSBbXTtcblxuICAvLyBXaGVuIG11bHRpcGxlIERPTSBlbGVtZW50cyBhcmUgaW4gdGhlIG9yaWdpbmFsIHNldCwgdGhlIHJlc3VsdGluZyBzZXQgd2lsbFxuICAvLyBiZSBpbiAqcmV2ZXJzZSogb3JkZXIgb2YgdGhlIG9yaWdpbmFsIGVsZW1lbnRzIGFzIHdlbGwsIHdpdGggZHVwbGljYXRlc1xuICAvLyByZW1vdmVkLlxuICB0aGlzLmdldCgpXG4gICAgLnJldmVyc2UoKVxuICAgIC5mb3JFYWNoKGZ1bmN0aW9uIChlbGVtKSB7XG4gICAgICB0cmF2ZXJzZVBhcmVudHModGhpcywgZWxlbS5wYXJlbnQsIHNlbGVjdG9yLCBJbmZpbml0eSkuZm9yRWFjaChmdW5jdGlvbiAoXG4gICAgICAgIG5vZGVcbiAgICAgICkge1xuICAgICAgICBpZiAocGFyZW50Tm9kZXMuaW5kZXhPZihub2RlKSA9PT0gLTEpIHtcbiAgICAgICAgICBwYXJlbnROb2Rlcy5wdXNoKG5vZGUpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9LCB0aGlzKTtcblxuICByZXR1cm4gdGhpcy5fbWFrZShwYXJlbnROb2Rlcyk7XG59O1xuXG4vKipcbiAqIEdldCB0aGUgYW5jZXN0b3JzIG9mIGVhY2ggZWxlbWVudCBpbiB0aGUgY3VycmVudCBzZXQgb2YgbWF0Y2hlZCBlbGVtZW50cywgdXBcbiAqIHRvIGJ1dCBub3QgaW5jbHVkaW5nIHRoZSBlbGVtZW50IG1hdGNoZWQgYnkgdGhlIHNlbGVjdG9yLCBET00gbm9kZSwgb3JcbiAqIGNoZWVyaW8gb2JqZWN0LlxuICpcbiAqIEBleGFtcGxlXG4gKlxuICogJCgnLm9yYW5nZScpLnBhcmVudHNVbnRpbCgnI2Zvb2QnKS5sZW5ndGhcbiAqIC8vID0+IDFcbiAqXG4gKiBAcGFyYW0ge3N0cmluZ3xub2RlfGNoZWVyaW99IHNlbGVjdG9yIC0gU2VsZWN0b3IgZm9yIGVsZW1lbnQgdG8gc3RvcCBhdC5cbiAqIEBwYXJhbSB7c3RyaW5nfEZ1bmN0aW9ufSBbZmlsdGVyXSAtIE9wdGlvbmFsIGZpbHRlciBmb3IgcGFyZW50cy5cbiAqXG4gKiBAc2VlIHtAbGluayBodHRwOi8vYXBpLmpxdWVyeS5jb20vcGFyZW50c1VudGlsL31cbiAqL1xuZXhwb3J0cy5wYXJlbnRzVW50aWwgPSBmdW5jdGlvbiAoc2VsZWN0b3IsIGZpbHRlcikge1xuICB2YXIgcGFyZW50Tm9kZXMgPSBbXTtcbiAgdmFyIHVudGlsTm9kZTtcbiAgdmFyIHVudGlsTm9kZXM7XG5cbiAgaWYgKHR5cGVvZiBzZWxlY3RvciA9PT0gJ3N0cmluZycpIHtcbiAgICB1bnRpbE5vZGUgPSBzZWxlY3Quc2VsZWN0KFxuICAgICAgc2VsZWN0b3IsXG4gICAgICB0aGlzLnBhcmVudHMoKS50b0FycmF5KCksXG4gICAgICB0aGlzLm9wdGlvbnNcbiAgICApWzBdO1xuICB9IGVsc2UgaWYgKHNlbGVjdG9yICYmIHNlbGVjdG9yLmNoZWVyaW8pIHtcbiAgICB1bnRpbE5vZGVzID0gc2VsZWN0b3IudG9BcnJheSgpO1xuICB9IGVsc2UgaWYgKHNlbGVjdG9yKSB7XG4gICAgdW50aWxOb2RlID0gc2VsZWN0b3I7XG4gIH1cblxuICAvLyBXaGVuIG11bHRpcGxlIERPTSBlbGVtZW50cyBhcmUgaW4gdGhlIG9yaWdpbmFsIHNldCwgdGhlIHJlc3VsdGluZyBzZXQgd2lsbFxuICAvLyBiZSBpbiAqcmV2ZXJzZSogb3JkZXIgb2YgdGhlIG9yaWdpbmFsIGVsZW1lbnRzIGFzIHdlbGwsIHdpdGggZHVwbGljYXRlc1xuICAvLyByZW1vdmVkLlxuXG4gIHRoaXMudG9BcnJheSgpXG4gICAgLnJldmVyc2UoKVxuICAgIC5mb3JFYWNoKGZ1bmN0aW9uIChlbGVtKSB7XG4gICAgICB3aGlsZSAoKGVsZW0gPSBlbGVtLnBhcmVudCkpIHtcbiAgICAgICAgaWYgKFxuICAgICAgICAgICh1bnRpbE5vZGUgJiYgZWxlbSAhPT0gdW50aWxOb2RlKSB8fFxuICAgICAgICAgICh1bnRpbE5vZGVzICYmIHVudGlsTm9kZXMuaW5kZXhPZihlbGVtKSA9PT0gLTEpIHx8XG4gICAgICAgICAgKCF1bnRpbE5vZGUgJiYgIXVudGlsTm9kZXMpXG4gICAgICAgICkge1xuICAgICAgICAgIGlmIChpc1RhZyhlbGVtKSAmJiBwYXJlbnROb2Rlcy5pbmRleE9mKGVsZW0pID09PSAtMSkge1xuICAgICAgICAgICAgcGFyZW50Tm9kZXMucHVzaChlbGVtKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LCB0aGlzKTtcblxuICByZXR1cm4gdGhpcy5fbWFrZShcbiAgICBmaWx0ZXIgPyBzZWxlY3Quc2VsZWN0KGZpbHRlciwgcGFyZW50Tm9kZXMsIHRoaXMub3B0aW9ucykgOiBwYXJlbnROb2Rlc1xuICApO1xufTtcblxuLyoqXG4gKiBGb3IgZWFjaCBlbGVtZW50IGluIHRoZSBzZXQsIGdldCB0aGUgZmlyc3QgZWxlbWVudCB0aGF0IG1hdGNoZXMgdGhlIHNlbGVjdG9yXG4gKiBieSB0ZXN0aW5nIHRoZSBlbGVtZW50IGl0c2VsZiBhbmQgdHJhdmVyc2luZyB1cCB0aHJvdWdoIGl0cyBhbmNlc3RvcnMgaW5cbiAqIHRoZSBET00gdHJlZS5cbiAqXG4gKiBAZXhhbXBsZVxuICpcbiAqICQoJy5vcmFuZ2UnKS5jbG9zZXN0KClcbiAqIC8vID0+IFtdXG4gKiAkKCcub3JhbmdlJykuY2xvc2VzdCgnLmFwcGxlJylcbiAqIC8vID0+IFtdXG4gKiAkKCcub3JhbmdlJykuY2xvc2VzdCgnbGknKVxuICogLy8gPT4gWzxsaSBjbGFzcz1cIm9yYW5nZVwiPk9yYW5nZTwvbGk+XVxuICogJCgnLm9yYW5nZScpLmNsb3Nlc3QoJyNmcnVpdHMnKVxuICogLy8gPT4gWzx1bCBpZD1cImZydWl0c1wiPiAuLi4gPC91bD5dXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IFtzZWxlY3Rvcl0gLSBTZWxlY3RvciBmb3IgdGhlIGVsZW1lbnQgdG8gZmluZC5cbiAqXG4gKiBAc2VlIHtAbGluayBodHRwOi8vYXBpLmpxdWVyeS5jb20vY2xvc2VzdC99XG4gKi9cbmV4cG9ydHMuY2xvc2VzdCA9IGZ1bmN0aW9uIChzZWxlY3Rvcikge1xuICB2YXIgc2V0ID0gW107XG5cbiAgaWYgKCFzZWxlY3Rvcikge1xuICAgIHJldHVybiB0aGlzLl9tYWtlKHNldCk7XG4gIH1cblxuICBkb21FYWNoKHRoaXMsIGZ1bmN0aW9uIChpZHgsIGVsZW0pIHtcbiAgICB2YXIgY2xvc2VzdEVsZW0gPSB0cmF2ZXJzZVBhcmVudHModGhpcywgZWxlbSwgc2VsZWN0b3IsIDEpWzBdO1xuXG4gICAgLy8gRG8gbm90IGFkZCBkdXBsaWNhdGUgZWxlbWVudHMgdG8gdGhlIHNldFxuICAgIGlmIChjbG9zZXN0RWxlbSAmJiBzZXQuaW5kZXhPZihjbG9zZXN0RWxlbSkgPCAwKSB7XG4gICAgICBzZXQucHVzaChjbG9zZXN0RWxlbSk7XG4gICAgfVxuICB9KTtcblxuICByZXR1cm4gdGhpcy5fbWFrZShzZXQpO1xufTtcblxuLyoqXG4gKiBHZXRzIHRoZSBuZXh0IHNpYmxpbmcgb2YgdGhlIGZpcnN0IHNlbGVjdGVkIGVsZW1lbnQsIG9wdGlvbmFsbHkgZmlsdGVyZWQgYnlcbiAqIGEgc2VsZWN0b3IuXG4gKlxuICogQGV4YW1wbGVcbiAqXG4gKiAkKCcuYXBwbGUnKS5uZXh0KCkuaGFzQ2xhc3MoJ29yYW5nZScpXG4gKiAvLz0+IHRydWVcbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gW3NlbGVjdG9yXSAtIElmIHNwZWNpZmllZCBmaWx0ZXIgZm9yIHNpYmxpbmcuXG4gKlxuICogQHNlZSB7QGxpbmsgaHR0cDovL2FwaS5qcXVlcnkuY29tL25leHQvfVxuICovXG5leHBvcnRzLm5leHQgPSBmdW5jdGlvbiAoc2VsZWN0b3IpIHtcbiAgaWYgKCF0aGlzWzBdKSB7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cbiAgdmFyIGVsZW1zID0gW107XG5cbiAgdGhpcy50b0FycmF5KCkuZm9yRWFjaChmdW5jdGlvbiAoZWxlbSkge1xuICAgIHdoaWxlICgoZWxlbSA9IGVsZW0ubmV4dCkpIHtcbiAgICAgIGlmIChpc1RhZyhlbGVtKSkge1xuICAgICAgICBlbGVtcy5wdXNoKGVsZW0pO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgfVxuICB9KTtcblxuICByZXR1cm4gc2VsZWN0b3JcbiAgICA/IGV4cG9ydHMuZmlsdGVyLmNhbGwoZWxlbXMsIHNlbGVjdG9yLCB0aGlzKVxuICAgIDogdGhpcy5fbWFrZShlbGVtcyk7XG59O1xuXG4vKipcbiAqIEdldHMgYWxsIHRoZSBmb2xsb3dpbmcgc2libGluZ3Mgb2YgdGhlIGZpcnN0IHNlbGVjdGVkIGVsZW1lbnQsIG9wdGlvbmFsbHlcbiAqIGZpbHRlcmVkIGJ5IGEgc2VsZWN0b3IuXG4gKlxuICogQGV4YW1wbGVcbiAqXG4gKiAkKCcuYXBwbGUnKS5uZXh0QWxsKClcbiAqIC8vPT4gWzxsaSBjbGFzcz1cIm9yYW5nZVwiPk9yYW5nZTwvbGk+LCA8bGkgY2xhc3M9XCJwZWFyXCI+UGVhcjwvbGk+XVxuICogJCgnLmFwcGxlJykubmV4dEFsbCgnLm9yYW5nZScpXG4gKiAvLz0+IFs8bGkgY2xhc3M9XCJvcmFuZ2VcIj5PcmFuZ2U8L2xpPl1cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gW3NlbGVjdG9yXSAtIElmIHNwZWNpZmllZCBmaWx0ZXIgZm9yIHNpYmxpbmdzLlxuICpcbiAqIEBzZWUge0BsaW5rIGh0dHA6Ly9hcGkuanF1ZXJ5LmNvbS9uZXh0QWxsL31cbiAqL1xuZXhwb3J0cy5uZXh0QWxsID0gZnVuY3Rpb24gKHNlbGVjdG9yKSB7XG4gIGlmICghdGhpc1swXSkge1xuICAgIHJldHVybiB0aGlzO1xuICB9XG4gIHZhciBlbGVtcyA9IFtdO1xuXG4gIHRoaXMudG9BcnJheSgpLmZvckVhY2goZnVuY3Rpb24gKGVsZW0pIHtcbiAgICB3aGlsZSAoKGVsZW0gPSBlbGVtLm5leHQpKSB7XG4gICAgICBpZiAoaXNUYWcoZWxlbSkgJiYgZWxlbXMuaW5kZXhPZihlbGVtKSA9PT0gLTEpIHtcbiAgICAgICAgZWxlbXMucHVzaChlbGVtKTtcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xuXG4gIHJldHVybiBzZWxlY3RvclxuICAgID8gZXhwb3J0cy5maWx0ZXIuY2FsbChlbGVtcywgc2VsZWN0b3IsIHRoaXMpXG4gICAgOiB0aGlzLl9tYWtlKGVsZW1zKTtcbn07XG5cbi8qKlxuICogR2V0cyBhbGwgdGhlIGZvbGxvd2luZyBzaWJsaW5ncyB1cCB0byBidXQgbm90IGluY2x1ZGluZyB0aGUgZWxlbWVudCBtYXRjaGVkXG4gKiBieSB0aGUgc2VsZWN0b3IsIG9wdGlvbmFsbHkgZmlsdGVyZWQgYnkgYW5vdGhlciBzZWxlY3Rvci5cbiAqXG4gKiBAZXhhbXBsZVxuICpcbiAqICQoJy5hcHBsZScpLm5leHRVbnRpbCgnLnBlYXInKVxuICogLy89PiBbPGxpIGNsYXNzPVwib3JhbmdlXCI+T3JhbmdlPC9saT5dXG4gKlxuICogQHBhcmFtIHtzdHJpbmd8Y2hlZXJpb3xub2RlfSBzZWxlY3RvciAtIFNlbGVjdG9yIGZvciBlbGVtZW50IHRvIHN0b3AgYXQuXG4gKiBAcGFyYW0ge3N0cmluZ30gW2ZpbHRlclNlbGVjdG9yXSAtIElmIHNwZWNpZmllZCBmaWx0ZXIgZm9yIHNpYmxpbmdzLlxuICpcbiAqIEBzZWUge0BsaW5rIGh0dHA6Ly9hcGkuanF1ZXJ5LmNvbS9uZXh0VW50aWwvfVxuICovXG5leHBvcnRzLm5leHRVbnRpbCA9IGZ1bmN0aW9uIChzZWxlY3RvciwgZmlsdGVyU2VsZWN0b3IpIHtcbiAgaWYgKCF0aGlzWzBdKSB7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cbiAgdmFyIGVsZW1zID0gW107XG4gIHZhciB1bnRpbE5vZGU7XG4gIHZhciB1bnRpbE5vZGVzO1xuXG4gIGlmICh0eXBlb2Ygc2VsZWN0b3IgPT09ICdzdHJpbmcnKSB7XG4gICAgdW50aWxOb2RlID0gc2VsZWN0LnNlbGVjdChzZWxlY3RvciwgdGhpcy5uZXh0QWxsKCkuZ2V0KCksIHRoaXMub3B0aW9ucylbMF07XG4gIH0gZWxzZSBpZiAoc2VsZWN0b3IgJiYgc2VsZWN0b3IuY2hlZXJpbykge1xuICAgIHVudGlsTm9kZXMgPSBzZWxlY3Rvci5nZXQoKTtcbiAgfSBlbHNlIGlmIChzZWxlY3Rvcikge1xuICAgIHVudGlsTm9kZSA9IHNlbGVjdG9yO1xuICB9XG5cbiAgdGhpcy50b0FycmF5KCkuZm9yRWFjaChmdW5jdGlvbiAoZWxlbSkge1xuICAgIHdoaWxlICgoZWxlbSA9IGVsZW0ubmV4dCkpIHtcbiAgICAgIGlmIChcbiAgICAgICAgKHVudGlsTm9kZSAmJiBlbGVtICE9PSB1bnRpbE5vZGUpIHx8XG4gICAgICAgICh1bnRpbE5vZGVzICYmIHVudGlsTm9kZXMuaW5kZXhPZihlbGVtKSA9PT0gLTEpIHx8XG4gICAgICAgICghdW50aWxOb2RlICYmICF1bnRpbE5vZGVzKVxuICAgICAgKSB7XG4gICAgICAgIGlmIChpc1RhZyhlbGVtKSAmJiBlbGVtcy5pbmRleE9mKGVsZW0pID09PSAtMSkge1xuICAgICAgICAgIGVsZW1zLnB1c2goZWxlbSk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cbiAgfSk7XG5cbiAgcmV0dXJuIGZpbHRlclNlbGVjdG9yXG4gICAgPyBleHBvcnRzLmZpbHRlci5jYWxsKGVsZW1zLCBmaWx0ZXJTZWxlY3RvciwgdGhpcylcbiAgICA6IHRoaXMuX21ha2UoZWxlbXMpO1xufTtcblxuLyoqXG4gKiBHZXRzIHRoZSBwcmV2aW91cyBzaWJsaW5nIG9mIHRoZSBmaXJzdCBzZWxlY3RlZCBlbGVtZW50IG9wdGlvbmFsbHkgZmlsdGVyZWRcbiAqIGJ5IGEgc2VsZWN0b3IuXG4gKlxuICogQGV4YW1wbGVcbiAqXG4gKiAkKCcub3JhbmdlJykucHJldigpLmhhc0NsYXNzKCdhcHBsZScpXG4gKiAvLz0+IHRydWVcbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gW3NlbGVjdG9yXSAtIElmIHNwZWNpZmllZCBmaWx0ZXIgZm9yIHNpYmxpbmdzLlxuICpcbiAqIEBzZWUge0BsaW5rIGh0dHA6Ly9hcGkuanF1ZXJ5LmNvbS9wcmV2L31cbiAqL1xuZXhwb3J0cy5wcmV2ID0gZnVuY3Rpb24gKHNlbGVjdG9yKSB7XG4gIGlmICghdGhpc1swXSkge1xuICAgIHJldHVybiB0aGlzO1xuICB9XG4gIHZhciBlbGVtcyA9IFtdO1xuXG4gIHRoaXMudG9BcnJheSgpLmZvckVhY2goZnVuY3Rpb24gKGVsZW0pIHtcbiAgICB3aGlsZSAoKGVsZW0gPSBlbGVtLnByZXYpKSB7XG4gICAgICBpZiAoaXNUYWcoZWxlbSkpIHtcbiAgICAgICAgZWxlbXMucHVzaChlbGVtKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgIH1cbiAgfSk7XG5cbiAgcmV0dXJuIHNlbGVjdG9yXG4gICAgPyBleHBvcnRzLmZpbHRlci5jYWxsKGVsZW1zLCBzZWxlY3RvciwgdGhpcylcbiAgICA6IHRoaXMuX21ha2UoZWxlbXMpO1xufTtcblxuLyoqXG4gKiBHZXRzIGFsbCB0aGUgcHJlY2VkaW5nIHNpYmxpbmdzIG9mIHRoZSBmaXJzdCBzZWxlY3RlZCBlbGVtZW50LCBvcHRpb25hbGx5XG4gKiBmaWx0ZXJlZCBieSBhIHNlbGVjdG9yLlxuICpcbiAqIEBleGFtcGxlXG4gKlxuICogJCgnLnBlYXInKS5wcmV2QWxsKClcbiAqIC8vPT4gWzxsaSBjbGFzcz1cIm9yYW5nZVwiPk9yYW5nZTwvbGk+LCA8bGkgY2xhc3M9XCJhcHBsZVwiPkFwcGxlPC9saT5dXG4gKiAkKCcucGVhcicpLnByZXZBbGwoJy5vcmFuZ2UnKVxuICogLy89PiBbPGxpIGNsYXNzPVwib3JhbmdlXCI+T3JhbmdlPC9saT5dXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IFtzZWxlY3Rvcl0gLSBJZiBzcGVjaWZpZWQgZmlsdGVyIGZvciBzaWJsaW5ncy5cbiAqXG4gKiBAc2VlIHtAbGluayBodHRwOi8vYXBpLmpxdWVyeS5jb20vcHJldkFsbC99XG4gKi9cbmV4cG9ydHMucHJldkFsbCA9IGZ1bmN0aW9uIChzZWxlY3Rvcikge1xuICBpZiAoIXRoaXNbMF0pIHtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuICB2YXIgZWxlbXMgPSBbXTtcblxuICB0aGlzLnRvQXJyYXkoKS5mb3JFYWNoKGZ1bmN0aW9uIChlbGVtKSB7XG4gICAgd2hpbGUgKChlbGVtID0gZWxlbS5wcmV2KSkge1xuICAgICAgaWYgKGlzVGFnKGVsZW0pICYmIGVsZW1zLmluZGV4T2YoZWxlbSkgPT09IC0xKSB7XG4gICAgICAgIGVsZW1zLnB1c2goZWxlbSk7XG4gICAgICB9XG4gICAgfVxuICB9KTtcblxuICByZXR1cm4gc2VsZWN0b3JcbiAgICA/IGV4cG9ydHMuZmlsdGVyLmNhbGwoZWxlbXMsIHNlbGVjdG9yLCB0aGlzKVxuICAgIDogdGhpcy5fbWFrZShlbGVtcyk7XG59O1xuXG4vKipcbiAqIEdldHMgYWxsIHRoZSBwcmVjZWRpbmcgc2libGluZ3MgdXAgdG8gYnV0IG5vdCBpbmNsdWRpbmcgdGhlIGVsZW1lbnQgbWF0Y2hlZFxuICogYnkgdGhlIHNlbGVjdG9yLCBvcHRpb25hbGx5IGZpbHRlcmVkIGJ5IGFub3RoZXIgc2VsZWN0b3IuXG4gKlxuICogQGV4YW1wbGVcbiAqXG4gKiAkKCcucGVhcicpLnByZXZVbnRpbCgnLmFwcGxlJylcbiAqIC8vPT4gWzxsaSBjbGFzcz1cIm9yYW5nZVwiPk9yYW5nZTwvbGk+XVxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfGNoZWVyaW98bm9kZX0gc2VsZWN0b3IgLSBTZWxlY3RvciBmb3IgZWxlbWVudCB0byBzdG9wIGF0LlxuICogQHBhcmFtIHtzdHJpbmd9IFtmaWx0ZXJTZWxlY3Rvcl0gLSBJZiBzcGVjaWZpZWQgZmlsdGVyIGZvciBzaWJsaW5ncy5cbiAqXG4gKiBAc2VlIHtAbGluayBodHRwOi8vYXBpLmpxdWVyeS5jb20vcHJldlVudGlsL31cbiAqL1xuZXhwb3J0cy5wcmV2VW50aWwgPSBmdW5jdGlvbiAoc2VsZWN0b3IsIGZpbHRlclNlbGVjdG9yKSB7XG4gIGlmICghdGhpc1swXSkge1xuICAgIHJldHVybiB0aGlzO1xuICB9XG4gIHZhciBlbGVtcyA9IFtdO1xuICB2YXIgdW50aWxOb2RlO1xuICB2YXIgdW50aWxOb2RlcztcblxuICBpZiAodHlwZW9mIHNlbGVjdG9yID09PSAnc3RyaW5nJykge1xuICAgIHVudGlsTm9kZSA9IHNlbGVjdC5zZWxlY3Qoc2VsZWN0b3IsIHRoaXMucHJldkFsbCgpLmdldCgpLCB0aGlzLm9wdGlvbnMpWzBdO1xuICB9IGVsc2UgaWYgKHNlbGVjdG9yICYmIHNlbGVjdG9yLmNoZWVyaW8pIHtcbiAgICB1bnRpbE5vZGVzID0gc2VsZWN0b3IuZ2V0KCk7XG4gIH0gZWxzZSBpZiAoc2VsZWN0b3IpIHtcbiAgICB1bnRpbE5vZGUgPSBzZWxlY3RvcjtcbiAgfVxuXG4gIHRoaXMudG9BcnJheSgpLmZvckVhY2goZnVuY3Rpb24gKGVsZW0pIHtcbiAgICB3aGlsZSAoKGVsZW0gPSBlbGVtLnByZXYpKSB7XG4gICAgICBpZiAoXG4gICAgICAgICh1bnRpbE5vZGUgJiYgZWxlbSAhPT0gdW50aWxOb2RlKSB8fFxuICAgICAgICAodW50aWxOb2RlcyAmJiB1bnRpbE5vZGVzLmluZGV4T2YoZWxlbSkgPT09IC0xKSB8fFxuICAgICAgICAoIXVudGlsTm9kZSAmJiAhdW50aWxOb2RlcylcbiAgICAgICkge1xuICAgICAgICBpZiAoaXNUYWcoZWxlbSkgJiYgZWxlbXMuaW5kZXhPZihlbGVtKSA9PT0gLTEpIHtcbiAgICAgICAgICBlbGVtcy5wdXNoKGVsZW0pO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xuXG4gIHJldHVybiBmaWx0ZXJTZWxlY3RvclxuICAgID8gZXhwb3J0cy5maWx0ZXIuY2FsbChlbGVtcywgZmlsdGVyU2VsZWN0b3IsIHRoaXMpXG4gICAgOiB0aGlzLl9tYWtlKGVsZW1zKTtcbn07XG5cbi8qKlxuICogR2V0cyB0aGUgZmlyc3Qgc2VsZWN0ZWQgZWxlbWVudCdzIHNpYmxpbmdzLCBleGNsdWRpbmcgaXRzZWxmLlxuICpcbiAqIEBleGFtcGxlXG4gKlxuICogJCgnLnBlYXInKS5zaWJsaW5ncygpLmxlbmd0aFxuICogLy89PiAyXG4gKlxuICogJCgnLnBlYXInKS5zaWJsaW5ncygnLm9yYW5nZScpLmxlbmd0aFxuICogLy89PiAxXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IFtzZWxlY3Rvcl0gLSBJZiBzcGVjaWZpZWQgZmlsdGVyIGZvciBzaWJsaW5ncy5cbiAqXG4gKiBAc2VlIHtAbGluayBodHRwOi8vYXBpLmpxdWVyeS5jb20vc2libGluZ3MvfVxuICovXG5leHBvcnRzLnNpYmxpbmdzID0gZnVuY3Rpb24gKHNlbGVjdG9yKSB7XG4gIHZhciBwYXJlbnQgPSB0aGlzLnBhcmVudCgpO1xuXG4gIHZhciBlbGVtcyA9IChwYXJlbnQgPyBwYXJlbnQuY2hpbGRyZW4oKSA6IHRoaXMuc2libGluZ3NBbmRNZSgpKVxuICAgIC50b0FycmF5KClcbiAgICAuZmlsdGVyKGZ1bmN0aW9uIChlbGVtKSB7XG4gICAgICByZXR1cm4gaXNUYWcoZWxlbSkgJiYgIXRoaXMuaXMoZWxlbSk7XG4gICAgfSwgdGhpcyk7XG5cbiAgaWYgKHNlbGVjdG9yICE9PSB1bmRlZmluZWQpIHtcbiAgICByZXR1cm4gZXhwb3J0cy5maWx0ZXIuY2FsbChlbGVtcywgc2VsZWN0b3IsIHRoaXMpO1xuICB9XG4gIHJldHVybiB0aGlzLl9tYWtlKGVsZW1zKTtcbn07XG5cbi8qKlxuICogR2V0cyB0aGUgY2hpbGRyZW4gb2YgdGhlIGZpcnN0IHNlbGVjdGVkIGVsZW1lbnQuXG4gKlxuICogQGV4YW1wbGVcbiAqXG4gKiAkKCcjZnJ1aXRzJykuY2hpbGRyZW4oKS5sZW5ndGhcbiAqIC8vPT4gM1xuICpcbiAqICQoJyNmcnVpdHMnKS5jaGlsZHJlbignLnBlYXInKS50ZXh0KClcbiAqIC8vPT4gUGVhclxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBbc2VsZWN0b3JdIC0gSWYgc3BlY2lmaWVkIGZpbHRlciBmb3IgY2hpbGRyZW4uXG4gKlxuICogQHNlZSB7QGxpbmsgaHR0cDovL2FwaS5qcXVlcnkuY29tL2NoaWxkcmVuL31cbiAqL1xuZXhwb3J0cy5jaGlsZHJlbiA9IGZ1bmN0aW9uIChzZWxlY3Rvcikge1xuICB2YXIgZWxlbXMgPSB0aGlzLnRvQXJyYXkoKS5yZWR1Y2UoZnVuY3Rpb24gKG5ld0VsZW1zLCBlbGVtKSB7XG4gICAgcmV0dXJuIG5ld0VsZW1zLmNvbmNhdChlbGVtLmNoaWxkcmVuLmZpbHRlcihpc1RhZykpO1xuICB9LCBbXSk7XG5cbiAgaWYgKHNlbGVjdG9yID09PSB1bmRlZmluZWQpIHJldHVybiB0aGlzLl9tYWtlKGVsZW1zKTtcblxuICByZXR1cm4gZXhwb3J0cy5maWx0ZXIuY2FsbChlbGVtcywgc2VsZWN0b3IsIHRoaXMpO1xufTtcblxuLyoqXG4gKiBHZXRzIHRoZSBjaGlsZHJlbiBvZiBlYWNoIGVsZW1lbnQgaW4gdGhlIHNldCBvZiBtYXRjaGVkIGVsZW1lbnRzLCBpbmNsdWRpbmdcbiAqIHRleHQgYW5kIGNvbW1lbnQgbm9kZXMuXG4gKlxuICogQGV4YW1wbGVcbiAqXG4gKiAkKCcjZnJ1aXRzJykuY29udGVudHMoKS5sZW5ndGhcbiAqIC8vPT4gM1xuICpcbiAqIEBzZWUge0BsaW5rIGh0dHA6Ly9hcGkuanF1ZXJ5LmNvbS9jb250ZW50cy99XG4gKi9cbmV4cG9ydHMuY29udGVudHMgPSBmdW5jdGlvbiAoKSB7XG4gIHZhciBlbGVtcyA9IHRoaXMudG9BcnJheSgpLnJlZHVjZShmdW5jdGlvbiAobmV3RWxlbXMsIGVsZW0pIHtcbiAgICByZXR1cm4gbmV3RWxlbXMuY29uY2F0KGVsZW0uY2hpbGRyZW4pO1xuICB9LCBbXSk7XG4gIHJldHVybiB0aGlzLl9tYWtlKGVsZW1zKTtcbn07XG5cbi8qKlxuICogSXRlcmF0ZXMgb3ZlciBhIGNoZWVyaW8gb2JqZWN0LCBleGVjdXRpbmcgYSBmdW5jdGlvbiBmb3IgZWFjaCBtYXRjaGVkXG4gKiBlbGVtZW50LiBXaGVuIHRoZSBjYWxsYmFjayBpcyBmaXJlZCwgdGhlIGZ1bmN0aW9uIGlzIGZpcmVkIGluIHRoZSBjb250ZXh0IG9mXG4gKiB0aGUgRE9NIGVsZW1lbnQsIHNvIGB0aGlzYCByZWZlcnMgdG8gdGhlIGN1cnJlbnQgZWxlbWVudCwgd2hpY2ggaXNcbiAqIGVxdWl2YWxlbnQgdG8gdGhlIGZ1bmN0aW9uIHBhcmFtZXRlciBgZWxlbWVudGAuIFRvIGJyZWFrIG91dCBvZiB0aGUgYGVhY2hgXG4gKiBsb29wIGVhcmx5LCByZXR1cm4gd2l0aCBgZmFsc2VgLlxuICpcbiAqIEBleGFtcGxlXG4gKlxuICogY29uc3QgZnJ1aXRzID0gW107XG4gKlxuICogJCgnbGknKS5lYWNoKGZ1bmN0aW9uKGksIGVsZW0pIHtcbiAqICAgZnJ1aXRzW2ldID0gJCh0aGlzKS50ZXh0KCk7XG4gKiB9KTtcbiAqXG4gKiBmcnVpdHMuam9pbignLCAnKTtcbiAqIC8vPT4gQXBwbGUsIE9yYW5nZSwgUGVhclxuICpcbiAqIEBwYXJhbSB7RnVuY3Rpb259IGZuIC0gRnVuY3Rpb24gdG8gZXhlY3V0ZS5cbiAqXG4gKiBAc2VlIHtAbGluayBodHRwOi8vYXBpLmpxdWVyeS5jb20vZWFjaC99XG4gKi9cbmV4cG9ydHMuZWFjaCA9IGZ1bmN0aW9uIChmbikge1xuICB2YXIgaSA9IDA7XG4gIHZhciBsZW4gPSB0aGlzLmxlbmd0aDtcbiAgd2hpbGUgKGkgPCBsZW4gJiYgZm4uY2FsbCh0aGlzW2ldLCBpLCB0aGlzW2ldKSAhPT0gZmFsc2UpICsraTtcbiAgcmV0dXJuIHRoaXM7XG59O1xuXG4vKipcbiAqIFBhc3MgZWFjaCBlbGVtZW50IGluIHRoZSBjdXJyZW50IG1hdGNoZWQgc2V0IHRocm91Z2ggYSBmdW5jdGlvbiwgcHJvZHVjaW5nIGFcbiAqIG5ldyBDaGVlcmlvIG9iamVjdCBjb250YWluaW5nIHRoZSByZXR1cm4gdmFsdWVzLiBUaGUgZnVuY3Rpb24gY2FuIHJldHVybiBhblxuICogaW5kaXZpZHVhbCBkYXRhIGl0ZW0gb3IgYW4gYXJyYXkgb2YgZGF0YSBpdGVtcyB0byBiZSBpbnNlcnRlZCBpbnRvIHRoZVxuICogcmVzdWx0aW5nIHNldC4gSWYgYW4gYXJyYXkgaXMgcmV0dXJuZWQsIHRoZSBlbGVtZW50cyBpbnNpZGUgdGhlIGFycmF5IGFyZVxuICogaW5zZXJ0ZWQgaW50byB0aGUgc2V0LiBJZiB0aGUgZnVuY3Rpb24gcmV0dXJucyBudWxsIG9yIHVuZGVmaW5lZCwgbm8gZWxlbWVudFxuICogd2lsbCBiZSBpbnNlcnRlZC5cbiAqXG4gKiBAZXhhbXBsZVxuICpcbiAqICQoJ2xpJykubWFwKGZ1bmN0aW9uKGksIGVsKSB7XG4gKiAgIC8vIHRoaXMgPT09IGVsXG4gKiAgIHJldHVybiAkKHRoaXMpLnRleHQoKTtcbiAqIH0pLmdldCgpLmpvaW4oJyAnKTtcbiAqIC8vPT4gXCJhcHBsZSBvcmFuZ2UgcGVhclwiXG4gKlxuICogQHBhcmFtIHtGdW5jdGlvbn0gZm4gLSBGdW5jdGlvbiB0byBleGVjdXRlLlxuICpcbiAqIEBzZWUge0BsaW5rIGh0dHA6Ly9hcGkuanF1ZXJ5LmNvbS9tYXAvfVxuICovXG5leHBvcnRzLm1hcCA9IGZ1bmN0aW9uIChmbikge1xuICB2YXIgZWxlbXMgPSBbXTtcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmxlbmd0aDsgaSsrKSB7XG4gICAgdmFyIGVsID0gdGhpc1tpXTtcbiAgICB2YXIgdmFsID0gZm4uY2FsbChlbCwgaSwgZWwpO1xuICAgIGlmICh2YWwgIT0gbnVsbCkge1xuICAgICAgZWxlbXMgPSBlbGVtcy5jb25jYXQodmFsKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHRoaXMuX21ha2UoZWxlbXMpO1xufTtcblxuZnVuY3Rpb24gZ2V0RmlsdGVyRm4obWF0Y2gpIHtcbiAgaWYgKHR5cGVvZiBtYXRjaCA9PT0gJ2Z1bmN0aW9uJykge1xuICAgIHJldHVybiBmdW5jdGlvbiAoZWwsIGkpIHtcbiAgICAgIHJldHVybiBtYXRjaC5jYWxsKGVsLCBpLCBlbCk7XG4gICAgfTtcbiAgfSBlbHNlIGlmIChtYXRjaC5jaGVlcmlvKSB7XG4gICAgcmV0dXJuIG1hdGNoLmlzLmJpbmQobWF0Y2gpO1xuICB9XG4gIHJldHVybiBmdW5jdGlvbiAoZWwpIHtcbiAgICByZXR1cm4gbWF0Y2ggPT09IGVsO1xuICB9O1xufVxuXG4vKipcbiAqIEl0ZXJhdGVzIG92ZXIgYSBjaGVlcmlvIG9iamVjdCwgcmVkdWNpbmcgdGhlIHNldCBvZiBzZWxlY3RvciBlbGVtZW50cyB0b1xuICogdGhvc2UgdGhhdCBtYXRjaCB0aGUgc2VsZWN0b3Igb3IgcGFzcyB0aGUgZnVuY3Rpb24ncyB0ZXN0LiBXaGVuIGEgQ2hlZXJpb1xuICogc2VsZWN0aW9uIGlzIHNwZWNpZmllZCwgcmV0dXJuIG9ubHkgdGhlIGVsZW1lbnRzIGNvbnRhaW5lZCBpbiB0aGF0XG4gKiBzZWxlY3Rpb24uIFdoZW4gYW4gZWxlbWVudCBpcyBzcGVjaWZpZWQsIHJldHVybiBvbmx5IHRoYXQgZWxlbWVudCAoaWYgaXQgaXNcbiAqIGNvbnRhaW5lZCBpbiB0aGUgb3JpZ2luYWwgc2VsZWN0aW9uKS4gSWYgdXNpbmcgdGhlIGZ1bmN0aW9uIG1ldGhvZCwgdGhlXG4gKiBmdW5jdGlvbiBpcyBleGVjdXRlZCBpbiB0aGUgY29udGV4dCBvZiB0aGUgc2VsZWN0ZWQgZWxlbWVudCwgc28gYHRoaXNgXG4gKiByZWZlcnMgdG8gdGhlIGN1cnJlbnQgZWxlbWVudC5cbiAqXG4gKiBAZnVuY3Rpb25cbiAqIEBwYXJhbSB7c3RyaW5nIHwgRnVuY3Rpb259IG1hdGNoIC0gVmFsdWUgdG8gbG9vayBmb3IsIGZvbGxvd2luZyB0aGUgcnVsZXMgYWJvdmUuXG4gKiBAcGFyYW0ge25vZGVbXX0gY29udGFpbmVyIC0gT3B0aW9uYWwgbm9kZSB0byBmaWx0ZXIgaW5zdGVhZC5cbiAqXG4gKiBAZXhhbXBsZSA8Y2FwdGlvbj5TZWxlY3RvcjwvY2FwdGlvbj5cbiAqXG4gKiAkKCdsaScpLmZpbHRlcignLm9yYW5nZScpLmF0dHIoJ2NsYXNzJyk7XG4gKiAvLz0+IG9yYW5nZVxuICpcbiAqIEBleGFtcGxlIDxjYXB0aW9uPkZ1bmN0aW9uPC9jYXB0aW9uPlxuICpcbiAqICQoJ2xpJykuZmlsdGVyKGZ1bmN0aW9uKGksIGVsKSB7XG4gKiAgIC8vIHRoaXMgPT09IGVsXG4gKiAgIHJldHVybiAkKHRoaXMpLmF0dHIoJ2NsYXNzJykgPT09ICdvcmFuZ2UnO1xuICogfSkuYXR0cignY2xhc3MnKVxuICogLy89PiBvcmFuZ2VcbiAqXG4gKiBAc2VlIHtAbGluayBodHRwOi8vYXBpLmpxdWVyeS5jb20vZmlsdGVyL31cbiAqL1xuZXhwb3J0cy5maWx0ZXIgPSBmdW5jdGlvbiAobWF0Y2gsIGNvbnRhaW5lcikge1xuICBjb250YWluZXIgPSBjb250YWluZXIgfHwgdGhpcztcbiAgdmFyIGVsZW1lbnRzID0gdGhpcy50b0FycmF5ID8gdGhpcy50b0FycmF5KCkgOiB0aGlzO1xuXG4gIGlmICh0eXBlb2YgbWF0Y2ggPT09ICdzdHJpbmcnKSB7XG4gICAgZWxlbWVudHMgPSBzZWxlY3QuZmlsdGVyKG1hdGNoLCBlbGVtZW50cywgY29udGFpbmVyLm9wdGlvbnMpO1xuICB9IGVsc2Uge1xuICAgIGVsZW1lbnRzID0gZWxlbWVudHMuZmlsdGVyKGdldEZpbHRlckZuKG1hdGNoKSk7XG4gIH1cblxuICByZXR1cm4gY29udGFpbmVyLl9tYWtlKGVsZW1lbnRzKTtcbn07XG5cbi8qKlxuICogUmVtb3ZlIGVsZW1lbnRzIGZyb20gdGhlIHNldCBvZiBtYXRjaGVkIGVsZW1lbnRzLiBHaXZlbiBhIGpRdWVyeSBvYmplY3QgdGhhdFxuICogcmVwcmVzZW50cyBhIHNldCBvZiBET00gZWxlbWVudHMsIHRoZSBgLm5vdCgpYCBtZXRob2QgY29uc3RydWN0cyBhIG5ld1xuICogalF1ZXJ5IG9iamVjdCBmcm9tIGEgc3Vic2V0IG9mIHRoZSBtYXRjaGluZyBlbGVtZW50cy4gVGhlIHN1cHBsaWVkIHNlbGVjdG9yXG4gKiBpcyB0ZXN0ZWQgYWdhaW5zdCBlYWNoIGVsZW1lbnQ7IHRoZSBlbGVtZW50cyB0aGF0IGRvbid0IG1hdGNoIHRoZSBzZWxlY3RvclxuICogd2lsbCBiZSBpbmNsdWRlZCBpbiB0aGUgcmVzdWx0LiBUaGUgYC5ub3QoKWAgbWV0aG9kIGNhbiB0YWtlIGEgZnVuY3Rpb24gYXNcbiAqIGl0cyBhcmd1bWVudCBpbiB0aGUgc2FtZSB3YXkgdGhhdCBgLmZpbHRlcigpYCBkb2VzLiBFbGVtZW50cyBmb3Igd2hpY2ggdGhlXG4gKiBmdW5jdGlvbiByZXR1cm5zIHRydWUgYXJlIGV4Y2x1ZGVkIGZyb20gdGhlIGZpbHRlcmVkIHNldDsgYWxsIG90aGVyIGVsZW1lbnRzXG4gKiBhcmUgaW5jbHVkZWQuXG4gKlxuICogQGZ1bmN0aW9uXG4gKiBAcGFyYW0ge3N0cmluZyB8IEZ1bmN0aW9ufSBtYXRjaCAtIFZhbHVlIHRvIGxvb2sgZm9yLCBmb2xsb3dpbmcgdGhlIHJ1bGVzIGFib3ZlLlxuICogQHBhcmFtIHtub2RlW119IGNvbnRhaW5lciAtIE9wdGlvbmFsIG5vZGUgdG8gZmlsdGVyIGluc3RlYWQuXG4gKlxuICogQGV4YW1wbGUgPGNhcHRpb24+U2VsZWN0b3I8L2NhcHRpb24+XG4gKlxuICogJCgnbGknKS5ub3QoJy5hcHBsZScpLmxlbmd0aDtcbiAqIC8vPT4gMlxuICpcbiAqIEBleGFtcGxlIDxjYXB0aW9uPkZ1bmN0aW9uPC9jYXB0aW9uPlxuICpcbiAqICQoJ2xpJykubm90KGZ1bmN0aW9uKGksIGVsKSB7XG4gKiAgIC8vIHRoaXMgPT09IGVsXG4gKiAgIHJldHVybiAkKHRoaXMpLmF0dHIoJ2NsYXNzJykgPT09ICdvcmFuZ2UnO1xuICogfSkubGVuZ3RoO1xuICogLy89PiAyXG4gKlxuICogQHNlZSB7QGxpbmsgaHR0cDovL2FwaS5qcXVlcnkuY29tL25vdC99XG4gKi9cbmV4cG9ydHMubm90ID0gZnVuY3Rpb24gKG1hdGNoLCBjb250YWluZXIpIHtcbiAgY29udGFpbmVyID0gY29udGFpbmVyIHx8IHRoaXM7XG4gIHZhciBlbGVtZW50cyA9IGNvbnRhaW5lci50b0FycmF5ID8gY29udGFpbmVyLnRvQXJyYXkoKSA6IGNvbnRhaW5lcjtcbiAgdmFyIG1hdGNoZXM7XG4gIHZhciBmaWx0ZXJGbjtcblxuICBpZiAodHlwZW9mIG1hdGNoID09PSAnc3RyaW5nJykge1xuICAgIG1hdGNoZXMgPSBuZXcgU2V0KHNlbGVjdC5maWx0ZXIobWF0Y2gsIGVsZW1lbnRzLCB0aGlzLm9wdGlvbnMpKTtcbiAgICBlbGVtZW50cyA9IGVsZW1lbnRzLmZpbHRlcihmdW5jdGlvbiAoZWwpIHtcbiAgICAgIHJldHVybiAhbWF0Y2hlcy5oYXMoZWwpO1xuICAgIH0pO1xuICB9IGVsc2Uge1xuICAgIGZpbHRlckZuID0gZ2V0RmlsdGVyRm4obWF0Y2gpO1xuICAgIGVsZW1lbnRzID0gZWxlbWVudHMuZmlsdGVyKGZ1bmN0aW9uIChlbCwgaSkge1xuICAgICAgcmV0dXJuICFmaWx0ZXJGbihlbCwgaSk7XG4gICAgfSk7XG4gIH1cblxuICByZXR1cm4gY29udGFpbmVyLl9tYWtlKGVsZW1lbnRzKTtcbn07XG5cbi8qKlxuICogRmlsdGVycyB0aGUgc2V0IG9mIG1hdGNoZWQgZWxlbWVudHMgdG8gb25seSB0aG9zZSB3aGljaCBoYXZlIHRoZSBnaXZlbiBET01cbiAqIGVsZW1lbnQgYXMgYSBkZXNjZW5kYW50IG9yIHdoaWNoIGhhdmUgYSBkZXNjZW5kYW50IHRoYXQgbWF0Y2hlcyB0aGUgZ2l2ZW5cbiAqIHNlbGVjdG9yLiBFcXVpdmFsZW50IHRvIGAuZmlsdGVyKCc6aGFzKHNlbGVjdG9yKScpYC5cbiAqXG4gKiBAZXhhbXBsZSA8Y2FwdGlvbj5TZWxlY3RvcjwvY2FwdGlvbj5cbiAqXG4gKiAkKCd1bCcpLmhhcygnLnBlYXInKS5hdHRyKCdpZCcpO1xuICogLy89PiBmcnVpdHNcbiAqXG4gKiBAZXhhbXBsZSA8Y2FwdGlvbj5FbGVtZW50PC9jYXB0aW9uPlxuICpcbiAqICQoJ3VsJykuaGFzKCQoJy5wZWFyJylbMF0pLmF0dHIoJ2lkJyk7XG4gKiAvLz0+IGZydWl0c1xuICpcbiAqIEBwYXJhbSB7c3RyaW5nfGNoZWVyaW98bm9kZX0gc2VsZWN0b3JPckhheXN0YWNrIC0gRWxlbWVudCB0byBsb29rIGZvci5cbiAqXG4gKiBAc2VlIHtAbGluayBodHRwOi8vYXBpLmpxdWVyeS5jb20vaGFzL31cbiAqL1xuZXhwb3J0cy5oYXMgPSBmdW5jdGlvbiAoc2VsZWN0b3JPckhheXN0YWNrKSB7XG4gIHZhciB0aGF0ID0gdGhpcztcbiAgcmV0dXJuIGV4cG9ydHMuZmlsdGVyLmNhbGwodGhpcywgZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB0aGF0Ll9tYWtlKHRoaXMpLmZpbmQoc2VsZWN0b3JPckhheXN0YWNrKS5sZW5ndGggPiAwO1xuICB9KTtcbn07XG5cbi8qKlxuICogV2lsbCBzZWxlY3QgdGhlIGZpcnN0IGVsZW1lbnQgb2YgYSBjaGVlcmlvIG9iamVjdC5cbiAqXG4gKiBAZXhhbXBsZVxuICpcbiAqICQoJyNmcnVpdHMnKS5jaGlsZHJlbigpLmZpcnN0KCkudGV4dCgpXG4gKiAvLz0+IEFwcGxlXG4gKlxuICogQHNlZSB7QGxpbmsgaHR0cDovL2FwaS5qcXVlcnkuY29tL2ZpcnN0L31cbiAqL1xuZXhwb3J0cy5maXJzdCA9IGZ1bmN0aW9uICgpIHtcbiAgcmV0dXJuIHRoaXMubGVuZ3RoID4gMSA/IHRoaXMuX21ha2UodGhpc1swXSkgOiB0aGlzO1xufTtcblxuLyoqXG4gKiBXaWxsIHNlbGVjdCB0aGUgbGFzdCBlbGVtZW50IG9mIGEgY2hlZXJpbyBvYmplY3QuXG4gKlxuICogQGV4YW1wbGVcbiAqXG4gKiAkKCcjZnJ1aXRzJykuY2hpbGRyZW4oKS5sYXN0KCkudGV4dCgpXG4gKiAvLz0+IFBlYXJcbiAqXG4gKiBAc2VlIHtAbGluayBodHRwOi8vYXBpLmpxdWVyeS5jb20vbGFzdC99XG4gKi9cbmV4cG9ydHMubGFzdCA9IGZ1bmN0aW9uICgpIHtcbiAgcmV0dXJuIHRoaXMubGVuZ3RoID4gMSA/IHRoaXMuX21ha2UodGhpc1t0aGlzLmxlbmd0aCAtIDFdKSA6IHRoaXM7XG59O1xuXG4vKipcbiAqIFJlZHVjZSB0aGUgc2V0IG9mIG1hdGNoZWQgZWxlbWVudHMgdG8gdGhlIG9uZSBhdCB0aGUgc3BlY2lmaWVkIGluZGV4LiBVc2VcbiAqIGAuZXEoLWkpYCB0byBjb3VudCBiYWNrd2FyZHMgZnJvbSB0aGUgbGFzdCBzZWxlY3RlZCBlbGVtZW50LlxuICpcbiAqIEBleGFtcGxlXG4gKlxuICogJCgnbGknKS5lcSgwKS50ZXh0KClcbiAqIC8vPT4gQXBwbGVcbiAqXG4gKiAkKCdsaScpLmVxKC0xKS50ZXh0KClcbiAqIC8vPT4gUGVhclxuICpcbiAqIEBwYXJhbSB7bnVtYmVyfSBpIC0gSW5kZXggb2YgdGhlIGVsZW1lbnQgdG8gc2VsZWN0LlxuICpcbiAqIEBzZWUge0BsaW5rIGh0dHA6Ly9hcGkuanF1ZXJ5LmNvbS9lcS99XG4gKi9cbmV4cG9ydHMuZXEgPSBmdW5jdGlvbiAoaSkge1xuICBpID0gK2k7XG5cbiAgLy8gVXNlIHRoZSBmaXJzdCBpZGVudGl0eSBvcHRpbWl6YXRpb24gaWYgcG9zc2libGVcbiAgaWYgKGkgPT09IDAgJiYgdGhpcy5sZW5ndGggPD0gMSkgcmV0dXJuIHRoaXM7XG5cbiAgaWYgKGkgPCAwKSBpID0gdGhpcy5sZW5ndGggKyBpO1xuICByZXR1cm4gdGhpc1tpXSA/IHRoaXMuX21ha2UodGhpc1tpXSkgOiB0aGlzLl9tYWtlKFtdKTtcbn07XG5cbi8qKlxuICogUmV0cmlldmUgdGhlIERPTSBlbGVtZW50cyBtYXRjaGVkIGJ5IHRoZSBDaGVlcmlvIG9iamVjdC4gSWYgYW4gaW5kZXggaXNcbiAqIHNwZWNpZmllZCwgcmV0cmlldmUgb25lIG9mIHRoZSBlbGVtZW50cyBtYXRjaGVkIGJ5IHRoZSBDaGVlcmlvIG9iamVjdC5cbiAqXG4gKiBAZXhhbXBsZVxuICpcbiAqICQoJ2xpJykuZ2V0KDApLnRhZ05hbWVcbiAqIC8vPT4gbGlcbiAqXG4gKiBJZiBubyBpbmRleCBpcyBzcGVjaWZpZWQsIHJldHJpZXZlIGFsbCBlbGVtZW50cyBtYXRjaGVkIGJ5IHRoZSBDaGVlcmlvIG9iamVjdDpcbiAqXG4gKiBAZXhhbXBsZVxuICpcbiAqICQoJ2xpJykuZ2V0KCkubGVuZ3RoXG4gKiAvLz0+IDNcbiAqXG4gKiBAcGFyYW0ge251bWJlcn0gW2ldIC0gRWxlbWVudCB0byByZXRyaWV2ZS5cbiAqXG4gKiBAc2VlIHtAbGluayBodHRwOi8vYXBpLmpxdWVyeS5jb20vZ2V0L31cbiAqL1xuZXhwb3J0cy5nZXQgPSBmdW5jdGlvbiAoaSkge1xuICBpZiAoaSA9PSBudWxsKSB7XG4gICAgcmV0dXJuIEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKHRoaXMpO1xuICB9XG4gIHJldHVybiB0aGlzW2kgPCAwID8gdGhpcy5sZW5ndGggKyBpIDogaV07XG59O1xuXG4vKipcbiAqIFNlYXJjaCBmb3IgYSBnaXZlbiBlbGVtZW50IGZyb20gYW1vbmcgdGhlIG1hdGNoZWQgZWxlbWVudHMuXG4gKlxuICogQGV4YW1wbGVcbiAqXG4gKiAkKCcucGVhcicpLmluZGV4KClcbiAqIC8vPT4gMlxuICogJCgnLm9yYW5nZScpLmluZGV4KCdsaScpXG4gKiAvLz0+IDFcbiAqICQoJy5hcHBsZScpLmluZGV4KCQoJyNmcnVpdCwgbGknKSlcbiAqIC8vPT4gMVxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfGNoZWVyaW98bm9kZX0gW3NlbGVjdG9yT3JOZWVkbGVdIC0gRWxlbWVudCB0byBsb29rIGZvci5cbiAqXG4gKiBAc2VlIHtAbGluayBodHRwOi8vYXBpLmpxdWVyeS5jb20vaW5kZXgvfVxuICovXG5leHBvcnRzLmluZGV4ID0gZnVuY3Rpb24gKHNlbGVjdG9yT3JOZWVkbGUpIHtcbiAgdmFyICRoYXlzdGFjaztcbiAgdmFyIG5lZWRsZTtcblxuICBpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMCkge1xuICAgICRoYXlzdGFjayA9IHRoaXMucGFyZW50KCkuY2hpbGRyZW4oKTtcbiAgICBuZWVkbGUgPSB0aGlzWzBdO1xuICB9IGVsc2UgaWYgKHR5cGVvZiBzZWxlY3Rvck9yTmVlZGxlID09PSAnc3RyaW5nJykge1xuICAgICRoYXlzdGFjayA9IHRoaXMuX21ha2Uoc2VsZWN0b3JPck5lZWRsZSk7XG4gICAgbmVlZGxlID0gdGhpc1swXTtcbiAgfSBlbHNlIHtcbiAgICAkaGF5c3RhY2sgPSB0aGlzO1xuICAgIG5lZWRsZSA9IHNlbGVjdG9yT3JOZWVkbGUuY2hlZXJpbyA/IHNlbGVjdG9yT3JOZWVkbGVbMF0gOiBzZWxlY3Rvck9yTmVlZGxlO1xuICB9XG5cbiAgcmV0dXJuICRoYXlzdGFjay5nZXQoKS5pbmRleE9mKG5lZWRsZSk7XG59O1xuXG4vKipcbiAqIEdldHMgdGhlIGVsZW1lbnRzIG1hdGNoaW5nIHRoZSBzcGVjaWZpZWQgcmFuZ2UuXG4gKlxuICogQGV4YW1wbGVcbiAqXG4gKiAkKCdsaScpLnNsaWNlKDEpLmVxKDApLnRleHQoKVxuICogLy89PiAnT3JhbmdlJ1xuICpcbiAqICQoJ2xpJykuc2xpY2UoMSwgMikubGVuZ3RoXG4gKiAvLz0+IDFcbiAqXG4gKiBAc2VlIHtAbGluayBodHRwOi8vYXBpLmpxdWVyeS5jb20vc2xpY2UvfVxuICovXG5leHBvcnRzLnNsaWNlID0gZnVuY3Rpb24gKCkge1xuICByZXR1cm4gdGhpcy5fbWFrZShbXS5zbGljZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpKTtcbn07XG5cbmZ1bmN0aW9uIHRyYXZlcnNlUGFyZW50cyhzZWxmLCBlbGVtLCBzZWxlY3RvciwgbGltaXQpIHtcbiAgdmFyIGVsZW1zID0gW107XG4gIHdoaWxlIChlbGVtICYmIGVsZW1zLmxlbmd0aCA8IGxpbWl0ICYmIGVsZW0udHlwZSAhPT0gJ3Jvb3QnKSB7XG4gICAgaWYgKCFzZWxlY3RvciB8fCBleHBvcnRzLmZpbHRlci5jYWxsKFtlbGVtXSwgc2VsZWN0b3IsIHNlbGYpLmxlbmd0aCkge1xuICAgICAgZWxlbXMucHVzaChlbGVtKTtcbiAgICB9XG4gICAgZWxlbSA9IGVsZW0ucGFyZW50O1xuICB9XG4gIHJldHVybiBlbGVtcztcbn1cblxuLyoqXG4gKiBFbmQgdGhlIG1vc3QgcmVjZW50IGZpbHRlcmluZyBvcGVyYXRpb24gaW4gdGhlIGN1cnJlbnQgY2hhaW4gYW5kIHJldHVybiB0aGVcbiAqIHNldCBvZiBtYXRjaGVkIGVsZW1lbnRzIHRvIGl0cyBwcmV2aW91cyBzdGF0ZS5cbiAqXG4gKiBAZXhhbXBsZVxuICpcbiAqICQoJ2xpJykuZXEoMCkuZW5kKCkubGVuZ3RoXG4gKiAvLz0+IDNcbiAqXG4gKiBAc2VlIHtAbGluayBodHRwOi8vYXBpLmpxdWVyeS5jb20vZW5kL31cbiAqL1xuZXhwb3J0cy5lbmQgPSBmdW5jdGlvbiAoKSB7XG4gIHJldHVybiB0aGlzLnByZXZPYmplY3QgfHwgdGhpcy5fbWFrZShbXSk7XG59O1xuXG4vKipcbiAqIEFkZCBlbGVtZW50cyB0byB0aGUgc2V0IG9mIG1hdGNoZWQgZWxlbWVudHMuXG4gKlxuICogQGV4YW1wbGVcbiAqXG4gKiAkKCcuYXBwbGUnKS5hZGQoJy5vcmFuZ2UnKS5sZW5ndGhcbiAqIC8vPT4gMlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfGNoZWVyaW99IG90aGVyIC0gRWxlbWVudHMgdG8gYWRkLlxuICogQHBhcmFtIHtjaGVlcmlvfSBbY29udGV4dF0gLSBPcHRpb25hbGx5IHRoZSBjb250ZXh0IG9mIHRoZSBuZXcgc2VsZWN0aW9uLlxuICpcbiAqIEBzZWUge0BsaW5rIGh0dHA6Ly9hcGkuanF1ZXJ5LmNvbS9hZGQvfVxuICovXG5leHBvcnRzLmFkZCA9IGZ1bmN0aW9uIChvdGhlciwgY29udGV4dCkge1xuICB2YXIgc2VsZWN0aW9uID0gdGhpcy5fbWFrZShvdGhlciwgY29udGV4dCk7XG4gIHZhciBjb250ZW50cyA9IHVuaXF1ZVNvcnQoc2VsZWN0aW9uLmdldCgpLmNvbmNhdCh0aGlzLmdldCgpKSk7XG5cbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBjb250ZW50cy5sZW5ndGg7ICsraSkge1xuICAgIHNlbGVjdGlvbltpXSA9IGNvbnRlbnRzW2ldO1xuICB9XG4gIHNlbGVjdGlvbi5sZW5ndGggPSBjb250ZW50cy5sZW5ndGg7XG5cbiAgcmV0dXJuIHNlbGVjdGlvbjtcbn07XG5cbi8qKlxuICogQWRkIHRoZSBwcmV2aW91cyBzZXQgb2YgZWxlbWVudHMgb24gdGhlIHN0YWNrIHRvIHRoZSBjdXJyZW50IHNldCwgb3B0aW9uYWxseVxuICogZmlsdGVyZWQgYnkgYSBzZWxlY3Rvci5cbiAqXG4gKiBAZXhhbXBsZVxuICpcbiAqICQoJ2xpJykuZXEoMCkuYWRkQmFjaygnLm9yYW5nZScpLmxlbmd0aFxuICogLy89PiAyXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHNlbGVjdG9yIC0gU2VsZWN0b3IgZm9yIHRoZSBlbGVtZW50cyB0byBhZGQuXG4gKlxuICogQHNlZSB7QGxpbmsgaHR0cDovL2FwaS5qcXVlcnkuY29tL2FkZEJhY2svfVxuICovXG5leHBvcnRzLmFkZEJhY2sgPSBmdW5jdGlvbiAoc2VsZWN0b3IpIHtcbiAgcmV0dXJuIHRoaXMuYWRkKFxuICAgIGFyZ3VtZW50cy5sZW5ndGggPyB0aGlzLnByZXZPYmplY3QuZmlsdGVyKHNlbGVjdG9yKSA6IHRoaXMucHJldk9iamVjdFxuICApO1xufTtcbiJdfQ==