9874f46713bea927a6bcfb4273e31697
"use strict";

var __extends = this && this.__extends || function () {
  var _extendStatics = function extendStatics(d, b) {
    _extendStatics = Object.setPrototypeOf || {
      __proto__: []
    } instanceof Array && function (d, b) {
      d.__proto__ = b;
    } || function (d, b) {
      for (var p in b) {
        if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];
      }
    };

    return _extendStatics(d, b);
  };

  return function (d, b) {
    if (typeof b !== "function" && b !== null) throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");

    _extendStatics(d, b);

    function __() {
      this.constructor = d;
    }

    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
  };
}();

var __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {
  if (k2 === undefined) k2 = k;
  Object.defineProperty(o, k2, {
    enumerable: true,
    get: function get() {
      return m[k];
    }
  });
} : function (o, m, k, k2) {
  if (k2 === undefined) k2 = k;
  o[k2] = m[k];
});

var __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {
  Object.defineProperty(o, "default", {
    enumerable: true,
    value: v
  });
} : function (o, v) {
  o["default"] = v;
});

var __importStar = this && this.__importStar || function (mod) {
  if (mod && mod.__esModule) return mod;
  var result = {};
  if (mod != null) for (var k in mod) {
    if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
  }

  __setModuleDefault(result, mod);

  return result;
};

var __importDefault = this && this.__importDefault || function (mod) {
  return mod && mod.__esModule ? mod : {
    "default": mod
  };
};

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.parseFeed = exports.FeedHandler = void 0;

var domhandler_1 = __importDefault(require("domhandler"));

var DomUtils = __importStar(require("domutils"));

var Parser_1 = require("./Parser");

var FeedItemMediaMedium;

(function (FeedItemMediaMedium) {
  FeedItemMediaMedium[FeedItemMediaMedium["image"] = 0] = "image";
  FeedItemMediaMedium[FeedItemMediaMedium["audio"] = 1] = "audio";
  FeedItemMediaMedium[FeedItemMediaMedium["video"] = 2] = "video";
  FeedItemMediaMedium[FeedItemMediaMedium["document"] = 3] = "document";
  FeedItemMediaMedium[FeedItemMediaMedium["executable"] = 4] = "executable";
})(FeedItemMediaMedium || (FeedItemMediaMedium = {}));

var FeedItemMediaExpression;

(function (FeedItemMediaExpression) {
  FeedItemMediaExpression[FeedItemMediaExpression["sample"] = 0] = "sample";
  FeedItemMediaExpression[FeedItemMediaExpression["full"] = 1] = "full";
  FeedItemMediaExpression[FeedItemMediaExpression["nonstop"] = 2] = "nonstop";
})(FeedItemMediaExpression || (FeedItemMediaExpression = {}));

var FeedHandler = function (_super) {
  __extends(FeedHandler, _super);

  function FeedHandler(callback, options) {
    var _this = this;

    if (typeof callback === "object") {
      callback = undefined;
      options = callback;
    }

    _this = _super.call(this, callback, options) || this;
    return _this;
  }

  FeedHandler.prototype.onend = function () {
    var _a, _b;

    var feedRoot = getOneElement(isValidFeed, this.dom);

    if (!feedRoot) {
      this.handleCallback(new Error("couldn't find root of feed"));
      return;
    }

    var feed = {};

    if (feedRoot.name === "feed") {
      var childs = feedRoot.children;
      feed.type = "atom";
      addConditionally(feed, "id", "id", childs);
      addConditionally(feed, "title", "title", childs);
      var href = getAttribute("href", getOneElement("link", childs));

      if (href) {
        feed.link = href;
      }

      addConditionally(feed, "description", "subtitle", childs);
      var updated = fetch("updated", childs);

      if (updated) {
        feed.updated = new Date(updated);
      }

      addConditionally(feed, "author", "email", childs, true);
      feed.items = getElements("entry", childs).map(function (item) {
        var entry = {};
        var children = item.children;
        addConditionally(entry, "id", "id", children);
        addConditionally(entry, "title", "title", children);
        var href = getAttribute("href", getOneElement("link", children));

        if (href) {
          entry.link = href;
        }

        var description = fetch("summary", children) || fetch("content", children);

        if (description) {
          entry.description = description;
        }

        var pubDate = fetch("updated", children);

        if (pubDate) {
          entry.pubDate = new Date(pubDate);
        }

        entry.media = getMediaElements(children);
        return entry;
      });
    } else {
      var childs = (_b = (_a = getOneElement("channel", feedRoot.children)) === null || _a === void 0 ? void 0 : _a.children) !== null && _b !== void 0 ? _b : [];
      feed.type = feedRoot.name.substr(0, 3);
      feed.id = "";
      addConditionally(feed, "title", "title", childs);
      addConditionally(feed, "link", "link", childs);
      addConditionally(feed, "description", "description", childs);
      var updated = fetch("lastBuildDate", childs);

      if (updated) {
        feed.updated = new Date(updated);
      }

      addConditionally(feed, "author", "managingEditor", childs, true);
      feed.items = getElements("item", feedRoot.children).map(function (item) {
        var entry = {};
        var children = item.children;
        addConditionally(entry, "id", "guid", children);
        addConditionally(entry, "title", "title", children);
        addConditionally(entry, "link", "link", children);
        addConditionally(entry, "description", "description", children);
        var pubDate = fetch("pubDate", children);
        if (pubDate) entry.pubDate = new Date(pubDate);
        entry.media = getMediaElements(children);
        return entry;
      });
    }

    this.feed = feed;
    this.handleCallback(null);
  };

  return FeedHandler;
}(domhandler_1.default);

exports.FeedHandler = FeedHandler;

function getMediaElements(where) {
  return getElements("media:content", where).map(function (elem) {
    var media = {
      medium: elem.attribs.medium,
      isDefault: !!elem.attribs.isDefault
    };

    if (elem.attribs.url) {
      media.url = elem.attribs.url;
    }

    if (elem.attribs.fileSize) {
      media.fileSize = parseInt(elem.attribs.fileSize, 10);
    }

    if (elem.attribs.type) {
      media.type = elem.attribs.type;
    }

    if (elem.attribs.expression) {
      media.expression = elem.attribs.expression;
    }

    if (elem.attribs.bitrate) {
      media.bitrate = parseInt(elem.attribs.bitrate, 10);
    }

    if (elem.attribs.framerate) {
      media.framerate = parseInt(elem.attribs.framerate, 10);
    }

    if (elem.attribs.samplingrate) {
      media.samplingrate = parseInt(elem.attribs.samplingrate, 10);
    }

    if (elem.attribs.channels) {
      media.channels = parseInt(elem.attribs.channels, 10);
    }

    if (elem.attribs.duration) {
      media.duration = parseInt(elem.attribs.duration, 10);
    }

    if (elem.attribs.height) {
      media.height = parseInt(elem.attribs.height, 10);
    }

    if (elem.attribs.width) {
      media.width = parseInt(elem.attribs.width, 10);
    }

    if (elem.attribs.lang) {
      media.lang = elem.attribs.lang;
    }

    return media;
  });
}

function getElements(tagName, where) {
  return DomUtils.getElementsByTagName(tagName, where, true);
}

function getOneElement(tagName, node) {
  return DomUtils.getElementsByTagName(tagName, node, true, 1)[0];
}

function fetch(tagName, where, recurse) {
  if (recurse === void 0) {
    recurse = false;
  }

  return DomUtils.getText(DomUtils.getElementsByTagName(tagName, where, recurse, 1)).trim();
}

function getAttribute(name, elem) {
  if (!elem) {
    return null;
  }

  var attribs = elem.attribs;
  return attribs[name];
}

function addConditionally(obj, prop, what, where, recurse) {
  if (recurse === void 0) {
    recurse = false;
  }

  var tmp = fetch(what, where, recurse);
  if (tmp) obj[prop] = tmp;
}

function isValidFeed(value) {
  return value === "rss" || value === "feed" || value === "rdf:RDF";
}

function parseFeed(feed, options) {
  if (options === void 0) {
    options = {
      xmlMode: true
    };
  }

  var handler = new FeedHandler(options);
  new Parser_1.Parser(handler, options).end(feed);
  return handler.feed;
}

exports.parseFeed = parseFeed;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkZlZWRIYW5kbGVyLmpzIl0sIm5hbWVzIjpbIl9fZXh0ZW5kcyIsImV4dGVuZFN0YXRpY3MiLCJkIiwiYiIsIk9iamVjdCIsInNldFByb3RvdHlwZU9mIiwiX19wcm90b19fIiwiQXJyYXkiLCJwIiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJjYWxsIiwiVHlwZUVycm9yIiwiU3RyaW5nIiwiX18iLCJjb25zdHJ1Y3RvciIsImNyZWF0ZSIsIl9fY3JlYXRlQmluZGluZyIsIm8iLCJtIiwiayIsImsyIiwidW5kZWZpbmVkIiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwiZ2V0IiwiX19zZXRNb2R1bGVEZWZhdWx0IiwidiIsInZhbHVlIiwiX19pbXBvcnRTdGFyIiwibW9kIiwiX19lc01vZHVsZSIsInJlc3VsdCIsIl9faW1wb3J0RGVmYXVsdCIsImV4cG9ydHMiLCJwYXJzZUZlZWQiLCJGZWVkSGFuZGxlciIsImRvbWhhbmRsZXJfMSIsInJlcXVpcmUiLCJEb21VdGlscyIsIlBhcnNlcl8xIiwiRmVlZEl0ZW1NZWRpYU1lZGl1bSIsIkZlZWRJdGVtTWVkaWFFeHByZXNzaW9uIiwiX3N1cGVyIiwiY2FsbGJhY2siLCJvcHRpb25zIiwiX3RoaXMiLCJvbmVuZCIsIl9hIiwiX2IiLCJmZWVkUm9vdCIsImdldE9uZUVsZW1lbnQiLCJpc1ZhbGlkRmVlZCIsImRvbSIsImhhbmRsZUNhbGxiYWNrIiwiRXJyb3IiLCJmZWVkIiwibmFtZSIsImNoaWxkcyIsImNoaWxkcmVuIiwidHlwZSIsImFkZENvbmRpdGlvbmFsbHkiLCJocmVmIiwiZ2V0QXR0cmlidXRlIiwibGluayIsInVwZGF0ZWQiLCJmZXRjaCIsIkRhdGUiLCJpdGVtcyIsImdldEVsZW1lbnRzIiwibWFwIiwiaXRlbSIsImVudHJ5IiwiZGVzY3JpcHRpb24iLCJwdWJEYXRlIiwibWVkaWEiLCJnZXRNZWRpYUVsZW1lbnRzIiwic3Vic3RyIiwiaWQiLCJkZWZhdWx0Iiwid2hlcmUiLCJlbGVtIiwibWVkaXVtIiwiYXR0cmlicyIsImlzRGVmYXVsdCIsInVybCIsImZpbGVTaXplIiwicGFyc2VJbnQiLCJleHByZXNzaW9uIiwiYml0cmF0ZSIsImZyYW1lcmF0ZSIsInNhbXBsaW5ncmF0ZSIsImNoYW5uZWxzIiwiZHVyYXRpb24iLCJoZWlnaHQiLCJ3aWR0aCIsImxhbmciLCJ0YWdOYW1lIiwiZ2V0RWxlbWVudHNCeVRhZ05hbWUiLCJub2RlIiwicmVjdXJzZSIsImdldFRleHQiLCJ0cmltIiwib2JqIiwicHJvcCIsIndoYXQiLCJ0bXAiLCJ4bWxNb2RlIiwiaGFuZGxlciIsIlBhcnNlciIsImVuZCJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBQ0EsSUFBSUEsU0FBUyxHQUFJLFFBQVEsS0FBS0EsU0FBZCxJQUE2QixZQUFZO0FBQ3JELE1BQUlDLGNBQWEsR0FBRyx1QkFBVUMsQ0FBVixFQUFhQyxDQUFiLEVBQWdCO0FBQ2hDRixJQUFBQSxjQUFhLEdBQUdHLE1BQU0sQ0FBQ0MsY0FBUCxJQUNYO0FBQUVDLE1BQUFBLFNBQVMsRUFBRTtBQUFiLGlCQUE2QkMsS0FBN0IsSUFBc0MsVUFBVUwsQ0FBVixFQUFhQyxDQUFiLEVBQWdCO0FBQUVELE1BQUFBLENBQUMsQ0FBQ0ksU0FBRixHQUFjSCxDQUFkO0FBQWtCLEtBRC9ELElBRVosVUFBVUQsQ0FBVixFQUFhQyxDQUFiLEVBQWdCO0FBQUUsV0FBSyxJQUFJSyxDQUFULElBQWNMLENBQWQ7QUFBaUIsWUFBSUMsTUFBTSxDQUFDSyxTQUFQLENBQWlCQyxjQUFqQixDQUFnQ0MsSUFBaEMsQ0FBcUNSLENBQXJDLEVBQXdDSyxDQUF4QyxDQUFKLEVBQWdETixDQUFDLENBQUNNLENBQUQsQ0FBRCxHQUFPTCxDQUFDLENBQUNLLENBQUQsQ0FBUjtBQUFqRTtBQUErRSxLQUZyRzs7QUFHQSxXQUFPUCxjQUFhLENBQUNDLENBQUQsRUFBSUMsQ0FBSixDQUFwQjtBQUNILEdBTEQ7O0FBTUEsU0FBTyxVQUFVRCxDQUFWLEVBQWFDLENBQWIsRUFBZ0I7QUFDbkIs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VixJQUFtQkEsS0FBSyxLQUFLLE1BQTdCLElBQXVDQSxLQUFLLEtBQUssU0FBeEQ7QUFDSDs7QUFPRCxTQUFTTyxTQUFULENBQW1CcUIsSUFBbkIsRUFBeUJYLE9BQXpCLEVBQWtDO0FBQzlCLE1BQUlBLE9BQU8sS0FBSyxLQUFLLENBQXJCLEVBQXdCO0FBQUVBLElBQUFBLE9BQU8sR0FBRztBQUFFOEQsTUFBQUEsT0FBTyxFQUFFO0FBQVgsS0FBVjtBQUE4Qjs7QUFDeEQsTUFBSUMsT0FBTyxHQUFHLElBQUl4RSxXQUFKLENBQWdCUyxPQUFoQixDQUFkO0FBQ0EsTUFBSUwsUUFBUSxDQUFDcUUsTUFBYixDQUFvQkQsT0FBcEIsRUFBNkIvRCxPQUE3QixFQUFzQ2lFLEdBQXRDLENBQTBDdEQsSUFBMUM7QUFDQSxTQUFPb0QsT0FBTyxDQUFDcEQsSUFBZjtBQUNIOztBQUNEdEIsT0FBTyxDQUFDQyxTQUFSLEdBQW9CQSxTQUFwQiIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xudmFyIF9fZXh0ZW5kcyA9ICh0aGlzICYmIHRoaXMuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkge1xuICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fFxuICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fFxuICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGIsIHApKSBkW3BdID0gYltwXTsgfTtcbiAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgfTtcbiAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgaWYgKHR5cGVvZiBiICE9PSBcImZ1bmN0aW9uXCIgJiYgYiAhPT0gbnVsbClcbiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJDbGFzcyBleHRlbmRzIHZhbHVlIFwiICsgU3RyaW5nKGIpICsgXCIgaXMgbm90IGEgY29uc3RydWN0b3Igb3IgbnVsbFwiKTtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XG4gICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTtcbiAgICB9O1xufSkoKTtcbnZhciBfX2NyZWF0ZUJpbmRpbmcgPSAodGhpcyAmJiB0aGlzLl9fY3JlYXRlQmluZGluZykgfHwgKE9iamVjdC5jcmVhdGUgPyAoZnVuY3Rpb24obywgbSwgaywgazIpIHtcbiAgICBpZiAoazIgPT09IHVuZGVmaW5lZCkgazIgPSBrO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBrMiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gbVtrXTsgfSB9KTtcbn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBvW2syXSA9IG1ba107XG59KSk7XG52YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX3NldE1vZHVsZURlZmF1bHQpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgXCJkZWZhdWx0XCIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHYgfSk7XG59KSA6IGZ1bmN0aW9uKG8sIHYpIHtcbiAgICBvW1wiZGVmYXVsdFwiXSA9IHY7XG59KTtcbnZhciBfX2ltcG9ydFN0YXIgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0U3RhcikgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIGlmIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpIHJldHVybiBtb2Q7XG4gICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgIGlmIChtb2QgIT0gbnVsbCkgZm9yICh2YXIgayBpbiBtb2QpIGlmIChrICE9PSBcImRlZmF1bHRcIiAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobW9kLCBrKSkgX19jcmVhdGVCaW5kaW5nKHJlc3VsdCwgbW9kLCBrKTtcbiAgICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xuICAgIHJldHVybiByZXN1bHQ7XG59O1xudmFyIF9faW1wb3J0RGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnREZWZhdWx0KSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgcmV0dXJuIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpID8gbW9kIDogeyBcImRlZmF1bHRcIjogbW9kIH07XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5wYXJzZUZlZWQgPSBleHBvcnRzLkZlZWRIYW5kbGVyID0gdm9pZCAwO1xudmFyIGRvbWhhbmRsZXJfMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwiZG9taGFuZGxlclwiKSk7XG52YXIgRG9tVXRpbHMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcImRvbXV0aWxzXCIpKTtcbnZhciBQYXJzZXJfMSA9IHJlcXVpcmUoXCIuL1BhcnNlclwiKTtcbnZhciBGZWVkSXRlbU1lZGlhTWVkaXVtO1xuKGZ1bmN0aW9uIChGZWVkSXRlbU1lZGlhTWVkaXVtKSB7XG4gICAgRmVlZEl0ZW1NZWRpYU1lZGl1bVtGZWVkSXRlbU1lZGlhTWVkaXVtW1wiaW1hZ2VcIl0gPSAwXSA9IFwiaW1hZ2VcIjtcbiAgICBGZWVkSXRlbU1lZGlhTWVkaXVtW0ZlZWRJdGVtTWVkaWFNZWRpdW1bXCJhdWRpb1wiXSA9IDFdID0gXCJhdWRpb1wiO1xuICAgIEZlZWRJdGVtTWVkaWFNZWRpdW1bRmVlZEl0ZW1NZWRpYU1lZGl1bVtcInZpZGVvXCJdID0gMl0gPSBcInZpZGVvXCI7XG4gICAgRmVlZEl0ZW1NZWRpYU1lZGl1bVtGZWVkSXRlbU1lZGlhTWVkaXVtW1wiZG9jdW1lbnRcIl0gPSAzXSA9IFwiZG9jdW1lbnRcIjtcbiAgICBGZWVkSXRlbU1lZGlhTWVkaXVtW0ZlZWRJdGVtTWVkaWFNZWRpdW1bXCJleGVjdXRhYmxlXCJdID0gNF0gPSBcImV4ZWN1dGFibGVcIjtcbn0pKEZlZWRJdGVtTWVkaWFNZWRpdW0gfHwgKEZlZWRJdGVtTWVkaWFNZWRpdW0gPSB7fSkpO1xudmFyIEZlZWRJdGVtTWVkaWFFeHByZXNzaW9uO1xuKGZ1bmN0aW9uIChGZWVkSXRlbU1lZGlhRXhwcmVzc2lvbikge1xuICAgIEZlZWRJdGVtTWVkaWFFeHByZXNzaW9uW0ZlZWRJdGVtTWVkaWFFeHByZXNzaW9uW1wic2FtcGxlXCJdID0gMF0gPSBcInNhbXBsZVwiO1xuICAgIEZlZWRJdGVtTWVkaWFFeHByZXNzaW9uW0ZlZWRJdGVtTWVkaWFFeHByZXNzaW9uW1wiZnVsbFwiXSA9IDFdID0gXCJmdWxsXCI7XG4gICAgRmVlZEl0ZW1NZWRpYUV4cHJlc3Npb25bRmVlZEl0ZW1NZWRpYUV4cHJlc3Npb25bXCJub25zdG9wXCJdID0gMl0gPSBcIm5vbnN0b3BcIjtcbn0pKEZlZWRJdGVtTWVkaWFFeHByZXNzaW9uIHx8IChGZWVkSXRlbU1lZGlhRXhwcmVzc2lvbiA9IHt9KSk7XG4vLyBUT0RPOiBDb25zdW1lIGRhdGEgYXMgaXQgaXMgY29taW5nIGluXG52YXIgRmVlZEhhbmRsZXIgPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKEZlZWRIYW5kbGVyLCBfc3VwZXIpO1xuICAgIC8qKlxuICAgICAqXG4gICAgICogQHBhcmFtIGNhbGxiYWNrXG4gICAgICogQHBhcmFtIG9wdGlvbnNcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBGZWVkSGFuZGxlcihjYWxsYmFjaywgb3B0aW9ucykge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICBpZiAodHlwZW9mIGNhbGxiYWNrID09PSBcIm9iamVjdFwiKSB7XG4gICAgICAgICAgICBjYWxsYmFjayA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIG9wdGlvbnMgPSBjYWxsYmFjaztcbiAgICAgICAgfVxuICAgICAgICBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMsIGNhbGxiYWNrLCBvcHRpb25zKSB8fCB0aGlzO1xuICAgICAgICByZXR1cm4gX3RoaXM7XG4gICAgfVxuICAgIEZlZWRIYW5kbGVyLnByb3RvdHlwZS5vbmVuZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIF9hLCBfYjtcbiAgICAgICAgdmFyIGZlZWRSb290ID0gZ2V0T25lRWxlbWVudChpc1ZhbGlkRmVlZCwgdGhpcy5kb20pO1xuICAgICAgICBpZiAoIWZlZWRSb290KSB7XG4gICAgICAgICAgICB0aGlzLmhhbmRsZUNhbGxiYWNrKG5ldyBFcnJvcihcImNvdWxkbid0IGZpbmQgcm9vdCBvZiBmZWVkXCIpKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB2YXIgZmVlZCA9IHt9O1xuICAgICAgICBpZiAoZmVlZFJvb3QubmFtZSA9PT0gXCJmZWVkXCIpIHtcbiAgICAgICAgICAgIHZhciBjaGlsZHMgPSBmZWVkUm9vdC5jaGlsZHJlbjtcbiAgICAgICAgICAgIGZlZWQudHlwZSA9IFwiYXRvbVwiO1xuICAgICAgICAgICAgYWRkQ29uZGl0aW9uYWxseShmZWVkLCBcImlkXCIsIFwiaWRcIiwgY2hpbGRzKTtcbiAgICAgICAgICAgIGFkZENvbmRpdGlvbmFsbHkoZmVlZCwgXCJ0aXRsZVwiLCBcInRpdGxlXCIsIGNoaWxkcyk7XG4gICAgICAgICAgICB2YXIgaHJlZiA9IGdldEF0dHJpYnV0ZShcImhyZWZcIiwgZ2V0T25lRWxlbWVudChcImxpbmtcIiwgY2hpbGRzKSk7XG4gICAgICAgICAgICBpZiAoaHJlZikge1xuICAgICAgICAgICAgICAgIGZlZWQubGluayA9IGhyZWY7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBhZGRDb25kaXRpb25hbGx5KGZlZWQsIFwiZGVzY3JpcHRpb25cIiwgXCJzdWJ0aXRsZVwiLCBjaGlsZHMpO1xuICAgICAgICAgICAgdmFyIHVwZGF0ZWQgPSBmZXRjaChcInVwZGF0ZWRcIiwgY2hpbGRzKTtcbiAgICAgICAgICAgIGlmICh1cGRhdGVkKSB7XG4gICAgICAgICAgICAgICAgZmVlZC51cGRhdGVkID0gbmV3IERhdGUodXBkYXRlZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBhZGRDb25kaXRpb25hbGx5KGZlZWQsIFwiYXV0aG9yXCIsIFwiZW1haWxcIiwgY2hpbGRzLCB0cnVlKTtcbiAgICAgICAgICAgIGZlZWQuaXRlbXMgPSBnZXRFbGVtZW50cyhcImVudHJ5XCIsIGNoaWxkcykubWFwKGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICAgICAgICAgICAgdmFyIGVudHJ5ID0ge307XG4gICAgICAgICAgICAgICAgdmFyIGNoaWxkcmVuID0gaXRlbS5jaGlsZHJlbjtcbiAgICAgICAgICAgICAgICBhZGRDb25kaXRpb25hbGx5KGVudHJ5LCBcImlkXCIsIFwiaWRcIiwgY2hpbGRyZW4pO1xuICAgICAgICAgICAgICAgIGFkZENvbmRpdGlvbmFsbHkoZW50cnksIFwidGl0bGVcIiwgXCJ0aXRsZVwiLCBjaGlsZHJlbik7XG4gICAgICAgICAgICAgICAgdmFyIGhyZWYgPSBnZXRBdHRyaWJ1dGUoXCJocmVmXCIsIGdldE9uZUVsZW1lbnQoXCJsaW5rXCIsIGNoaWxkcmVuKSk7XG4gICAgICAgICAgICAgICAgaWYgKGhyZWYpIHtcbiAgICAgICAgICAgICAgICAgICAgZW50cnkubGluayA9IGhyZWY7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHZhciBkZXNjcmlwdGlvbiA9IGZldGNoKFwic3VtbWFyeVwiLCBjaGlsZHJlbikgfHwgZmV0Y2goXCJjb250ZW50XCIsIGNoaWxkcmVuKTtcbiAgICAgICAgICAgICAgICBpZiAoZGVzY3JpcHRpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgZW50cnkuZGVzY3JpcHRpb24gPSBkZXNjcmlwdGlvbjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdmFyIHB1YkRhdGUgPSBmZXRjaChcInVwZGF0ZWRcIiwgY2hpbGRyZW4pO1xuICAgICAgICAgICAgICAgIGlmIChwdWJEYXRlKSB7XG4gICAgICAgICAgICAgICAgICAgIGVudHJ5LnB1YkRhdGUgPSBuZXcgRGF0ZShwdWJEYXRlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZW50cnkubWVkaWEgPSBnZXRNZWRpYUVsZW1lbnRzKGNoaWxkcmVuKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZW50cnk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHZhciBjaGlsZHMgPSAoX2IgPSAoX2EgPSBnZXRPbmVFbGVtZW50KFwiY2hhbm5lbFwiLCBmZWVkUm9vdC5jaGlsZHJlbikpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5jaGlsZHJlbikgIT09IG51bGwgJiYgX2IgIT09IHZvaWQgMCA/IF9iIDogW107XG4gICAgICAgICAgICBmZWVkLnR5cGUgPSBmZWVkUm9vdC5uYW1lLnN1YnN0cigwLCAzKTtcbiAgICAgICAgICAgIGZlZWQuaWQgPSBcIlwiO1xuICAgICAgICAgICAgYWRkQ29uZGl0aW9uYWxseShmZWVkLCBcInRpdGxlXCIsIFwidGl0bGVcIiwgY2hpbGRzKTtcbiAgICAgICAgICAgIGFkZENvbmRpdGlvbmFsbHkoZmVlZCwgXCJsaW5rXCIsIFwibGlua1wiLCBjaGlsZHMpO1xuICAgICAgICAgICAgYWRkQ29uZGl0aW9uYWxseShmZWVkLCBcImRlc2NyaXB0aW9uXCIsIFwiZGVzY3JpcHRpb25cIiwgY2hpbGRzKTtcbiAgICAgICAgICAgIHZhciB1cGRhdGVkID0gZmV0Y2goXCJsYXN0QnVpbGREYXRlXCIsIGNoaWxkcyk7XG4gICAgICAgICAgICBpZiAodXBkYXRlZCkge1xuICAgICAgICAgICAgICAgIGZlZWQudXBkYXRlZCA9IG5ldyBEYXRlKHVwZGF0ZWQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYWRkQ29uZGl0aW9uYWxseShmZWVkLCBcImF1dGhvclwiLCBcIm1hbmFnaW5nRWRpdG9yXCIsIGNoaWxkcywgdHJ1ZSk7XG4gICAgICAgICAgICBmZWVkLml0ZW1zID0gZ2V0RWxlbWVudHMoXCJpdGVtXCIsIGZlZWRSb290LmNoaWxkcmVuKS5tYXAoZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgICAgICAgICAgICB2YXIgZW50cnkgPSB7fTtcbiAgICAgICAgICAgICAgICB2YXIgY2hpbGRyZW4gPSBpdGVtLmNoaWxkcmVuO1xuICAgICAgICAgICAgICAgIGFkZENvbmRpdGlvbmFsbHkoZW50cnksIFwiaWRcIiwgXCJndWlkXCIsIGNoaWxkcmVuKTtcbiAgICAgICAgICAgICAgICBhZGRDb25kaXRpb25hbGx5KGVudHJ5LCBcInRpdGxlXCIsIFwidGl0bGVcIiwgY2hpbGRyZW4pO1xuICAgICAgICAgICAgICAgIGFkZENvbmRpdGlvbmFsbHkoZW50cnksIFwibGlua1wiLCBcImxpbmtcIiwgY2hpbGRyZW4pO1xuICAgICAgICAgICAgICAgIGFkZENvbmRpdGlvbmFsbHkoZW50cnksIFwiZGVzY3JpcHRpb25cIiwgXCJkZXNjcmlwdGlvblwiLCBjaGlsZHJlbik7XG4gICAgICAgICAgICAgICAgdmFyIHB1YkRhdGUgPSBmZXRjaChcInB1YkRhdGVcIiwgY2hpbGRyZW4pO1xuICAgICAgICAgICAgICAgIGlmIChwdWJEYXRlKVxuICAgICAgICAgICAgICAgICAgICBlbnRyeS5wdWJEYXRlID0gbmV3IERhdGUocHViRGF0ZSk7XG4gICAgICAgICAgICAgICAgZW50cnkubWVkaWEgPSBnZXRNZWRpYUVsZW1lbnRzKGNoaWxkcmVuKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZW50cnk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmZlZWQgPSBmZWVkO1xuICAgICAgICB0aGlzLmhhbmRsZUNhbGxiYWNrKG51bGwpO1xuICAgIH07XG4gICAgcmV0dXJuIEZlZWRIYW5kbGVyO1xufShkb21oYW5kbGVyXzEuZGVmYXVsdCkpO1xuZXhwb3J0cy5GZWVkSGFuZGxlciA9IEZlZWRIYW5kbGVyO1xuZnVuY3Rpb24gZ2V0TWVkaWFFbGVtZW50cyh3aGVyZSkge1xuICAgIHJldHVybiBnZXRFbGVtZW50cyhcIm1lZGlhOmNvbnRlbnRcIiwgd2hlcmUpLm1hcChmdW5jdGlvbiAoZWxlbSkge1xuICAgICAgICB2YXIgbWVkaWEgPSB7XG4gICAgICAgICAgICBtZWRpdW06IGVsZW0uYXR0cmlicy5tZWRpdW0sXG4gICAgICAgICAgICBpc0RlZmF1bHQ6ICEhZWxlbS5hdHRyaWJzLmlzRGVmYXVsdCxcbiAgICAgICAgfTtcbiAgICAgICAgaWYgKGVsZW0uYXR0cmlicy51cmwpIHtcbiAgICAgICAgICAgIG1lZGlhLnVybCA9IGVsZW0uYXR0cmlicy51cmw7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGVsZW0uYXR0cmlicy5maWxlU2l6ZSkge1xuICAgICAgICAgICAgbWVkaWEuZmlsZVNpemUgPSBwYXJzZUludChlbGVtLmF0dHJpYnMuZmlsZVNpemUsIDEwKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZWxlbS5hdHRyaWJzLnR5cGUpIHtcbiAgICAgICAgICAgIG1lZGlhLnR5cGUgPSBlbGVtLmF0dHJpYnMudHlwZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZWxlbS5hdHRyaWJzLmV4cHJlc3Npb24pIHtcbiAgICAgICAgICAgIG1lZGlhLmV4cHJlc3Npb24gPSBlbGVtLmF0dHJpYnNcbiAgICAgICAgICAgICAgICAuZXhwcmVzc2lvbjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZWxlbS5hdHRyaWJzLmJpdHJhdGUpIHtcbiAgICAgICAgICAgIG1lZGlhLmJpdHJhdGUgPSBwYXJzZUludChlbGVtLmF0dHJpYnMuYml0cmF0ZSwgMTApO1xuICAgICAgICB9XG4gICAgICAgIGlmIChlbGVtLmF0dHJpYnMuZnJhbWVyYXRlKSB7XG4gICAgICAgICAgICBtZWRpYS5mcmFtZXJhdGUgPSBwYXJzZUludChlbGVtLmF0dHJpYnMuZnJhbWVyYXRlLCAxMCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGVsZW0uYXR0cmlicy5zYW1wbGluZ3JhdGUpIHtcbiAgICAgICAgICAgIG1lZGlhLnNhbXBsaW5ncmF0ZSA9IHBhcnNlSW50KGVsZW0uYXR0cmlicy5zYW1wbGluZ3JhdGUsIDEwKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZWxlbS5hdHRyaWJzLmNoYW5uZWxzKSB7XG4gICAgICAgICAgICBtZWRpYS5jaGFubmVscyA9IHBhcnNlSW50KGVsZW0uYXR0cmlicy5jaGFubmVscywgMTApO1xuICAgICAgICB9XG4gICAgICAgIGlmIChlbGVtLmF0dHJpYnMuZHVyYXRpb24pIHtcbiAgICAgICAgICAgIG1lZGlhLmR1cmF0aW9uID0gcGFyc2VJbnQoZWxlbS5hdHRyaWJzLmR1cmF0aW9uLCAxMCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGVsZW0uYXR0cmlicy5oZWlnaHQpIHtcbiAgICAgICAgICAgIG1lZGlhLmhlaWdodCA9IHBhcnNlSW50KGVsZW0uYXR0cmlicy5oZWlnaHQsIDEwKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZWxlbS5hdHRyaWJzLndpZHRoKSB7XG4gICAgICAgICAgICBtZWRpYS53aWR0aCA9IHBhcnNlSW50KGVsZW0uYXR0cmlicy53aWR0aCwgMTApO1xuICAgICAgICB9XG4gICAgICAgIGlmIChlbGVtLmF0dHJpYnMubGFuZykge1xuICAgICAgICAgICAgbWVkaWEubGFuZyA9IGVsZW0uYXR0cmlicy5sYW5nO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBtZWRpYTtcbiAgICB9KTtcbn1cbmZ1bmN0aW9uIGdldEVsZW1lbnRzKHRhZ05hbWUsIHdoZXJlKSB7XG4gICAgcmV0dXJuIERvbVV0aWxzLmdldEVsZW1lbnRzQnlUYWdOYW1lKHRhZ05hbWUsIHdoZXJlLCB0cnVlKTtcbn1cbmZ1bmN0aW9uIGdldE9uZUVsZW1lbnQodGFnTmFtZSwgbm9kZSkge1xuICAgIHJldHVybiBEb21VdGlscy5nZXRFbGVtZW50c0J5VGFnTmFtZSh0YWdOYW1lLCBub2RlLCB0cnVlLCAxKVswXTtcbn1cbmZ1bmN0aW9uIGZldGNoKHRhZ05hbWUsIHdoZXJlLCByZWN1cnNlKSB7XG4gICAgaWYgKHJlY3Vyc2UgPT09IHZvaWQgMCkgeyByZWN1cnNlID0gZmFsc2U7IH1cbiAgICByZXR1cm4gRG9tVXRpbHMuZ2V0VGV4dChEb21VdGlscy5nZXRFbGVtZW50c0J5VGFnTmFtZSh0YWdOYW1lLCB3aGVyZSwgcmVjdXJzZSwgMSkpLnRyaW0oKTtcbn1cbmZ1bmN0aW9uIGdldEF0dHJpYnV0ZShuYW1lLCBlbGVtKSB7XG4gICAgaWYgKCFlbGVtKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICB2YXIgYXR0cmlicyA9IGVsZW0uYXR0cmlicztcbiAgICByZXR1cm4gYXR0cmlic1tuYW1lXTtcbn1cbmZ1bmN0aW9uIGFkZENvbmRpdGlvbmFsbHkob2JqLCBwcm9wLCB3aGF0LCB3aGVyZSwgcmVjdXJzZSkge1xuICAgIGlmIChyZWN1cnNlID09PSB2b2lkIDApIHsgcmVjdXJzZSA9IGZhbHNlOyB9XG4gICAgdmFyIHRtcCA9IGZldGNoKHdoYXQsIHdoZXJlLCByZWN1cnNlKTtcbiAgICBpZiAodG1wKVxuICAgICAgICBvYmpbcHJvcF0gPSB0bXA7XG59XG5mdW5jdGlvbiBpc1ZhbGlkRmVlZCh2YWx1ZSkge1xuICAgIHJldHVybiB2YWx1ZSA9PT0gXCJyc3NcIiB8fCB2YWx1ZSA9PT0gXCJmZWVkXCIgfHwgdmFsdWUgPT09IFwicmRmOlJERlwiO1xufVxuLyoqXG4gKiBQYXJzZSBhIGZlZWQuXG4gKlxuICogQHBhcmFtIGZlZWQgVGhlIGZlZWQgdGhhdCBzaG91bGQgYmUgcGFyc2VkLCBhcyBhIHN0cmluZy5cbiAqIEBwYXJhbSBvcHRpb25zIE9wdGlvbmFsbHksIG9wdGlvbnMgZm9yIHBhcnNpbmcuIFdoZW4gdXNpbmcgdGhpcyBvcHRpb24sIHlvdSBzaG91bGQgc2V0IGB4bWxNb2RlYCB0byBgdHJ1ZWAuXG4gKi9cbmZ1bmN0aW9uIHBhcnNlRmVlZChmZWVkLCBvcHRpb25zKSB7XG4gICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgeyBvcHRpb25zID0geyB4bWxNb2RlOiB0cnVlIH07IH1cbiAgICB2YXIgaGFuZGxlciA9IG5ldyBGZWVkSGFuZGxlcihvcHRpb25zKTtcbiAgICBuZXcgUGFyc2VyXzEuUGFyc2VyKGhhbmRsZXIsIG9wdGlvbnMpLmVuZChmZWVkKTtcbiAgICByZXR1cm4gaGFuZGxlci5mZWVkO1xufVxuZXhwb3J0cy5wYXJzZUZlZWQgPSBwYXJzZUZlZWQ7XG4iXX0=