a09c83f08a9634306923146d87fea188
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var url = require("url");

var URL = url.URL;

var http = require("http");

var https = require("https");

var Writable = require("stream").Writable;

var assert = require("assert");

var debug = require("./debug");

var eventHandlers = Object.create(null);
["abort", "aborted", "connect", "error", "socket", "timeout"].forEach(function (event) {
  eventHandlers[event] = function (arg1, arg2, arg3) {
    this._redirectable.emit(event, arg1, arg2, arg3);
  };
});
var RedirectionError = createErrorType("ERR_FR_REDIRECTION_FAILURE", "");
var TooManyRedirectsError = createErrorType("ERR_FR_TOO_MANY_REDIRECTS", "Maximum number of redirects exceeded");
var MaxBodyLengthExceededError = createErrorType("ERR_FR_MAX_BODY_LENGTH_EXCEEDED", "Request body larger than maxBodyLength limit");
var WriteAfterEndError = createErrorType("ERR_STREAM_WRITE_AFTER_END", "write after end");

function RedirectableRequest(options, responseCallback) {
  Writable.call(this);

  this._sanitizeOptions(options);

  this._options = options;
  this._ended = false;
  this._ending = false;
  this._redirectCount = 0;
  this._redirects = [];
  this._requestBodyLength = 0;
  this._requestBodyBuffers = [];

  if (responseCallback) {
    this.on("response", responseCallback);
  }

  var self = this;

  this._onNativeResponse = function (response) {
    self._processResponse(response);
  };

  this._performRequest();
}

RedirectableRequest.prototype = Object.create(Writable.prototype);

RedirectableRequest.prototype.abort = function () {
  this._currentRequest.removeAllListeners();

  this._currentRequest.on("error", noop);

  this._currentRequest.abort();

  this.emit("abort");
  this.removeAllListeners();
};

RedirectableRequest.prototype.write = function (data, encoding, callback) {
  if (this._ending) {
    throw new WriteAfterEndError();
  }

  if (!(typeof data === "string" || typeof data === "object" && "length" in data)) {
    throw new TypeError("data should be a string, Buffer or Uint8Array");
  }

  if (typeof encoding === "function") {
    callback = encoding;
    encoding = null;
  }

  if (data.length === 0) {
    if (callback) {
      callback();
    }

    return;
  }

  if (this._requestBodyLength + data.length <= this._options.maxBodyLength) {
    this._requestBodyLength += data.length;

    this._requestBodyBuffers.push({
      data: data,
      encoding: encoding
    });

    this._currentRequest.write(data, encoding, callback);
  } else {
      this.emit("error", new MaxBodyLengthExceededError());
      this.abort();
    }
};

RedirectableRequest.prototype.end = function (data, encoding, callback) {
  if (typeof data === "function") {
    callback = data;
    data = encoding = null;
  } else if (typeof encoding === "function") {
    callback = encoding;
    encoding = null;
  }

  if (!data) {
    this._ended = this._ending = true;

    this._currentRequest.end(null, null, callback);
  } else {
    var self = this;
    var currentRequest = this._currentRequest;
    this.write(data, encoding, function () {
      self._ended = true;
      currentRequest.end(null, null, callback);
    });
    this._ending = true;
  }
};

RedirectableRequest.prototype.setHeader = function (name, value) {
  this._options.headers[name] = value;

  this._currentRequest.setHeader(name, value);
};

RedirectableRequest.prototype.removeHeader = function (name) {
  delete this._options.headers[name];

  this._currentRequest.removeHeader(name);
};

RedirectableRequest.prototype.setTimeout = function (msecs, callback) {
  var self = this;

  if (callback) {
    this.on("timeout", callback);
  }

  function startTimer() {
    if (self._timeout) {
      clearTimeout(self._timeout);
    }

    self._timeout = setTimeout(function () {
      self.emit("timeout");
      clearTimer();
    }, msecs);
  }

  function clearTimer() {
    clearTimeout(this._timeout);

    if (callback) {
      self.removeListener("timeout", callback);
    }

    if (!this.socket) {
      self._currentRequest.removeListener("socket", startTimer);
    }
  }

  if (this.socket) {
    startTimer();
  } else {
    this._currentRequest.once("socket", startTimer);
  }

  this.once("response", clearTimer);
  this.once("error", clearTimer);
  return this;
};

["flushHeaders", "getHeader", "setNoDelay", "setSocketKeepAlive"].forEach(function (method) {
  RedirectableRequest.prototype[method] = function (a, b) {
    return this._currentRequest[method](a, b);
  };
});
["aborted", "connection", "socket"].forEach(function (property) {
  Object.defineProperty(RedirectableRequest.prototype, property, {
    get: function get() {
      return this._currentRequest[property];
    }
  });
});

RedirectableRequest.prototype._sanitizeOptions = function (options) {
  if (!options.headers) {
    options.headers = {};
  }

  if (options.host) {
    if (!options.hostname) {
      options.hostname = options.host;
    }

    delete options.host;
  }

  if (!options.pathname && options.path) {
    var searchPos = options.path.indexOf("?");

    if (searchPos < 0) {
      options.pathname = options.path;
    } else {
      options.pathname = options.path.substring(0, searchPos);
      options.search = options.path.substring(searchPos);
    }
  }
};

RedirectableRequest.prototype._performRequest = function () {
  var protocol = this._options.protocol;
  var nativeProtocol = this._options.nativeProtocols[protocol];

  if (!nativeProtocol) {
    this.emit("error", new TypeError("Unsupported protocol " + protocol));
    return;
  }

  if (this._options.agents) {
    var scheme = protocol.substr(0, protocol.length - 1);
    this._options.agent = this._options.agents[scheme];
  }

  var request = this._currentRequest = nativeProtocol.request(this._options, this._onNativeResponse);
  this._currentUrl = url.format(this._options);
  request._redirectable = this;

  for (var event in eventHandlers) {
    if (event) {
      request.on(event, eventHandlers[event]);
    }
  }

  if (this._isRedirect) {
    var i = 0;
    var self = this;
    var buffers = this._requestBodyBuffers;

    (function writeNext(error) {
      if (request === self._currentRequest) {
        if (error) {
          self.emit("error", error);
        } else if (i < buffers.length) {
            var buffer = buffers[i++];

            if (!request.finished) {
              request.write(buffer.data, buffer.encoding, writeNext);
            }
          } else if (self._ended) {
              request.end();
            }
      }
    })();
  }
};

RedirectableRequest.prototype._processResponse = function (response) {
  var statusCode = response.statusCode;

  if (this._options.trackRedirects) {
    this._redirects.push({
      url: this._currentUrl,
      headers: response.headers,
      statusCode: statusCode
    });
  }

  var location = response.headers.location;

  if (location && this._options.followRedirects !== false && statusCode >= 300 && statusCode < 400) {
    this._currentRequest.removeAllListeners();

    this._currentRequest.on("error", noop);

    this._currentRequest.abort();

    response.destroy();

    if (++this._redirectCount > this._options.maxRedirects) {
      this.emit("error", new TooManyRedirectsError());
      return;
    }

    if ((statusCode === 301 || statusCode === 302) && this._options.method === "POST" || statusCode === 303 && !/^(?:GET|HEAD)$/.test(this._options.method)) {
      this._options.method = "GET";
      this._requestBodyBuffers = [];
      removeMatchingHeaders(/^content-/i, this._options.headers);
    }

    var previousHostName = removeMatchingHeaders(/^host$/i, this._options.headers) || url.parse(this._currentUrl).hostname;
    var redirectUrl = url.resolve(this._currentUrl, location);
    debug("redirecting to", redirectUrl);
    this._isRedirect = true;
    var redirectUrlParts = url.parse(redirectUrl);
    (0, _extends2.default)(this._options, redirectUrlParts);

    if (redirectUrlParts.hostname !== previousHostName) {
      removeMatchingHeaders(/^authorization$/i, this._options.headers);
    }

    if (typeof this._options.beforeRedirect === "function") {
      var responseDetails = {
        headers: response.headers
      };

      try {
        this._options.beforeRedirect.call(null, this._options, responseDetails);
      } catch (err) {
        this.emit("error", err);
        return;
      }

      this._sanitizeOptions(this._options);
    }

    try {
      this._performRequest();
    } catch (cause) {
      var error = new RedirectionError("Redirected request failed: " + cause.message);
      error.cause = cause;
      this.emit("error", error);
    }
  } else {
    response.responseUrl = this._currentUrl;
    response.redirects = this._redirects;
    this.emit("response", response);
    this._requestBodyBuffers = [];
  }
};

function wrap(protocols) {
  var exports = {
    maxRedirects: 21,
    maxBodyLength: 10 * 1024 * 1024
  };
  var nativeProtocols = {};
  Object.keys(protocols).forEach(function (scheme) {
    var protocol = scheme + ":";
    var nativeProtocol = nativeProtocols[protocol] = protocols[scheme];
    var wrappedProtocol = exports[scheme] = Object.create(nativeProtocol);

    function request(input, options, callback) {
      if (typeof input === "string") {
        var urlStr = input;

        try {
          input = urlToOptions(new URL(urlStr));
        } catch (err) {
          input = url.parse(urlStr);
        }
      } else if (URL && input instanceof URL) {
        input = urlToOptions(input);
      } else {
        callback = options;
        options = input;
        input = {
          protocol: protocol
        };
      }

      if (typeof options === "function") {
        callback = options;
        options = null;
      }

      options = (0, _extends2.default)({
        maxRedirects: exports.maxRedirects,
        maxBodyLength: exports.maxBodyLength
      }, input, options);
      options.nativeProtocols = nativeProtocols;
      assert.equal(options.protocol, protocol, "protocol mismatch");
      debug("options", options);
      return new RedirectableRequest(options, callback);
    }

    function get(input, options, callback) {
      var wrappedRequest = wrappedProtocol.request(input, options, callback);
      wrappedRequest.end();
      return wrappedRequest;
    }

    Object.defineProperties(wrappedProtocol, {
      request: {
        value: request,
        configurable: true,
        enumerable: true,
        writable: true
      },
      get: {
        value: get,
        configurable: true,
        enumerable: true,
        writable: true
      }
    });
  });
  return exports;
}

function noop() {}

function urlToOptions(urlObject) {
  var options = {
    protocol: urlObject.protocol,
    hostname: urlObject.hostname.startsWith("[") ? urlObject.hostname.slice(1, -1) : urlObject.hostname,
    hash: urlObject.hash,
    search: urlObject.search,
    pathname: urlObject.pathname,
    path: urlObject.pathname + urlObject.search,
    href: urlObject.href
  };

  if (urlObject.port !== "") {
    options.port = Number(urlObject.port);
  }

  return options;
}

function removeMatchingHeaders(regex, headers) {
  var lastValue;

  for (var header in headers) {
    if (regex.test(header)) {
      lastValue = headers[header];
      delete headers[header];
    }
  }

  return lastValue;
}

function createErrorType(code, defaultMessage) {
  function CustomError(message) {
    Error.captureStackTrace(this, this.constructor);
    this.message = message || defaultMessage;
  }

  CustomError.prototype = new Error();
  CustomError.prototype.constructor = CustomError;
  CustomError.prototype.name = "Error [" + code + "]";
  CustomError.prototype.code = code;
  return CustomError;
}

module.exports = wrap({
  http: http,
  https: https
});
module.exports.wrap = wrap;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbInVybCIsInJlcXVpcmUiLCJVUkwiLCJodHRwIiwiaHR0cHMiLCJXcml0YWJsZSIsImFzc2VydCIsImRlYnVnIiwiZXZlbnRIYW5kbGVycyIsIk9iamVjdCIsImNyZWF0ZSIsImZvckVhY2giLCJldmVudCIsImFyZzEiLCJhcmcyIiwiYXJnMyIsIl9yZWRpcmVjdGFibGUiLCJlbWl0IiwiUmVkaXJlY3Rpb25FcnJvciIsImNyZWF0ZUVycm9yVHlwZSIsIlRvb01hbnlSZWRpcmVjdHNFcnJvciIsIk1heEJvZHlMZW5ndGhFeGNlZWRlZEVycm9yIiwiV3JpdGVBZnRlckVuZEVycm9yIiwiUmVkaXJlY3RhYmxlUmVxdWVzdCIsIm9wdGlvbnMiLCJyZXNwb25zZUNhbGxiYWNrIiwiY2FsbCIsIl9zYW5pdGl6ZU9wdGlvbnMiLCJfb3B0aW9ucyIsIl9lbmRlZCIsIl9lbmRpbmciLCJfcmVkaXJlY3RDb3VudCIsIl9yZWRpcmVjdHMiLCJfcmVxdWVzdEJvZHlMZW5ndGgiLCJfcmVxdWVzdEJvZHlCdWZmZXJzIiwib24iLCJzZWxmIiwiX29uTmF0aXZlUmVzcG9uc2UiLCJyZXNwb25zZSIsIl9wcm9jZXNzUmVzcG9uc2UiLCJfcGVyZm9ybVJlcXVlc3QiLCJwcm90b3R5cGUiLCJhYm9ydCIsIl9jdXJyZW50UmVxdWVzdCIsInJlbW92ZUFsbExpc3RlbmVycyIsIm5vb3AiLCJ3cml0ZSIsImRhdGEiLCJlbmNvZGluZyIsImNhbGxiYWNrIiwiVHlwZUVycm9yIiwibGVuZ3RoIiwibWF4Qm9keUxlbmd0aCIsInB1c2giLCJlbmQiLCJjdXJyZW50UmVxdWVzdCIsInNldEhlYWRlciIsIm5hbWUiLCJ2YWx1ZSIsImhlYWRlcnMiLCJyZW1vdmVIZWFkZXIiLCJzZXRUaW1lb3V0IiwibXNlY3MiLCJzdGFydFRpbWVyIiwiX3RpbWVvdXQiLCJjbGVhclRpbWVvdXQiLCJjbGVhclRpbWVyIiwicmVtb3ZlTGlzdGVuZXIiLCJzb2NrZXQiLCJvbmNlIiwibWV0aG9kIiwiYSIsImIiLCJwcm9wZXJ0eSIsImRlZmluZVByb3BlcnR5IiwiZ2V0IiwiaG9zdCIsImhvc3RuYW1lIiwicGF0aG5hbWUiLCJwYXRoIiwic2VhcmNoUG9zIiwiaW5kZXhPZiIsInN1YnN0cmluZyIsInNlYXJjaCIsInByb3RvY29sIiwibmF0aXZlUHJvdG9jb2wiLCJuYXRpdmVQcm90b2NvbHMiLCJhZ2VudHMiLCJzY2hlbWUiLCJzdWJzdHIiLCJhZ2VudCIsInJlcXVlc3QiLCJfY3VycmVudFVybCIsImZvcm1hdCIsIl9pc1JlZGlyZWN0IiwiaSIsImJ1ZmZlcnMiLCJ3cml0ZU5leHQiLCJlcnJvciIsImJ1ZmZlciIsImZpbmlzaGVkIiwic3RhdHVzQ29kZSIsInRyYWNrUmVkaXJlY3RzIiwibG9jYXRpb24iLCJmb2xsb3dSZWRpcmVjdHMiLCJkZXN0cm95IiwibWF4UmVkaXJlY3RzIiwidGVzdCIsInJlbW92ZU1hdGNoaW5nSGVhZGVycyIsInByZXZpb3VzSG9zdE5hbWUiLCJwYXJzZSIsInJlZGlyZWN0VXJsIiwicmVzb2x2ZSIsInJlZGlyZWN0VXJsUGFydHMiLCJiZWZvcmVSZWRpcmVjdCIsInJlc3BvbnNlRGV0YWlscyIsImVyciIsImNhdXNlIiwibWVzc2FnZSIsInJlc3BvbnNlVXJsIiwicmVkaXJlY3RzIiwid3JhcCIsInByb3RvY29scyIsImV4cG9ydHMiLCJrZXlzIiwid3JhcHBlZFByb3RvY29sIiwiaW5wdXQiLCJ1cmxTdHIiLCJ1cmxUb09wdGlvbnMiLCJlcXVhbCIsIndyYXBwZWRSZXF1ZXN0IiwiZGVmaW5lUHJvcGVydGllcyIsImNvbmZpZ3VyYWJsZSIsImVudW1lcmFibGUiLCJ3cml0YWJsZSIsInVybE9iamVjdCIsInN0YXJ0c1dpdGgiLCJzbGljZSIsImhhc2giLCJocmVmIiwicG9ydCIsIk51bWJlciIsInJlZ2V4IiwibGFzdFZhbHVlIiwiaGVhZGVyIiwiY29kZSIsImRlZmF1bHRNZXNzYWdlIiwiQ3VzdG9tRXJyb3IiLCJFcnJvciIsImNhcHR1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dXJsXCIpO1xudmFyIFVSTCA9IHVybC5VUkw7XG52YXIgaHR0cCA9IHJlcXVpcmUoXCJodHRwXCIpO1xudmFyIGh0dHBzID0gcmVxdWlyZShcImh0dHBzXCIpO1xudmFyIFdyaXRhYmxlID0gcmVxdWlyZShcInN0cmVhbVwiKS5Xcml0YWJsZTtcbnZhciBhc3NlcnQgPSByZXF1aXJlKFwiYXNzZXJ0XCIpO1xudmFyIGRlYnVnID0gcmVxdWlyZShcIi4vZGVidWdcIik7XG5cbi8vIENyZWF0ZSBoYW5kbGVycyB0aGF0IHBhc3MgZXZlbnRzIGZyb20gbmF0aXZlIHJlcXVlc3RzXG52YXIgZXZlbnRIYW5kbGVycyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG5bXCJhYm9ydFwiLCBcImFib3J0ZWRcIiwgXCJjb25uZWN0XCIsIFwiZXJyb3JcIiwgXCJzb2NrZXRcIiwgXCJ0aW1lb3V0XCJdLmZvckVhY2goZnVuY3Rpb24gKGV2ZW50KSB7XG4gIGV2ZW50SGFuZGxlcnNbZXZlbnRdID0gZnVuY3Rpb24gKGFyZzEsIGFyZzIsIGFyZzMpIHtcbiAgICB0aGlzLl9yZWRpcmVjdGFibGUuZW1pdChldmVudCwgYXJnMSwgYXJnMiwgYXJnMyk7XG4gIH07XG59KTtcblxuLy8gRXJyb3IgdHlwZXMgd2l0aCBjb2Rlc1xudmFyIFJlZGlyZWN0aW9uRXJyb3IgPSBjcmVhdGVFcnJvclR5cGUoXG4gIFwiRVJSX0ZSX1JFRElSRUNUSU9OX0ZBSUxVUkVcIixcbiAgXCJcIlxuKTtcbnZhciBUb29NYW55UmVkaXJlY3RzRXJyb3IgPSBjcmVhdGVFcnJvclR5cGUoXG4gIFwiRVJSX0ZSX1RPT19NQU5ZX1JFRElSRUNUU1wiLFxuICBcIk1heGltdW0gbnVtYmVyIG9mIHJlZGlyZWN0cyBleGNlZWRlZFwiXG4pO1xudmFyIE1heEJvZHlMZW5ndGhFeGNlZWRlZEVycm9yID0gY3JlYXRlRXJyb3JUeXBlKFxuICBcIkVSUl9GUl9NQVhfQk9EWV9MRU5HVEhfRVhDRUVERURcIixcbiAgXCJSZXF1ZXN0IGJvZHkgbGFyZ2VyIHRoYW4gbWF4Qm9keUxlbmd0aCBsaW1pdFwiXG4pO1xudmFyIFdyaXRlQWZ0ZXJFbmRFcnJvciA9IGNyZWF0ZUVycm9yVHlwZShcbiAgXCJFUlJfU1RSRUFNX1dSSVRFX0FGVEVSX0VORFwiLFxuICBcIndyaXRlIGFmdGVyIGVuZFwiXG4pO1xuXG4vLyBBbiBIVFRQKFMpIHJlcXVlc3QgdGhhdCBjYW4gYmUgcmVkaXJlY3RlZFxuZnVuY3Rpb24gUmVkaXJlY3RhYmxlUmVxdWVzdChvcHRpb25zLCByZXNwb25zZUNhbGxiYWNrKSB7XG4gIC8vIEluaXRpYWxpemUgdGhlIHJlcXVlc3RcbiAgV3JpdGFibGUuY2FsbCh0aGlzKTtcbiAgdGhpcy5fc2FuaXRpemVPcHRpb25zKG9wdGlvbnMpO1xuICB0aGlzLl9vcHRpb25zID0gb3B0aW9ucztcbiAgdGhpcy5fZW5kZWQgPSBmYWxzZTtcbiAgdGhpcy5fZW5kaW5nID0gZmFsc2U7XG4gIHRoaXMuX3JlZGlyZWN0Q291bnQgPSAwO1xuICB0aGlzLl9yZWRpcmVjdHMgPSBbXTtcbiAgdGhpcy5fcmVxdWVzdEJvZHlMZW5ndGggPSAwO1xuICB0aGlzLl9yZXF1ZXN0Qm9keUJ1ZmZlcnMgPSBbXTtcblxuICAvLyBBdHRhY2ggYSBjYWxsYmFjayBpZiBwYXNzZWRcbiAgaWYgKHJlc3BvbnNlQ2FsbGJhY2spIHtcbiAgICB0aGlzLm9uKFwicmVzcG9uc2VcIiwgcmVzcG9uc2VDYWxsYmFjayk7XG4gIH1cblxuICAvLyBSZWFjdCB0byByZXNwb25zZXMgb2YgbmF0aXZlIHJlcXVlc3RzXG4gIHZhciBzZWxmID0gdGhpcztcbiAgdGhpcy5fb25OYXRpdmVSZXNwb25zZSA9IGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgIHNlbGYuX3Byb2Nlc3NSZXNwb25zZShyZXNwb25zZSk7XG4gIH07XG5cbiAgLy8gUGVyZm9ybSB0aGUgZmlyc3QgcmVxdWVzdFxuICB0aGlzLl9wZXJmb3JtUmVxdWVzdCgpO1xufVxuUmVkaXJlY3RhYmxlUmVxdWVzdC5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKFdyaXRhYmxlLnByb3RvdHlwZSk7XG5cblJlZGlyZWN0YWJsZVJlcXVlc3QucHJvdG90eXBlLmFib3J0ID0gZnVuY3Rpb24gKCkge1xuICAvLyBBYm9ydCB0aGUgaW50ZXJuYWwgcmVxdWVzdFxuICB0aGlzLl9jdXJyZW50UmVxdWVzdC5yZW1vdmVBbGxMaXN0ZW5lcnMoKTtcbiAgdGhpcy5fY3VycmVudFJlcXVlc3Qub24oXCJlcnJvclwiLCBub29wKTtcbiAgdGhpcy5fY3VycmVudFJlcXVlc3QuYWJvcnQoKTtcblxuICAvLyBBYm9ydCB0aGlzIHJlcXVlc3RcbiAgdGhpcy5lbWl0KFwiYWJvcnRcIik7XG4gIHRoaXMucmVtb3ZlQWxsTGlzdGVuZXJzKCk7XG59O1xuXG4vLyBXcml0ZXMgYnVmZmVyZWQgZGF0YSB0byB0aGUgY3VycmVudCBuYXRpdmUgcmVxdWVzdFxuUmVkaXJlY3RhYmxlUmVxdWVzdC5wcm90b3R5cGUud3JpdGUgPSBmdW5jdGlvbiAoZGF0YSwgZW5jb2RpbmcsIGNhbGxiYWNrKSB7XG4gIC8vIFdyaXRpbmcgaXMgbm90IGFsbG93ZWQgaWYgZW5kIGhhcyBiZWVuIGNhbGxlZFxuICBpZiAodGhpcy5fZW5kaW5nKSB7XG4gICAgdGhyb3cgbmV3IFdyaXRlQWZ0ZXJFbmRFcnJvcigpO1xuICB9XG5cbiAgLy8gVmFsaWRhdGUgaW5wdXQgYW5kIHNoaWZ0IHBhcmFtZXRlcnMgaWYgbmVjZXNzYXJ5XG4gIGlmICghKHR5cGVvZiBkYXRhID09PSBcInN0cmluZ1wiIHx8IHR5cGVvZiBkYXRhID09PSBcIm9iamVjdFwiICYmIChcImxlbmd0aFwiIGluIGRhdGEpKSkge1xuICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJkYXRhIHNob3VsZCBiZSBhIHN0cmluZywgQnVmZmVyIG9yIFVpbnQ4QXJyYXlcIik7XG4gIH1cbiAgaWYgKHR5cGVvZiBlbmNvZGluZyA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgY2FsbGJhY2sgPSBlbmNvZGluZztcbiAgICBlbmNvZGluZyA9IG51bGw7XG4gIH1cblxuICAvLyBJZ25vcmUgZW1wdHkgYnVmZmVycywgc2luY2Ugd3JpdGluZyB0aGVtIGRvZXNuJ3QgaW52b2tlIHRoZSBjYWxsYmFja1xuICAvLyBodHRwczovL2dpdGh1Yi5jb20vbm9kZWpzL25vZGUvaXNzdWVzLzIyMDY2XG4gIGlmIChkYXRhLmxlbmd0aCA9PT0gMCkge1xuICAgIGlmIChjYWxsYmFjaykge1xuICAgICAgY2FsbGJhY2soKTtcbiAgICB9XG4gICAgcmV0dXJuO1xuICB9XG4gIC8vIE9ubHkgd3JpdGUgd2hlbiB3ZSBkb24ndCBleGNlZWQgdGhlIG1heGltdW0gYm9keSBsZW5ndGhcbiAgaWYgKHRoaXMuX3JlcXVlc3RCb2R5TGVuZ3RoICsgZGF0YS5sZW5ndGggPD0gdGhpcy5fb3B0aW9ucy5tYXhCb2R5TGVuZ3RoKSB7XG4gICAgdGhpcy5fcmVxdWVzdEJvZHlMZW5ndGggKz0gZGF0YS5sZW5ndGg7XG4gICAgdGhpcy5fcmVxdWVzdEJvZHlCdWZmZXJzLnB1c2goeyBkYXRhOiBkYXRhLCBlbmNvZGluZzogZW5jb2RpbmcgfSk7XG4gICAgdGhpcy5fY3VycmVudFJlcXVlc3Qud3JpdGUoZGF0YSwgZW5jb2RpbmcsIGNhbGxiYWNrKTtcbiAgfVxuICAvLyBFcnJvciB3aGVuIHdlIGV4Y2VlZCB0aGUgbWF4aW11bSBib2R5IGxlbmd0aFxuICBlbHNlIHtcbiAgICB0aGlzLmVtaXQoXCJlcnJvclwiLCBuZXcgTWF4Qm9keUxlbmd0aEV4Y2VlZGVkRXJyb3IoKSk7XG4gICAgdGhpcy5hYm9ydCgpO1xuICB9XG59O1xuXG4vLyBFbmRzIHRoZSBjdXJyZW50IG5hdGl2ZSByZXF1ZXN0XG5SZWRpcmVjdGFibGVSZXF1ZXN0LnByb3RvdHlwZS5lbmQgPSBmdW5jdGlvbiAoZGF0YSwgZW5jb2RpbmcsIGNhbGxiYWNrKSB7XG4gIC8vIFNoaWZ0IHBhcmFtZXRlcnMgaWYgbmVjZXNzYXJ5XG4gIGlmICh0eXBlb2YgZGF0YSA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgY2FsbGJhY2sgPSBkYXRhO1xuICAgIGRhdGEgPSBlbmNvZGluZyA9IG51bGw7XG4gIH1cbiAgZWxzZSBpZiAodHlwZW9mIGVuY29kaW5nID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICBjYWxsYmFjayA9IGVuY29kaW5nO1xuICAgIGVuY29kaW5nID0gbnVsbDtcbiAgfVxuXG4gIC8vIFdyaXRlIGRhdGEgaWYgbmVlZGVkIGFuZCBlbmRcbiAgaWYgKCFkYXRhKSB7XG4gICAgdGhpcy5fZW5kZWQgPSB0aGlzLl9lbmRpbmcgPSB0cnVlO1xuICAgIHRoaXMuX2N1cnJlbnRSZXF1ZXN0LmVuZChudWxsLCBudWxsLCBjYWxsYmFjayk7XG4gIH1cbiAgZWxzZSB7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIHZhciBjdXJyZW50UmVxdWVzdCA9IHRoaXMuX2N1cnJlbnRSZXF1ZXN0O1xuICAgIHRoaXMud3JpdGUoZGF0YSwgZW5jb2RpbmcsIGZ1bmN0aW9uICgpIHtcbiAgICAgIHNlbGYuX2VuZGVkID0gdHJ1ZTtcbiAgICAgIGN1cnJlbnRSZXF1ZXN0LmVuZChudWxsLCBudWxsLCBjYWxsYmFjayk7XG4gICAgfSk7XG4gICAgdGhpcy5fZW5kaW5nID0gdHJ1ZTtcbiAgfVxufTtcblxuLy8gU2V0cyBhIGhlYWRlciB2YWx1ZSBvbiB0aGUgY3VycmVudCBuYXRpdmUgcmVxdWVzdFxuUmVkaXJlY3RhYmxlUmVxdWVzdC5wcm90b3R5cGUuc2V0SGVhZGVyID0gZnVuY3Rpb24gKG5hbWUsIHZhbHVlKSB7XG4gIHRoaXMuX29wdGlvbnMuaGVhZGVyc1tuYW1lXSA9IHZhbHVlO1xuICB0aGlzLl9jdXJyZW50UmVxdWVzdC5zZXRIZWFkZXIobmFtZSwgdmFsdWUpO1xufTtcblxuLy8gQ2xlYXJzIGEgaGVhZGVyIHZhbHVlIG9uIHRoZSBjdXJyZW50IG5hdGl2ZSByZXF1ZXN0XG5SZWRpcmVjdGFibGVSZXF1ZXN0LnByb3RvdHlwZS5yZW1vdmVIZWFkZXIgPSBmdW5jdGlvbiAobmFtZSkge1xuICBkZWxldGUgdGhpcy5fb3B0aW9ucy5oZWFkZXJzW25hbWVdO1xuICB0aGlzLl9jdXJyZW50UmVxdWVzdC5yZW1vdmVIZWFkZXIobmFtZSk7XG59O1xuXG4vLyBHbG9iYWwgdGltZW91dCBmb3IgYWxsIHVuZGVybHlpbmcgcmVxdWVzdHNcblJlZGlyZWN0YWJsZVJlcXVlc3QucHJvdG90eXBlLnNldFRpbWVvdXQgPSBmdW5jdGlvbiAobXNlY3MsIGNhbGxiYWNrKSB7XG4gIHZhciBzZWxmID0gdGhpcztcbiAgaWYgKGNhbGxiYWNrKSB7XG4gICAgdGhpcy5vbihcInRpbWVvdXRcIiwgY2FsbGJhY2spO1xuICB9XG5cbiAgLy8gU2V0cyB1cCBhIHRpbWVyIHRvIHRyaWdnZXIgYSB0aW1lb3V0IGV2ZW50XG4gIGZ1bmN0aW9uIHN0YXJ0VGltZXIoKSB7XG4gICAgaWYgKHNlbGYuX3RpbWVvdXQpIHtcbiAgICAgIGNsZWFyVGltZW91dChzZWxmLl90aW1lb3V0KTtcbiAgICB9XG4gICAgc2VsZi5fdGltZW91dCA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgc2VsZi5lbWl0KFwidGltZW91dFwiKTtcbiAgICAgIGNsZWFyVGltZXIoKTtcbiAgICB9LCBtc2Vjcyk7XG4gIH1cblxuICAvLyBQcmV2ZW50IGEgdGltZW91dCBmcm9tIHRyaWdnZXJpbmdcbiAgZnVuY3Rpb24gY2xlYXJUaW1lcigpIHtcbiAgICBjbGVhclRpbWVvdXQodGhpcy5fdGltZW91dCk7XG4gICAgaWYgKGNhbGxiYWNrKSB7XG4gICAgICBzZWxmLnJlbW92ZUxpc3RlbmVyKFwidGltZW91dFwiLCBjYWxsYmFjayk7XG4gICAgfVxuICAgIGlmICghdGhpcy5zb2NrZXQpIHtcbiAgICAgIHNlbGYuX2N1cnJlbnRSZXF1ZXN0LnJlbW92ZUxpc3RlbmVyKFwic29ja2V0XCIsIHN0YXJ0VGltZXIpO1xuICAgIH1cbiAgfVxuXG4gIC8vIFN0YXJ0IHRoZSB0aW1lciB3aGVuIHRoZSBzb2NrZXQgaXMgb3BlbmVkXG4gIGlmICh0aGlzLnNvY2tldCkge1xuICAgIHN0YXJ0VGltZXIoKTtcbiAgfVxuICBlbHNlIHtcbiAgICB0aGlzLl9jdXJyZW50UmVxdWVzdC5vbmNlKFwic29ja2V0XCIsIHN0YXJ0VGltZXIpO1xuICB9XG5cbiAgdGhpcy5vbmNlKFwicmVzcG9uc2VcIiwgY2xlYXJUaW1lcik7XG4gIHRoaXMub25jZShcImVycm9yXCIsIGNsZWFyVGltZXIpO1xuXG4gIHJldHVybiB0aGlzO1xufTtcblxuLy8gUHJveHkgYWxsIG90aGVyIHB1YmxpYyBDbGllbnRSZXF1ZXN0IG1ldGhvZHNcbltcbiAgXCJmbHVzaEhlYWRlcnNcIiwgXCJnZXRIZWFkZXJcIixcbiAgXCJzZXROb0RlbGF5XCIsIFwic2V0U29ja2V0S2VlcEFsaXZlXCIsXG5dLmZvckVhY2goZnVuY3Rpb24gKG1ldGhvZCkge1xuICBSZWRpcmVjdGFibGVSZXF1ZXN0LnByb3RvdHlwZVttZXRob2RdID0gZnVuY3Rpb24gKGEsIGIpIHtcbiAgICByZXR1cm4gdGhpcy5fY3VycmVudFJlcXVlc3RbbWV0aG9kXShhLCBiKTtcbiAgfTtcbn0pO1xuXG4vLyBQcm94eSBhbGwgcHVibGljIENsaWVudFJlcXVlc3QgcHJvcGVydGllc1xuW1wiYWJvcnRlZFwiLCBcImNvbm5lY3Rpb25cIiwgXCJzb2NrZXRcIl0uZm9yRWFjaChmdW5jdGlvbiAocHJvcGVydHkpIHtcbiAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFJlZGlyZWN0YWJsZVJlcXVlc3QucHJvdG90eXBlLCBwcm9wZXJ0eSwge1xuICAgIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpcy5fY3VycmVudFJlcXVlc3RbcHJvcGVydHldOyB9LFxuICB9KTtcbn0pO1xuXG5SZWRpcmVjdGFibGVSZXF1ZXN0LnByb3RvdHlwZS5fc2FuaXRpemVPcHRpb25zID0gZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgLy8gRW5zdXJlIGhlYWRlcnMgYXJlIGFsd2F5cyBwcmVzZW50XG4gIGlmICghb3B0aW9ucy5oZWFkZXJzKSB7XG4gICAgb3B0aW9ucy5oZWFkZXJzID0ge307XG4gIH1cblxuICAvLyBTaW5jZSBodHRwLnJlcXVlc3QgdHJlYXRzIGhvc3QgYXMgYW4gYWxpYXMgb2YgaG9zdG5hbWUsXG4gIC8vIGJ1dCB0aGUgdXJsIG1vZHVsZSBpbnRlcnByZXRzIGhvc3QgYXMgaG9zdG5hbWUgcGx1cyBwb3J0LFxuICAvLyBlbGltaW5hdGUgdGhlIGhvc3QgcHJvcGVydHkgdG8gYXZvaWQgY29uZnVzaW9uLlxuICBpZiAob3B0aW9ucy5ob3N0KSB7XG4gICAgLy8gVXNlIGhvc3RuYW1lIGlmIHNldCwgYmVjYXVzZSBpdCBoYXMgcHJlY2VkZW5jZVxuICAgIGlmICghb3B0aW9ucy5ob3N0bmFtZSkge1xuICAgICAgb3B0aW9ucy5ob3N0bmFtZSA9IG9wdGlvbnMuaG9zdDtcbiAgICB9XG4gICAgZGVsZXRlIG9wdGlvbnMuaG9zdDtcbiAgfVxuXG4gIC8vIENvbXBsZXRlIHRoZSBVUkwgb2JqZWN0IHdoZW4gbmVjZXNzYXJ5XG4gIGlmICghb3B0aW9ucy5wYXRobmFtZSAmJiBvcHRpb25zLnBhdGgpIHtcbiAgICB2YXIgc2VhcmNoUG9zID0gb3B0aW9ucy5wYXRoLmluZGV4T2YoXCI/XCIpO1xuICAgIGlmIChzZWFyY2hQb3MgPCAwKSB7XG4gICAgICBvcHRpb25zLnBhdGhuYW1lID0gb3B0aW9ucy5wYXRoO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgIG9wdGlvbnMucGF0aG5hbWUgPSBvcHRpb25zLnBhdGguc3Vic3RyaW5nKDAsIHNlYXJjaFBvcyk7XG4gICAgICBvcHRpb25zLnNlYXJjaCA9IG9wdGlvbnMucGF0aC5zdWJzdHJpbmcoc2VhcmNoUG9zKTtcbiAgICB9XG4gIH1cbn07XG5cblxuLy8gRXhlY3V0ZXMgdGhlIG5leHQgbmF0aXZlIHJlcXVlc3QgKGluaXRpYWwgb3IgcmVkaXJlY3QpXG5SZWRpcmVjdGFibGVSZXF1ZXN0LnByb3RvdHlwZS5fcGVyZm9ybVJlcXVlc3QgPSBmdW5jdGlvbiAoKSB7XG4gIC8vIExvYWQgdGhlIG5hdGl2ZSBwcm90b2NvbFxuICB2YXIgcHJvdG9jb2wgPSB0aGlzLl9vcHRpb25zLnByb3RvY29sO1xuICB2YXIgbmF0aXZlUHJvdG9jb2wgPSB0aGlzLl9vcHRpb25zLm5hdGl2ZVByb3RvY29sc1twcm90b2NvbF07XG4gIGlmICghbmF0aXZlUHJvdG9jb2wpIHtcbiAgICB0aGlzLmVtaXQoXCJlcnJvclwiLCBuZXcgVHlwZUVycm9yKFwiVW5zdXBwb3J0ZWQgcHJvdG9jb2wgXCIgKyBwcm90b2NvbCkpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIC8vIElmIHNwZWNpZmllZCwgdXNlIHRoZSBhZ2VudCBjb3JyZXNwb25kaW5nIHRvIHRoZSBwcm90b2NvbFxuICAvLyAoSFRUUCBhbmQgSFRUUFMgdXNlIGRpZmZlcmVudCB0eXBlcyBvZiBhZ2VudHMpXG4gIGlmICh0aGlzLl9vcHRpb25zLmFnZW50cykge1xuICAgIHZhciBzY2hlbWUgPSBwcm90b2NvbC5zdWJzdHIoMCwgcHJvdG9jb2wubGVuZ3RoIC0gMSk7XG4gICAgdGhpcy5fb3B0aW9ucy5hZ2VudCA9IHRoaXMuX29wdGlvbnMuYWdlbnRzW3NjaGVtZV07XG4gIH1cblxuICAvLyBDcmVhdGUgdGhlIG5hdGl2ZSByZXF1ZXN0XG4gIHZhciByZXF1ZXN0ID0gdGhpcy5fY3VycmVudFJlcXVlc3QgPVxuICAgICAgICBuYXRpdmVQcm90b2NvbC5yZXF1ZXN0KHRoaXMuX29wdGlvbnMsIHRoaXMuX29uTmF0aXZlUmVzcG9uc2UpO1xuICB0aGlzLl9jdXJyZW50VXJsID0gdXJsLmZvcm1hdCh0aGlzLl9vcHRpb25zKTtcblxuICAvLyBTZXQgdXAgZXZlbnQgaGFuZGxlcnNcbiAgcmVxdWVzdC5fcmVkaXJlY3RhYmxlID0gdGhpcztcbiAgZm9yICh2YXIgZXZlbnQgaW4gZXZlbnRIYW5kbGVycykge1xuICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBlbHNlICovXG4gICAgaWYgKGV2ZW50KSB7XG4gICAgICByZXF1ZXN0Lm9uKGV2ZW50LCBldmVudEhhbmRsZXJzW2V2ZW50XSk7XG4gICAgfVxuICB9XG5cbiAgLy8gRW5kIGEgcmVkaXJlY3RlZCByZXF1ZXN0XG4gIC8vIChUaGUgZmlyc3QgcmVxdWVzdCBtdXN0IGJlIGVuZGVkIGV4cGxpY2l0bHkgd2l0aCBSZWRpcmVjdGFibGVSZXF1ZXN0I2VuZClcbiAgaWYgKHRoaXMuX2lzUmVkaXJlY3QpIHtcbiAgICAvLyBXcml0ZSB0aGUgcmVxdWVzdCBlbnRpdHkgYW5kIGVuZC5cbiAgICB2YXIgaSA9IDA7XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIHZhciBidWZmZXJzID0gdGhpcy5fcmVxdWVzdEJvZHlCdWZmZXJzO1xuICAgIChmdW5jdGlvbiB3cml0ZU5leHQoZXJyb3IpIHtcbiAgICAgIC8vIE9ubHkgd3JpdGUgaWYgdGhpcyByZXF1ZXN0IGhhcyBub3QgYmVlbiByZWRpcmVjdGVkIHlldFxuICAgICAgLyogaXN0YW5idWwgaWdub3JlIGVsc2UgKi9cbiAgICAgIGlmIChyZXF1ZXN0ID09PSBzZWxmLl9jdXJyZW50UmVxdWVzdCkge1xuICAgICAgICAvLyBSZXBvcnQgYW55IHdyaXRlIGVycm9yc1xuICAgICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi9cbiAgICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgICAgc2VsZi5lbWl0KFwiZXJyb3JcIiwgZXJyb3IpO1xuICAgICAgICB9XG4gICAgICAgIC8vIFdyaXRlIHRoZSBuZXh0IGJ1ZmZlciBpZiB0aGVyZSBhcmUgc3RpbGwgbGVmdFxuICAgICAgICBlbHNlIGlmIChpIDwgYnVmZmVycy5sZW5ndGgpIHtcbiAgICAgICAgICB2YXIgYnVmZmVyID0gYnVmZmVyc1tpKytdO1xuICAgICAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBlbHNlICovXG4gICAgICAgICAgaWYgKCFyZXF1ZXN0LmZpbmlzaGVkKSB7XG4gICAgICAgICAgICByZXF1ZXN0LndyaXRlKGJ1ZmZlci5kYXRhLCBidWZmZXIuZW5jb2RpbmcsIHdyaXRlTmV4dCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vIEVuZCB0aGUgcmVxdWVzdCBpZiBgZW5kYCBoYXMgYmVlbiBjYWxsZWQgb24gdXNcbiAgICAgICAgZWxzZSBpZiAoc2VsZi5fZW5kZWQpIHtcbiAgICAgICAgICByZXF1ZXN0LmVuZCgpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSgpKTtcbiAgfVxufTtcblxuLy8gUHJvY2Vzc2VzIGEgcmVzcG9uc2UgZnJvbSB0aGUgY3VycmVudCBuYXRpdmUgcmVxdWVzdFxuUmVkaXJlY3RhYmxlUmVxdWVzdC5wcm90b3R5cGUuX3Byb2Nlc3NSZXNwb25zZSA9IGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAvLyBTdG9yZSB0aGUgcmVkaXJlY3RlZCByZXNwb25zZVxuICB2YXIgc3RhdHVzQ29kZSA9IHJlc3BvbnNlLnN0YXR1c0NvZGU7XG4gIGlmICh0aGlzLl9vcHRpb25zLnRyYWNrUmVkaXJlY3RzKSB7XG4gICAgdGhpcy5fcmVkaXJlY3RzLnB1c2goe1xuICAgICAgdXJsOiB0aGlzLl9jdXJyZW50VXJsLFxuICAgICAgaGVhZGVyczogcmVzcG9uc2UuaGVhZGVycyxcbiAgICAgIHN0YXR1c0NvZGU6IHN0YXR1c0NvZGUsXG4gICAgfSk7XG4gIH1cblxuICAvLyBSRkM3MjMxwqc2LjQ6IFRoZSAzeHggKFJlZGlyZWN0aW9uKSBjbGFzcyBvZiBzdGF0dXMgY29kZSBpbmRpY2F0ZXNcbiAgLy8gdGhhdCBmdXJ0aGVyIGFjdGlvbiBuZWVkcyB0byBiZSB0YWtlbiBieSB0aGUgdXNlciBhZ2VudCBpbiBvcmRlciB0b1xuICAvLyBmdWxmaWxsIHRoZSByZXF1ZXN0LiBJZiBhIExvY2F0aW9uIGhlYWRlciBmaWVsZCBpcyBwcm92aWRlZCxcbiAgLy8gdGhlIHVzZXIgYWdlbnQgTUFZIGF1dG9tYXRpY2FsbHkgcmVkaXJlY3QgaXRzIHJlcXVlc3QgdG8gdGhlIFVSSVxuICAvLyByZWZlcmVuY2VkIGJ5IHRoZSBMb2NhdGlvbiBmaWVsZCB2YWx1ZSxcbiAgLy8gZXZlbiBpZiB0aGUgc3BlY2lmaWMgc3RhdHVzIGNvZGUgaXMgbm90IHVuZGVyc3Rvb2QuXG4gIHZhciBsb2NhdGlvbiA9IHJlc3BvbnNlLmhlYWRlcnMubG9jYXRpb247XG4gIGlmIChsb2NhdGlvbiAmJiB0aGlzLl9vcHRpb25zLmZvbGxvd1JlZGlyZWN0cyAhPT0gZmFsc2UgJiZcbiAgICAgIHN0YXR1c0NvZGUgPj0gMzAwICYmIHN0YXR1c0NvZGUgPCA0MDApIHtcbiAgICAvLyBBYm9ydCB0aGUgY3VycmVudCByZXF1ZXN0XG4gICAgdGhpcy5fY3VycmVudFJlcXVlc3QucmVtb3ZlQWxsTGlzdGVuZXJzKCk7XG4gICAgdGhpcy5fY3VycmVudFJlcXVlc3Qub24oXCJlcnJvclwiLCBub29wKTtcbiAgICB0aGlzLl9jdXJyZW50UmVxdWVzdC5hYm9ydCgpO1xuICAgIC8vIERpc2NhcmQgdGhlIHJlbWFpbmRlciBvZiB0aGUgcmVzcG9uc2UgdG8gYXZvaWQgd2FpdGluZyBmb3IgZGF0YVxuICAgIHJlc3BvbnNlLmRlc3Ryb3koKTtcblxuICAgIC8vIFJGQzcyMzHCpzYuNDogQSBjbGllbnQgU0hPVUxEIGRldGVjdCBhbmQgaW50ZXJ2ZW5lXG4gICAgLy8gaW4gY3ljbGljYWwgcmVkaXJlY3Rpb25zIChpLmUuLCBcImluZmluaXRlXCIgcmVkaXJlY3Rpb24gbG9vcHMpLlxuICAgIGlmICgrK3RoaXMuX3JlZGlyZWN0Q291bnQgPiB0aGlzLl9vcHRpb25zLm1heFJlZGlyZWN0cykge1xuICAgICAgdGhpcy5lbWl0KFwiZXJyb3JcIiwgbmV3IFRvb01hbnlSZWRpcmVjdHNFcnJvcigpKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBSRkM3MjMxwqc2LjQ6IEF1dG9tYXRpYyByZWRpcmVjdGlvbiBuZWVkcyB0byBkb25lIHdpdGhcbiAgICAvLyBjYXJlIGZvciBtZXRob2RzIG5vdCBrbm93biB0byBiZSBzYWZlLCBb4oCmXVxuICAgIC8vIFJGQzcyMzHCpzYuNC4y4oCTMzogRm9yIGhpc3RvcmljYWwgcmVhc29ucywgYSB1c2VyIGFnZW50IE1BWSBjaGFuZ2VcbiAgICAvLyB0aGUgcmVxdWVzdCBtZXRob2QgZnJvbSBQT1NUIHRvIEdFVCBmb3IgdGhlIHN1YnNlcXVlbnQgcmVxdWVzdC5cbiAgICBpZiAoKHN0YXR1c0NvZGUgPT09IDMwMSB8fCBzdGF0dXNDb2RlID09PSAzMDIpICYmIHRoaXMuX29wdGlvbnMubWV0aG9kID09PSBcIlBPU1RcIiB8fFxuICAgICAgICAvLyBSRkM3MjMxwqc2LjQuNDogVGhlIDMwMyAoU2VlIE90aGVyKSBzdGF0dXMgY29kZSBpbmRpY2F0ZXMgdGhhdFxuICAgICAgICAvLyB0aGUgc2VydmVyIGlzIHJlZGlyZWN0aW5nIHRoZSB1c2VyIGFnZW50IHRvIGEgZGlmZmVyZW50IHJlc291cmNlIFvigKZdXG4gICAgICAgIC8vIEEgdXNlciBhZ2VudCBjYW4gcGVyZm9ybSBhIHJldHJpZXZhbCByZXF1ZXN0IHRhcmdldGluZyB0aGF0IFVSSVxuICAgICAgICAvLyAoYSBHRVQgb3IgSEVBRCByZXF1ZXN0IGlmIHVzaW5nIEhUVFApIFvigKZdXG4gICAgICAgIChzdGF0dXNDb2RlID09PSAzMDMpICYmICEvXig/OkdFVHxIRUFEKSQvLnRlc3QodGhpcy5fb3B0aW9ucy5tZXRob2QpKSB7XG4gICAgICB0aGlzLl9vcHRpb25zLm1ldGhvZCA9IFwiR0VUXCI7XG4gICAgICAvLyBEcm9wIGEgcG9zc2libGUgZW50aXR5IGFuZCBoZWFkZXJzIHJlbGF0ZWQgdG8gaXRcbiAgICAgIHRoaXMuX3JlcXVlc3RCb2R5QnVmZmVycyA9IFtdO1xuICAgICAgcmVtb3ZlTWF0Y2hpbmdIZWFkZXJzKC9eY29udGVudC0vaSwgdGhpcy5fb3B0aW9ucy5oZWFkZXJzKTtcbiAgICB9XG5cbiAgICAvLyBEcm9wIHRoZSBIb3N0IGhlYWRlciwgYXMgdGhlIHJlZGlyZWN0IG1pZ2h0IGxlYWQgdG8gYSBkaWZmZXJlbnQgaG9zdFxuICAgIHZhciBwcmV2aW91c0hvc3ROYW1lID0gcmVtb3ZlTWF0Y2hpbmdIZWFkZXJzKC9eaG9zdCQvaSwgdGhpcy5fb3B0aW9ucy5oZWFkZXJzKSB8fFxuICAgICAgdXJsLnBhcnNlKHRoaXMuX2N1cnJlbnRVcmwpLmhvc3RuYW1lO1xuXG4gICAgLy8gQ3JlYXRlIHRoZSByZWRpcmVjdGVkIHJlcXVlc3RcbiAgICB2YXIgcmVkaXJlY3RVcmwgPSB1cmwucmVzb2x2ZSh0aGlzLl9jdXJyZW50VXJsLCBsb2NhdGlvbik7XG4gICAgZGVidWcoXCJyZWRpcmVjdGluZyB0b1wiLCByZWRpcmVjdFVybCk7XG4gICAgdGhpcy5faXNSZWRpcmVjdCA9IHRydWU7XG4gICAgdmFyIHJlZGlyZWN0VXJsUGFydHMgPSB1cmwucGFyc2UocmVkaXJlY3RVcmwpO1xuICAgIE9iamVjdC5hc3NpZ24odGhpcy5fb3B0aW9ucywgcmVkaXJlY3RVcmxQYXJ0cyk7XG5cbiAgICAvLyBEcm9wIHRoZSBBdXRob3JpemF0aW9uIGhlYWRlciBpZiByZWRpcmVjdGluZyB0byBhbm90aGVyIGhvc3RcbiAgICBpZiAocmVkaXJlY3RVcmxQYXJ0cy5ob3N0bmFtZSAhPT0gcHJldmlvdXNIb3N0TmFtZSkge1xuICAgICAgcmVtb3ZlTWF0Y2hpbmdIZWFkZXJzKC9eYXV0aG9yaXphdGlvbiQvaSwgdGhpcy5fb3B0aW9ucy5oZWFkZXJzKTtcbiAgICB9XG5cbiAgICAvLyBFdmFsdWF0ZSB0aGUgYmVmb3JlUmVkaXJlY3QgY2FsbGJhY2tcbiAgICBpZiAodHlwZW9mIHRoaXMuX29wdGlvbnMuYmVmb3JlUmVkaXJlY3QgPT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgdmFyIHJlc3BvbnNlRGV0YWlscyA9IHsgaGVhZGVyczogcmVzcG9uc2UuaGVhZGVycyB9O1xuICAgICAgdHJ5IHtcbiAgICAgICAgdGhpcy5fb3B0aW9ucy5iZWZvcmVSZWRpcmVjdC5jYWxsKG51bGwsIHRoaXMuX29wdGlvbnMsIHJlc3BvbnNlRGV0YWlscyk7XG4gICAgICB9XG4gICAgICBjYXRjaCAoZXJyKSB7XG4gICAgICAgIHRoaXMuZW1pdChcImVycm9yXCIsIGVycik7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIHRoaXMuX3Nhbml0aXplT3B0aW9ucyh0aGlzLl9vcHRpb25zKTtcbiAgICB9XG5cbiAgICAvLyBQZXJmb3JtIHRoZSByZWRpcmVjdGVkIHJlcXVlc3RcbiAgICB0cnkge1xuICAgICAgdGhpcy5fcGVyZm9ybVJlcXVlc3QoKTtcbiAgICB9XG4gICAgY2F0Y2ggKGNhdXNlKSB7XG4gICAgICB2YXIgZXJyb3IgPSBuZXcgUmVkaXJlY3Rpb25FcnJvcihcIlJlZGlyZWN0ZWQgcmVxdWVzdCBmYWlsZWQ6IFwiICsgY2F1c2UubWVzc2FnZSk7XG4gICAgICBlcnJvci5jYXVzZSA9IGNhdXNlO1xuICAgICAgdGhpcy5lbWl0KFwiZXJyb3JcIiwgZXJyb3IpO1xuICAgIH1cbiAgfVxuICBlbHNlIHtcbiAgICAvLyBUaGUgcmVzcG9uc2UgaXMgbm90IGEgcmVkaXJlY3Q7IHJldHVybiBpdCBhcy1pc1xuICAgIHJlc3BvbnNlLnJlc3BvbnNlVXJsID0gdGhpcy5fY3VycmVudFVybDtcbiAgICByZXNwb25zZS5yZWRpcmVjdHMgPSB0aGlzLl9yZWRpcmVjdHM7XG4gICAgdGhpcy5lbWl0KFwicmVzcG9uc2VcIiwgcmVzcG9uc2UpO1xuXG4gICAgLy8gQ2xlYW4gdXBcbiAgICB0aGlzLl9yZXF1ZXN0Qm9keUJ1ZmZlcnMgPSBbXTtcbiAgfVxufTtcblxuLy8gV3JhcHMgdGhlIGtleS92YWx1ZSBvYmplY3Qgb2YgcHJvdG9jb2xzIHdpdGggcmVkaXJlY3QgZnVuY3Rpb25hbGl0eVxuZnVuY3Rpb24gd3JhcChwcm90b2NvbHMpIHtcbiAgLy8gRGVmYXVsdCBzZXR0aW5nc1xuICB2YXIgZXhwb3J0cyA9IHtcbiAgICBtYXhSZWRpcmVjdHM6IDIxLFxuICAgIG1heEJvZHlMZW5ndGg6IDEwICogMTAyNCAqIDEwMjQsXG4gIH07XG5cbiAgLy8gV3JhcCBlYWNoIHByb3RvY29sXG4gIHZhciBuYXRpdmVQcm90b2NvbHMgPSB7fTtcbiAgT2JqZWN0LmtleXMocHJvdG9jb2xzKS5mb3JFYWNoKGZ1bmN0aW9uIChzY2hlbWUpIHtcbiAgICB2YXIgcHJvdG9jb2wgPSBzY2hlbWUgKyBcIjpcIjtcbiAgICB2YXIgbmF0aXZlUHJvdG9jb2wgPSBuYXRpdmVQcm90b2NvbHNbcHJvdG9jb2xdID0gcHJvdG9jb2xzW3NjaGVtZV07XG4gICAgdmFyIHdyYXBwZWRQcm90b2NvbCA9IGV4cG9ydHNbc2NoZW1lXSA9IE9iamVjdC5jcmVhdGUobmF0aXZlUHJvdG9jb2wpO1xuXG4gICAgLy8gRXhlY3V0ZXMgYSByZXF1ZXN0LCBmb2xsb3dpbmcgcmVkaXJlY3RzXG4gICAgZnVuY3Rpb24gcmVxdWVzdChpbnB1dCwgb3B0aW9ucywgY2FsbGJhY2spIHtcbiAgICAgIC8vIFBhcnNlIHBhcmFtZXRlcnNcbiAgICAgIGlmICh0eXBlb2YgaW5wdXQgPT09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgdmFyIHVybFN0ciA9IGlucHV0O1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGlucHV0ID0gdXJsVG9PcHRpb25zKG5ldyBVUkwodXJsU3RyKSk7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGVycikge1xuICAgICAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovXG4gICAgICAgICAgaW5wdXQgPSB1cmwucGFyc2UodXJsU3RyKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgZWxzZSBpZiAoVVJMICYmIChpbnB1dCBpbnN0YW5jZW9mIFVSTCkpIHtcbiAgICAgICAgaW5wdXQgPSB1cmxUb09wdGlvbnMoaW5wdXQpO1xuICAgICAgfVxuICAgICAgZWxzZSB7XG4gICAgICAgIGNhbGxiYWNrID0gb3B0aW9ucztcbiAgICAgICAgb3B0aW9ucyA9IGlucHV0O1xuICAgICAgICBpbnB1dCA9IHsgcHJvdG9jb2w6IHByb3RvY29sIH07XG4gICAgICB9XG4gICAgICBpZiAodHlwZW9mIG9wdGlvbnMgPT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgICBjYWxsYmFjayA9IG9wdGlvbnM7XG4gICAgICAgIG9wdGlvbnMgPSBudWxsO1xuICAgICAgfVxuXG4gICAgICAvLyBTZXQgZGVmYXVsdHNcbiAgICAgIG9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHtcbiAgICAgICAgbWF4UmVkaXJlY3RzOiBleHBvcnRzLm1heFJlZGlyZWN0cyxcbiAgICAgICAgbWF4Qm9keUxlbmd0aDogZXhwb3J0cy5tYXhCb2R5TGVuZ3RoLFxuICAgICAgfSwgaW5wdXQsIG9wdGlvbnMpO1xuICAgICAgb3B0aW9ucy5uYXRpdmVQcm90b2NvbHMgPSBuYXRpdmVQcm90b2NvbHM7XG5cbiAgICAgIGFzc2VydC5lcXVhbChvcHRpb25zLnByb3RvY29sLCBwcm90b2NvbCwgXCJwcm90b2NvbCBtaXNtYXRjaFwiKTtcbiAgICAgIGRlYnVnKFwib3B0aW9uc1wiLCBvcHRpb25zKTtcbiAgICAgIHJldHVybiBuZXcgUmVkaXJlY3RhYmxlUmVxdWVzdChvcHRpb25zLCBjYWxsYmFjayk7XG4gICAgfVxuXG4gICAgLy8gRXhlY3V0ZXMgYSBHRVQgcmVxdWVzdCwgZm9sbG93aW5nIHJlZGlyZWN0c1xuICAgIGZ1bmN0aW9uIGdldChpbnB1dCwgb3B0aW9ucywgY2FsbGJhY2spIHtcbiAgICAgIHZhciB3cmFwcGVkUmVxdWVzdCA9IHdyYXBwZWRQcm90b2NvbC5yZXF1ZXN0KGlucHV0LCBvcHRpb25zLCBjYWxsYmFjayk7XG4gICAgICB3cmFwcGVkUmVxdWVzdC5lbmQoKTtcbiAgICAgIHJldHVybiB3cmFwcGVkUmVxdWVzdDtcbiAgICB9XG5cbiAgICAvLyBFeHBvc2UgdGhlIHByb3BlcnRpZXMgb24gdGhlIHdyYXBwZWQgcHJvdG9jb2xcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydGllcyh3cmFwcGVkUHJvdG9jb2wsIHtcbiAgICAgIHJlcXVlc3Q6IHsgdmFsdWU6IHJlcXVlc3QsIGNvbmZpZ3VyYWJsZTogdHJ1ZSwgZW51bWVyYWJsZTogdHJ1ZSwgd3JpdGFibGU6IHRydWUgfSxcbiAgICAgIGdldDogeyB2YWx1ZTogZ2V0LCBjb25maWd1cmFibGU6IHRydWUsIGVudW1lcmFibGU6IHRydWUsIHdyaXRhYmxlOiB0cnVlIH0sXG4gICAgfSk7XG4gIH0pO1xuICByZXR1cm4gZXhwb3J0cztcbn1cblxuLyogaXN0YW5idWwgaWdub3JlIG5leHQgKi9cbmZ1bmN0aW9uIG5vb3AoKSB7IC8qIGVtcHR5ICovIH1cblxuLy8gZnJvbSBodHRwczovL2dpdGh1Yi5jb20vbm9kZWpzL25vZGUvYmxvYi9tYXN0ZXIvbGliL2ludGVybmFsL3VybC5qc1xuZnVuY3Rpb24gdXJsVG9PcHRpb25zKHVybE9iamVjdCkge1xuICB2YXIgb3B0aW9ucyA9IHtcbiAgICBwcm90b2NvbDogdXJsT2JqZWN0LnByb3RvY29sLFxuICAgIGhvc3RuYW1lOiB1cmxPYmplY3QuaG9zdG5hbWUuc3RhcnRzV2l0aChcIltcIikgP1xuICAgICAgLyogaXN0YW5idWwgaWdub3JlIG5leHQgKi9cbiAgICAgIHVybE9iamVjdC5ob3N0bmFtZS5zbGljZSgxLCAtMSkgOlxuICAgICAgdXJsT2JqZWN0Lmhvc3RuYW1lLFxuICAgIGhhc2g6IHVybE9iamVjdC5oYXNoLFxuICAgIHNlYXJjaDogdXJsT2JqZWN0LnNlYXJjaCxcbiAgICBwYXRobmFtZTogdXJsT2JqZWN0LnBhdGhuYW1lLFxuICAgIHBhdGg6IHVybE9iamVjdC5wYXRobmFtZSArIHVybE9iamVjdC5zZWFyY2gsXG4gICAgaHJlZjogdXJsT2JqZWN0LmhyZWYsXG4gIH07XG4gIGlmICh1cmxPYmplY3QucG9ydCAhPT0gXCJcIikge1xuICAgIG9wdGlvbnMucG9ydCA9IE51bWJlcih1cmxPYmplY3QucG9ydCk7XG4gIH1cbiAgcmV0dXJuIG9wdGlvbnM7XG59XG5cbmZ1bmN0aW9uIHJlbW92ZU1hdGNoaW5nSGVhZGVycyhyZWdleCwgaGVhZGVycykge1xuICB2YXIgbGFzdFZhbHVlO1xuICBmb3IgKHZhciBoZWFkZXIgaW4gaGVhZGVycykge1xuICAgIGlmIChyZWdleC50ZXN0KGhlYWRlcikpIHtcbiAgICAgIGxhc3RWYWx1ZSA9IGhlYWRlcnNbaGVhZGVyXTtcbiAgICAgIGRlbGV0ZSBoZWFkZXJzW2hlYWRlcl07XG4gICAgfVxuICB9XG4gIHJldHVybiBsYXN0VmFsdWU7XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZUVycm9yVHlwZShjb2RlLCBkZWZhdWx0TWVzc2FnZSkge1xuICBmdW5jdGlvbiBDdXN0b21FcnJvcihtZXNzYWdlKSB7XG4gICAgRXJyb3IuY2FwdHVyZVN0YWNrVHJhY2UodGhpcywgdGhpcy5jb25zdHJ1Y3Rvcik7XG4gICAgdGhpcy5tZXNzYWdlID0gbWVzc2FnZSB8fCBkZWZhdWx0TWVzc2FnZTtcbiAgfVxuICBDdXN0b21FcnJvci5wcm90b3R5cGUgPSBuZXcgRXJyb3IoKTtcbiAgQ3VzdG9tRXJyb3IucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gQ3VzdG9tRXJyb3I7XG4gIEN1c3RvbUVycm9yLnByb3RvdHlwZS5uYW1lID0gXCJFcnJvciBbXCIgKyBjb2RlICsgXCJdXCI7XG4gIEN1c3RvbUVycm9yLnByb3RvdHlwZS5jb2RlID0gY29kZTtcbiAgcmV0dXJuIEN1c3RvbUVycm9yO1xufVxuXG4vLyBFeHBvcnRzXG5tb2R1bGUuZXhwb3J0cyA9IHdyYXAoeyBodHRwOiBodHRwLCBodHRwczogaHR0cHMgfSk7XG5tb2R1bGUuZXhwb3J0cy53cmFwID0gd3JhcDtcbiJdfQ==