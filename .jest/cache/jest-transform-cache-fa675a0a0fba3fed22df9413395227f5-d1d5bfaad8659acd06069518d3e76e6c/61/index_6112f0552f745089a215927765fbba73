e3beba66fc192438add7b3cb5e391df8
'use strict';

exports.__esModule = true;

var _extends = Object.assign || function (target) {
  for (var i = 1; i < arguments.length; i++) {
    var source = arguments[i];

    for (var key in source) {
      if (Object.prototype.hasOwnProperty.call(source, key)) {
        target[key] = source[key];
      }
    }
  }

  return target;
};

exports.default = fsmIterator;
var hasOwnProperty = Object.prototype.hasOwnProperty;

function fsmIterator(initialState, definition) {
  var fsm = _extends({}, definition);

  var currentState = initialState;
  var done = false;
  var returnValue = void 0;
  var handledReturn = false;

  function setReturnValue(value) {
    returnValue = {
      value: value
    };
  }

  function consumeReturnValue() {
    if (returnValue) {
      var _returnValue = returnValue,
          value = _returnValue.value;
      returnValue = undefined;
      return value;
    }

    return undefined;
  }

  function processResult(result, handlerName) {
    if (done) {
      if (returnValue) {
        return {
          value: consumeReturnValue(),
          done: true
        };
      }

      return {
        value: undefined,
        done: true
      };
    }

    if (result.next && result.done) {
      var errorMessage = 'You supplied a next state while specifying to end ' + 'the iterator. This is more than likely an accident. ' + ('Please check your "' + handlerName + '" handler.');
      throw new Error(errorMessage);
    }

    fsm.previousState = currentState;
    currentState = result.next || currentState;
    done = !!result.done;

    if (done && hasOwnProperty.call(result, 'value')) {
      consumeReturnValue();
      return {
        value: result.value,
        done: true
      };
    }

    if (done && returnValue) {
      return {
        value: consumeReturnValue(),
        done: true
      };
    }

    return {
      value: result.value,
      done: done
    };
  }

  var iterator = {
    next: function next(value) {
      if (!hasOwnProperty.call(fsm, currentState)) {
        return {
          value: undefined,
          done: true
        };
      }

      var result = fsm[currentState](value, fsm);
      return processResult(result, currentState);
    },
    throw: function _throw(e) {
      if (!hasOwnProperty.call(fsm, 'throw')) {
        throw e;
      }

      var result = fsm.throw(e, fsm);
      return processResult(result, 'throw');
    },
    return: function _return(value) {
      if (!returnValue) {
        setReturnValue(value);
      }

      if (!handledReturn && hasOwnProperty.call(fsm, 'return')) {
        handledReturn = true;
        var result = fsm.return(value, fsm);
        return processResult(result, 'return');
      }

      if (returnValue) {
        return {
          value: consumeReturnValue(),
          done: true
        };
      }

      return {
        value: value,
        done: true
      };
    }
  };

  if (typeof Symbol === 'function' && Symbol.iterator) {
    iterator[Symbol.iterator] = function () {
      return iterator;
    };
  }

  return iterator;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbImV4cG9ydHMiLCJfX2VzTW9kdWxlIiwiX2V4dGVuZHMiLCJPYmplY3QiLCJhc3NpZ24iLCJ0YXJnZXQiLCJpIiwiYXJndW1lbnRzIiwibGVuZ3RoIiwic291cmNlIiwia2V5IiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJjYWxsIiwiZGVmYXVsdCIsImZzbUl0ZXJhdG9yIiwiaW5pdGlhbFN0YXRlIiwiZGVmaW5pdGlvbiIsImZzbSIsImN1cnJlbnRTdGF0ZSIsImRvbmUiLCJyZXR1cm5WYWx1ZSIsImhhbmRsZWRSZXR1cm4iLCJzZXRSZXR1cm5WYWx1ZSIsInZhbHVlIiwiY29uc3VtZVJldHVyblZhbHVlIiwiX3JldHVyblZhbHVlIiwidW5kZWZpbmVkIiwicHJvY2Vzc1Jlc3VsdCIsInJlc3VsdCIsImhhbmRsZXJOYW1lIiwibmV4dCIsImVycm9yTWVzc2FnZSIsIkVycm9yIiwicHJldmlvdXNTdGF0ZSIsIml0ZXJhdG9yIiwidGhyb3ciLCJfdGhyb3ciLCJlIiwicmV0dXJuIiwiX3JldHVybiIsIlN5bWJvbCJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUFBLE9BQU8sQ0FBQ0MsVUFBUixHQUFxQixJQUFyQjs7QUFFQSxJQUFJQyxRQUFRLEdBQUdDLE1BQU0sQ0FBQ0MsTUFBUCxJQUFpQixVQUFVQyxNQUFWLEVBQWtCO0FBQUUsT0FBSyxJQUFJQyxDQUFDLEdBQUcsQ0FBYixFQUFnQkEsQ0FBQyxHQUFHQyxTQUFTLENBQUNDLE1BQTlCLEVBQXNDRixDQUFDLEVBQXZDLEVBQTJDO0FBQUUsUUFBSUcsTUFBTSxHQUFHRixTQUFTLENBQUNELENBQUQsQ0FBdEI7O0FBQTJCLFNBQUssSUFBSUksR0FBVCxJQUFnQkQsTUFBaEIsRUFBd0I7QUFBRSxVQUFJTixNQUFNLENBQUNRLFNBQVAsQ0FBaUJDLGNBQWpCLENBQWdDQyxJQUFoQyxDQUFxQ0osTUFBckMsRUFBNkNDLEdBQTdDLENBQUosRUFBdUQ7QUFBRUwsUUFB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RCxTQUFQO0FBSUQ7O0FBRUQsYUFBTztBQUNMSSxRQUFBQSxLQUFLLEVBQUVBLEtBREY7QUFFTEosUUFBQUEsSUFBSSxFQUFFO0FBRkQsT0FBUDtBQUlEO0FBM0NZLEdBQWY7O0FBOENBLE1BQUksT0FBT3FCLE1BQVAsS0FBa0IsVUFBbEIsSUFBZ0NBLE1BQU0sQ0FBQ04sUUFBM0MsRUFBcUQ7QUFDbkRBLElBQUFBLFFBQVEsQ0FBQ00sTUFBTSxDQUFDTixRQUFSLENBQVIsR0FBNEIsWUFBWTtBQUN0QyxhQUFPQSxRQUFQO0FBQ0QsS0FGRDtBQUdEOztBQUVELFNBQU9BLFFBQVA7QUFDRCIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTtcblxudmFyIF9leHRlbmRzID0gT2JqZWN0LmFzc2lnbiB8fCBmdW5jdGlvbiAodGFyZ2V0KSB7IGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7IHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaV07IGZvciAodmFyIGtleSBpbiBzb3VyY2UpIHsgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChzb3VyY2UsIGtleSkpIHsgdGFyZ2V0W2tleV0gPSBzb3VyY2Vba2V5XTsgfSB9IH0gcmV0dXJuIHRhcmdldDsgfTtcblxuZXhwb3J0cy5kZWZhdWx0ID0gZnNtSXRlcmF0b3I7XG52YXIgaGFzT3duUHJvcGVydHkgPSBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5O1xuXG5mdW5jdGlvbiBmc21JdGVyYXRvcihpbml0aWFsU3RhdGUsIGRlZmluaXRpb24pIHtcbiAgdmFyIGZzbSA9IF9leHRlbmRzKHt9LCBkZWZpbml0aW9uKTtcblxuICB2YXIgY3VycmVudFN0YXRlID0gaW5pdGlhbFN0YXRlO1xuICB2YXIgZG9uZSA9IGZhbHNlO1xuICB2YXIgcmV0dXJuVmFsdWUgPSB2b2lkIDA7XG4gIHZhciBoYW5kbGVkUmV0dXJuID0gZmFsc2U7XG5cbiAgZnVuY3Rpb24gc2V0UmV0dXJuVmFsdWUodmFsdWUpIHtcbiAgICByZXR1cm5WYWx1ZSA9IHsgdmFsdWU6IHZhbHVlIH07XG4gIH1cblxuICBmdW5jdGlvbiBjb25zdW1lUmV0dXJuVmFsdWUoKSB7XG4gICAgaWYgKHJldHVyblZhbHVlKSB7XG4gICAgICB2YXIgX3JldHVyblZhbHVlID0gcmV0dXJuVmFsdWUsXG4gICAgICAgICAgdmFsdWUgPSBfcmV0dXJuVmFsdWUudmFsdWU7XG5cbiAgICAgIHJldHVyblZhbHVlID0gdW5kZWZpbmVkO1xuXG4gICAgICByZXR1cm4gdmFsdWU7XG4gICAgfVxuXG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgfVxuXG4gIGZ1bmN0aW9uIHByb2Nlc3NSZXN1bHQocmVzdWx0LCBoYW5kbGVyTmFtZSkge1xuICAgIGlmIChkb25lKSB7XG4gICAgICBpZiAocmV0dXJuVmFsdWUpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICB2YWx1ZTogY29uc3VtZVJldHVyblZhbHVlKCksXG4gICAgICAgICAgZG9uZTogdHJ1ZVxuICAgICAgICB9O1xuICAgICAgfVxuXG4gICAgICByZXR1cm4ge1xuICAgICAgICB2YWx1ZTogdW5kZWZpbmVkLFxuICAgICAgICBkb25lOiB0cnVlXG4gICAgICB9O1xuICAgIH1cblxuICAgIGlmIChyZXN1bHQubmV4dCAmJiByZXN1bHQuZG9uZSkge1xuICAgICAgdmFyIGVycm9yTWVzc2FnZSA9ICdZb3Ugc3VwcGxpZWQgYSBuZXh0IHN0YXRlIHdoaWxlIHNwZWNpZnlpbmcgdG8gZW5kICcgKyAndGhlIGl0ZXJhdG9yLiBUaGlzIGlzIG1vcmUgdGhhbiBsaWtlbHkgYW4gYWNjaWRlbnQuICcgKyAoJ1BsZWFzZSBjaGVjayB5b3VyIFwiJyArIGhhbmRsZXJOYW1lICsgJ1wiIGhhbmRsZXIuJyk7XG5cbiAgICAgIHRocm93IG5ldyBFcnJvcihlcnJvck1lc3NhZ2UpO1xuICAgIH1cblxuICAgIGZzbS5wcmV2aW91c1N0YXRlID0gY3VycmVudFN0YXRlO1xuICAgIGN1cnJlbnRTdGF0ZSA9IHJlc3VsdC5uZXh0IHx8IGN1cnJlbnRTdGF0ZTtcbiAgICBkb25lID0gISFyZXN1bHQuZG9uZTtcblxuICAgIGlmIChkb25lICYmIGhhc093blByb3BlcnR5LmNhbGwocmVzdWx0LCAndmFsdWUnKSkge1xuICAgICAgY29uc3VtZVJldHVyblZhbHVlKCk7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHZhbHVlOiByZXN1bHQudmFsdWUsXG4gICAgICAgIGRvbmU6IHRydWVcbiAgICAgIH07XG4gICAgfVxuXG4gICAgaWYgKGRvbmUgJiYgcmV0dXJuVmFsdWUpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHZhbHVlOiBjb25zdW1lUmV0dXJuVmFsdWUoKSxcbiAgICAgICAgZG9uZTogdHJ1ZVxuICAgICAgfTtcbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgdmFsdWU6IHJlc3VsdC52YWx1ZSxcbiAgICAgIGRvbmU6IGRvbmVcbiAgICB9O1xuICB9XG5cbiAgdmFyIGl0ZXJhdG9yID0ge1xuICAgIG5leHQ6IGZ1bmN0aW9uIG5leHQodmFsdWUpIHtcbiAgICAgIGlmICghaGFzT3duUHJvcGVydHkuY2FsbChmc20sIGN1cnJlbnRTdGF0ZSkpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICB2YWx1ZTogdW5kZWZpbmVkLFxuICAgICAgICAgIGRvbmU6IHRydWVcbiAgICAgICAgfTtcbiAgICAgIH1cblxuICAgICAgdmFyIHJlc3VsdCA9IGZzbVtjdXJyZW50U3RhdGVdKHZhbHVlLCBmc20pO1xuICAgICAgcmV0dXJuIHByb2Nlc3NSZXN1bHQocmVzdWx0LCBjdXJyZW50U3RhdGUpO1xuICAgIH0sXG4gICAgdGhyb3c6IGZ1bmN0aW9uIF90aHJvdyhlKSB7XG4gICAgICBpZiAoIWhhc093blByb3BlcnR5LmNhbGwoZnNtLCAndGhyb3cnKSkge1xuICAgICAgICB0aHJvdyBlO1xuICAgICAgfVxuXG4gICAgICB2YXIgcmVzdWx0ID0gZnNtLnRocm93KGUsIGZzbSk7XG4gICAgICByZXR1cm4gcHJvY2Vzc1Jlc3VsdChyZXN1bHQsICd0aHJvdycpO1xuICAgIH0sXG4gICAgcmV0dXJuOiBmdW5jdGlvbiBfcmV0dXJuKHZhbHVlKSB7XG4gICAgICBpZiAoIXJldHVyblZhbHVlKSB7XG4gICAgICAgIHNldFJldHVyblZhbHVlKHZhbHVlKTtcbiAgICAgIH1cblxuICAgICAgaWYgKCFoYW5kbGVkUmV0dXJuICYmIGhhc093blByb3BlcnR5LmNhbGwoZnNtLCAncmV0dXJuJykpIHtcbiAgICAgICAgaGFuZGxlZFJldHVybiA9IHRydWU7XG5cbiAgICAgICAgdmFyIHJlc3VsdCA9IGZzbS5yZXR1cm4odmFsdWUsIGZzbSk7XG4gICAgICAgIHJldHVybiBwcm9jZXNzUmVzdWx0KHJlc3VsdCwgJ3JldHVybicpO1xuICAgICAgfVxuXG4gICAgICBpZiAocmV0dXJuVmFsdWUpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICB2YWx1ZTogY29uc3VtZVJldHVyblZhbHVlKCksXG4gICAgICAgICAgZG9uZTogdHJ1ZVxuICAgICAgICB9O1xuICAgICAgfVxuXG4gICAgICByZXR1cm4ge1xuICAgICAgICB2YWx1ZTogdmFsdWUsXG4gICAgICAgIGRvbmU6IHRydWVcbiAgICAgIH07XG4gICAgfVxuICB9O1xuXG4gIGlmICh0eXBlb2YgU3ltYm9sID09PSAnZnVuY3Rpb24nICYmIFN5bWJvbC5pdGVyYXRvcikge1xuICAgIGl0ZXJhdG9yW1N5bWJvbC5pdGVyYXRvcl0gPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gaXRlcmF0b3I7XG4gICAgfTtcbiAgfVxuXG4gIHJldHVybiBpdGVyYXRvcjtcbn0iXX0=