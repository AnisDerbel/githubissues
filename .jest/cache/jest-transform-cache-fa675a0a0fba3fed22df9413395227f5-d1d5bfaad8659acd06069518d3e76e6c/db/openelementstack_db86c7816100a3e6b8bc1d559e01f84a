997d5c7e9c5b884b18099a8a632b4066
'use strict';

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var HTML = require('../common/html');

var $ = HTML.TAG_NAMES;
var NS = HTML.NAMESPACES;

function isImpliedEndTagRequired(tn) {
  switch (tn.length) {
    case 1:
      return tn === $.P;

    case 2:
      return tn === $.RB || tn === $.RP || tn === $.RT || tn === $.DD || tn === $.DT || tn === $.LI;

    case 3:
      return tn === $.RTC;

    case 6:
      return tn === $.OPTION;

    case 8:
      return tn === $.OPTGROUP;
  }

  return false;
}

function isImpliedEndTagRequiredThoroughly(tn) {
  switch (tn.length) {
    case 1:
      return tn === $.P;

    case 2:
      return tn === $.RB || tn === $.RP || tn === $.RT || tn === $.DD || tn === $.DT || tn === $.LI || tn === $.TD || tn === $.TH || tn === $.TR;

    case 3:
      return tn === $.RTC;

    case 5:
      return tn === $.TBODY || tn === $.TFOOT || tn === $.THEAD;

    case 6:
      return tn === $.OPTION;

    case 7:
      return tn === $.CAPTION;

    case 8:
      return tn === $.OPTGROUP || tn === $.COLGROUP;
  }

  return false;
}

function isScopingElement(tn, ns) {
  switch (tn.length) {
    case 2:
      if (tn === $.TD || tn === $.TH) {
        return ns === NS.HTML;
      } else if (tn === $.MI || tn === $.MO || tn === $.MN || tn === $.MS) {
        return ns === NS.MATHML;
      }

      break;

    case 4:
      if (tn === $.HTML) {
        return ns === NS.HTML;
      } else if (tn === $.DESC) {
        return ns === NS.SVG;
      }

      break;

    case 5:
      if (tn === $.TABLE) {
        return ns === NS.HTML;
      } else if (tn === $.MTEXT) {
        return ns === NS.MATHML;
      } else if (tn === $.TITLE) {
        return ns === NS.SVG;
      }

      break;

    case 6:
      return (tn === $.APPLET || tn === $.OBJECT) && ns === NS.HTML;

    case 7:
      return (tn === $.CAPTION || tn === $.MARQUEE) && ns === NS.HTML;

    case 8:
      return tn === $.TEMPLATE && ns === NS.HTML;

    case 13:
      return tn === $.FOREIGN_OBJECT && ns === NS.SVG;

    case 14:
      return tn === $.ANNOTATION_XML && ns === NS.MATHML;
  }

  return false;
}

var OpenElementStack = function () {
  function OpenElementStack(document, treeAdapter) {
    (0, _classCallCheck2.default)(this, OpenElementStack);
    this.stackTop = -1;
    this.items = [];
    this.current = document;
    this.currentTagName = null;
    this.currentTmplContent = null;
    this.tmplCount = 0;
    this.treeAdapter = treeAdapter;
  }

  (0, _createClass2.default)(OpenElementStack, [{
    key: "_indexOf",
    value: function _indexOf(element) {
      var idx = -1;

      for (var i = this.stackTop; i >= 0; i--) {
        if (this.items[i] === element) {
          idx = i;
          break;
        }
      }

      return idx;
    }
  }, {
    key: "_isInTemplate",
    value: function _isInTemplate() {
      return this.currentTagName === $.TEMPLATE && this.treeAdapter.getNamespaceURI(this.current) === NS.HTML;
    }
  }, {
    key: "_updateCurrentElement",
    value: function _updateCurrentElement() {
      this.current = this.items[this.stackTop];
      this.currentTagName = this.current && this.treeAdapter.getTagName(this.current);
      this.currentTmplContent = this._isInTemplate() ? this.treeAdapter.getTemplateContent(this.current) : null;
    }
  }, {
    key: "push",
    value: function push(element) {
      this.items[++this.stackTop] = element;

      this._updateCurrentElement();

      if (this._isInTemplate()) {
        this.tmplCount++;
      }
    }
  }, {
    key: "pop",
    value: function pop() {
      this.stackTop--;

      if (this.tmplCount > 0 && this._isInTemplate()) {
        this.tmplCount--;
      }

      this._updateCurrentElement();
    }
  }, {
    key: "replace",
    value: function replace(oldElement, newElement) {
      var idx = this._indexOf(oldElement);

      this.items[idx] = newElement;

      if (idx === this.stackTop) {
        this._updateCurrentElement();
      }
    }
  }, {
    key: "insertAfter",
    value: function insertAfter(referenceElement, newElement) {
      var insertionIdx = this._indexOf(referenceElement) + 1;
      this.items.splice(insertionIdx, 0, newElement);

      if (insertionIdx === ++this.stackTop) {
        this._updateCurrentElement();
      }
    }
  }, {
    key: "popUntilTagNamePopped",
    value: function popUntilTagNamePopped(tagName) {
      while (this.stackTop > -1) {
        var tn = this.currentTagName;
        var ns = this.treeAdapter.getNamespaceURI(this.current);
        this.pop();

        if (tn === tagName && ns === NS.HTML) {
          break;
        }
      }
    }
  }, {
    key: "popUntilElementPopped",
    value: function popUntilElementPopped(element) {
      while (this.stackTop > -1) {
        var poppedElement = this.current;
        this.pop();

        if (poppedElement === element) {
          break;
        }
      }
    }
  }, {
    key: "popUntilNumberedHeaderPopped",
    value: function popUntilNumberedHeaderPopped() {
      while (this.stackTop > -1) {
        var tn = this.currentTagName;
        var ns = this.treeAdapter.getNamespaceURI(this.current);
        this.pop();

        if (tn === $.H1 || tn === $.H2 || tn === $.H3 || tn === $.H4 || tn === $.H5 || tn === $.H6 && ns === NS.HTML) {
          break;
        }
      }
    }
  }, {
    key: "popUntilTableCellPopped",
    value: function popUntilTableCellPopped() {
      while (this.stackTop > -1) {
        var tn = this.currentTagName;
        var ns = this.treeAdapter.getNamespaceURI(this.current);
        this.pop();

        if (tn === $.TD || tn === $.TH && ns === NS.HTML) {
          break;
        }
      }
    }
  }, {
    key: "popAllUpToHtmlElement",
    value: function popAllUpToHtmlElement() {
      this.stackTop = 0;

      this._updateCurrentElement();
    }
  }, {
    key: "clearBackToTableContext",
    value: function clearBackToTableContext() {
      while (this.currentTagName !== $.TABLE && this.currentTagName !== $.TEMPLATE && this.currentTagName !== $.HTML || this.treeAdapter.getNamespaceURI(this.current) !== NS.HTML) {
        this.pop();
      }
    }
  }, {
    key: "clearBackToTableBodyContext",
    value: function clearBackToTableBodyContext() {
      while (this.currentTagName !== $.TBODY && this.currentTagName !== $.TFOOT && this.currentTagName !== $.THEAD && this.currentTagName !== $.TEMPLATE && this.currentTagName !== $.HTML || this.treeAdapter.getNamespaceURI(this.current) !== NS.HTML) {
        this.pop();
      }
    }
  }, {
    key: "clearBackToTableRowContext",
    value: function clearBackToTableRowContext() {
      while (this.currentTagName !== $.TR && this.currentTagName !== $.TEMPLATE && this.currentTagName !== $.HTML || this.treeAdapter.getNamespaceURI(this.current) !== NS.HTML) {
        this.pop();
      }
    }
  }, {
    key: "remove",
    value: function remove(element) {
      for (var i = this.stackTop; i >= 0; i--) {
        if (this.items[i] === element) {
          this.items.splice(i, 1);
          this.stackTop--;

          this._updateCurrentElement();

          break;
        }
      }
    }
  }, {
    key: "tryPeekProperlyNestedBodyElement",
    value: function tryPeekProperlyNestedBodyElement() {
      var element = this.items[1];
      return element && this.treeAdapter.getTagName(element) === $.BODY ? element : null;
    }
  }, {
    key: "contains",
    value: function contains(element) {
      return this._indexOf(element) > -1;
    }
  }, {
    key: "getCommonAncestor",
    value: function getCommonAncestor(element) {
      var elementIdx = this._indexOf(element);

      return --elementIdx >= 0 ? this.items[elementIdx] : null;
    }
  }, {
    key: "isRootHtmlElementCurrent",
    value: function isRootHtmlElementCurrent() {
      return this.stackTop === 0 && this.currentTagName === $.HTML;
    }
  }, {
    key: "hasInScope",
    value: function hasInScope(tagName) {
      for (var i = this.stackTop; i >= 0; i--) {
        var tn = this.treeAdapter.getTagName(this.items[i]);
        var ns = this.treeAdapter.getNamespaceURI(this.items[i]);

        if (tn === tagName && ns === NS.HTML) {
          return true;
        }

        if (isScopingElement(tn, ns)) {
          return false;
        }
      }

      return true;
    }
  }, {
    key: "hasNumberedHeaderInScope",
    value: function hasNumberedHeaderInScope() {
      for (var i = this.stackTop; i >= 0; i--) {
        var tn = this.treeAdapter.getTagName(this.items[i]);
        var ns = this.treeAdapter.getNamespaceURI(this.items[i]);

        if ((tn === $.H1 || tn === $.H2 || tn === $.H3 || tn === $.H4 || tn === $.H5 || tn === $.H6) && ns === NS.HTML) {
          return true;
        }

        if (isScopingElement(tn, ns)) {
          return false;
        }
      }

      return true;
    }
  }, {
    key: "hasInListItemScope",
    value: function hasInListItemScope(tagName) {
      for (var i = this.stackTop; i >= 0; i--) {
        var tn = this.treeAdapter.getTagName(this.items[i]);
        var ns = this.treeAdapter.getNamespaceURI(this.items[i]);

        if (tn === tagName && ns === NS.HTML) {
          return true;
        }

        if ((tn === $.UL || tn === $.OL) && ns === NS.HTML || isScopingElement(tn, ns)) {
          return false;
        }
      }

      return true;
    }
  }, {
    key: "hasInButtonScope",
    value: function hasInButtonScope(tagName) {
      for (var i = this.stackTop; i >= 0; i--) {
        var tn = this.treeAdapter.getTagName(this.items[i]);
        var ns = this.treeAdapter.getNamespaceURI(this.items[i]);

        if (tn === tagName && ns === NS.HTML) {
          return true;
        }

        if (tn === $.BUTTON && ns === NS.HTML || isScopingElement(tn, ns)) {
          return false;
        }
      }

      return true;
    }
  }, {
    key: "hasInTableScope",
    value: function hasInTableScope(tagName) {
      for (var i = this.stackTop; i >= 0; i--) {
        var tn = this.treeAdapter.getTagName(this.items[i]);
        var ns = this.treeAdapter.getNamespaceURI(this.items[i]);

        if (ns !== NS.HTML) {
          continue;
        }

        if (tn === tagName) {
          return true;
        }

        if (tn === $.TABLE || tn === $.TEMPLATE || tn === $.HTML) {
          return false;
        }
      }

      return true;
    }
  }, {
    key: "hasTableBodyContextInTableScope",
    value: function hasTableBodyContextInTableScope() {
      for (var i = this.stackTop; i >= 0; i--) {
        var tn = this.treeAdapter.getTagName(this.items[i]);
        var ns = this.treeAdapter.getNamespaceURI(this.items[i]);

        if (ns !== NS.HTML) {
          continue;
        }

        if (tn === $.TBODY || tn === $.THEAD || tn === $.TFOOT) {
          return true;
        }

        if (tn === $.TABLE || tn === $.HTML) {
          return false;
        }
      }

      return true;
    }
  }, {
    key: "hasInSelectScope",
    value: function hasInSelectScope(tagName) {
      for (var i = this.stackTop; i >= 0; i--) {
        var tn = this.treeAdapter.getTagName(this.items[i]);
        var ns = this.treeAdapter.getNamespaceURI(this.items[i]);

        if (ns !== NS.HTML) {
          continue;
        }

        if (tn === tagName) {
          return true;
        }

        if (tn !== $.OPTION && tn !== $.OPTGROUP) {
          return false;
        }
      }

      return true;
    }
  }, {
    key: "generateImpliedEndTags",
    value: function generateImpliedEndTags() {
      while (isImpliedEndTagRequired(this.currentTagName)) {
        this.pop();
      }
    }
  }, {
    key: "generateImpliedEndTagsThoroughly",
    value: function generateImpliedEndTagsThoroughly() {
      while (isImpliedEndTagRequiredThoroughly(this.currentTagName)) {
        this.pop();
      }
    }
  }, {
    key: "generateImpliedEndTagsWithExclusion",
    value: function generateImpliedEndTagsWithExclusion(exclusionTagName) {
      while (isImpliedEndTagRequired(this.currentTagName) && this.currentTagName !== exclusionTagName) {
        this.pop();
      }
    }
  }]);
  return OpenElementStack;
}();

module.exports = OpenElementStack;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm9wZW4tZWxlbWVudC1zdGFjay5qcyJdLCJuYW1lcyI6WyJIVE1MIiwicmVxdWlyZSIsIiQiLCJUQUdfTkFNRVMiLCJOUyIsIk5BTUVTUEFDRVMiLCJpc0ltcGxpZWRFbmRUYWdSZXF1aXJlZCIsInRuIiwibGVuZ3RoIiwiUCIsIlJCIiwiUlAiLCJSVCIsIkREIiwiRFQiLCJMSSIsIlJUQyIsIk9QVElPTiIsIk9QVEdST1VQIiwiaXNJbXBsaWVkRW5kVGFnUmVxdWlyZWRUaG9yb3VnaGx5IiwiVEQiLCJUSCIsIlRSIiwiVEJPRFkiLCJURk9PVCIsIlRIRUFEIiwiQ0FQVElPTiIsIkNPTEdST1VQIiwiaXNTY29waW5nRWxlbWVudCIsIm5zIiwiTUkiLCJNTyIsIk1OIiwiTVMiLCJNQVRITUwiLCJERVNDIiwiU1ZHIiwiVEFCTEUiLCJNVEVYVCIsIlRJVExFIiwiQVBQTEVUIiwiT0JKRUNUIiwiTUFSUVVFRSIsIlRFTVBMQVRFIiwiRk9SRUlHTl9PQkpFQ1QiLCJBTk5PVEFUSU9OX1hNTCIsIk9wZW5FbGVtZW50U3RhY2siLCJkb2N1bWVudCIsInRyZWVBZGFwdGVyIiwic3RhY2tUb3AiLCJpdGVtcyIsImN1cnJlbnQiLCJjdXJyZW50VGFnTmFtZSIsImN1cnJlbnRUbXBsQ29udGVudCIsInRtcGxDb3VudCIsImVsZW1lbnQiLCJpZHgiLCJpIiwiZ2V0TmFtZXNwYWNlVVJJIiwiZ2V0VGFnTmFtZSIsIl9pc0luVGVtcGxhdGUiLCJnZXRUZW1wbGF0ZUNvbnRlbnQiLCJfdXBkYXRlQ3VycmVudEVsZW1lbnQiLCJvbGRFbGVtZW50IiwibmV3RWxlbWVudCIsIl9pbmRleE9mIiwicmVmZXJlbmNlRWxlbWVudCIsImluc2VydGlvbklkeCIsInNwbGljZSIsInRhZ05hbWUiLCJwb3AiLCJwb3BwZWRFbGVtZW50IiwiSDEiLCJIMiIsIkgzIiwiSDQiLCJINSIsIkg2IiwiQk9EWSIsImVsZW1lbnRJZHgiLCJVTCIsIk9MIiwiQlVUVE9OIiwiZXhjbHVzaW9uVGFnTmFt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Q0g7OztXQUdELGtDQUF5QjtBQUNyQixhQUFPWix1QkFBdUIsQ0FBQyxLQUFLOEMsY0FBTixDQUE5QixFQUFxRDtBQUNqRCxhQUFLa0IsR0FBTDtBQUNIO0FBQ0o7OztXQUVELDRDQUFtQztBQUMvQixhQUFPbkQsaUNBQWlDLENBQUMsS0FBS2lDLGNBQU4sQ0FBeEMsRUFBK0Q7QUFDM0QsYUFBS2tCLEdBQUw7QUFDSDtBQUNKOzs7V0FFRCw2Q0FBb0NhLGdCQUFwQyxFQUFzRDtBQUNsRCxhQUFPN0UsdUJBQXVCLENBQUMsS0FBSzhDLGNBQU4sQ0FBdkIsSUFBZ0QsS0FBS0EsY0FBTCxLQUF3QitCLGdCQUEvRSxFQUFpRztBQUM3RixhQUFLYixHQUFMO0FBQ0g7QUFDSjs7Ozs7QUFHTGMsTUFBTSxDQUFDQyxPQUFQLEdBQWlCdkMsZ0JBQWpCIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG5jb25zdCBIVE1MID0gcmVxdWlyZSgnLi4vY29tbW9uL2h0bWwnKTtcblxuLy9BbGlhc2VzXG5jb25zdCAkID0gSFRNTC5UQUdfTkFNRVM7XG5jb25zdCBOUyA9IEhUTUwuTkFNRVNQQUNFUztcblxuLy9FbGVtZW50IHV0aWxzXG5cbi8vT1BUSU1JWkFUSU9OOiBJbnRlZ2VyIGNvbXBhcmlzb25zIGFyZSBsb3ctY29zdCwgc28gd2UgY2FuIHVzZSB2ZXJ5IGZhc3QgdGFnIG5hbWUgbGVuZ3RoIGZpbHRlcnMgaGVyZS5cbi8vSXQncyBmYXN0ZXIgdGhhbiB1c2luZyBkaWN0aW9uYXJ5LlxuZnVuY3Rpb24gaXNJbXBsaWVkRW5kVGFnUmVxdWlyZWQodG4pIHtcbiAgICBzd2l0Y2ggKHRuLmxlbmd0aCkge1xuICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICByZXR1cm4gdG4gPT09ICQuUDtcblxuICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICByZXR1cm4gdG4gPT09ICQuUkIgfHwgdG4gPT09ICQuUlAgfHwgdG4gPT09ICQuUlQgfHwgdG4gPT09ICQuREQgfHwgdG4gPT09ICQuRFQgfHwgdG4gPT09ICQuTEk7XG5cbiAgICAgICAgY2FzZSAzOlxuICAgICAgICAgICAgcmV0dXJuIHRuID09PSAkLlJUQztcblxuICAgICAgICBjYXNlIDY6XG4gICAgICAgICAgICByZXR1cm4gdG4gPT09ICQuT1BUSU9OO1xuXG4gICAgICAgIGNhc2UgODpcbiAgICAgICAgICAgIHJldHVybiB0biA9PT0gJC5PUFRHUk9VUDtcbiAgICB9XG5cbiAgICByZXR1cm4gZmFsc2U7XG59XG5cbmZ1bmN0aW9uIGlzSW1wbGllZEVuZFRhZ1JlcXVpcmVkVGhvcm91Z2hseSh0bikge1xuICAgIHN3aXRjaCAodG4ubGVuZ3RoKSB7XG4gICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgIHJldHVybiB0biA9PT0gJC5QO1xuXG4gICAgICAgIGNhc2UgMjpcbiAgICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICAgICAgdG4gPT09ICQuUkIgfHxcbiAgICAgICAgICAgICAgICB0biA9PT0gJC5SUCB8fFxuICAgICAgICAgICAgICAgIHRuID09PSAkLlJUIHx8XG4gICAgICAgICAgICAgICAgdG4gPT09ICQuREQgfHxcbiAgICAgICAgICAgICAgICB0biA9PT0gJC5EVCB8fFxuICAgICAgICAgICAgICAgIHRuID09PSAkLkxJIHx8XG4gICAgICAgICAgICAgICAgdG4gPT09ICQuVEQgfHxcbiAgICAgICAgICAgICAgICB0biA9PT0gJC5USCB8fFxuICAgICAgICAgICAgICAgIHRuID09PSAkLlRSXG4gICAgICAgICAgICApO1xuXG4gICAgICAgIGNhc2UgMzpcbiAgICAgICAgICAgIHJldHVybiB0biA9PT0gJC5SVEM7XG5cbiAgICAgICAgY2FzZSA1OlxuICAgICAgICAgICAgcmV0dXJuIHRuID09PSAkLlRCT0RZIHx8IHRuID09PSAkLlRGT09UIHx8IHRuID09PSAkLlRIRUFEO1xuXG4gICAgICAgIGNhc2UgNjpcbiAgICAgICAgICAgIHJldHVybiB0biA9PT0gJC5PUFRJT047XG5cbiAgICAgICAgY2FzZSA3OlxuICAgICAgICAgICAgcmV0dXJuIHRuID09PSAkLkNBUFRJT047XG5cbiAgICAgICAgY2FzZSA4OlxuICAgICAgICAgICAgcmV0dXJuIHRuID09PSAkLk9QVEdST1VQIHx8IHRuID09PSAkLkNPTEdST1VQO1xuICAgIH1cblxuICAgIHJldHVybiBmYWxzZTtcbn1cblxuZnVuY3Rpb24gaXNTY29waW5nRWxlbWVudCh0biwgbnMpIHtcbiAgICBzd2l0Y2ggKHRuLmxlbmd0aCkge1xuICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICBpZiAodG4gPT09ICQuVEQgfHwgdG4gPT09ICQuVEgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbnMgPT09IE5TLkhUTUw7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRuID09PSAkLk1JIHx8IHRuID09PSAkLk1PIHx8IHRuID09PSAkLk1OIHx8IHRuID09PSAkLk1TKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5zID09PSBOUy5NQVRITUw7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgIGNhc2UgNDpcbiAgICAgICAgICAgIGlmICh0biA9PT0gJC5IVE1MKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5zID09PSBOUy5IVE1MO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh0biA9PT0gJC5ERVNDKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5zID09PSBOUy5TVkc7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgIGNhc2UgNTpcbiAgICAgICAgICAgIGlmICh0biA9PT0gJC5UQUJMRSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBucyA9PT0gTlMuSFRNTDtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodG4gPT09ICQuTVRFWFQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbnMgPT09IE5TLk1BVEhNTDtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodG4gPT09ICQuVElUTEUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbnMgPT09IE5TLlNWRztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgY2FzZSA2OlxuICAgICAgICAgICAgcmV0dXJuICh0biA9PT0gJC5BUFBMRVQgfHwgdG4gPT09ICQuT0JKRUNUKSAmJiBucyA9PT0gTlMuSFRNTDtcblxuICAgICAgICBjYXNlIDc6XG4gICAgICAgICAgICByZXR1cm4gKHRuID09PSAkLkNBUFRJT04gfHwgdG4gPT09ICQuTUFSUVVFRSkgJiYgbnMgPT09IE5TLkhUTUw7XG5cbiAgICAgICAgY2FzZSA4OlxuICAgICAgICAgICAgcmV0dXJuIHRuID09PSAkLlRFTVBMQVRFICYmIG5zID09PSBOUy5IVE1MO1xuXG4gICAgICAgIGNhc2UgMTM6XG4gICAgICAgICAgICByZXR1cm4gdG4gPT09ICQuRk9SRUlHTl9PQkpFQ1QgJiYgbnMgPT09IE5TLlNWRztcblxuICAgICAgICBjYXNlIDE0OlxuICAgICAgICAgICAgcmV0dXJuIHRuID09PSAkLkFOTk9UQVRJT05fWE1MICYmIG5zID09PSBOUy5NQVRITUw7XG4gICAgfVxuXG4gICAgcmV0dXJuIGZhbHNlO1xufVxuXG4vL1N0YWNrIG9mIG9wZW4gZWxlbWVudHNcbmNsYXNzIE9wZW5FbGVtZW50U3RhY2sge1xuICAgIGNvbnN0cnVjdG9yKGRvY3VtZW50LCB0cmVlQWRhcHRlcikge1xuICAgICAgICB0aGlzLnN0YWNrVG9wID0gLTE7XG4gICAgICAgIHRoaXMuaXRlbXMgPSBbXTtcbiAgICAgICAgdGhpcy5jdXJyZW50ID0gZG9jdW1lbnQ7XG4gICAgICAgIHRoaXMuY3VycmVudFRhZ05hbWUgPSBudWxsO1xuICAgICAgICB0aGlzLmN1cnJlbnRUbXBsQ29udGVudCA9IG51bGw7XG4gICAgICAgIHRoaXMudG1wbENvdW50ID0gMDtcbiAgICAgICAgdGhpcy50cmVlQWRhcHRlciA9IHRyZWVBZGFwdGVyO1xuICAgIH1cblxuICAgIC8vSW5kZXggb2YgZWxlbWVudFxuICAgIF9pbmRleE9mKGVsZW1lbnQpIHtcbiAgICAgICAgbGV0IGlkeCA9IC0xO1xuXG4gICAgICAgIGZvciAobGV0IGkgPSB0aGlzLnN0YWNrVG9wOyBpID49IDA7IGktLSkge1xuICAgICAgICAgICAgaWYgKHRoaXMuaXRlbXNbaV0gPT09IGVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICBpZHggPSBpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBpZHg7XG4gICAgfVxuXG4gICAgLy9VcGRhdGUgY3VycmVudCBlbGVtZW50XG4gICAgX2lzSW5UZW1wbGF0ZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudFRhZ05hbWUgPT09ICQuVEVNUExBVEUgJiYgdGhpcy50cmVlQWRhcHRlci5nZXROYW1lc3BhY2VVUkkodGhpcy5jdXJyZW50KSA9PT0gTlMuSFRNTDtcbiAgICB9XG5cbiAgICBfdXBkYXRlQ3VycmVudEVsZW1lbnQoKSB7XG4gICAgICAgIHRoaXMuY3VycmVudCA9IHRoaXMuaXRlbXNbdGhpcy5zdGFja1RvcF07XG4gICAgICAgIHRoaXMuY3VycmVudFRhZ05hbWUgPSB0aGlzLmN1cnJlbnQgJiYgdGhpcy50cmVlQWRhcHRlci5nZXRUYWdOYW1lKHRoaXMuY3VycmVudCk7XG5cbiAgICAgICAgdGhpcy5jdXJyZW50VG1wbENvbnRlbnQgPSB0aGlzLl9pc0luVGVtcGxhdGUoKSA/IHRoaXMudHJlZUFkYXB0ZXIuZ2V0VGVtcGxhdGVDb250ZW50KHRoaXMuY3VycmVudCkgOiBudWxsO1xuICAgIH1cblxuICAgIC8vTXV0YXRpb25zXG4gICAgcHVzaChlbGVtZW50KSB7XG4gICAgICAgIHRoaXMuaXRlbXNbKyt0aGlzLnN0YWNrVG9wXSA9IGVsZW1lbnQ7XG4gICAgICAgIHRoaXMuX3VwZGF0ZUN1cnJlbnRFbGVtZW50KCk7XG5cbiAgICAgICAgaWYgKHRoaXMuX2lzSW5UZW1wbGF0ZSgpKSB7XG4gICAgICAgICAgICB0aGlzLnRtcGxDb3VudCsrO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcG9wKCkge1xuICAgICAgICB0aGlzLnN0YWNrVG9wLS07XG5cbiAgICAgICAgaWYgKHRoaXMudG1wbENvdW50ID4gMCAmJiB0aGlzLl9pc0luVGVtcGxhdGUoKSkge1xuICAgICAgICAgICAgdGhpcy50bXBsQ291bnQtLTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuX3VwZGF0ZUN1cnJlbnRFbGVtZW50KCk7XG4gICAgfVxuXG4gICAgcmVwbGFjZShvbGRFbGVtZW50LCBuZXdFbGVtZW50KSB7XG4gICAgICAgIGNvbnN0IGlkeCA9IHRoaXMuX2luZGV4T2Yob2xkRWxlbWVudCk7XG5cbiAgICAgICAgdGhpcy5pdGVtc1tpZHhdID0gbmV3RWxlbWVudDtcblxuICAgICAgICBpZiAoaWR4ID09PSB0aGlzLnN0YWNrVG9wKSB7XG4gICAgICAgICAgICB0aGlzLl91cGRhdGVDdXJyZW50RWxlbWVudCgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgaW5zZXJ0QWZ0ZXIocmVmZXJlbmNlRWxlbWVudCwgbmV3RWxlbWVudCkge1xuICAgICAgICBjb25zdCBpbnNlcnRpb25JZHggPSB0aGlzLl9pbmRleE9mKHJlZmVyZW5jZUVsZW1lbnQpICsgMTtcblxuICAgICAgICB0aGlzLml0ZW1zLnNwbGljZShpbnNlcnRpb25JZHgsIDAsIG5ld0VsZW1lbnQpO1xuXG4gICAgICAgIGlmIChpbnNlcnRpb25JZHggPT09ICsrdGhpcy5zdGFja1RvcCkge1xuICAgICAgICAgICAgdGhpcy5fdXBkYXRlQ3VycmVudEVsZW1lbnQoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHBvcFVudGlsVGFnTmFtZVBvcHBlZCh0YWdOYW1lKSB7XG4gICAgICAgIHdoaWxlICh0aGlzLnN0YWNrVG9wID4gLTEpIHtcbiAgICAgICAgICAgIGNvbnN0IHRuID0gdGhpcy5jdXJyZW50VGFnTmFtZTtcbiAgICAgICAgICAgIGNvbnN0IG5zID0gdGhpcy50cmVlQWRhcHRlci5nZXROYW1lc3BhY2VVUkkodGhpcy5jdXJyZW50KTtcblxuICAgICAgICAgICAgdGhpcy5wb3AoKTtcblxuICAgICAgICAgICAgaWYgKHRuID09PSB0YWdOYW1lICYmIG5zID09PSBOUy5IVE1MKSB7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwb3BVbnRpbEVsZW1lbnRQb3BwZWQoZWxlbWVudCkge1xuICAgICAgICB3aGlsZSAodGhpcy5zdGFja1RvcCA+IC0xKSB7XG4gICAgICAgICAgICBjb25zdCBwb3BwZWRFbGVtZW50ID0gdGhpcy5jdXJyZW50O1xuXG4gICAgICAgICAgICB0aGlzLnBvcCgpO1xuXG4gICAgICAgICAgICBpZiAocG9wcGVkRWxlbWVudCA9PT0gZWxlbWVudCkge1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgcG9wVW50aWxOdW1iZXJlZEhlYWRlclBvcHBlZCgpIHtcbiAgICAgICAgd2hpbGUgKHRoaXMuc3RhY2tUb3AgPiAtMSkge1xuICAgICAgICAgICAgY29uc3QgdG4gPSB0aGlzLmN1cnJlbnRUYWdOYW1lO1xuICAgICAgICAgICAgY29uc3QgbnMgPSB0aGlzLnRyZWVBZGFwdGVyLmdldE5hbWVzcGFjZVVSSSh0aGlzLmN1cnJlbnQpO1xuXG4gICAgICAgICAgICB0aGlzLnBvcCgpO1xuXG4gICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgICAgdG4gPT09ICQuSDEgfHxcbiAgICAgICAgICAgICAgICB0biA9PT0gJC5IMiB8fFxuICAgICAgICAgICAgICAgIHRuID09PSAkLkgzIHx8XG4gICAgICAgICAgICAgICAgdG4gPT09ICQuSDQgfHxcbiAgICAgICAgICAgICAgICB0biA9PT0gJC5INSB8fFxuICAgICAgICAgICAgICAgICh0biA9PT0gJC5INiAmJiBucyA9PT0gTlMuSFRNTClcbiAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgcG9wVW50aWxUYWJsZUNlbGxQb3BwZWQoKSB7XG4gICAgICAgIHdoaWxlICh0aGlzLnN0YWNrVG9wID4gLTEpIHtcbiAgICAgICAgICAgIGNvbnN0IHRuID0gdGhpcy5jdXJyZW50VGFnTmFtZTtcbiAgICAgICAgICAgIGNvbnN0IG5zID0gdGhpcy50cmVlQWRhcHRlci5nZXROYW1lc3BhY2VVUkkodGhpcy5jdXJyZW50KTtcblxuICAgICAgICAgICAgdGhpcy5wb3AoKTtcblxuICAgICAgICAgICAgaWYgKHRuID09PSAkLlREIHx8ICh0biA9PT0gJC5USCAmJiBucyA9PT0gTlMuSFRNTCkpIHtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIHBvcEFsbFVwVG9IdG1sRWxlbWVudCgpIHtcbiAgICAgICAgLy9OT1RFOiBoZXJlIHdlIGFzc3VtZSB0aGF0IHJvb3QgPGh0bWw+IGVsZW1lbnQgaXMgYWx3YXlzIGZpcnN0IGluIHRoZSBvcGVuIGVsZW1lbnQgc3RhY2ssIHNvXG4gICAgICAgIC8vd2UgcGVyZm9ybSB0aGlzIGZhc3Qgc3RhY2sgY2xlYW4gdXAuXG4gICAgICAgIHRoaXMuc3RhY2tUb3AgPSAwO1xuICAgICAgICB0aGlzLl91cGRhdGVDdXJyZW50RWxlbWVudCgpO1xuICAgIH1cblxuICAgIGNsZWFyQmFja1RvVGFibGVDb250ZXh0KCkge1xuICAgICAgICB3aGlsZSAoXG4gICAgICAgICAgICAodGhpcy5jdXJyZW50VGFnTmFtZSAhPT0gJC5UQUJMRSAmJiB0aGlzLmN1cnJlbnRUYWdOYW1lICE9PSAkLlRFTVBMQVRFICYmIHRoaXMuY3VycmVudFRhZ05hbWUgIT09ICQuSFRNTCkgfHxcbiAgICAgICAgICAgIHRoaXMudHJlZUFkYXB0ZXIuZ2V0TmFtZXNwYWNlVVJJKHRoaXMuY3VycmVudCkgIT09IE5TLkhUTUxcbiAgICAgICAgKSB7XG4gICAgICAgICAgICB0aGlzLnBvcCgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgY2xlYXJCYWNrVG9UYWJsZUJvZHlDb250ZXh0KCkge1xuICAgICAgICB3aGlsZSAoXG4gICAgICAgICAgICAodGhpcy5jdXJyZW50VGFnTmFtZSAhPT0gJC5UQk9EWSAmJlxuICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudFRhZ05hbWUgIT09ICQuVEZPT1QgJiZcbiAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRUYWdOYW1lICE9PSAkLlRIRUFEICYmXG4gICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50VGFnTmFtZSAhPT0gJC5URU1QTEFURSAmJlxuICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudFRhZ05hbWUgIT09ICQuSFRNTCkgfHxcbiAgICAgICAgICAgIHRoaXMudHJlZUFkYXB0ZXIuZ2V0TmFtZXNwYWNlVVJJKHRoaXMuY3VycmVudCkgIT09IE5TLkhUTUxcbiAgICAgICAgKSB7XG4gICAgICAgICAgICB0aGlzLnBvcCgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgY2xlYXJCYWNrVG9UYWJsZVJvd0NvbnRleHQoKSB7XG4gICAgICAgIHdoaWxlIChcbiAgICAgICAgICAgICh0aGlzLmN1cnJlbnRUYWdOYW1lICE9PSAkLlRSICYmIHRoaXMuY3VycmVudFRhZ05hbWUgIT09ICQuVEVNUExBVEUgJiYgdGhpcy5jdXJyZW50VGFnTmFtZSAhPT0gJC5IVE1MKSB8fFxuICAgICAgICAgICAgdGhpcy50cmVlQWRhcHRlci5nZXROYW1lc3BhY2VVUkkodGhpcy5jdXJyZW50KSAhPT0gTlMuSFRNTFxuICAgICAgICApIHtcbiAgICAgICAgICAgIHRoaXMucG9wKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICByZW1vdmUoZWxlbWVudCkge1xuICAgICAgICBmb3IgKGxldCBpID0gdGhpcy5zdGFja1RvcDsgaSA+PSAwOyBpLS0pIHtcbiAgICAgICAgICAgIGlmICh0aGlzLml0ZW1zW2ldID09PSBlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5pdGVtcy5zcGxpY2UoaSwgMSk7XG4gICAgICAgICAgICAgICAgdGhpcy5zdGFja1RvcC0tO1xuICAgICAgICAgICAgICAgIHRoaXMuX3VwZGF0ZUN1cnJlbnRFbGVtZW50KCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvL1NlYXJjaFxuICAgIHRyeVBlZWtQcm9wZXJseU5lc3RlZEJvZHlFbGVtZW50KCkge1xuICAgICAgICAvL1Byb3Blcmx5IG5lc3RlZCA8Ym9keT4gZWxlbWVudCAoc2hvdWxkIGJlIHNlY29uZCBlbGVtZW50IGluIHN0YWNrKS5cbiAgICAgICAgY29uc3QgZWxlbWVudCA9IHRoaXMuaXRlbXNbMV07XG5cbiAgICAgICAgcmV0dXJuIGVsZW1lbnQgJiYgdGhpcy50cmVlQWRhcHRlci5nZXRUYWdOYW1lKGVsZW1lbnQpID09PSAkLkJPRFkgPyBlbGVtZW50IDogbnVsbDtcbiAgICB9XG5cbiAgICBjb250YWlucyhlbGVtZW50KSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9pbmRleE9mKGVsZW1lbnQpID4gLTE7XG4gICAgfVxuXG4gICAgZ2V0Q29tbW9uQW5jZXN0b3IoZWxlbWVudCkge1xuICAgICAgICBsZXQgZWxlbWVudElkeCA9IHRoaXMuX2luZGV4T2YoZWxlbWVudCk7XG5cbiAgICAgICAgcmV0dXJuIC0tZWxlbWVudElkeCA+PSAwID8gdGhpcy5pdGVtc1tlbGVtZW50SWR4XSA6IG51bGw7XG4gICAgfVxuXG4gICAgaXNSb290SHRtbEVsZW1lbnRDdXJyZW50KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5zdGFja1RvcCA9PT0gMCAmJiB0aGlzLmN1cnJlbnRUYWdOYW1lID09PSAkLkhUTUw7XG4gICAgfVxuXG4gICAgLy9FbGVtZW50IGluIHNjb3BlXG4gICAgaGFzSW5TY29wZSh0YWdOYW1lKSB7XG4gICAgICAgIGZvciAobGV0IGkgPSB0aGlzLnN0YWNrVG9wOyBpID49IDA7IGktLSkge1xuICAgICAgICAgICAgY29uc3QgdG4gPSB0aGlzLnRyZWVBZGFwdGVyLmdldFRhZ05hbWUodGhpcy5pdGVtc1tpXSk7XG4gICAgICAgICAgICBjb25zdCBucyA9IHRoaXMudHJlZUFkYXB0ZXIuZ2V0TmFtZXNwYWNlVVJJKHRoaXMuaXRlbXNbaV0pO1xuXG4gICAgICAgICAgICBpZiAodG4gPT09IHRhZ05hbWUgJiYgbnMgPT09IE5TLkhUTUwpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGlzU2NvcGluZ0VsZW1lbnQodG4sIG5zKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIGhhc051bWJlcmVkSGVhZGVySW5TY29wZSgpIHtcbiAgICAgICAgZm9yIChsZXQgaSA9IHRoaXMuc3RhY2tUb3A7IGkgPj0gMDsgaS0tKSB7XG4gICAgICAgICAgICBjb25zdCB0biA9IHRoaXMudHJlZUFkYXB0ZXIuZ2V0VGFnTmFtZSh0aGlzLml0ZW1zW2ldKTtcbiAgICAgICAgICAgIGNvbnN0IG5zID0gdGhpcy50cmVlQWRhcHRlci5nZXROYW1lc3BhY2VVUkkodGhpcy5pdGVtc1tpXSk7XG5cbiAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgICAodG4gPT09ICQuSDEgfHwgdG4gPT09ICQuSDIgfHwgdG4gPT09ICQuSDMgfHwgdG4gPT09ICQuSDQgfHwgdG4gPT09ICQuSDUgfHwgdG4gPT09ICQuSDYpICYmXG4gICAgICAgICAgICAgICAgbnMgPT09IE5TLkhUTUxcbiAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoaXNTY29waW5nRWxlbWVudCh0biwgbnMpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgaGFzSW5MaXN0SXRlbVNjb3BlKHRhZ05hbWUpIHtcbiAgICAgICAgZm9yIChsZXQgaSA9IHRoaXMuc3RhY2tUb3A7IGkgPj0gMDsgaS0tKSB7XG4gICAgICAgICAgICBjb25zdCB0biA9IHRoaXMudHJlZUFkYXB0ZXIuZ2V0VGFnTmFtZSh0aGlzLml0ZW1zW2ldKTtcbiAgICAgICAgICAgIGNvbnN0IG5zID0gdGhpcy50cmVlQWRhcHRlci5nZXROYW1lc3BhY2VVUkkodGhpcy5pdGVtc1tpXSk7XG5cbiAgICAgICAgICAgIGlmICh0biA9PT0gdGFnTmFtZSAmJiBucyA9PT0gTlMuSFRNTCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoKCh0biA9PT0gJC5VTCB8fCB0biA9PT0gJC5PTCkgJiYgbnMgPT09IE5TLkhUTUwpIHx8IGlzU2NvcGluZ0VsZW1lbnQodG4sIG5zKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIGhhc0luQnV0dG9uU2NvcGUodGFnTmFtZSkge1xuICAgICAgICBmb3IgKGxldCBpID0gdGhpcy5zdGFja1RvcDsgaSA+PSAwOyBpLS0pIHtcbiAgICAgICAgICAgIGNvbnN0IHRuID0gdGhpcy50cmVlQWRhcHRlci5nZXRUYWdOYW1lKHRoaXMuaXRlbXNbaV0pO1xuICAgICAgICAgICAgY29uc3QgbnMgPSB0aGlzLnRyZWVBZGFwdGVyLmdldE5hbWVzcGFjZVVSSSh0aGlzLml0ZW1zW2ldKTtcblxuICAgICAgICAgICAgaWYgKHRuID09PSB0YWdOYW1lICYmIG5zID09PSBOUy5IVE1MKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICgodG4gPT09ICQuQlVUVE9OICYmIG5zID09PSBOUy5IVE1MKSB8fCBpc1Njb3BpbmdFbGVtZW50KHRuLCBucykpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICBoYXNJblRhYmxlU2NvcGUodGFnTmFtZSkge1xuICAgICAgICBmb3IgKGxldCBpID0gdGhpcy5zdGFja1RvcDsgaSA+PSAwOyBpLS0pIHtcbiAgICAgICAgICAgIGNvbnN0IHRuID0gdGhpcy50cmVlQWRhcHRlci5nZXRUYWdOYW1lKHRoaXMuaXRlbXNbaV0pO1xuICAgICAgICAgICAgY29uc3QgbnMgPSB0aGlzLnRyZWVBZGFwdGVyLmdldE5hbWVzcGFjZVVSSSh0aGlzLml0ZW1zW2ldKTtcblxuICAgICAgICAgICAgaWYgKG5zICE9PSBOUy5IVE1MKSB7XG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICh0biA9PT0gdGFnTmFtZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodG4gPT09ICQuVEFCTEUgfHwgdG4gPT09ICQuVEVNUExBVEUgfHwgdG4gPT09ICQuSFRNTCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIGhhc1RhYmxlQm9keUNvbnRleHRJblRhYmxlU2NvcGUoKSB7XG4gICAgICAgIGZvciAobGV0IGkgPSB0aGlzLnN0YWNrVG9wOyBpID49IDA7IGktLSkge1xuICAgICAgICAgICAgY29uc3QgdG4gPSB0aGlzLnRyZWVBZGFwdGVyLmdldFRhZ05hbWUodGhpcy5pdGVtc1tpXSk7XG4gICAgICAgICAgICBjb25zdCBucyA9IHRoaXMudHJlZUFkYXB0ZXIuZ2V0TmFtZXNwYWNlVVJJKHRoaXMuaXRlbXNbaV0pO1xuXG4gICAgICAgICAgICBpZiAobnMgIT09IE5TLkhUTUwpIHtcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHRuID09PSAkLlRCT0RZIHx8IHRuID09PSAkLlRIRUFEIHx8IHRuID09PSAkLlRGT09UKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICh0biA9PT0gJC5UQUJMRSB8fCB0biA9PT0gJC5IVE1MKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgaGFzSW5TZWxlY3RTY29wZSh0YWdOYW1lKSB7XG4gICAgICAgIGZvciAobGV0IGkgPSB0aGlzLnN0YWNrVG9wOyBpID49IDA7IGktLSkge1xuICAgICAgICAgICAgY29uc3QgdG4gPSB0aGlzLnRyZWVBZGFwdGVyLmdldFRhZ05hbWUodGhpcy5pdGVtc1tpXSk7XG4gICAgICAgICAgICBjb25zdCBucyA9IHRoaXMudHJlZUFkYXB0ZXIuZ2V0TmFtZXNwYWNlVVJJKHRoaXMuaXRlbXNbaV0pO1xuXG4gICAgICAgICAgICBpZiAobnMgIT09IE5TLkhUTUwpIHtcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHRuID09PSB0YWdOYW1lKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICh0biAhPT0gJC5PUFRJT04gJiYgdG4gIT09ICQuT1BUR1JPVVApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICAvL0ltcGxpZWQgZW5kIHRhZ3NcbiAgICBnZW5lcmF0ZUltcGxpZWRFbmRUYWdzKCkge1xuICAgICAgICB3aGlsZSAoaXNJbXBsaWVkRW5kVGFnUmVxdWlyZWQodGhpcy5jdXJyZW50VGFnTmFtZSkpIHtcbiAgICAgICAgICAgIHRoaXMucG9wKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBnZW5lcmF0ZUltcGxpZWRFbmRUYWdzVGhvcm91Z2hseSgpIHtcbiAgICAgICAgd2hpbGUgKGlzSW1wbGllZEVuZFRhZ1JlcXVpcmVkVGhvcm91Z2hseSh0aGlzLmN1cnJlbnRUYWdOYW1lKSkge1xuICAgICAgICAgICAgdGhpcy5wb3AoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGdlbmVyYXRlSW1wbGllZEVuZFRhZ3NXaXRoRXhjbHVzaW9uKGV4Y2x1c2lvblRhZ05hbWUpIHtcbiAgICAgICAgd2hpbGUgKGlzSW1wbGllZEVuZFRhZ1JlcXVpcmVkKHRoaXMuY3VycmVudFRhZ05hbWUpICYmIHRoaXMuY3VycmVudFRhZ05hbWUgIT09IGV4Y2x1c2lvblRhZ05hbWUpIHtcbiAgICAgICAgICAgIHRoaXMucG9wKCk7XG4gICAgICAgIH1cbiAgICB9XG59XG5cbm1vZHVsZS5leHBvcnRzID0gT3BlbkVsZW1lbnRTdGFjaztcbiJdfQ==