0c9fb4ddc5b8d0c71980c17a8673524b
"use strict";

var __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {
  if (k2 === undefined) k2 = k;
  Object.defineProperty(o, k2, {
    enumerable: true,
    get: function get() {
      return m[k];
    }
  });
} : function (o, m, k, k2) {
  if (k2 === undefined) k2 = k;
  o[k2] = m[k];
});

var __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {
  Object.defineProperty(o, "default", {
    enumerable: true,
    value: v
  });
} : function (o, v) {
  o["default"] = v;
});

var __importStar = this && this.__importStar || function (mod) {
  if (mod && mod.__esModule) return mod;
  var result = {};
  if (mod != null) for (var k in mod) {
    if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
  }

  __setModuleDefault(result, mod);

  return result;
};

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.pseudos = exports.filters = exports.is = exports.selectOne = exports.selectAll = exports.prepareContext = exports._compileToken = exports._compileUnsafe = exports.compile = void 0;

var DomUtils = __importStar(require("domutils"));

var boolbase_1 = require("boolbase");

var compile_1 = require("./compile");

var subselects_1 = require("./pseudo-selectors/subselects");

var defaultEquals = function defaultEquals(a, b) {
  return a === b;
};

var defaultOptions = {
  adapter: DomUtils,
  equals: defaultEquals
};

function convertOptionFormats(options) {
  var _a, _b, _c, _d;

  var opts = options !== null && options !== void 0 ? options : defaultOptions;
  (_a = opts.adapter) !== null && _a !== void 0 ? _a : opts.adapter = DomUtils;
  (_b = opts.equals) !== null && _b !== void 0 ? _b : opts.equals = (_d = (_c = opts.adapter) === null || _c === void 0 ? void 0 : _c.equals) !== null && _d !== void 0 ? _d : defaultEquals;
  return opts;
}

function wrapCompile(func) {
  return function addAdapter(selector, options, context) {
    var opts = convertOptionFormats(options);
    return func(selector, opts, context);
  };
}

exports.compile = wrapCompile(compile_1.compile);
exports._compileUnsafe = wrapCompile(compile_1.compileUnsafe);
exports._compileToken = wrapCompile(compile_1.compileToken);

function getSelectorFunc(searchFunc) {
  return function select(query, elements, options) {
    var opts = convertOptionFormats(options);

    if (typeof query !== "function") {
      query = compile_1.compileUnsafe(query, opts, elements);
    }

    var filteredElements = prepareContext(elements, opts.adapter, query.shouldTestNextSiblings);
    return searchFunc(query, filteredElements, opts);
  };
}

function prepareContext(elems, adapter, shouldTestNextSiblings) {
  if (shouldTestNextSiblings === void 0) {
    shouldTestNextSiblings = false;
  }

  if (shouldTestNextSiblings) {
    elems = appendNextSiblings(elems, adapter);
  }

  return Array.isArray(elems) ? adapter.removeSubsets(elems) : adapter.getChildren(elems);
}

exports.prepareContext = prepareContext;

function appendNextSiblings(elem, adapter) {
  var elems = Array.isArray(elem) ? elem.slice(0) : [elem];

  for (var i = 0; i < elems.length; i++) {
    var nextSiblings = subselects_1.getNextSiblings(elems[i], adapter);
    elems.push.apply(elems, nextSiblings);
  }

  return elems;
}

exports.selectAll = getSelectorFunc(function (query, elems, options) {
  return query === boolbase_1.falseFunc || !elems || elems.length === 0 ? [] : options.adapter.findAll(query, elems);
});
exports.selectOne = getSelectorFunc(function (query, elems, options) {
  return query === boolbase_1.falseFunc || !elems || elems.length === 0 ? null : options.adapter.findOne(query, elems);
});

function is(elem, query, options) {
  var opts = convertOptionFormats(options);
  return (typeof query === "function" ? query : compile_1.compile(query, opts))(elem);
}

exports.is = is;
exports.default = exports.selectAll;

var pseudo_selectors_1 = require("./pseudo-selectors");

Object.defineProperty(exports, "filters", {
  enumerable: true,
  get: function get() {
    return pseudo_selectors_1.filters;
  }
});
Object.defineProperty(exports, "pseudos", {
  enumerable: true,
  get: function get() {
    return pseudo_selectors_1.pseudos;
  }
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbIl9fY3JlYXRlQmluZGluZyIsIk9iamVjdCIsImNyZWF0ZSIsIm8iLCJtIiwiayIsImsyIiwidW5kZWZpbmVkIiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwiZ2V0IiwiX19zZXRNb2R1bGVEZWZhdWx0IiwidiIsInZhbHVlIiwiX19pbXBvcnRTdGFyIiwibW9kIiwiX19lc01vZHVsZSIsInJlc3VsdCIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwiY2FsbCIsImV4cG9ydHMiLCJwc2V1ZG9zIiwiZmlsdGVycyIsImlzIiwic2VsZWN0T25lIiwic2VsZWN0QWxsIiwicHJlcGFyZUNvbnRleHQiLCJfY29tcGlsZVRva2VuIiwiX2NvbXBpbGVVbnNhZmUiLCJjb21waWxlIiwiRG9tVXRpbHMiLCJyZXF1aXJlIiwiYm9vbGJhc2VfMSIsImNvbXBpbGVfMSIsInN1YnNlbGVjdHNfMSIsImRlZmF1bHRFcXVhbHMiLCJhIiwiYiIsImRlZmF1bHRPcHRpb25zIiwiYWRhcHRlciIsImVxdWFscyIsImNvbnZlcnRPcHRpb25Gb3JtYXRzIiwib3B0aW9ucyIsIl9hIiwiX2IiLCJfYyIsIl9kIiwib3B0cyIsIndyYXBDb21waWxlIiwiZnVuYyIsImFkZEFkYXB0ZXIiLCJzZWxlY3RvciIsImNvbnRleHQiLCJjb21waWxlVW5zYWZlIiwiY29tcGlsZVRva2VuIiwiZ2V0U2VsZWN0b3JGdW5jIiwic2VhcmNoRnVuYyIsInNlbGVjdCIsInF1ZXJ5IiwiZWxlbWVudHMiLCJmaWx0ZXJlZEVsZW1lbnRzIiwic2hvdWxkVGVzdE5leHRTaWJsaW5ncyIsImVsZW1zIiwiYXBwZW5kTmV4dFNpYmxpbmdzIiwiQXJyYXkiLCJpc0FycmF5IiwicmVtb3ZlU3Vic2V0cyIsImdldENoaWxkcmVuIiwiZWxlbSIsInNsaWNlIiwiaSIsImxlbmd0aCIsIm5leHRTaWJsaW5ncyIsImdldE5leHRTaWJsaW5ncyIsInB1c2giLCJhcHBseSIsImZhbHNlRnVuYyIsImZpbmRBbGwiLCJmaW5kT25lIiwiZGVmYXVsdCIsInBzZXVkb19zZWxlY3RvcnNfMSJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBQ0EsSUFBSUEsZUFBZSxHQUFJLFFBQVEsS0FBS0EsZUFBZCxLQUFtQ0MsTUFBTSxDQUFDQyxNQUFQLEdBQWlCLFVBQVNDLENBQVQsRUFBWUMsQ0FBWixFQUFlQyxDQUFmLEVBQWtCQyxFQUFsQixFQUFzQjtBQUM1RixNQUFJQSxFQUFFLEtBQUtDLFNBQVgsRUFBc0JELEVBQUUsR0FBR0QsQ0FBTDtBQUN0QkosRUFBQUEsTUFBTSxDQUFDTyxjQUFQLENBQXNCTCxDQUF0QixFQUF5QkcsRUFBekIsRUFBNkI7QUFBRUcsSUFBQUEsVUFBVSxFQUFFLElBQWQ7QUFBb0JDLElBQUFBLEdBQUcsRUFBRSxlQUFXO0FBQUUsYUFBT04sQ0FBQyxDQUFDQyxDQUFELENBQVI7QUFBYztBQUFwRCxHQUE3QjtBQUNILENBSHdELEdBR25ELFVBQVNGLENBQVQsRUFBWUMsQ0FBWixFQUFlQyxDQUFmLEVBQWtCQyxFQUFsQixFQUFzQjtBQUN4QixNQUFJQSxFQUFFLEtBQUtDLFNBQVgsRUFBc0JELEVBQUUsR0FBR0QsQ0FBTDtBQUN0QkYsRUFBQUEsQ0FBQyxDQUFDRyxFQUFELENBQUQsR0FBUUYsQ0FBQyxDQUFDQyxDQUFELENBQVQ7QUFDSCxDQU5xQixDQUF0Qjs7QUFPQSxJQUFJTSxrQkFBa0IsR0FBSSxRQUFRLEtBQUtBLGtCQUFkLEtBQXNDVixNQUFNLENBQUNDLE1BQVAsR0FBaUIsVUFBU0MsQ0FBVCxFQUFZUyxDQUFaLEVBQWU7QUFDM0ZYLEVBQUFBLE1BQU0sQ0FBQ08sY0FBUCxDQUFzQkwsQ0FBdEIsRUFBeUIsU0FBekIsRUFBb0M7QUFBRU0sSUFBQUEsVUFBVSxFQUFFLElBQWQ7QUFBb0JJLElBQUFBLEtBQUssRUFBRUQ7QUFBM0IsR0FBcEM7QUFDSCxDQUY4RCxHQUUxRCxVQUFTVCxDQUFULEVBQVlTLENBQVosRUFBZTtBQUNoQlQsRUFBQUEsQ0FBQyxDQUFD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LFNBQS9CLEVBQTBDO0FBQUVaLEVBQUFBLFVBQVUsRUFBRSxJQUFkO0FBQW9CQyxFQUFBQSxHQUFHLEVBQUUsZUFBWTtBQUFFLFdBQU91RSxrQkFBa0IsQ0FBQzFELE9BQTFCO0FBQW9DO0FBQTNFLENBQTFDO0FBQ0F0QixNQUFNLENBQUNPLGNBQVAsQ0FBc0JhLE9BQXRCLEVBQStCLFNBQS9CLEVBQTBDO0FBQUVaLEVBQUFBLFVBQVUsRUFBRSxJQUFkO0FBQW9CQyxFQUFBQSxHQUFHLEVBQUUsZUFBWTtBQUFFLFdBQU91RSxrQkFBa0IsQ0FBQzNELE9BQTFCO0FBQW9DO0FBQTNFLENBQTFDIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19jcmVhdGVCaW5kaW5nID0gKHRoaXMgJiYgdGhpcy5fX2NyZWF0ZUJpbmRpbmcpIHx8IChPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gICAgaWYgKGsyID09PSB1bmRlZmluZWQpIGsyID0gaztcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkobywgazIsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBmdW5jdGlvbigpIHsgcmV0dXJuIG1ba107IH0gfSk7XG59KSA6IChmdW5jdGlvbihvLCBtLCBrLCBrMikge1xuICAgIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gICAgb1trMl0gPSBtW2tdO1xufSkpO1xudmFyIF9fc2V0TW9kdWxlRGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19zZXRNb2R1bGVEZWZhdWx0KSB8fCAoT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCB2KSB7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIFwiZGVmYXVsdFwiLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2IH0pO1xufSkgOiBmdW5jdGlvbihvLCB2KSB7XG4gICAgb1tcImRlZmF1bHRcIl0gPSB2O1xufSk7XG52YXIgX19pbXBvcnRTdGFyID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydFN0YXIpIHx8IGZ1bmN0aW9uIChtb2QpIHtcbiAgICBpZiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSByZXR1cm4gbW9kO1xuICAgIHZhciByZXN1bHQgPSB7fTtcbiAgICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgaW4gbW9kKSBpZiAoayAhPT0gXCJkZWZhdWx0XCIgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG1vZCwgaykpIF9fY3JlYXRlQmluZGluZyhyZXN1bHQsIG1vZCwgayk7XG4gICAgX19zZXRNb2R1bGVEZWZhdWx0KHJlc3VsdCwgbW9kKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMucHNldWRvcyA9IGV4cG9ydHMuZmlsdGVycyA9IGV4cG9ydHMuaXMgPSBleHBvcnRzLnNlbGVjdE9uZSA9IGV4cG9ydHMuc2VsZWN0QWxsID0gZXhwb3J0cy5wcmVwYXJlQ29udGV4dCA9IGV4cG9ydHMuX2NvbXBpbGVUb2tlbiA9IGV4cG9ydHMuX2NvbXBpbGVVbnNhZmUgPSBleHBvcnRzLmNvbXBpbGUgPSB2b2lkIDA7XG52YXIgRG9tVXRpbHMgPSBfX2ltcG9ydFN0YXIocmVxdWlyZShcImRvbXV0aWxzXCIpKTtcbnZhciBib29sYmFzZV8xID0gcmVxdWlyZShcImJvb2xiYXNlXCIpO1xudmFyIGNvbXBpbGVfMSA9IHJlcXVpcmUoXCIuL2NvbXBpbGVcIik7XG52YXIgc3Vic2VsZWN0c18xID0gcmVxdWlyZShcIi4vcHNldWRvLXNlbGVjdG9ycy9zdWJzZWxlY3RzXCIpO1xudmFyIGRlZmF1bHRFcXVhbHMgPSBmdW5jdGlvbiAoYSwgYikgeyByZXR1cm4gYSA9PT0gYjsgfTtcbnZhciBkZWZhdWx0T3B0aW9ucyA9IHtcbiAgICBhZGFwdGVyOiBEb21VdGlscyxcbiAgICBlcXVhbHM6IGRlZmF1bHRFcXVhbHMsXG59O1xuZnVuY3Rpb24gY29udmVydE9wdGlvbkZvcm1hdHMob3B0aW9ucykge1xuICAgIHZhciBfYSwgX2IsIF9jLCBfZDtcbiAgICAvKlxuICAgICAqIFdlIGZvcmNlIG9uZSBmb3JtYXQgb2Ygb3B0aW9ucyB0byB0aGUgb3RoZXIgb25lLlxuICAgICAqL1xuICAgIC8vIEB0cy1leHBlY3QtZXJyb3IgRGVmYXVsdCBvcHRpb25zIG1heSBoYXZlIGluY29tcGF0aWJsZSBgTm9kZWAgLyBgRWxlbWVudE5vZGVgLlxuICAgIHZhciBvcHRzID0gb3B0aW9ucyAhPT0gbnVsbCAmJiBvcHRpb25zICE9PSB2b2lkIDAgPyBvcHRpb25zIDogZGVmYXVsdE9wdGlvbnM7XG4gICAgLy8gQHRzLWV4cGVjdC1lcnJvciBTYW1lIGFzIGFib3ZlLlxuICAgIChfYSA9IG9wdHMuYWRhcHRlcikgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogKG9wdHMuYWRhcHRlciA9IERvbVV0aWxzKTtcbiAgICAvLyBAdHMtZXhwZWN0LWVycm9yIGBlcXVhbHNgIGRvZXMgbm90IGV4aXN0IG9uIGBPcHRpb25zYFxuICAgIChfYiA9IG9wdHMuZXF1YWxzKSAhPT0gbnVsbCAmJiBfYiAhPT0gdm9pZCAwID8gX2IgOiAob3B0cy5lcXVhbHMgPSAoX2QgPSAoX2MgPSBvcHRzLmFkYXB0ZXIpID09PSBudWxsIHx8IF9jID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYy5lcXVhbHMpICE9PSBudWxsICYmIF9kICE9PSB2b2lkIDAgPyBfZCA6IGRlZmF1bHRFcXVhbHMpO1xuICAgIHJldHVybiBvcHRzO1xufVxuZnVuY3Rpb24gd3JhcENvbXBpbGUoZnVuYykge1xuICAgIHJldHVybiBmdW5jdGlvbiBhZGRBZGFwdGVyKHNlbGVjdG9yLCBvcHRpb25zLCBjb250ZXh0KSB7XG4gICAgICAgIHZhciBvcHRzID0gY29udmVydE9wdGlvbkZvcm1hdHMob3B0aW9ucyk7XG4gICAgICAgIHJldHVybiBmdW5jKHNlbGVjdG9yLCBvcHRzLCBjb250ZXh0KTtcbiAgICB9O1xufVxuLyoqXG4gKiBDb21waWxlcyB0aGUgcXVlcnksIHJldHVybnMgYSBmdW5jdGlvbi5cbiAqL1xuZXhwb3J0cy5jb21waWxlID0gd3JhcENvbXBpbGUoY29tcGlsZV8xLmNvbXBpbGUpO1xuZXhwb3J0cy5fY29tcGlsZVVuc2FmZSA9IHdyYXBDb21waWxlKGNvbXBpbGVfMS5jb21waWxlVW5zYWZlKTtcbmV4cG9ydHMuX2NvbXBpbGVUb2tlbiA9IHdyYXBDb21waWxlKGNvbXBpbGVfMS5jb21waWxlVG9rZW4pO1xuZnVuY3Rpb24gZ2V0U2VsZWN0b3JGdW5jKHNlYXJjaEZ1bmMpIHtcbiAgICByZXR1cm4gZnVuY3Rpb24gc2VsZWN0KHF1ZXJ5LCBlbGVtZW50cywgb3B0aW9ucykge1xuICAgICAgICB2YXIgb3B0cyA9IGNvbnZlcnRPcHRpb25Gb3JtYXRzKG9wdGlvbnMpO1xuICAgICAgICBpZiAodHlwZW9mIHF1ZXJ5ICE9PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgICAgIHF1ZXJ5ID0gY29tcGlsZV8xLmNvbXBpbGVVbnNhZmUocXVlcnksIG9wdHMsIGVsZW1lbnRzKTtcbiAgICAgICAgfVxuICAgICAgICB2YXIgZmlsdGVyZWRFbGVtZW50cyA9IHByZXBhcmVDb250ZXh0KGVsZW1lbnRzLCBvcHRzLmFkYXB0ZXIsIHF1ZXJ5LnNob3VsZFRlc3ROZXh0U2libGluZ3MpO1xuICAgICAgICByZXR1cm4gc2VhcmNoRnVuYyhxdWVyeSwgZmlsdGVyZWRFbGVtZW50cywgb3B0cyk7XG4gICAgfTtcbn1cbmZ1bmN0aW9uIHByZXBhcmVDb250ZXh0KGVsZW1zLCBhZGFwdGVyLCBzaG91bGRUZXN0TmV4dFNpYmxpbmdzKSB7XG4gICAgaWYgKHNob3VsZFRlc3ROZXh0U2libGluZ3MgPT09IHZvaWQgMCkgeyBzaG91bGRUZXN0TmV4dFNpYmxpbmdzID0gZmFsc2U7IH1cbiAgICAvKlxuICAgICAqIEFkZCBzaWJsaW5ncyBpZiB0aGUgcXVlcnkgcmVxdWlyZXMgdGhlbS5cbiAgICAgKiBTZWUgaHR0cHM6Ly9naXRodWIuY29tL2ZiNTUvY3NzLXNlbGVjdC9wdWxsLzQzI2lzc3VlY29tbWVudC0yMjU0MTQ2OTJcbiAgICAgKi9cbiAgICBpZiAoc2hvdWxkVGVzdE5leHRTaWJsaW5ncykge1xuICAgICAgICBlbGVtcyA9IGFwcGVuZE5leHRTaWJsaW5ncyhlbGVtcywgYWRhcHRlcik7XG4gICAgfVxuICAgIHJldHVybiBBcnJheS5pc0FycmF5KGVsZW1zKVxuICAgICAgICA/IGFkYXB0ZXIucmVtb3ZlU3Vic2V0cyhlbGVtcylcbiAgICAgICAgOiBhZGFwdGVyLmdldENoaWxkcmVuKGVsZW1zKTtcbn1cbmV4cG9ydHMucHJlcGFyZUNvbnRleHQgPSBwcmVwYXJlQ29udGV4dDtcbmZ1bmN0aW9uIGFwcGVuZE5leHRTaWJsaW5ncyhlbGVtLCBhZGFwdGVyKSB7XG4gICAgLy8gT3JkZXIgbWF0dGVycyBiZWNhdXNlIGpRdWVyeSBzZWVtcyB0byBjaGVjayB0aGUgY2hpbGRyZW4gYmVmb3JlIHRoZSBzaWJsaW5nc1xuICAgIHZhciBlbGVtcyA9IEFycmF5LmlzQXJyYXkoZWxlbSkgPyBlbGVtLnNsaWNlKDApIDogW2VsZW1dO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZWxlbXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgdmFyIG5leHRTaWJsaW5ncyA9IHN1YnNlbGVjdHNfMS5nZXROZXh0U2libGluZ3MoZWxlbXNbaV0sIGFkYXB0ZXIpO1xuICAgICAgICBlbGVtcy5wdXNoLmFwcGx5KGVsZW1zLCBuZXh0U2libGluZ3MpO1xuICAgIH1cbiAgICByZXR1cm4gZWxlbXM7XG59XG4vKipcbiAqIEB0ZW1wbGF0ZSBOb2RlIFRoZSBnZW5lcmljIE5vZGUgdHlwZSBmb3IgdGhlIERPTSBhZGFwdGVyIGJlaW5nIHVzZWQuXG4gKiBAdGVtcGxhdGUgRWxlbWVudE5vZGUgVGhlIE5vZGUgdHlwZSBmb3IgZWxlbWVudHMgZm9yIHRoZSBET00gYWRhcHRlciBiZWluZyB1c2VkLlxuICogQHBhcmFtIGVsZW1zIEVsZW1lbnRzIHRvIHF1ZXJ5LiBJZiBpdCBpcyBhbiBlbGVtZW50LCBpdHMgY2hpbGRyZW4gd2lsbCBiZSBxdWVyaWVkLi5cbiAqIEBwYXJhbSBxdWVyeSBjYW4gYmUgZWl0aGVyIGEgQ1NTIHNlbGVjdG9yIHN0cmluZyBvciBhIGNvbXBpbGVkIHF1ZXJ5IGZ1bmN0aW9uLlxuICogQHBhcmFtIFtvcHRpb25zXSBvcHRpb25zIGZvciBxdWVyeWluZyB0aGUgZG9jdW1lbnQuXG4gKiBAc2VlIGNvbXBpbGUgZm9yIHN1cHBvcnRlZCBzZWxlY3RvciBxdWVyaWVzLlxuICogQHJldHVybnMgQWxsIG1hdGNoaW5nIGVsZW1lbnRzLlxuICpcbiAqL1xuZXhwb3J0cy5zZWxlY3RBbGwgPSBnZXRTZWxlY3RvckZ1bmMoZnVuY3Rpb24gKHF1ZXJ5LCBlbGVtcywgb3B0aW9ucykge1xuICAgIHJldHVybiBxdWVyeSA9PT0gYm9vbGJhc2VfMS5mYWxzZUZ1bmMgfHwgIWVsZW1zIHx8IGVsZW1zLmxlbmd0aCA9PT0gMFxuICAgICAgICA/IFtdXG4gICAgICAgIDogb3B0aW9ucy5hZGFwdGVyLmZpbmRBbGwocXVlcnksIGVsZW1zKTtcbn0pO1xuLyoqXG4gKiBAdGVtcGxhdGUgTm9kZSBUaGUgZ2VuZXJpYyBOb2RlIHR5cGUgZm9yIHRoZSBET00gYWRhcHRlciBiZWluZyB1c2VkLlxuICogQHRlbXBsYXRlIEVsZW1lbnROb2RlIFRoZSBOb2RlIHR5cGUgZm9yIGVsZW1lbnRzIGZvciB0aGUgRE9NIGFkYXB0ZXIgYmVpbmcgdXNlZC5cbiAqIEBwYXJhbSBlbGVtcyBFbGVtZW50cyB0byBxdWVyeS4gSWYgaXQgaXMgYW4gZWxlbWVudCwgaXRzIGNoaWxkcmVuIHdpbGwgYmUgcXVlcmllZC4uXG4gKiBAcGFyYW0gcXVlcnkgY2FuIGJlIGVpdGhlciBhIENTUyBzZWxlY3RvciBzdHJpbmcgb3IgYSBjb21waWxlZCBxdWVyeSBmdW5jdGlvbi5cbiAqIEBwYXJhbSBbb3B0aW9uc10gb3B0aW9ucyBmb3IgcXVlcnlpbmcgdGhlIGRvY3VtZW50LlxuICogQHNlZSBjb21waWxlIGZvciBzdXBwb3J0ZWQgc2VsZWN0b3IgcXVlcmllcy5cbiAqIEByZXR1cm5zIHRoZSBmaXJzdCBtYXRjaCwgb3IgbnVsbCBpZiB0aGVyZSB3YXMgbm8gbWF0Y2guXG4gKi9cbmV4cG9ydHMuc2VsZWN0T25lID0gZ2V0U2VsZWN0b3JGdW5jKGZ1bmN0aW9uIChxdWVyeSwgZWxlbXMsIG9wdGlvbnMpIHtcbiAgICByZXR1cm4gcXVlcnkgPT09IGJvb2xiYXNlXzEuZmFsc2VGdW5jIHx8ICFlbGVtcyB8fCBlbGVtcy5sZW5ndGggPT09IDBcbiAgICAgICAgPyBudWxsXG4gICAgICAgIDogb3B0aW9ucy5hZGFwdGVyLmZpbmRPbmUocXVlcnksIGVsZW1zKTtcbn0pO1xuLyoqXG4gKiBUZXN0cyB3aGV0aGVyIG9yIG5vdCBhbiBlbGVtZW50IGlzIG1hdGNoZWQgYnkgcXVlcnkuXG4gKlxuICogQHRlbXBsYXRlIE5vZGUgVGhlIGdlbmVyaWMgTm9kZSB0eXBlIGZvciB0aGUgRE9NIGFkYXB0ZXIgYmVpbmcgdXNlZC5cbiAqIEB0ZW1wbGF0ZSBFbGVtZW50Tm9kZSBUaGUgTm9kZSB0eXBlIGZvciBlbGVtZW50cyBmb3IgdGhlIERPTSBhZGFwdGVyIGJlaW5nIHVzZWQuXG4gKiBAcGFyYW0gZWxlbSBUaGUgZWxlbWVudCB0byB0ZXN0IGlmIGl0IG1hdGNoZXMgdGhlIHF1ZXJ5LlxuICogQHBhcmFtIHF1ZXJ5IGNhbiBiZSBlaXRoZXIgYSBDU1Mgc2VsZWN0b3Igc3RyaW5nIG9yIGEgY29tcGlsZWQgcXVlcnkgZnVuY3Rpb24uXG4gKiBAcGFyYW0gW29wdGlvbnNdIG9wdGlvbnMgZm9yIHF1ZXJ5aW5nIHRoZSBkb2N1bWVudC5cbiAqIEBzZWUgY29tcGlsZSBmb3Igc3VwcG9ydGVkIHNlbGVjdG9yIHF1ZXJpZXMuXG4gKiBAcmV0dXJuc1xuICovXG5mdW5jdGlvbiBpcyhlbGVtLCBxdWVyeSwgb3B0aW9ucykge1xuICAgIHZhciBvcHRzID0gY29udmVydE9wdGlvbkZvcm1hdHMob3B0aW9ucyk7XG4gICAgcmV0dXJuICh0eXBlb2YgcXVlcnkgPT09IFwiZnVuY3Rpb25cIiA/IHF1ZXJ5IDogY29tcGlsZV8xLmNvbXBpbGUocXVlcnksIG9wdHMpKShlbGVtKTtcbn1cbmV4cG9ydHMuaXMgPSBpcztcbi8qKlxuICogQWxpYXMgZm9yIHNlbGVjdEFsbChxdWVyeSwgZWxlbXMsIG9wdGlvbnMpLlxuICogQHNlZSBbY29tcGlsZV0gZm9yIHN1cHBvcnRlZCBzZWxlY3RvciBxdWVyaWVzLlxuICovXG5leHBvcnRzLmRlZmF1bHQgPSBleHBvcnRzLnNlbGVjdEFsbDtcbi8vIEV4cG9ydCBmaWx0ZXJzIGFuZCBwc2V1ZG9zIHRvIGFsbG93IHVzZXJzIHRvIHN1cHBseSB0aGVpciBvd24uXG52YXIgcHNldWRvX3NlbGVjdG9yc18xID0gcmVxdWlyZShcIi4vcHNldWRvLXNlbGVjdG9yc1wiKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcImZpbHRlcnNcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHBzZXVkb19zZWxlY3RvcnNfMS5maWx0ZXJzOyB9IH0pO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwicHNldWRvc1wiLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gcHNldWRvX3NlbGVjdG9yc18xLnBzZXVkb3M7IH0gfSk7XG4iXX0=