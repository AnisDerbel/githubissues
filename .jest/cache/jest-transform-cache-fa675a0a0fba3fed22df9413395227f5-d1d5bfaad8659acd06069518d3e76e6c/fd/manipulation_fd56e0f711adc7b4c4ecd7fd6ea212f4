e16975c2ed11f7cb6d140dc72c002d85
var parse = require('../parse');

var html = require('../static').html;

var text = require('../static').text;

var updateDOM = parse.update;

var utils = require('../utils');

var domEach = utils.domEach;
var cloneDom = utils.cloneDom;
var isHtml = utils.isHtml;
var slice = Array.prototype.slice;

var domhandler = require('domhandler');

var DomUtils = require('htmlparser2').DomUtils;

exports._makeDomArray = function makeDomArray(elem, clone) {
  if (elem == null) {
    return [];
  } else if (elem.cheerio) {
    return clone ? cloneDom(elem.get(), elem.options) : elem.get();
  } else if (Array.isArray(elem)) {
    return elem.reduce(function (newElems, el) {
      return newElems.concat(this._makeDomArray(el, clone));
    }.bind(this), []);
  } else if (typeof elem === 'string') {
    return parse(elem, this.options, false).children;
  }

  return clone ? cloneDom([elem]) : [elem];
};

var _insert = function _insert(concatenator) {
  return function () {
    var elems = slice.call(arguments);
    var lastIdx = this.length - 1;
    return domEach(this, function (i, el) {
      var dom;
      var domSrc;

      if (typeof elems[0] === 'function') {
        domSrc = elems[0].call(el, i, html(el.children));
      } else {
        domSrc = elems;
      }

      dom = this._makeDomArray(domSrc, i < lastIdx);
      concatenator(dom, el.children, el);
    });
  };
};

var uniqueSplice = function uniqueSplice(array, spliceIdx, spliceCount, newElems, parent) {
  var spliceArgs = [spliceIdx, spliceCount].concat(newElems);
  var prev = array[spliceIdx - 1] || null;
  var next = array[spliceIdx + spliceCount] || null;
  var idx;
  var len;
  var prevIdx;
  var node;
  var oldParent;

  for (idx = 0, len = newElems.length; idx < len; ++idx) {
    node = newElems[idx];
    oldParent = node.parent;
    prevIdx = oldParent && oldParent.children.indexOf(newElems[idx]);

    if (oldParent && prevIdx > -1) {
      oldParent.children.splice(prevIdx, 1);

      if (parent === oldParent && spliceIdx > prevIdx) {
        spliceArgs[0]--;
      }
    }

    node.parent = parent;

    if (node.prev) {
      node.prev.next = node.next || null;
    }

    if (node.next) {
      node.next.prev = node.prev || null;
    }

    node.prev = newElems[idx - 1] || prev;
    node.next = newElems[idx + 1] || next;
  }

  if (prev) {
    prev.next = newElems[0];
  }

  if (next) {
    next.prev = newElems[newElems.length - 1];
  }

  return array.splice.apply(array, spliceArgs);
};

exports.appendTo = function (target) {
  if (!target.cheerio) {
    target = this.constructor.call(this.constructor, target, null, this._originalRoot);
  }

  target.append(this);
  return this;
};

exports.prependTo = function (target) {
  if (!target.cheerio) {
    target = this.constructor.call(this.constructor, target, null, this._originalRoot);
  }

  target.prepend(this);
  return this;
};

exports.append = _insert(function (dom, children, parent) {
  uniqueSplice(children, children.length, 0, dom, parent);
});
exports.prepend = _insert(function (dom, children, parent) {
  uniqueSplice(children, 0, 0, dom, parent);
});

function _wrap(insert) {
  return function (wrapper) {
    var wrapperFn = typeof wrapper === 'function' && wrapper;
    var lastIdx = this.length - 1;
    var lastParent = this.parents().last();

    for (var i = 0; i < this.length; i++) {
      var el = this[i];
      var wrapperDom;
      var elInsertLocation;
      var j;

      if (wrapperFn) {
        wrapper = wrapperFn.call(el, i);
      }

      if (typeof wrapper === 'string' && !isHtml(wrapper)) {
        wrapper = lastParent.find(wrapper).clone();
      }

      wrapperDom = this._makeDomArray(wrapper, i < lastIdx).slice(0, 1);
      elInsertLocation = wrapperDom[0];
      j = 0;

      while (elInsertLocation && elInsertLocation.children) {
        if (j >= elInsertLocation.children.length) {
          break;
        }

        if (elInsertLocation.children[j].type === 'tag') {
          elInsertLocation = elInsertLocation.children[j];
          j = 0;
        } else {
          j++;
        }
      }

      insert(el, elInsertLocation, wrapperDom);
    }

    return this;
  };
}

exports.wrap = _wrap(function (el, elInsertLocation, wrapperDom) {
  var parent = el.parent;
  var siblings = parent.children;
  var index = siblings.indexOf(el);
  updateDOM([el], elInsertLocation);
  uniqueSplice(siblings, index, 0, wrapperDom, parent);
});
exports.wrapInner = _wrap(function (el, elInsertLocation, wrapperDom) {
  updateDOM(el.children, elInsertLocation);
  updateDOM(wrapperDom, el);
});

exports.after = function () {
  var elems = slice.call(arguments);
  var lastIdx = this.length - 1;
  domEach(this, function (i, el) {
    var parent = el.parent;

    if (!parent) {
      return;
    }

    var siblings = parent.children;
    var index = siblings.indexOf(el);
    var domSrc;
    var dom;
    if (index < 0) return;

    if (typeof elems[0] === 'function') {
      domSrc = elems[0].call(el, i, html(el.children));
    } else {
      domSrc = elems;
    }

    dom = this._makeDomArray(domSrc, i < lastIdx);
    uniqueSplice(siblings, index + 1, 0, dom, parent);
  });
  return this;
};

exports.insertAfter = function (target) {
  var clones = [];
  var self = this;

  if (typeof target === 'string') {
    target = this.constructor.call(this.constructor, target, null, this._originalRoot);
  }

  target = this._makeDomArray(target);
  self.remove();
  domEach(target, function (i, el) {
    var clonedSelf = self._makeDomArray(self.clone());

    var parent = el.parent;

    if (!parent) {
      return;
    }

    var siblings = parent.children;
    var index = siblings.indexOf(el);
    if (index < 0) return;
    uniqueSplice(siblings, index + 1, 0, clonedSelf, parent);
    clones.push(clonedSelf);
  });
  return this.constructor.call(this.constructor, this._makeDomArray(clones));
};

exports.before = function () {
  var elems = slice.call(arguments);
  var lastIdx = this.length - 1;
  domEach(this, function (i, el) {
    var parent = el.parent;

    if (!parent) {
      return;
    }

    var siblings = parent.children;
    var index = siblings.indexOf(el);
    var domSrc;
    var dom;
    if (index < 0) return;

    if (typeof elems[0] === 'function') {
      domSrc = elems[0].call(el, i, html(el.children));
    } else {
      domSrc = elems;
    }

    dom = this._makeDomArray(domSrc, i < lastIdx);
    uniqueSplice(siblings, index, 0, dom, parent);
  });
  return this;
};

exports.insertBefore = function (target) {
  var clones = [];
  var self = this;

  if (typeof target === 'string') {
    target = this.constructor.call(this.constructor, target, null, this._originalRoot);
  }

  target = this._makeDomArray(target);
  self.remove();
  domEach(target, function (i, el) {
    var clonedSelf = self._makeDomArray(self.clone());

    var parent = el.parent;

    if (!parent) {
      return;
    }

    var siblings = parent.children;
    var index = siblings.indexOf(el);
    if (index < 0) return;
    uniqueSplice(siblings, index, 0, clonedSelf, parent);
    clones.push(clonedSelf);
  });
  return this.constructor.call(this.constructor, this._makeDomArray(clones));
};

exports.remove = function (selector) {
  var elems = this;
  if (selector) elems = elems.filter(selector);
  domEach(elems, function (i, el) {
    DomUtils.removeElement(el);
    el.prev = el.next = el.parent = null;
  });
  return this;
};

exports.replaceWith = function (content) {
  var self = this;
  domEach(this, function (i, el) {
    var parent = el.parent;

    if (!parent) {
      return;
    }

    var siblings = parent.children;

    var dom = self._makeDomArray(typeof content === 'function' ? content.call(el, i, el) : content);

    var index;
    updateDOM(dom, null);
    index = siblings.indexOf(el);
    uniqueSplice(siblings, index, 1, dom, parent);
    el.parent = el.prev = el.next = null;
  });
  return this;
};

exports.empty = function () {
  domEach(this, function (i, el) {
    el.children.forEach(function (child) {
      child.next = child.prev = child.parent = null;
    });
    el.children.length = 0;
  });
  return this;
};

exports.html = function (str) {
  if (str === undefined) {
    if (!this[0] || !this[0].children) return null;
    return html(this[0].children, this.options);
  }

  var opts = this.options;
  domEach(this, function (i, el) {
    el.children.forEach(function (child) {
      child.next = child.prev = child.parent = null;
    });
    var content = str.cheerio ? str.clone().get() : parse('' + str, opts, false).children;
    updateDOM(content, el);
  });
  return this;
};

exports.toString = function () {
  return html(this, this.options);
};

exports.text = function (str) {
  if (str === undefined) {
    return text(this);
  } else if (typeof str === 'function') {
    var self = this;
    return domEach(this, function (i, el) {
      return exports.text.call(self._make(el), str.call(el, i, text([el])));
    });
  }

  domEach(this, function (i, el) {
    el.children.forEach(function (child) {
      child.next = child.prev = child.parent = null;
    });
    var textNode = new domhandler.Text(str);
    updateDOM(textNode, el);
  });
  return this;
};

exports.clone = function () {
  return this._make(cloneDom(this.get(), this.options));
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1hbmlwdWxhdGlvbi5qcyJdLCJuYW1lcyI6WyJwYXJzZSIsInJlcXVpcmUiLCJodG1sIiwidGV4dCIsInVwZGF0ZURPTSIsInVwZGF0ZSIsInV0aWxzIiwiZG9tRWFjaCIsImNsb25lRG9tIiwiaXNIdG1sIiwic2xpY2UiLCJBcnJheSIsInByb3RvdHlwZSIsImRvbWhhbmRsZXIiLCJEb21VdGlscyIsImV4cG9ydHMiLCJfbWFrZURvbUFycmF5IiwibWFrZURvbUFycmF5IiwiZWxlbSIsImNsb25lIiwiY2hlZXJpbyIsImdldCIsIm9wdGlvbnMiLCJpc0FycmF5IiwicmVkdWNlIiwibmV3RWxlbXMiLCJlbCIsImNvbmNhdCIsImJpbmQiLCJjaGlsZHJlbiIsIl9pbnNlcnQiLCJjb25jYXRlbmF0b3IiLCJlbGVtcyIsImNhbGwiLCJhcmd1bWVudHMiLCJsYXN0SWR4IiwibGVuZ3RoIiwiaSIsImRvbSIsImRvbVNyYyIsInVuaXF1ZVNwbGljZSIsImFycmF5Iiwic3BsaWNlSWR4Iiwic3BsaWNlQ291bnQiLCJwYXJlbnQiLCJzcGxpY2VBcmdzIiwicHJldiIsIm5leHQiLCJpZHgiLCJsZW4iLCJwcmV2SWR4Iiwibm9kZSIsIm9sZFBhcmVudCIsImluZGV4T2YiLCJzcGxpY2UiLCJhcHBseSIsImFwcGVuZFRvIiwidGFyZ2V0IiwiY29uc3RydWN0b3IiLCJfb3JpZ2luYWxSb290IiwiYXBwZW5kIiwicHJlcGVuZFRvIiwicHJlcGVuZCIsIl93cmFwIiwiaW5zZXJ0Iiwid3JhcHBlciIsIndyYXBwZXJGbiIsImxhc3RQYXJlbnQiLCJwYXJlbnRzIiwibGFzdCIsIndyYXBwZXJEb20iLCJlbEluc2VydExvY2F0aW9uIiwiaiIsImZpbmQiLCJ0eXBlIiwid3JhcCIsInNpYmxpbmdzIiwiaW5kZXgiLCJ3cmFwSW5uZXIiLCJhZnRlciIsImluc2VydEFmdGVyIiwiY2xvbmVzIiwic2VsZiIsInJlbW92ZSIsImNsb25lZFNlbGYiLCJwdXNoIiwiYmVmb3JlIiwiaW5zZXJ0QmVmb3JlIiwic2VsZWN0b3IiLCJmaWx0ZXIiLCJyZW1vdmVFbGVtZW50IiwicmVwbGFjZVdpdGgiLCJjb250ZW50IiwiZW1wdHkiLCJmb3JFYWNoIiwiY2hpbGQiLCJzdHIiLCJ1bmRlZmluZWQiLCJvcHRzIiwidG9TdHJpbmciLCJfbWFrZSIsInRleHROb2RlIiwiVGV4dCJdLCJtYXBwaW5ncyI6IkFBTUEsSUFBSUEsS0FBSyxHQUFHQyxPQUFPLENBQUMsVUFBRCxDQUFuQjs7QUFDQSxJQUFJQyxJQUFJLEdBQUdELE9BQU8sQ0FBQyxXQUFELENBQVAsQ0FBcUJDLElBQWhDOztBQUNBLElBQUlDLElBQUksR0FBR0YsT0FBTyxDQUFDLFdBQUQsQ0FBUCxDQUFxQkUsSUFBaEM7O0FBQ0EsSUFBSUMsU0FBUyxHQUFHSixLQUFLLENBQUNLLE1BQXRCOztBQUNBLElBQUlDLEtBQUssR0FBR0wsT0FBTyxDQUFDLFVBQUQsQ0FBbkI7O0FBQ0EsSUFBSU0sT0FBTyxHQUFHRCxLQUFLLENBQUNDLE9BQXBCO0FBQ0EsSUFBSUMsUUFBUSxHQUFHRixLQUFLLENBQUNFLFFBQXJCO0FBQ0EsSUFBSUMsTUFBTSxHQUFHSCxLQUFLLENBQUNHLE1BQW5CO0FBQ0EsSUFBSUMsS0FBSyxHQUFHQyxLQUFLLENBQUNDLFNBQU4sQ0FBZ0JGLEtBQTVCOztBQUNBLElBQUlHLFVBQVUsR0FBR1osT0FBTyxDQUFDLFlBQUQsQ0FBeEI7O0FBQ0EsSUFBSWEsUUFBUSxHQUFHYixPQUFPLENBQUMsYUFBRCxDQUFQLENBQXVCYSxRQUF0Qzs7QUFVQUMsT0FBTyxDQUFDQyxhQUFSLEdBQXdCLFNBQVNDLFlBQVQsQ0FBc0JDLElBQXRCLEVBQTRCQyxLQUE1QixFQUFtQztBQUN6RCxNQUFJRCxJQUFJLElBQUksSUFBWixFQUFrQjtBQUNoQixXQUFPLEVBQVA7QUFDRCxHQUZELE1BRU8sSUFBSUEsSUFBSSxDQUFDRSxPQUFULEVBQWtCO0FBQ3ZCLFdBQU9ELEtBQUssR0FBR1gsUUFBUSxDQUFDVSxJQUFJLENBQUNHLEdBQUwsRUFBRCxF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IHN0cnVjdHVyZS5cbiAqXG4gKiBAbW9kdWxlIGNoZWVyaW8vbWFuaXB1bGF0aW9uXG4gKi9cblxudmFyIHBhcnNlID0gcmVxdWlyZSgnLi4vcGFyc2UnKTtcbnZhciBodG1sID0gcmVxdWlyZSgnLi4vc3RhdGljJykuaHRtbDtcbnZhciB0ZXh0ID0gcmVxdWlyZSgnLi4vc3RhdGljJykudGV4dDtcbnZhciB1cGRhdGVET00gPSBwYXJzZS51cGRhdGU7XG52YXIgdXRpbHMgPSByZXF1aXJlKCcuLi91dGlscycpO1xudmFyIGRvbUVhY2ggPSB1dGlscy5kb21FYWNoO1xudmFyIGNsb25lRG9tID0gdXRpbHMuY2xvbmVEb207XG52YXIgaXNIdG1sID0gdXRpbHMuaXNIdG1sO1xudmFyIHNsaWNlID0gQXJyYXkucHJvdG90eXBlLnNsaWNlO1xudmFyIGRvbWhhbmRsZXIgPSByZXF1aXJlKCdkb21oYW5kbGVyJyk7XG52YXIgRG9tVXRpbHMgPSByZXF1aXJlKCdodG1scGFyc2VyMicpLkRvbVV0aWxzO1xuXG4vKipcbiAqIENyZWF0ZSBhbiBhcnJheSBvZiBub2RlcywgcmVjdXJzaW5nIGludG8gYXJyYXlzIGFuZCBwYXJzaW5nIHN0cmluZ3MgaWZcbiAqIG5lY2Vzc2FyeS5cbiAqXG4gKiBAcGFyYW0ge2NoZWVyaW98c3RyaW5nfGNoZWVyaW9bXXxzdHJpbmdbXX0gW2VsZW1dIC0gRWxlbWVudHMgdG8gbWFrZSBhbiBhcnJheSBvZi5cbiAqIEBwYXJhbSB7Ym9vbGVhbn0gW2Nsb25lXSAtIE9wdGlvbmFsbHkgY2xvbmUgbm9kZXMuXG4gKiBAcHJpdmF0ZVxuICovXG5leHBvcnRzLl9tYWtlRG9tQXJyYXkgPSBmdW5jdGlvbiBtYWtlRG9tQXJyYXkoZWxlbSwgY2xvbmUpIHtcbiAgaWYgKGVsZW0gPT0gbnVsbCkge1xuICAgIHJldHVybiBbXTtcbiAgfSBlbHNlIGlmIChlbGVtLmNoZWVyaW8pIHtcbiAgICByZXR1cm4gY2xvbmUgPyBjbG9uZURvbShlbGVtLmdldCgpLCBlbGVtLm9wdGlvbnMpIDogZWxlbS5nZXQoKTtcbiAgfSBlbHNlIGlmIChBcnJheS5pc0FycmF5KGVsZW0pKSB7XG4gICAgcmV0dXJuIGVsZW0ucmVkdWNlKFxuICAgICAgZnVuY3Rpb24gKG5ld0VsZW1zLCBlbCkge1xuICAgICAgICByZXR1cm4gbmV3RWxlbXMuY29uY2F0KHRoaXMuX21ha2VEb21BcnJheShlbCwgY2xvbmUpKTtcbiAgICAgIH0uYmluZCh0aGlzKSxcbiAgICAgIFtdXG4gICAgKTtcbiAgfSBlbHNlIGlmICh0eXBlb2YgZWxlbSA9PT0gJ3N0cmluZycpIHtcbiAgICByZXR1cm4gcGFyc2UoZWxlbSwgdGhpcy5vcHRpb25zLCBmYWxzZSkuY2hpbGRyZW47XG4gIH1cbiAgcmV0dXJuIGNsb25lID8gY2xvbmVEb20oW2VsZW1dKSA6IFtlbGVtXTtcbn07XG5cbnZhciBfaW5zZXJ0ID0gZnVuY3Rpb24gKGNvbmNhdGVuYXRvcikge1xuICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgIHZhciBlbGVtcyA9IHNsaWNlLmNhbGwoYXJndW1lbnRzKTtcbiAgICB2YXIgbGFzdElkeCA9IHRoaXMubGVuZ3RoIC0gMTtcblxuICAgIHJldHVybiBkb21FYWNoKHRoaXMsIGZ1bmN0aW9uIChpLCBlbCkge1xuICAgICAgdmFyIGRvbTtcbiAgICAgIHZhciBkb21TcmM7XG5cbiAgICAgIGlmICh0eXBlb2YgZWxlbXNbMF0gPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgZG9tU3JjID0gZWxlbXNbMF0uY2FsbChlbCwgaSwgaHRtbChlbC5jaGlsZHJlbikpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZG9tU3JjID0gZWxlbXM7XG4gICAgICB9XG5cbiAgICAgIGRvbSA9IHRoaXMuX21ha2VEb21BcnJheShkb21TcmMsIGkgPCBsYXN0SWR4KTtcbiAgICAgIGNvbmNhdGVuYXRvcihkb20sIGVsLmNoaWxkcmVuLCBlbCk7XG4gICAgfSk7XG4gIH07XG59O1xuXG4vKlxuICogTW9kaWZ5IGFuIGFycmF5IGluLXBsYWNlLCByZW1vdmluZyBzb21lIG51bWJlciBvZiBlbGVtZW50cyBhbmQgYWRkaW5nIG5ld1xuICogZWxlbWVudHMgZGlyZWN0bHkgZm9sbG93aW5nIHRoZW0uXG4gKlxuICogQHBhcmFtIHtBcnJheX0gYXJyYXkgVGFyZ2V0IGFycmF5IHRvIHNwbGljZS5cbiAqIEBwYXJhbSB7TnVtYmVyfSBzcGxpY2VJZHggSW5kZXggYXQgd2hpY2ggdG8gYmVnaW4gY2hhbmdpbmcgdGhlIGFycmF5LlxuICogQHBhcmFtIHtOdW1iZXJ9IHNwbGljZUNvdW50IE51bWJlciBvZiBlbGVtZW50cyB0byByZW1vdmUgZnJvbSB0aGUgYXJyYXkuXG4gKiBAcGFyYW0ge0FycmF5fSBuZXdFbGVtcyBFbGVtZW50cyB0byBpbnNlcnQgaW50byB0aGUgYXJyYXkuXG4gKlxuICogQHByaXZhdGVcbiAqL1xudmFyIHVuaXF1ZVNwbGljZSA9IGZ1bmN0aW9uIChhcnJheSwgc3BsaWNlSWR4LCBzcGxpY2VDb3VudCwgbmV3RWxlbXMsIHBhcmVudCkge1xuICB2YXIgc3BsaWNlQXJncyA9IFtzcGxpY2VJZHgsIHNwbGljZUNvdW50XS5jb25jYXQobmV3RWxlbXMpO1xuICB2YXIgcHJldiA9IGFycmF5W3NwbGljZUlkeCAtIDFdIHx8IG51bGw7XG4gIHZhciBuZXh0ID0gYXJyYXlbc3BsaWNlSWR4ICsgc3BsaWNlQ291bnRdIHx8IG51bGw7XG4gIHZhciBpZHg7XG4gIHZhciBsZW47XG4gIHZhciBwcmV2SWR4O1xuICB2YXIgbm9kZTtcbiAgdmFyIG9sZFBhcmVudDtcblxuICAvLyBCZWZvcmUgc3BsaWNpbmcgaW4gbmV3IGVsZW1lbnRzLCBlbnN1cmUgdGhleSBkbyBub3QgYWxyZWFkeSBhcHBlYXIgaW4gdGhlXG4gIC8vIGN1cnJlbnQgYXJyYXkuXG4gIGZvciAoaWR4ID0gMCwgbGVuID0gbmV3RWxlbXMubGVuZ3RoOyBpZHggPCBsZW47ICsraWR4KSB7XG4gICAgbm9kZSA9IG5ld0VsZW1zW2lkeF07XG4gICAgb2xkUGFyZW50ID0gbm9kZS5wYXJlbnQ7XG4gICAgcHJldklkeCA9IG9sZFBhcmVudCAmJiBvbGRQYXJlbnQuY2hpbGRyZW4uaW5kZXhPZihuZXdFbGVtc1tpZHhdKTtcblxuICAgIGlmIChvbGRQYXJlbnQgJiYgcHJldklkeCA+IC0xKSB7XG4gICAgICBvbGRQYXJlbnQuY2hpbGRyZW4uc3BsaWNlKHByZXZJZHgsIDEpO1xuICAgICAgaWYgKHBhcmVudCA9PT0gb2xkUGFyZW50ICYmIHNwbGljZUlkeCA+IHByZXZJZHgpIHtcbiAgICAgICAgc3BsaWNlQXJnc1swXS0tO1xuICAgICAgfVxuICAgIH1cblxuICAgIG5vZGUucGFyZW50ID0gcGFyZW50O1xuXG4gICAgaWYgKG5vZGUucHJldikge1xuICAgICAgbm9kZS5wcmV2Lm5leHQgPSBub2RlLm5leHQgfHwgbnVsbDtcbiAgICB9XG5cbiAgICBpZiAobm9kZS5uZXh0KSB7XG4gICAgICBub2RlLm5leHQucHJldiA9IG5vZGUucHJldiB8fCBudWxsO1xuICAgIH1cblxuICAgIG5vZGUucHJldiA9IG5ld0VsZW1zW2lkeCAtIDFdIHx8IHByZXY7XG4gICAgbm9kZS5uZXh0ID0gbmV3RWxlbXNbaWR4ICsgMV0gfHwgbmV4dDtcbiAgfVxuXG4gIGlmIChwcmV2KSB7XG4gICAgcHJldi5uZXh0ID0gbmV3RWxlbXNbMF07XG4gIH1cbiAgaWYgKG5leHQpIHtcbiAgICBuZXh0LnByZXYgPSBuZXdFbGVtc1tuZXdFbGVtcy5sZW5ndGggLSAxXTtcbiAgfVxuICByZXR1cm4gYXJyYXkuc3BsaWNlLmFwcGx5KGFycmF5LCBzcGxpY2VBcmdzKTtcbn07XG5cbi8qKlxuICogSW5zZXJ0IGV2ZXJ5IGVsZW1lbnQgaW4gdGhlIHNldCBvZiBtYXRjaGVkIGVsZW1lbnRzIHRvIHRoZSBlbmQgb2YgdGhlXG4gKiB0YXJnZXQuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd8Y2hlZXJpb30gdGFyZ2V0IC0gRWxlbWVudCB0byBhcHBlbmQgZWxlbWVudHMgdG8uXG4gKlxuICogQGV4YW1wbGVcbiAqXG4gKiAkKCc8bGkgY2xhc3M9XCJwbHVtXCI+UGx1bTwvbGk+JykuYXBwZW5kVG8oJyNmcnVpdHMnKVxuICogJC5odG1sKClcbiAqIC8vPT4gIDx1bCBpZD1cImZydWl0c1wiPlxuICogLy8gICAgICA8bGkgY2xhc3M9XCJhcHBsZVwiPkFwcGxlPC9saT5cbiAqIC8vICAgICAgPGxpIGNsYXNzPVwib3JhbmdlXCI+T3JhbmdlPC9saT5cbiAqIC8vICAgICAgPGxpIGNsYXNzPVwicGVhclwiPlBlYXI8L2xpPlxuICogLy8gICAgICA8bGkgY2xhc3M9XCJwbHVtXCI+UGx1bTwvbGk+XG4gKiAvLyAgICA8L3VsPlxuICpcbiAqIEBzZWUge0BsaW5rIGh0dHA6Ly9hcGkuanF1ZXJ5LmNvbS9hcHBlbmRUby99XG4gKi9cbmV4cG9ydHMuYXBwZW5kVG8gPSBmdW5jdGlvbiAodGFyZ2V0KSB7XG4gIGlmICghdGFyZ2V0LmNoZWVyaW8pIHtcbiAgICB0YXJnZXQgPSB0aGlzLmNvbnN0cnVjdG9yLmNhbGwoXG4gICAgICB0aGlzLmNvbnN0cnVjdG9yLFxuICAgICAgdGFyZ2V0LFxuICAgICAgbnVsbCxcbiAgICAgIHRoaXMuX29yaWdpbmFsUm9vdFxuICAgICk7XG4gIH1cblxuICB0YXJnZXQuYXBwZW5kKHRoaXMpO1xuXG4gIHJldHVybiB0aGlzO1xufTtcblxuLyoqXG4gKiBJbnNlcnQgZXZlcnkgZWxlbWVudCBpbiB0aGUgc2V0IG9mIG1hdGNoZWQgZWxlbWVudHMgdG8gdGhlIGJlZ2lubmluZyBvZiB0aGVcbiAqIHRhcmdldC5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ3xjaGVlcmlvfSB0YXJnZXQgLSBFbGVtZW50IHRvIHByZXBlbmQgZWxlbWVudHMgdG8uXG4gKlxuICogQGV4YW1wbGVcbiAqXG4gKiAkKCc8bGkgY2xhc3M9XCJwbHVtXCI+UGx1bTwvbGk+JykucHJlcGVuZFRvKCcjZnJ1aXRzJylcbiAqICQuaHRtbCgpXG4gKiAvLz0+ICA8dWwgaWQ9XCJmcnVpdHNcIj5cbiAqIC8vICAgICAgPGxpIGNsYXNzPVwicGx1bVwiPlBsdW08L2xpPlxuICogLy8gICAgICA8bGkgY2xhc3M9XCJhcHBsZVwiPkFwcGxlPC9saT5cbiAqIC8vICAgICAgPGxpIGNsYXNzPVwib3JhbmdlXCI+T3JhbmdlPC9saT5cbiAqIC8vICAgICAgPGxpIGNsYXNzPVwicGVhclwiPlBlYXI8L2xpPlxuICogLy8gICAgPC91bD5cbiAqXG4gKiBAc2VlIHtAbGluayBodHRwOi8vYXBpLmpxdWVyeS5jb20vcHJlcGVuZFRvL31cbiAqL1xuZXhwb3J0cy5wcmVwZW5kVG8gPSBmdW5jdGlvbiAodGFyZ2V0KSB7XG4gIGlmICghdGFyZ2V0LmNoZWVyaW8pIHtcbiAgICB0YXJnZXQgPSB0aGlzLmNvbnN0cnVjdG9yLmNhbGwoXG4gICAgICB0aGlzLmNvbnN0cnVjdG9yLFxuICAgICAgdGFyZ2V0LFxuICAgICAgbnVsbCxcbiAgICAgIHRoaXMuX29yaWdpbmFsUm9vdFxuICAgICk7XG4gIH1cblxuICB0YXJnZXQucHJlcGVuZCh0aGlzKTtcblxuICByZXR1cm4gdGhpcztcbn07XG5cbi8qKlxuICogSW5zZXJ0cyBjb250ZW50IGFzIHRoZSAqbGFzdCogY2hpbGQgb2YgZWFjaCBvZiB0aGUgc2VsZWN0ZWQgZWxlbWVudHMuXG4gKlxuICogQGZ1bmN0aW9uXG4gKlxuICogQGV4YW1wbGVcbiAqXG4gKiAkKCd1bCcpLmFwcGVuZCgnPGxpIGNsYXNzPVwicGx1bVwiPlBsdW08L2xpPicpXG4gKiAkLmh0bWwoKVxuICogLy89PiAgPHVsIGlkPVwiZnJ1aXRzXCI+XG4gKiAvLyAgICAgIDxsaSBjbGFzcz1cImFwcGxlXCI+QXBwbGU8L2xpPlxuICogLy8gICAgICA8bGkgY2xhc3M9XCJvcmFuZ2VcIj5PcmFuZ2U8L2xpPlxuICogLy8gICAgICA8bGkgY2xhc3M9XCJwZWFyXCI+UGVhcjwvbGk+XG4gKiAvLyAgICAgIDxsaSBjbGFzcz1cInBsdW1cIj5QbHVtPC9saT5cbiAqIC8vICAgIDwvdWw+XG4gKlxuICogQHNlZSB7QGxpbmsgaHR0cDovL2FwaS5qcXVlcnkuY29tL2FwcGVuZC99XG4gKi9cbmV4cG9ydHMuYXBwZW5kID0gX2luc2VydChmdW5jdGlvbiAoZG9tLCBjaGlsZHJlbiwgcGFyZW50KSB7XG4gIHVuaXF1ZVNwbGljZShjaGlsZHJlbiwgY2hpbGRyZW4ubGVuZ3RoLCAwLCBkb20sIHBhcmVudCk7XG59KTtcblxuLyoqXG4gKiBJbnNlcnRzIGNvbnRlbnQgYXMgdGhlICpmaXJzdCogY2hpbGQgb2YgZWFjaCBvZiB0aGUgc2VsZWN0ZWQgZWxlbWVudHMuXG4gKlxuICogQGZ1bmN0aW9uXG4gKlxuICogQGV4YW1wbGVcbiAqXG4gKiAkKCd1bCcpLnByZXBlbmQoJzxsaSBjbGFzcz1cInBsdW1cIj5QbHVtPC9saT4nKVxuICogJC5odG1sKClcbiAqIC8vPT4gIDx1bCBpZD1cImZydWl0c1wiPlxuICogLy8gICAgICA8bGkgY2xhc3M9XCJwbHVtXCI+UGx1bTwvbGk+XG4gKiAvLyAgICAgIDxsaSBjbGFzcz1cImFwcGxlXCI+QXBwbGU8L2xpPlxuICogLy8gICAgICA8bGkgY2xhc3M9XCJvcmFuZ2VcIj5PcmFuZ2U8L2xpPlxuICogLy8gICAgICA8bGkgY2xhc3M9XCJwZWFyXCI+UGVhcjwvbGk+XG4gKiAvLyAgICA8L3VsPlxuICpcbiAqIEBzZWUge0BsaW5rIGh0dHA6Ly9hcGkuanF1ZXJ5LmNvbS9wcmVwZW5kL31cbiAqL1xuZXhwb3J0cy5wcmVwZW5kID0gX2luc2VydChmdW5jdGlvbiAoZG9tLCBjaGlsZHJlbiwgcGFyZW50KSB7XG4gIHVuaXF1ZVNwbGljZShjaGlsZHJlbiwgMCwgMCwgZG9tLCBwYXJlbnQpO1xufSk7XG5cbmZ1bmN0aW9uIF93cmFwKGluc2VydCkge1xuICByZXR1cm4gZnVuY3Rpb24gKHdyYXBwZXIpIHtcbiAgICB2YXIgd3JhcHBlckZuID0gdHlwZW9mIHdyYXBwZXIgPT09ICdmdW5jdGlvbicgJiYgd3JhcHBlcjtcbiAgICB2YXIgbGFzdElkeCA9IHRoaXMubGVuZ3RoIC0gMTtcbiAgICB2YXIgbGFzdFBhcmVudCA9IHRoaXMucGFyZW50cygpLmxhc3QoKTtcblxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5sZW5ndGg7IGkrKykge1xuICAgICAgdmFyIGVsID0gdGhpc1tpXTtcbiAgICAgIHZhciB3cmFwcGVyRG9tO1xuICAgICAgdmFyIGVsSW5zZXJ0TG9jYXRpb247XG4gICAgICB2YXIgajtcblxuICAgICAgaWYgKHdyYXBwZXJGbikge1xuICAgICAgICB3cmFwcGVyID0gd3JhcHBlckZuLmNhbGwoZWwsIGkpO1xuICAgICAgfVxuXG4gICAgICBpZiAodHlwZW9mIHdyYXBwZXIgPT09ICdzdHJpbmcnICYmICFpc0h0bWwod3JhcHBlcikpIHtcbiAgICAgICAgd3JhcHBlciA9IGxhc3RQYXJlbnQuZmluZCh3cmFwcGVyKS5jbG9uZSgpO1xuICAgICAgfVxuXG4gICAgICB3cmFwcGVyRG9tID0gdGhpcy5fbWFrZURvbUFycmF5KHdyYXBwZXIsIGkgPCBsYXN0SWR4KS5zbGljZSgwLCAxKTtcbiAgICAgIGVsSW5zZXJ0TG9jYXRpb24gPSB3cmFwcGVyRG9tWzBdO1xuICAgICAgLy8gRmluZCB0aGUgZGVlcGVzdCBjaGlsZC4gT25seSBjb25zaWRlciB0aGUgZmlyc3QgdGFnIGNoaWxkIG9mIGVhY2ggbm9kZVxuICAgICAgLy8gKGlnbm9yZSB0ZXh0KTsgc3RvcCBpZiBubyBjaGlsZHJlbiBhcmUgZm91bmQuXG4gICAgICBqID0gMDtcblxuICAgICAgd2hpbGUgKGVsSW5zZXJ0TG9jYXRpb24gJiYgZWxJbnNlcnRMb2NhdGlvbi5jaGlsZHJlbikge1xuICAgICAgICBpZiAoaiA+PSBlbEluc2VydExvY2F0aW9uLmNoaWxkcmVuLmxlbmd0aCkge1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGVsSW5zZXJ0TG9jYXRpb24uY2hpbGRyZW5bal0udHlwZSA9PT0gJ3RhZycpIHtcbiAgICAgICAgICBlbEluc2VydExvY2F0aW9uID0gZWxJbnNlcnRMb2NhdGlvbi5jaGlsZHJlbltqXTtcbiAgICAgICAgICBqID0gMDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBqKys7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgaW5zZXJ0KGVsLCBlbEluc2VydExvY2F0aW9uLCB3cmFwcGVyRG9tKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcztcbiAgfTtcbn1cblxuLyoqXG4gKiBUaGUgLndyYXAoKSBmdW5jdGlvbiBjYW4gdGFrZSBhbnkgc3RyaW5nIG9yIG9iamVjdCB0aGF0IGNvdWxkIGJlIHBhc3NlZCB0b1xuICogdGhlICQoKSBmYWN0b3J5IGZ1bmN0aW9uIHRvIHNwZWNpZnkgYSBET00gc3RydWN0dXJlLiBUaGlzIHN0cnVjdHVyZSBtYXkgYmVcbiAqIG5lc3RlZCBzZXZlcmFsIGxldmVscyBkZWVwLCBidXQgc2hvdWxkIGNvbnRhaW4gb25seSBvbmUgaW5tb3N0IGVsZW1lbnQuIEFcbiAqIGNvcHkgb2YgdGhpcyBzdHJ1Y3R1cmUgd2lsbCBiZSB3cmFwcGVkIGFyb3VuZCBlYWNoIG9mIHRoZSBlbGVtZW50cyBpbiB0aGVcbiAqIHNldCBvZiBtYXRjaGVkIGVsZW1lbnRzLiBUaGlzIG1ldGhvZCByZXR1cm5zIHRoZSBvcmlnaW5hbCBzZXQgb2YgZWxlbWVudHNcbiAqIGZvciBjaGFpbmluZyBwdXJwb3Nlcy5cbiAqXG4gKiBAcGFyYW0ge2NoZWVyaW99IHdyYXBwZXIgLSBUaGUgRE9NIHN0cnVjdHVyZSB0byB3cmFwIGFyb3VuZCBlYWNoIGVsZW1lbnQgaW4gdGhlIHNlbGVjdGlvbi5cbiAqXG4gKiBAZXhhbXBsZVxuICpcbiAqIGNvbnN0IHJlZEZydWl0ID0gJCgnPGRpdiBjbGFzcz1cInJlZC1mcnVpdFwiPjwvZGl2PicpXG4gKiAkKCcuYXBwbGUnKS53cmFwKHJlZEZydWl0KVxuICpcbiAqIC8vPT4gPHVsIGlkPVwiZnJ1aXRzXCI+XG4gKiAvLyAgICAgPGRpdiBjbGFzcz1cInJlZC1mcnVpdFwiPlxuICogLy8gICAgICA8bGkgY2xhc3M9XCJhcHBsZVwiPkFwcGxlPC9saT5cbiAqIC8vICAgICA8L2Rpdj5cbiAqIC8vICAgICA8bGkgY2xhc3M9XCJvcmFuZ2VcIj5PcmFuZ2U8L2xpPlxuICogLy8gICAgIDxsaSBjbGFzcz1cInBsdW1cIj5QbHVtPC9saT5cbiAqIC8vICAgPC91bD5cbiAqXG4gKiBjb25zdCBoZWFsdGh5ID0gJCgnPGRpdiBjbGFzcz1cImhlYWx0aHlcIj48L2Rpdj4nKVxuICogJCgnbGknKS53cmFwKGhlYWx0aHkpXG4gKlxuICogLy89PiA8dWwgaWQ9XCJmcnVpdHNcIj5cbiAqIC8vICAgICA8ZGl2IGNsYXNzPVwiaGVhbHRoeVwiPlxuICogLy8gICAgICAgPGxpIGNsYXNzPVwiYXBwbGVcIj5BcHBsZTwvbGk+XG4gKiAvLyAgICAgPC9kaXY+XG4gKiAvLyAgICAgPGRpdiBjbGFzcz1cImhlYWx0aHlcIj5cbiAqIC8vICAgICAgIDxsaSBjbGFzcz1cIm9yYW5nZVwiPk9yYW5nZTwvbGk+XG4gKiAvLyAgICAgPC9kaXY+XG4gKiAvLyAgICAgPGRpdiBjbGFzcz1cImhlYWx0aHlcIj5cbiAqIC8vICAgICAgICA8bGkgY2xhc3M9XCJwbHVtXCI+UGx1bTwvbGk+XG4gKiAvLyAgICAgPC9kaXY+XG4gKiAvLyAgIDwvdWw+XG4gKlxuICogQHNlZSB7QGxpbmsgaHR0cDovL2FwaS5qcXVlcnkuY29tL3dyYXAvfVxuICovXG5leHBvcnRzLndyYXAgPSBfd3JhcChmdW5jdGlvbiAoZWwsIGVsSW5zZXJ0TG9jYXRpb24sIHdyYXBwZXJEb20pIHtcbiAgdmFyIHBhcmVudCA9IGVsLnBhcmVudDtcbiAgdmFyIHNpYmxpbmdzID0gcGFyZW50LmNoaWxkcmVuO1xuICB2YXIgaW5kZXggPSBzaWJsaW5ncy5pbmRleE9mKGVsKTtcblxuICB1cGRhdGVET00oW2VsXSwgZWxJbnNlcnRMb2NhdGlvbik7XG4gIC8vIFRoZSBwcmV2aW91cyBvcGVyYXRpb24gcmVtb3ZlZCB0aGUgY3VycmVudCBlbGVtZW50IGZyb20gdGhlIGBzaWJsaW5nc2BcbiAgLy8gYXJyYXksIHNvIHRoZSBgZG9tYCBhcnJheSBjYW4gYmUgaW5zZXJ0ZWQgd2l0aG91dCByZW1vdmluZyBhbnlcbiAgLy8gYWRkaXRpb25hbCBlbGVtZW50cy5cbiAgdW5pcXVlU3BsaWNlKHNpYmxpbmdzLCBpbmRleCwgMCwgd3JhcHBlckRvbSwgcGFyZW50KTtcbn0pO1xuXG4vKipcbiAqIFRoZSAud3JhcElubmVyKCkgZnVuY3Rpb24gY2FuIHRha2UgYW55IHN0cmluZyBvciBvYmplY3QgdGhhdCBjb3VsZCBiZSBwYXNzZWQgdG9cbiAqIHRoZSAkKCkgZmFjdG9yeSBmdW5jdGlvbiB0byBzcGVjaWZ5IGEgRE9NIHN0cnVjdHVyZS4gVGhpcyBzdHJ1Y3R1cmUgbWF5IGJlXG4gKiBuZXN0ZWQgc2V2ZXJhbCBsZXZlbHMgZGVlcCwgYnV0IHNob3VsZCBjb250YWluIG9ubHkgb25lIGlubW9zdCBlbGVtZW50LiBUaGVcbiAqIHN0cnVjdHVyZSB3aWxsIGJlIHdyYXBwZWQgYXJvdW5kIHRoZSBjb250ZW50IG9mIGVhY2ggb2YgdGhlIGVsZW1lbnRzIGluIHRoZSBzZXRcbiAqIG9mIG1hdGNoZWQgZWxlbWVudHMuXG4gKlxuICogQHBhcmFtIHtjaGVlcmlvfSB3cmFwcGVyIC0gVGhlIERPTSBzdHJ1Y3R1cmUgdG8gd3JhcCBhcm91bmQgdGhlIGNvbnRlbnQgb2YgZWFjaCBlbGVtZW50IGluIHRoZSBzZWxlY3Rpb24uXG4gKlxuICogQGV4YW1wbGVcbiAqXG4gKiBjb25zdCByZWRGcnVpdCA9ICQoJzxkaXYgY2xhc3M9XCJyZWQtZnJ1aXRcIj48L2Rpdj4nKVxuICogJCgnLmFwcGxlJykud3JhcElubmVyKHJlZEZydWl0KVxuICpcbiAqIC8vPT4gPHVsIGlkPVwiZnJ1aXRzXCI+XG4gKiAvLyAgICAgPGxpIGNsYXNzPVwiYXBwbGVcIj5cbiAqIC8vICAgICAgIDxkaXYgY2xhc3M9XCJyZWQtZnJ1aXRcIj5BcHBsZTwvZGl2PlxuICogLy8gICAgIDwvbGk+XG4gKiAvLyAgICAgPGxpIGNsYXNzPVwib3JhbmdlXCI+T3JhbmdlPC9saT5cbiAqIC8vICAgICA8bGkgY2xhc3M9XCJwZWFyXCI+UGVhcjwvbGk+XG4gKiAvLyAgIDwvdWw+XG4gKlxuICogY29uc3QgaGVhbHRoeSA9ICQoJzxkaXYgY2xhc3M9XCJoZWFsdGh5XCI+PC9kaXY+JylcbiAqICQoJ2xpJykud3JhcElubmVyKGhlYWx0aHkpXG4gKlxuICogLy89PiA8dWwgaWQ9XCJmcnVpdHNcIj5cbiAqIC8vICAgICA8bGkgY2xhc3M9XCJhcHBsZVwiPlxuICogLy8gICAgICAgPGRpdiBjbGFzcz1cImhlYWx0aHlcIj5BcHBsZTwvZGl2PlxuICogLy8gICAgIDwvbGk+XG4gKiAvLyAgICAgPGxpIGNsYXNzPVwib3JhbmdlXCI+XG4gKiAvLyAgICAgICA8ZGl2IGNsYXNzPVwiaGVhbHRoeVwiPk9yYW5nZTwvZGl2PlxuICogLy8gICAgIDwvbGk+XG4gKiAvLyAgICAgPGxpIGNsYXNzPVwicGVhclwiPlxuICogLy8gICAgICAgPGRpdiBjbGFzcz1cImhlYWx0aHlcIj5QZWFyPC9kaXY+XG4gKiAvLyAgICAgPC9saT5cbiAqIC8vICAgPC91bD5cbiAqXG4gKiBAc2VlIHtAbGluayBodHRwOi8vYXBpLmpxdWVyeS5jb20vd3JhcElubmVyL31cbiAqL1xuZXhwb3J0cy53cmFwSW5uZXIgPSBfd3JhcChmdW5jdGlvbiAoZWwsIGVsSW5zZXJ0TG9jYXRpb24sIHdyYXBwZXJEb20pIHtcbiAgdXBkYXRlRE9NKGVsLmNoaWxkcmVuLCBlbEluc2VydExvY2F0aW9uKTtcbiAgdXBkYXRlRE9NKHdyYXBwZXJEb20sIGVsKTtcbn0pO1xuXG4vKipcbiAqIEluc2VydCBjb250ZW50IG5leHQgdG8gZWFjaCBlbGVtZW50IGluIHRoZSBzZXQgb2YgbWF0Y2hlZCBlbGVtZW50cy5cbiAqXG4gKiBAZXhhbXBsZVxuICpcbiAqICQoJy5hcHBsZScpLmFmdGVyKCc8bGkgY2xhc3M9XCJwbHVtXCI+UGx1bTwvbGk+JylcbiAqICQuaHRtbCgpXG4gKiAvLz0+ICA8dWwgaWQ9XCJmcnVpdHNcIj5cbiAqIC8vICAgICAgPGxpIGNsYXNzPVwiYXBwbGVcIj5BcHBsZTwvbGk+XG4gKiAvLyAgICAgIDxsaSBjbGFzcz1cInBsdW1cIj5QbHVtPC9saT5cbiAqIC8vICAgICAgPGxpIGNsYXNzPVwib3JhbmdlXCI+T3JhbmdlPC9saT5cbiAqIC8vICAgICAgPGxpIGNsYXNzPVwicGVhclwiPlBlYXI8L2xpPlxuICogLy8gICAgPC91bD5cbiAqXG4gKiBAc2VlIHtAbGluayBodHRwOi8vYXBpLmpxdWVyeS5jb20vYWZ0ZXIvfVxuICovXG5leHBvcnRzLmFmdGVyID0gZnVuY3Rpb24gKCkge1xuICB2YXIgZWxlbXMgPSBzbGljZS5jYWxsKGFyZ3VtZW50cyk7XG4gIHZhciBsYXN0SWR4ID0gdGhpcy5sZW5ndGggLSAxO1xuXG4gIGRvbUVhY2godGhpcywgZnVuY3Rpb24gKGksIGVsKSB7XG4gICAgdmFyIHBhcmVudCA9IGVsLnBhcmVudDtcbiAgICBpZiAoIXBhcmVudCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHZhciBzaWJsaW5ncyA9IHBhcmVudC5jaGlsZHJlbjtcbiAgICB2YXIgaW5kZXggPSBzaWJsaW5ncy5pbmRleE9mKGVsKTtcbiAgICB2YXIgZG9tU3JjO1xuICAgIHZhciBkb207XG5cbiAgICAvLyBJZiBub3QgZm91bmQsIG1vdmUgb25cbiAgICBpZiAoaW5kZXggPCAwKSByZXR1cm47XG5cbiAgICBpZiAodHlwZW9mIGVsZW1zWzBdID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICBkb21TcmMgPSBlbGVtc1swXS5jYWxsKGVsLCBpLCBodG1sKGVsLmNoaWxkcmVuKSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGRvbVNyYyA9IGVsZW1zO1xuICAgIH1cbiAgICBkb20gPSB0aGlzLl9tYWtlRG9tQXJyYXkoZG9tU3JjLCBpIDwgbGFzdElkeCk7XG5cbiAgICAvLyBBZGQgZWxlbWVudCBhZnRlciBgdGhpc2AgZWxlbWVudFxuICAgIHVuaXF1ZVNwbGljZShzaWJsaW5ncywgaW5kZXggKyAxLCAwLCBkb20sIHBhcmVudCk7XG4gIH0pO1xuXG4gIHJldHVybiB0aGlzO1xufTtcblxuLyoqXG4gKiBJbnNlcnQgZXZlcnkgZWxlbWVudCBpbiB0aGUgc2V0IG9mIG1hdGNoZWQgZWxlbWVudHMgYWZ0ZXIgdGhlIHRhcmdldC5cbiAqXG4gKiBAZXhhbXBsZVxuICpcbiAqICQoJzxsaSBjbGFzcz1cInBsdW1cIj5QbHVtPC9saT4nKS5pbnNlcnRBZnRlcignLmFwcGxlJylcbiAqICQuaHRtbCgpXG4gKiAvLz0+ICA8dWwgaWQ9XCJmcnVpdHNcIj5cbiAqIC8vICAgICAgPGxpIGNsYXNzPVwiYXBwbGVcIj5BcHBsZTwvbGk+XG4gKiAvLyAgICAgIDxsaSBjbGFzcz1cInBsdW1cIj5QbHVtPC9saT5cbiAqIC8vICAgICAgPGxpIGNsYXNzPVwib3JhbmdlXCI+T3JhbmdlPC9saT5cbiAqIC8vICAgICAgPGxpIGNsYXNzPVwicGVhclwiPlBlYXI8L2xpPlxuICogLy8gICAgPC91bD5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ3xjaGVlcmlvfSB0YXJnZXQgLSBFbGVtZW50IHRvIGluc2VydCBlbGVtZW50cyBhZnRlci5cbiAqXG4gKiBAc2VlIHtAbGluayBodHRwOi8vYXBpLmpxdWVyeS5jb20vaW5zZXJ0QWZ0ZXIvfVxuICovXG5leHBvcnRzLmluc2VydEFmdGVyID0gZnVuY3Rpb24gKHRhcmdldCkge1xuICB2YXIgY2xvbmVzID0gW107XG4gIHZhciBzZWxmID0gdGhpcztcbiAgaWYgKHR5cGVvZiB0YXJnZXQgPT09ICdzdHJpbmcnKSB7XG4gICAgdGFyZ2V0ID0gdGhpcy5jb25zdHJ1Y3Rvci5jYWxsKFxuICAgICAgdGhpcy5jb25zdHJ1Y3RvcixcbiAgICAgIHRhcmdldCxcbiAgICAgIG51bGwsXG4gICAgICB0aGlzLl9vcmlnaW5hbFJvb3RcbiAgICApO1xuICB9XG4gIHRhcmdldCA9IHRoaXMuX21ha2VEb21BcnJheSh0YXJnZXQpO1xuICBzZWxmLnJlbW92ZSgpO1xuICBkb21FYWNoKHRhcmdldCwgZnVuY3Rpb24gKGksIGVsKSB7XG4gICAgdmFyIGNsb25lZFNlbGYgPSBzZWxmLl9tYWtlRG9tQXJyYXkoc2VsZi5jbG9uZSgpKTtcbiAgICB2YXIgcGFyZW50ID0gZWwucGFyZW50O1xuICAgIGlmICghcGFyZW50KSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdmFyIHNpYmxpbmdzID0gcGFyZW50LmNoaWxkcmVuO1xuICAgIHZhciBpbmRleCA9IHNpYmxpbmdzLmluZGV4T2YoZWwpO1xuXG4gICAgLy8gSWYgbm90IGZvdW5kLCBtb3ZlIG9uXG4gICAgaWYgKGluZGV4IDwgMCkgcmV0dXJuO1xuXG4gICAgLy8gQWRkIGNsb25lZCBgdGhpc2AgZWxlbWVudChzKSBhZnRlciB0YXJnZXQgZWxlbWVudFxuICAgIHVuaXF1ZVNwbGljZShzaWJsaW5ncywgaW5kZXggKyAxLCAwLCBjbG9uZWRTZWxmLCBwYXJlbnQpO1xuICAgIGNsb25lcy5wdXNoKGNsb25lZFNlbGYpO1xuICB9KTtcbiAgcmV0dXJuIHRoaXMuY29uc3RydWN0b3IuY2FsbCh0aGlzLmNvbnN0cnVjdG9yLCB0aGlzLl9tYWtlRG9tQXJyYXkoY2xvbmVzKSk7XG59O1xuXG4vKipcbiAqIEluc2VydCBjb250ZW50IHByZXZpb3VzIHRvIGVhY2ggZWxlbWVudCBpbiB0aGUgc2V0IG9mIG1hdGNoZWQgZWxlbWVudHMuXG4gKlxuICogQGV4YW1wbGVcbiAqXG4gKiAkKCcuYXBwbGUnKS5iZWZvcmUoJzxsaSBjbGFzcz1cInBsdW1cIj5QbHVtPC9saT4nKVxuICogJC5odG1sKClcbiAqIC8vPT4gIDx1bCBpZD1cImZydWl0c1wiPlxuICogLy8gICAgICA8bGkgY2xhc3M9XCJwbHVtXCI+UGx1bTwvbGk+XG4gKiAvLyAgICAgIDxsaSBjbGFzcz1cImFwcGxlXCI+QXBwbGU8L2xpPlxuICogLy8gICAgICA8bGkgY2xhc3M9XCJvcmFuZ2VcIj5PcmFuZ2U8L2xpPlxuICogLy8gICAgICA8bGkgY2xhc3M9XCJwZWFyXCI+UGVhcjwvbGk+XG4gKiAvLyAgICA8L3VsPlxuICpcbiAqIEBzZWUge0BsaW5rIGh0dHA6Ly9hcGkuanF1ZXJ5LmNvbS9iZWZvcmUvfVxuICovXG5leHBvcnRzLmJlZm9yZSA9IGZ1bmN0aW9uICgpIHtcbiAgdmFyIGVsZW1zID0gc2xpY2UuY2FsbChhcmd1bWVudHMpO1xuICB2YXIgbGFzdElkeCA9IHRoaXMubGVuZ3RoIC0gMTtcblxuICBkb21FYWNoKHRoaXMsIGZ1bmN0aW9uIChpLCBlbCkge1xuICAgIHZhciBwYXJlbnQgPSBlbC5wYXJlbnQ7XG4gICAgaWYgKCFwYXJlbnQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB2YXIgc2libGluZ3MgPSBwYXJlbnQuY2hpbGRyZW47XG4gICAgdmFyIGluZGV4ID0gc2libGluZ3MuaW5kZXhPZihlbCk7XG4gICAgdmFyIGRvbVNyYztcbiAgICB2YXIgZG9tO1xuXG4gICAgLy8gSWYgbm90IGZvdW5kLCBtb3ZlIG9uXG4gICAgaWYgKGluZGV4IDwgMCkgcmV0dXJuO1xuXG4gICAgaWYgKHR5cGVvZiBlbGVtc1swXSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgZG9tU3JjID0gZWxlbXNbMF0uY2FsbChlbCwgaSwgaHRtbChlbC5jaGlsZHJlbikpO1xuICAgIH0gZWxzZSB7XG4gICAgICBkb21TcmMgPSBlbGVtcztcbiAgICB9XG5cbiAgICBkb20gPSB0aGlzLl9tYWtlRG9tQXJyYXkoZG9tU3JjLCBpIDwgbGFzdElkeCk7XG5cbiAgICAvLyBBZGQgZWxlbWVudCBiZWZvcmUgYGVsYCBlbGVtZW50XG4gICAgdW5pcXVlU3BsaWNlKHNpYmxpbmdzLCBpbmRleCwgMCwgZG9tLCBwYXJlbnQpO1xuICB9KTtcblxuICByZXR1cm4gdGhpcztcbn07XG5cbi8qKlxuICogSW5zZXJ0IGV2ZXJ5IGVsZW1lbnQgaW4gdGhlIHNldCBvZiBtYXRjaGVkIGVsZW1lbnRzIGJlZm9yZSB0aGUgdGFyZ2V0LlxuICpcbiAqIEBleGFtcGxlXG4gKlxuICogJCgnPGxpIGNsYXNzPVwicGx1bVwiPlBsdW08L2xpPicpLmluc2VydEJlZm9yZSgnLmFwcGxlJylcbiAqICQuaHRtbCgpXG4gKiAvLz0+ICA8dWwgaWQ9XCJmcnVpdHNcIj5cbiAqIC8vICAgICAgPGxpIGNsYXNzPVwicGx1bVwiPlBsdW08L2xpPlxuICogLy8gICAgICA8bGkgY2xhc3M9XCJhcHBsZVwiPkFwcGxlPC9saT5cbiAqIC8vICAgICAgPGxpIGNsYXNzPVwib3JhbmdlXCI+T3JhbmdlPC9saT5cbiAqIC8vICAgICAgPGxpIGNsYXNzPVwicGVhclwiPlBlYXI8L2xpPlxuICogLy8gICAgPC91bD5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ3xjaGVlcmlvfSB0YXJnZXQgLSBFbGVtZW50IHRvIGluc2VydCBlbGVtZW50cyBiZWZvcmUuXG4gKlxuICogQHNlZSB7QGxpbmsgaHR0cDovL2FwaS5qcXVlcnkuY29tL2luc2VydEJlZm9yZS99XG4gKi9cbmV4cG9ydHMuaW5zZXJ0QmVmb3JlID0gZnVuY3Rpb24gKHRhcmdldCkge1xuICB2YXIgY2xvbmVzID0gW107XG4gIHZhciBzZWxmID0gdGhpcztcbiAgaWYgKHR5cGVvZiB0YXJnZXQgPT09ICdzdHJpbmcnKSB7XG4gICAgdGFyZ2V0ID0gdGhpcy5jb25zdHJ1Y3Rvci5jYWxsKFxuICAgICAgdGhpcy5jb25zdHJ1Y3RvcixcbiAgICAgIHRhcmdldCxcbiAgICAgIG51bGwsXG4gICAgICB0aGlzLl9vcmlnaW5hbFJvb3RcbiAgICApO1xuICB9XG4gIHRhcmdldCA9IHRoaXMuX21ha2VEb21BcnJheSh0YXJnZXQpO1xuICBzZWxmLnJlbW92ZSgpO1xuICBkb21FYWNoKHRhcmdldCwgZnVuY3Rpb24gKGksIGVsKSB7XG4gICAgdmFyIGNsb25lZFNlbGYgPSBzZWxmLl9tYWtlRG9tQXJyYXkoc2VsZi5jbG9uZSgpKTtcbiAgICB2YXIgcGFyZW50ID0gZWwucGFyZW50O1xuICAgIGlmICghcGFyZW50KSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdmFyIHNpYmxpbmdzID0gcGFyZW50LmNoaWxkcmVuO1xuICAgIHZhciBpbmRleCA9IHNpYmxpbmdzLmluZGV4T2YoZWwpO1xuXG4gICAgLy8gSWYgbm90IGZvdW5kLCBtb3ZlIG9uXG4gICAgaWYgKGluZGV4IDwgMCkgcmV0dXJuO1xuXG4gICAgLy8gQWRkIGNsb25lZCBgdGhpc2AgZWxlbWVudChzKSBhZnRlciB0YXJnZXQgZWxlbWVudFxuICAgIHVuaXF1ZVNwbGljZShzaWJsaW5ncywgaW5kZXgsIDAsIGNsb25lZFNlbGYsIHBhcmVudCk7XG4gICAgY2xvbmVzLnB1c2goY2xvbmVkU2VsZik7XG4gIH0pO1xuICByZXR1cm4gdGhpcy5jb25zdHJ1Y3Rvci5jYWxsKHRoaXMuY29uc3RydWN0b3IsIHRoaXMuX21ha2VEb21BcnJheShjbG9uZXMpKTtcbn07XG5cbi8qKlxuICogUmVtb3ZlcyB0aGUgc2V0IG9mIG1hdGNoZWQgZWxlbWVudHMgZnJvbSB0aGUgRE9NIGFuZCBhbGwgdGhlaXIgY2hpbGRyZW4uXG4gKiBgc2VsZWN0b3JgIGZpbHRlcnMgdGhlIHNldCBvZiBtYXRjaGVkIGVsZW1lbnRzIHRvIGJlIHJlbW92ZWQuXG4gKlxuICogQGV4YW1wbGVcbiAqXG4gKiAkKCcucGVhcicpLnJlbW92ZSgpXG4gKiAkLmh0bWwoKVxuICogLy89PiAgPHVsIGlkPVwiZnJ1aXRzXCI+XG4gKiAvLyAgICAgIDxsaSBjbGFzcz1cImFwcGxlXCI+QXBwbGU8L2xpPlxuICogLy8gICAgICA8bGkgY2xhc3M9XCJvcmFuZ2VcIj5PcmFuZ2U8L2xpPlxuICogLy8gICAgPC91bD5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gW3NlbGVjdG9yXSAtIE9wdGlvbmFsIHNlbGVjdG9yIGZvciBlbGVtZW50cyB0byByZW1vdmUuXG4gKlxuICogQHNlZSB7QGxpbmsgaHR0cDovL2FwaS5qcXVlcnkuY29tL3JlbW92ZS99XG4gKi9cbmV4cG9ydHMucmVtb3ZlID0gZnVuY3Rpb24gKHNlbGVjdG9yKSB7XG4gIHZhciBlbGVtcyA9IHRoaXM7XG5cbiAgLy8gRmlsdGVyIGlmIHdlIGhhdmUgc2VsZWN0b3JcbiAgaWYgKHNlbGVjdG9yKSBlbGVtcyA9IGVsZW1zLmZpbHRlcihzZWxlY3Rvcik7XG5cbiAgZG9tRWFjaChlbGVtcywgZnVuY3Rpb24gKGksIGVsKSB7XG4gICAgRG9tVXRpbHMucmVtb3ZlRWxlbWVudChlbCk7XG4gICAgZWwucHJldiA9IGVsLm5leHQgPSBlbC5wYXJlbnQgPSBudWxsO1xuICB9KTtcblxuICByZXR1cm4gdGhpcztcbn07XG5cbi8qKlxuICogUmVwbGFjZXMgbWF0Y2hlZCBlbGVtZW50cyB3aXRoIGBjb250ZW50YC5cbiAqXG4gKiBAZXhhbXBsZVxuICpcbiAqIGNvbnN0IHBsdW0gPSAkKCc8bGkgY2xhc3M9XCJwbHVtXCI+UGx1bTwvbGk+JylcbiAqICQoJy5wZWFyJykucmVwbGFjZVdpdGgocGx1bSlcbiAqICQuaHRtbCgpXG4gKiAvLz0+IDx1bCBpZD1cImZydWl0c1wiPlxuICogLy8gICAgIDxsaSBjbGFzcz1cImFwcGxlXCI+QXBwbGU8L2xpPlxuICogLy8gICAgIDxsaSBjbGFzcz1cIm9yYW5nZVwiPk9yYW5nZTwvbGk+XG4gKiAvLyAgICAgPGxpIGNsYXNzPVwicGx1bVwiPlBsdW08L2xpPlxuICogLy8gICA8L3VsPlxuICpcbiAqIEBwYXJhbSB7Y2hlZXJpb3xGdW5jdGlvbn0gY29udGVudCAtIFJlcGxhY2VtZW50IGZvciBtYXRjaGVkIGVsZW1lbnRzLlxuICpcbiAqIEBzZWUge0BsaW5rIGh0dHA6Ly9hcGkuanF1ZXJ5LmNvbS9yZXBsYWNlV2l0aC99XG4gKi9cbmV4cG9ydHMucmVwbGFjZVdpdGggPSBmdW5jdGlvbiAoY29udGVudCkge1xuICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgZG9tRWFjaCh0aGlzLCBmdW5jdGlvbiAoaSwgZWwpIHtcbiAgICB2YXIgcGFyZW50ID0gZWwucGFyZW50O1xuICAgIGlmICghcGFyZW50KSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdmFyIHNpYmxpbmdzID0gcGFyZW50LmNoaWxkcmVuO1xuICAgIHZhciBkb20gPSBzZWxmLl9tYWtlRG9tQXJyYXkoXG4gICAgICB0eXBlb2YgY29udGVudCA9PT0gJ2Z1bmN0aW9uJyA/IGNvbnRlbnQuY2FsbChlbCwgaSwgZWwpIDogY29udGVudFxuICAgICk7XG4gICAgdmFyIGluZGV4O1xuXG4gICAgLy8gSW4gdGhlIGNhc2UgdGhhdCBgZG9tYCBjb250YWlucyBub2RlcyB0aGF0IGFscmVhZHkgZXhpc3QgaW4gb3RoZXJcbiAgICAvLyBzdHJ1Y3R1cmVzLCBlbnN1cmUgdGhvc2Ugbm9kZXMgYXJlIHByb3Blcmx5IHJlbW92ZWQuXG4gICAgdXBkYXRlRE9NKGRvbSwgbnVsbCk7XG5cbiAgICBpbmRleCA9IHNpYmxpbmdzLmluZGV4T2YoZWwpO1xuXG4gICAgLy8gQ29tcGxldGVseSByZW1vdmUgb2xkIGVsZW1lbnRcbiAgICB1bmlxdWVTcGxpY2Uoc2libGluZ3MsIGluZGV4LCAxLCBkb20sIHBhcmVudCk7XG4gICAgZWwucGFyZW50ID0gZWwucHJldiA9IGVsLm5leHQgPSBudWxsO1xuICB9KTtcblxuICByZXR1cm4gdGhpcztcbn07XG5cbi8qKlxuICogRW1wdGllcyBhbiBlbGVtZW50LCByZW1vdmluZyBhbGwgaXRzIGNoaWxkcmVuLlxuICpcbiAqIEBleGFtcGxlXG4gKlxuICogJCgndWwnKS5lbXB0eSgpXG4gKiAkLmh0bWwoKVxuICogLy89PiAgPHVsIGlkPVwiZnJ1aXRzXCI+PC91bD5cbiAqXG4gKiBAc2VlIHtAbGluayBodHRwOi8vYXBpLmpxdWVyeS5jb20vZW1wdHkvfVxuICovXG5leHBvcnRzLmVtcHR5ID0gZnVuY3Rpb24gKCkge1xuICBkb21FYWNoKHRoaXMsIGZ1bmN0aW9uIChpLCBlbCkge1xuICAgIGVsLmNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24gKGNoaWxkKSB7XG4gICAgICBjaGlsZC5uZXh0ID0gY2hpbGQucHJldiA9IGNoaWxkLnBhcmVudCA9IG51bGw7XG4gICAgfSk7XG5cbiAgICBlbC5jaGlsZHJlbi5sZW5ndGggPSAwO1xuICB9KTtcbiAgcmV0dXJuIHRoaXM7XG59O1xuXG4vKipcbiAqIEdldHMgYW4gSFRNTCBjb250ZW50IHN0cmluZyBmcm9tIHRoZSBmaXJzdCBzZWxlY3RlZCBlbGVtZW50LiBJZiBgaHRtbFN0cmluZ2BcbiAqIGlzIHNwZWNpZmllZCwgZWFjaCBzZWxlY3RlZCBlbGVtZW50J3MgY29udGVudCBpcyByZXBsYWNlZCBieSB0aGUgbmV3XG4gKiBjb250ZW50LlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBzdHIgLSBJZiBzcGVjaWZpZWQgdXNlZCB0byByZXBsYWNlIHNlbGVjdGlvbidzIGNvbnRlbnRzLlxuICpcbiAqIEBleGFtcGxlXG4gKlxuICogJCgnLm9yYW5nZScpLmh0bWwoKVxuICogLy89PiBPcmFuZ2VcbiAqXG4gKiAkKCcjZnJ1aXRzJykuaHRtbCgnPGxpIGNsYXNzPVwibWFuZ29cIj5NYW5nbzwvbGk+JykuaHRtbCgpXG4gKiAvLz0+IDxsaSBjbGFzcz1cIm1hbmdvXCI+TWFuZ288L2xpPlxuICpcbiAqIEBzZWUge0BsaW5rIGh0dHA6Ly9hcGkuanF1ZXJ5LmNvbS9odG1sL31cbiAqL1xuZXhwb3J0cy5odG1sID0gZnVuY3Rpb24gKHN0cikge1xuICBpZiAoc3RyID09PSB1bmRlZmluZWQpIHtcbiAgICBpZiAoIXRoaXNbMF0gfHwgIXRoaXNbMF0uY2hpbGRyZW4pIHJldHVybiBudWxsO1xuICAgIHJldHVybiBodG1sKHRoaXNbMF0uY2hpbGRyZW4sIHRoaXMub3B0aW9ucyk7XG4gIH1cblxuICB2YXIgb3B0cyA9IHRoaXMub3B0aW9ucztcblxuICBkb21FYWNoKHRoaXMsIGZ1bmN0aW9uIChpLCBlbCkge1xuICAgIGVsLmNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24gKGNoaWxkKSB7XG4gICAgICBjaGlsZC5uZXh0ID0gY2hpbGQucHJldiA9IGNoaWxkLnBhcmVudCA9IG51bGw7XG4gICAgfSk7XG5cbiAgICB2YXIgY29udGVudCA9IHN0ci5jaGVlcmlvXG4gICAgICA/IHN0ci5jbG9uZSgpLmdldCgpXG4gICAgICA6IHBhcnNlKCcnICsgc3RyLCBvcHRzLCBmYWxzZSkuY2hpbGRyZW47XG5cbiAgICB1cGRhdGVET00oY29udGVudCwgZWwpO1xuICB9KTtcblxuICByZXR1cm4gdGhpcztcbn07XG5cbmV4cG9ydHMudG9TdHJpbmcgPSBmdW5jdGlvbiAoKSB7XG4gIHJldHVybiBodG1sKHRoaXMsIHRoaXMub3B0aW9ucyk7XG59O1xuXG4vKipcbiAqIEdldCB0aGUgY29tYmluZWQgdGV4dCBjb250ZW50cyBvZiBlYWNoIGVsZW1lbnQgaW4gdGhlIHNldCBvZiBtYXRjaGVkXG4gKiBlbGVtZW50cywgaW5jbHVkaW5nIHRoZWlyIGRlc2NlbmRhbnRzLiBJZiBgdGV4dFN0cmluZ2AgaXMgc3BlY2lmaWVkLCBlYWNoXG4gKiBzZWxlY3RlZCBlbGVtZW50J3MgY29udGVudCBpcyByZXBsYWNlZCBieSB0aGUgbmV3IHRleHQgY29udGVudC5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gW3N0cl0gLSBJZiBzcGVjaWZpZWQgcmVwbGFjZW1lbnQgZm9yIHRoZSBzZWxlY3RlZCBlbGVtZW50J3MgY29udGVudHMuXG4gKlxuICogQGV4YW1wbGVcbiAqXG4gKiAkKCcub3JhbmdlJykudGV4dCgpXG4gKiAvLz0+IE9yYW5nZVxuICpcbiAqICQoJ3VsJykudGV4dCgpXG4gKiAvLz0+ICBBcHBsZVxuICogLy8gICAgT3JhbmdlXG4gKiAvLyAgICBQZWFyXG4gKlxuICogQHNlZSB7QGxpbmsgaHR0cDovL2FwaS5qcXVlcnkuY29tL3RleHQvfVxuICovXG5leHBvcnRzLnRleHQgPSBmdW5jdGlvbiAoc3RyKSB7XG4gIC8vIElmIGBzdHJgIGlzIHVuZGVmaW5lZCwgYWN0IGFzIGEgXCJnZXR0ZXJcIlxuICBpZiAoc3RyID09PSB1bmRlZmluZWQpIHtcbiAgICByZXR1cm4gdGV4dCh0aGlzKTtcbiAgfSBlbHNlIGlmICh0eXBlb2Ygc3RyID09PSAnZnVuY3Rpb24nKSB7XG4gICAgLy8gRnVuY3Rpb24gc3VwcG9ydFxuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICByZXR1cm4gZG9tRWFjaCh0aGlzLCBmdW5jdGlvbiAoaSwgZWwpIHtcbiAgICAgIHJldHVybiBleHBvcnRzLnRleHQuY2FsbChzZWxmLl9tYWtlKGVsKSwgc3RyLmNhbGwoZWwsIGksIHRleHQoW2VsXSkpKTtcbiAgICB9KTtcbiAgfVxuXG4gIC8vIEFwcGVuZCB0ZXh0IG5vZGUgdG8gZWFjaCBzZWxlY3RlZCBlbGVtZW50c1xuICBkb21FYWNoKHRoaXMsIGZ1bmN0aW9uIChpLCBlbCkge1xuICAgIGVsLmNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24gKGNoaWxkKSB7XG4gICAgICBjaGlsZC5uZXh0ID0gY2hpbGQucHJldiA9IGNoaWxkLnBhcmVudCA9IG51bGw7XG4gICAgfSk7XG5cbiAgICB2YXIgdGV4dE5vZGUgPSBuZXcgZG9taGFuZGxlci5UZXh0KHN0cik7XG5cbiAgICB1cGRhdGVET00odGV4dE5vZGUsIGVsKTtcbiAgfSk7XG5cbiAgcmV0dXJuIHRoaXM7XG59O1xuXG4vKipcbiAqIENsb25lIHRoZSBjaGVlcmlvIG9iamVjdC5cbiAqXG4gKiBAZXhhbXBsZVxuICpcbiAqIGNvbnN0IG1vcmVGcnVpdCA9ICQoJyNmcnVpdHMnKS5jbG9uZSgpXG4gKlxuICogQHNlZSB7QGxpbmsgaHR0cDovL2FwaS5qcXVlcnkuY29tL2Nsb25lL31cbiAqL1xuZXhwb3J0cy5jbG9uZSA9IGZ1bmN0aW9uICgpIHtcbiAgcmV0dXJuIHRoaXMuX21ha2UoY2xvbmVEb20odGhpcy5nZXQoKSwgdGhpcy5vcHRpb25zKSk7XG59O1xuIl19