15c3f638c42e819b15daf1ebab7bf422
"use strict";

var __importDefault = this && this.__importDefault || function (mod) {
  return mod && mod.__esModule ? mod : {
    "default": mod
  };
};

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.filters = void 0;

var nth_check_1 = __importDefault(require("nth-check"));

var boolbase_1 = require("boolbase");

var attributes_1 = require("../attributes");

var checkAttrib = attributes_1.attributeRules.equals;

function getAttribFunc(name, value) {
  var data = {
    type: "attribute",
    action: "equals",
    ignoreCase: false,
    namespace: null,
    name: name,
    value: value
  };
  return function attribFunc(next, _rule, options) {
    return checkAttrib(next, data, options);
  };
}

function getChildFunc(next, adapter) {
  return function (elem) {
    var parent = adapter.getParent(elem);
    return !!parent && adapter.isTag(parent) && next(elem);
  };
}

exports.filters = {
  contains: function contains(next, text, _a) {
    var adapter = _a.adapter;
    return function contains(elem) {
      return next(elem) && adapter.getText(elem).includes(text);
    };
  },
  icontains: function icontains(next, text, _a) {
    var adapter = _a.adapter;
    var itext = text.toLowerCase();
    return function icontains(elem) {
      return next(elem) && adapter.getText(elem).toLowerCase().includes(itext);
    };
  },
  "nth-child": function nthChild(next, rule, _a) {
    var adapter = _a.adapter,
        equals = _a.equals;
    var func = nth_check_1.default(rule);
    if (func === boolbase_1.falseFunc) return boolbase_1.falseFunc;
    if (func === boolbase_1.trueFunc) return getChildFunc(next, adapter);
    return function nthChild(elem) {
      var siblings = adapter.getSiblings(elem);
      var pos = 0;

      for (var i = 0; i < siblings.length; i++) {
        if (equals(elem, siblings[i])) break;

        if (adapter.isTag(siblings[i])) {
          pos++;
        }
      }

      return func(pos) && next(elem);
    };
  },
  "nth-last-child": function nthLastChild(next, rule, _a) {
    var adapter = _a.adapter,
        equals = _a.equals;
    var func = nth_check_1.default(rule);
    if (func === boolbase_1.falseFunc) return boolbase_1.falseFunc;
    if (func === boolbase_1.trueFunc) return getChildFunc(next, adapter);
    return function nthLastChild(elem) {
      var siblings = adapter.getSiblings(elem);
      var pos = 0;

      for (var i = siblings.length - 1; i >= 0; i--) {
        if (equals(elem, siblings[i])) break;

        if (adapter.isTag(siblings[i])) {
          pos++;
        }
      }

      return func(pos) && next(elem);
    };
  },
  "nth-of-type": function nthOfType(next, rule, _a) {
    var adapter = _a.adapter,
        equals = _a.equals;
    var func = nth_check_1.default(rule);
    if (func === boolbase_1.falseFunc) return boolbase_1.falseFunc;
    if (func === boolbase_1.trueFunc) return getChildFunc(next, adapter);
    return function nthOfType(elem) {
      var siblings = adapter.getSiblings(elem);
      var pos = 0;

      for (var i = 0; i < siblings.length; i++) {
        var currentSibling = siblings[i];
        if (equals(elem, currentSibling)) break;

        if (adapter.isTag(currentSibling) && adapter.getName(currentSibling) === adapter.getName(elem)) {
          pos++;
        }
      }

      return func(pos) && next(elem);
    };
  },
  "nth-last-of-type": function nthLastOfType(next, rule, _a) {
    var adapter = _a.adapter,
        equals = _a.equals;
    var func = nth_check_1.default(rule);
    if (func === boolbase_1.falseFunc) return boolbase_1.falseFunc;
    if (func === boolbase_1.trueFunc) return getChildFunc(next, adapter);
    return function nthLastOfType(elem) {
      var siblings = adapter.getSiblings(elem);
      var pos = 0;

      for (var i = siblings.length - 1; i >= 0; i--) {
        var currentSibling = siblings[i];
        if (equals(elem, currentSibling)) break;

        if (adapter.isTag(currentSibling) && adapter.getName(currentSibling) === adapter.getName(elem)) {
          pos++;
        }
      }

      return func(pos) && next(elem);
    };
  },
  root: function root(next, _rule, _a) {
    var adapter = _a.adapter;
    return function (elem) {
      var parent = adapter.getParent(elem);
      return (parent == null || !adapter.isTag(parent)) && next(elem);
    };
  },
  scope: function scope(next, rule, options, context) {
    var equals = options.equals;

    if (!context || context.length === 0) {
      return exports.filters.root(next, rule, options);
    }

    if (context.length === 1) {
      return function (elem) {
        return equals(context[0], elem) && next(elem);
      };
    }

    return function (elem) {
      return context.includes(elem) && next(elem);
    };
  },
  checkbox: getAttribFunc("type", "checkbox"),
  file: getAttribFunc("type", "file"),
  password: getAttribFunc("type", "password"),
  radio: getAttribFunc("type", "radio"),
  reset: getAttribFunc("type", "reset"),
  image: getAttribFunc("type", "image"),
  submit: getAttribFunc("type", "submit"),
  hover: function hover(next, _rule, _a) {
    var adapter = _a.adapter;
    var isHovered = adapter.isHovered;

    if (typeof isHovered !== "function") {
      return boolbase_1.falseFunc;
    }

    return function hover(elem) {
      return isHovered(elem) && next(elem);
    };
  },
  visited: function visited(next, _rule, _a) {
    var adapter = _a.adapter;
    var isVisited = adapter.isVisited;

    if (typeof isVisited !== "function") {
      return boolbase_1.falseFunc;
    }

    return function visited(elem) {
      return isVisited(elem) && next(elem);
    };
  },
  active: function active(next, _rule, _a) {
    var adapter = _a.adapter;
    var isActive = adapter.isActive;

    if (typeof isActive !== "function") {
      return boolbase_1.falseFunc;
    }

    return function active(elem) {
      return isActive(elem) && next(elem);
    };
  }
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImZpbHRlcnMuanMiXSwibmFtZXMiOlsiX19pbXBvcnREZWZhdWx0IiwibW9kIiwiX19lc01vZHVsZSIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZXhwb3J0cyIsInZhbHVlIiwiZmlsdGVycyIsIm50aF9jaGVja18xIiwicmVxdWlyZSIsImJvb2xiYXNlXzEiLCJhdHRyaWJ1dGVzXzEiLCJjaGVja0F0dHJpYiIsImF0dHJpYnV0ZVJ1bGVzIiwiZXF1YWxzIiwiZ2V0QXR0cmliRnVuYyIsIm5hbWUiLCJkYXRhIiwidHlwZSIsImFjdGlvbiIsImlnbm9yZUNhc2UiLCJuYW1lc3BhY2UiLCJhdHRyaWJGdW5jIiwibmV4dCIsIl9ydWxlIiwib3B0aW9ucyIsImdldENoaWxkRnVuYyIsImFkYXB0ZXIiLCJlbGVtIiwicGFyZW50IiwiZ2V0UGFyZW50IiwiaXNUYWciLCJjb250YWlucyIsInRleHQiLCJfYSIsImdldFRleHQiLCJpbmNsdWRlcyIsImljb250YWlucyIsIml0ZXh0IiwidG9Mb3dlckNhc2UiLCJydWxlIiwiZnVuYyIsImRlZmF1bHQiLCJmYWxzZUZ1bmMiLCJ0cnVlRnVuYyIsIm50aENoaWxkIiwic2libGluZ3MiLCJnZXRTaWJsaW5ncyIsInBvcyIsImkiLCJsZW5ndGgiLCJudGhMYXN0Q2hpbGQiLCJudGhPZlR5cGUiLCJjdXJyZW50U2libGluZyIsImdldE5hbWUiLCJudGhMYXN0T2ZUeXBlIiwicm9vdCIsInNjb3BlIiwiY29udGV4dCIsImNoZWNrYm94IiwiZmlsZSIsInBhc3N3b3JkIiwicmFkaW8iLCJyZXNldCIsImltYWdlIiwic3VibWl0IiwiaG92ZXIiLCJpc0hvdmVyZWQiLCJ2aXNpdGVkIiwiaXNWaXNpdGVkIiwiYWN0aXZlIiwiaXNBY3RpdmUiXSwibWFwcGluZ3MiOiJBQUFBOztBQUNBLElBQUlBLGVBQWUsR0FBSSxRQUFRLEtBQUtBLGVBQWQsSUFBa0MsVUFBVUMsR0FBVixFQUFlO0FBQ25FLFNBQVFBLEdBQUcsSUFBSUEs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QjtBQUMvQixRQUFJUCxPQUFPLEdBQUdPLEVBQUUsQ0FBQ1AsT0FBakI7QUFDQSxRQUFJNEMsUUFBUSxHQUFHNUMsT0FBTyxDQUFDNEMsUUFBdkI7O0FBQ0EsUUFBSSxPQUFPQSxRQUFQLEtBQW9CLFVBQXhCLEVBQW9DO0FBQ2hDLGFBQU83RCxVQUFVLENBQUNpQyxTQUFsQjtBQUNIOztBQUNELFdBQU8sU0FBUzJCLE1BQVQsQ0FBZ0IxQyxJQUFoQixFQUFzQjtBQUN6QixhQUFPMkMsUUFBUSxDQUFDM0MsSUFBRCxDQUFSLElBQWtCTCxJQUFJLENBQUNLLElBQUQsQ0FBN0I7QUFDSCxLQUZEO0FBR0g7QUE5SmEsQ0FBbEIiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2ltcG9ydERlZmF1bHQgPSAodGhpcyAmJiB0aGlzLl9faW1wb3J0RGVmYXVsdCkgfHwgZnVuY3Rpb24gKG1vZCkge1xuICAgIHJldHVybiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSA/IG1vZCA6IHsgXCJkZWZhdWx0XCI6IG1vZCB9O1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuZmlsdGVycyA9IHZvaWQgMDtcbnZhciBudGhfY2hlY2tfMSA9IF9faW1wb3J0RGVmYXVsdChyZXF1aXJlKFwibnRoLWNoZWNrXCIpKTtcbnZhciBib29sYmFzZV8xID0gcmVxdWlyZShcImJvb2xiYXNlXCIpO1xudmFyIGF0dHJpYnV0ZXNfMSA9IHJlcXVpcmUoXCIuLi9hdHRyaWJ1dGVzXCIpO1xudmFyIGNoZWNrQXR0cmliID0gYXR0cmlidXRlc18xLmF0dHJpYnV0ZVJ1bGVzLmVxdWFscztcbmZ1bmN0aW9uIGdldEF0dHJpYkZ1bmMobmFtZSwgdmFsdWUpIHtcbiAgICB2YXIgZGF0YSA9IHtcbiAgICAgICAgdHlwZTogXCJhdHRyaWJ1dGVcIixcbiAgICAgICAgYWN0aW9uOiBcImVxdWFsc1wiLFxuICAgICAgICBpZ25vcmVDYXNlOiBmYWxzZSxcbiAgICAgICAgbmFtZXNwYWNlOiBudWxsLFxuICAgICAgICBuYW1lOiBuYW1lLFxuICAgICAgICB2YWx1ZTogdmFsdWUsXG4gICAgfTtcbiAgICByZXR1cm4gZnVuY3Rpb24gYXR0cmliRnVuYyhuZXh0LCBfcnVsZSwgb3B0aW9ucykge1xuICAgICAgICByZXR1cm4gY2hlY2tBdHRyaWIobmV4dCwgZGF0YSwgb3B0aW9ucyk7XG4gICAgfTtcbn1cbmZ1bmN0aW9uIGdldENoaWxkRnVuYyhuZXh0LCBhZGFwdGVyKSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uIChlbGVtKSB7XG4gICAgICAgIHZhciBwYXJlbnQgPSBhZGFwdGVyLmdldFBhcmVudChlbGVtKTtcbiAgICAgICAgcmV0dXJuICEhcGFyZW50ICYmIGFkYXB0ZXIuaXNUYWcocGFyZW50KSAmJiBuZXh0KGVsZW0pO1xuICAgIH07XG59XG5leHBvcnRzLmZpbHRlcnMgPSB7XG4gICAgY29udGFpbnM6IGZ1bmN0aW9uIChuZXh0LCB0ZXh0LCBfYSkge1xuICAgICAgICB2YXIgYWRhcHRlciA9IF9hLmFkYXB0ZXI7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiBjb250YWlucyhlbGVtKSB7XG4gICAgICAgICAgICByZXR1cm4gbmV4dChlbGVtKSAmJiBhZGFwdGVyLmdldFRleHQoZWxlbSkuaW5jbHVkZXModGV4dCk7XG4gICAgICAgIH07XG4gICAgfSxcbiAgICBpY29udGFpbnM6IGZ1bmN0aW9uIChuZXh0LCB0ZXh0LCBfYSkge1xuICAgICAgICB2YXIgYWRhcHRlciA9IF9hLmFkYXB0ZXI7XG4gICAgICAgIHZhciBpdGV4dCA9IHRleHQudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIGljb250YWlucyhlbGVtKSB7XG4gICAgICAgICAgICByZXR1cm4gKG5leHQoZWxlbSkgJiZcbiAgICAgICAgICAgICAgICBhZGFwdGVyLmdldFRleHQoZWxlbSkudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhpdGV4dCkpO1xuICAgICAgICB9O1xuICAgIH0sXG4gICAgLy8gTG9jYXRpb24gc3BlY2lmaWMgbWV0aG9kc1xuICAgIFwibnRoLWNoaWxkXCI6IGZ1bmN0aW9uIChuZXh0LCBydWxlLCBfYSkge1xuICAgICAgICB2YXIgYWRhcHRlciA9IF9hLmFkYXB0ZXIsIGVxdWFscyA9IF9hLmVxdWFscztcbiAgICAgICAgdmFyIGZ1bmMgPSBudGhfY2hlY2tfMS5kZWZhdWx0KHJ1bGUpO1xuICAgICAgICBpZiAoZnVuYyA9PT0gYm9vbGJhc2VfMS5mYWxzZUZ1bmMpXG4gICAgICAgICAgICByZXR1cm4gYm9vbGJhc2VfMS5mYWxzZUZ1bmM7XG4gICAgICAgIGlmIChmdW5jID09PSBib29sYmFzZV8xLnRydWVGdW5jKVxuICAgICAgICAgICAgcmV0dXJuIGdldENoaWxkRnVuYyhuZXh0LCBhZGFwdGVyKTtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIG50aENoaWxkKGVsZW0pIHtcbiAgICAgICAgICAgIHZhciBzaWJsaW5ncyA9IGFkYXB0ZXIuZ2V0U2libGluZ3MoZWxlbSk7XG4gICAgICAgICAgICB2YXIgcG9zID0gMDtcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2libGluZ3MubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICBpZiAoZXF1YWxzKGVsZW0sIHNpYmxpbmdzW2ldKSlcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgaWYgKGFkYXB0ZXIuaXNUYWcoc2libGluZ3NbaV0pKSB7XG4gICAgICAgICAgICAgICAgICAgIHBvcysrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBmdW5jKHBvcykgJiYgbmV4dChlbGVtKTtcbiAgICAgICAgfTtcbiAgICB9LFxuICAgIFwibnRoLWxhc3QtY2hpbGRcIjogZnVuY3Rpb24gKG5leHQsIHJ1bGUsIF9hKSB7XG4gICAgICAgIHZhciBhZGFwdGVyID0gX2EuYWRhcHRlciwgZXF1YWxzID0gX2EuZXF1YWxzO1xuICAgICAgICB2YXIgZnVuYyA9IG50aF9jaGVja18xLmRlZmF1bHQocnVsZSk7XG4gICAgICAgIGlmIChmdW5jID09PSBib29sYmFzZV8xLmZhbHNlRnVuYylcbiAgICAgICAgICAgIHJldHVybiBib29sYmFzZV8xLmZhbHNlRnVuYztcbiAgICAgICAgaWYgKGZ1bmMgPT09IGJvb2xiYXNlXzEudHJ1ZUZ1bmMpXG4gICAgICAgICAgICByZXR1cm4gZ2V0Q2hpbGRGdW5jKG5leHQsIGFkYXB0ZXIpO1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24gbnRoTGFzdENoaWxkKGVsZW0pIHtcbiAgICAgICAgICAgIHZhciBzaWJsaW5ncyA9IGFkYXB0ZXIuZ2V0U2libGluZ3MoZWxlbSk7XG4gICAgICAgICAgICB2YXIgcG9zID0gMDtcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSBzaWJsaW5ncy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuICAgICAgICAgICAgICAgIGlmIChlcXVhbHMoZWxlbSwgc2libGluZ3NbaV0pKVxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBpZiAoYWRhcHRlci5pc1RhZyhzaWJsaW5nc1tpXSkpIHtcbiAgICAgICAgICAgICAgICAgICAgcG9zKys7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGZ1bmMocG9zKSAmJiBuZXh0KGVsZW0pO1xuICAgICAgICB9O1xuICAgIH0sXG4gICAgXCJudGgtb2YtdHlwZVwiOiBmdW5jdGlvbiAobmV4dCwgcnVsZSwgX2EpIHtcbiAgICAgICAgdmFyIGFkYXB0ZXIgPSBfYS5hZGFwdGVyLCBlcXVhbHMgPSBfYS5lcXVhbHM7XG4gICAgICAgIHZhciBmdW5jID0gbnRoX2NoZWNrXzEuZGVmYXVsdChydWxlKTtcbiAgICAgICAgaWYgKGZ1bmMgPT09IGJvb2xiYXNlXzEuZmFsc2VGdW5jKVxuICAgICAgICAgICAgcmV0dXJuIGJvb2xiYXNlXzEuZmFsc2VGdW5jO1xuICAgICAgICBpZiAoZnVuYyA9PT0gYm9vbGJhc2VfMS50cnVlRnVuYylcbiAgICAgICAgICAgIHJldHVybiBnZXRDaGlsZEZ1bmMobmV4dCwgYWRhcHRlcik7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiBudGhPZlR5cGUoZWxlbSkge1xuICAgICAgICAgICAgdmFyIHNpYmxpbmdzID0gYWRhcHRlci5nZXRTaWJsaW5ncyhlbGVtKTtcbiAgICAgICAgICAgIHZhciBwb3MgPSAwO1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzaWJsaW5ncy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIHZhciBjdXJyZW50U2libGluZyA9IHNpYmxpbmdzW2ldO1xuICAgICAgICAgICAgICAgIGlmIChlcXVhbHMoZWxlbSwgY3VycmVudFNpYmxpbmcpKVxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBpZiAoYWRhcHRlci5pc1RhZyhjdXJyZW50U2libGluZykgJiZcbiAgICAgICAgICAgICAgICAgICAgYWRhcHRlci5nZXROYW1lKGN1cnJlbnRTaWJsaW5nKSA9PT0gYWRhcHRlci5nZXROYW1lKGVsZW0pKSB7XG4gICAgICAgICAgICAgICAgICAgIHBvcysrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBmdW5jKHBvcykgJiYgbmV4dChlbGVtKTtcbiAgICAgICAgfTtcbiAgICB9LFxuICAgIFwibnRoLWxhc3Qtb2YtdHlwZVwiOiBmdW5jdGlvbiAobmV4dCwgcnVsZSwgX2EpIHtcbiAgICAgICAgdmFyIGFkYXB0ZXIgPSBfYS5hZGFwdGVyLCBlcXVhbHMgPSBfYS5lcXVhbHM7XG4gICAgICAgIHZhciBmdW5jID0gbnRoX2NoZWNrXzEuZGVmYXVsdChydWxlKTtcbiAgICAgICAgaWYgKGZ1bmMgPT09IGJvb2xiYXNlXzEuZmFsc2VGdW5jKVxuICAgICAgICAgICAgcmV0dXJuIGJvb2xiYXNlXzEuZmFsc2VGdW5jO1xuICAgICAgICBpZiAoZnVuYyA9PT0gYm9vbGJhc2VfMS50cnVlRnVuYylcbiAgICAgICAgICAgIHJldHVybiBnZXRDaGlsZEZ1bmMobmV4dCwgYWRhcHRlcik7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiBudGhMYXN0T2ZUeXBlKGVsZW0pIHtcbiAgICAgICAgICAgIHZhciBzaWJsaW5ncyA9IGFkYXB0ZXIuZ2V0U2libGluZ3MoZWxlbSk7XG4gICAgICAgICAgICB2YXIgcG9zID0gMDtcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSBzaWJsaW5ncy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuICAgICAgICAgICAgICAgIHZhciBjdXJyZW50U2libGluZyA9IHNpYmxpbmdzW2ldO1xuICAgICAgICAgICAgICAgIGlmIChlcXVhbHMoZWxlbSwgY3VycmVudFNpYmxpbmcpKVxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBpZiAoYWRhcHRlci5pc1RhZyhjdXJyZW50U2libGluZykgJiZcbiAgICAgICAgICAgICAgICAgICAgYWRhcHRlci5nZXROYW1lKGN1cnJlbnRTaWJsaW5nKSA9PT0gYWRhcHRlci5nZXROYW1lKGVsZW0pKSB7XG4gICAgICAgICAgICAgICAgICAgIHBvcysrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBmdW5jKHBvcykgJiYgbmV4dChlbGVtKTtcbiAgICAgICAgfTtcbiAgICB9LFxuICAgIC8vIFRPRE8gZGV0ZXJtaW5lIHRoZSBhY3R1YWwgcm9vdCBlbGVtZW50XG4gICAgcm9vdDogZnVuY3Rpb24gKG5leHQsIF9ydWxlLCBfYSkge1xuICAgICAgICB2YXIgYWRhcHRlciA9IF9hLmFkYXB0ZXI7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAoZWxlbSkge1xuICAgICAgICAgICAgdmFyIHBhcmVudCA9IGFkYXB0ZXIuZ2V0UGFyZW50KGVsZW0pO1xuICAgICAgICAgICAgcmV0dXJuIChwYXJlbnQgPT0gbnVsbCB8fCAhYWRhcHRlci5pc1RhZyhwYXJlbnQpKSAmJiBuZXh0KGVsZW0pO1xuICAgICAgICB9O1xuICAgIH0sXG4gICAgc2NvcGU6IGZ1bmN0aW9uIChuZXh0LCBydWxlLCBvcHRpb25zLCBjb250ZXh0KSB7XG4gICAgICAgIHZhciBlcXVhbHMgPSBvcHRpb25zLmVxdWFscztcbiAgICAgICAgaWYgKCFjb250ZXh0IHx8IGNvbnRleHQubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAvLyBFcXVpdmFsZW50IHRvIDpyb290XG4gICAgICAgICAgICByZXR1cm4gZXhwb3J0cy5maWx0ZXJzLnJvb3QobmV4dCwgcnVsZSwgb3B0aW9ucyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNvbnRleHQubGVuZ3RoID09PSAxKSB7XG4gICAgICAgICAgICAvLyBOT1RFOiBjYW4ndCBiZSB1bnBhY2tlZCwgYXMgOmhhcyB1c2VzIHRoaXMgZm9yIHNpZGUtZWZmZWN0c1xuICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChlbGVtKSB7IHJldHVybiBlcXVhbHMoY29udGV4dFswXSwgZWxlbSkgJiYgbmV4dChlbGVtKTsgfTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGVsZW0pIHsgcmV0dXJuIGNvbnRleHQuaW5jbHVkZXMoZWxlbSkgJiYgbmV4dChlbGVtKTsgfTtcbiAgICB9LFxuICAgIC8vIEpRdWVyeSBleHRlbnNpb25zIChvdGhlcnMgZm9sbG93IGFzIHBzZXVkb3MpXG4gICAgY2hlY2tib3g6IGdldEF0dHJpYkZ1bmMoXCJ0eXBlXCIsIFwiY2hlY2tib3hcIiksXG4gICAgZmlsZTogZ2V0QXR0cmliRnVuYyhcInR5cGVcIiwgXCJmaWxlXCIpLFxuICAgIHBhc3N3b3JkOiBnZXRBdHRyaWJGdW5jKFwidHlwZVwiLCBcInBhc3N3b3JkXCIpLFxuICAgIHJhZGlvOiBnZXRBdHRyaWJGdW5jKFwidHlwZVwiLCBcInJhZGlvXCIpLFxuICAgIHJlc2V0OiBnZXRBdHRyaWJGdW5jKFwidHlwZVwiLCBcInJlc2V0XCIpLFxuICAgIGltYWdlOiBnZXRBdHRyaWJGdW5jKFwidHlwZVwiLCBcImltYWdlXCIpLFxuICAgIHN1Ym1pdDogZ2V0QXR0cmliRnVuYyhcInR5cGVcIiwgXCJzdWJtaXRcIiksXG4gICAgLy8gRHluYW1pYyBzdGF0ZSBwc2V1ZG9zLiBUaGVzZSBkZXBlbmQgb24gb3B0aW9uYWwgQWRhcHRlciBtZXRob2RzLlxuICAgIGhvdmVyOiBmdW5jdGlvbiAobmV4dCwgX3J1bGUsIF9hKSB7XG4gICAgICAgIHZhciBhZGFwdGVyID0gX2EuYWRhcHRlcjtcbiAgICAgICAgdmFyIGlzSG92ZXJlZCA9IGFkYXB0ZXIuaXNIb3ZlcmVkO1xuICAgICAgICBpZiAodHlwZW9mIGlzSG92ZXJlZCAhPT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgICAgICByZXR1cm4gYm9vbGJhc2VfMS5mYWxzZUZ1bmM7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIGhvdmVyKGVsZW0pIHtcbiAgICAgICAgICAgIHJldHVybiBpc0hvdmVyZWQoZWxlbSkgJiYgbmV4dChlbGVtKTtcbiAgICAgICAgfTtcbiAgICB9LFxuICAgIHZpc2l0ZWQ6IGZ1bmN0aW9uIChuZXh0LCBfcnVsZSwgX2EpIHtcbiAgICAgICAgdmFyIGFkYXB0ZXIgPSBfYS5hZGFwdGVyO1xuICAgICAgICB2YXIgaXNWaXNpdGVkID0gYWRhcHRlci5pc1Zpc2l0ZWQ7XG4gICAgICAgIGlmICh0eXBlb2YgaXNWaXNpdGVkICE9PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgICAgIHJldHVybiBib29sYmFzZV8xLmZhbHNlRnVuYztcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZnVuY3Rpb24gdmlzaXRlZChlbGVtKSB7XG4gICAgICAgICAgICByZXR1cm4gaXNWaXNpdGVkKGVsZW0pICYmIG5leHQoZWxlbSk7XG4gICAgICAgIH07XG4gICAgfSxcbiAgICBhY3RpdmU6IGZ1bmN0aW9uIChuZXh0LCBfcnVsZSwgX2EpIHtcbiAgICAgICAgdmFyIGFkYXB0ZXIgPSBfYS5hZGFwdGVyO1xuICAgICAgICB2YXIgaXNBY3RpdmUgPSBhZGFwdGVyLmlzQWN0aXZlO1xuICAgICAgICBpZiAodHlwZW9mIGlzQWN0aXZlICE9PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgICAgIHJldHVybiBib29sYmFzZV8xLmZhbHNlRnVuYztcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZnVuY3Rpb24gYWN0aXZlKGVsZW0pIHtcbiAgICAgICAgICAgIHJldHVybiBpc0FjdGl2ZShlbGVtKSAmJiBuZXh0KGVsZW0pO1xuICAgICAgICB9O1xuICAgIH0sXG59O1xuIl19