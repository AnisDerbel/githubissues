407c19a8344874e39b62cabd5240ff42
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.getElementsByTagType = exports.getElementsByTagName = exports.getElementById = exports.getElements = exports.testElement = void 0;

var querying_1 = require("./querying");

var tagtypes_1 = require("./tagtypes");

var Checks = {
  tag_name: function tag_name(name) {
    if (typeof name === "function") {
      return function (elem) {
        return tagtypes_1.isTag(elem) && name(elem.name);
      };
    } else if (name === "*") {
      return tagtypes_1.isTag;
    }

    return function (elem) {
      return tagtypes_1.isTag(elem) && elem.name === name;
    };
  },
  tag_type: function tag_type(type) {
    if (typeof type === "function") {
      return function (elem) {
        return type(elem.type);
      };
    }

    return function (elem) {
      return elem.type === type;
    };
  },
  tag_contains: function tag_contains(data) {
    if (typeof data === "function") {
      return function (elem) {
        return tagtypes_1.isText(elem) && data(elem.data);
      };
    }

    return function (elem) {
      return tagtypes_1.isText(elem) && elem.data === data;
    };
  }
};

function getAttribCheck(attrib, value) {
  if (typeof value === "function") {
    return function (elem) {
      return tagtypes_1.isTag(elem) && value(elem.attribs[attrib]);
    };
  }

  return function (elem) {
    return tagtypes_1.isTag(elem) && elem.attribs[attrib] === value;
  };
}

function combineFuncs(a, b) {
  return function (elem) {
    return a(elem) || b(elem);
  };
}

function compileTest(options) {
  var funcs = Object.keys(options).map(function (key) {
    var value = options[key];
    return key in Checks ? Checks[key](value) : getAttribCheck(key, value);
  });
  return funcs.length === 0 ? null : funcs.reduce(combineFuncs);
}

function testElement(options, node) {
  var test = compileTest(options);
  return test ? test(node) : true;
}

exports.testElement = testElement;

function getElements(options, nodes, recurse, limit) {
  if (limit === void 0) {
    limit = Infinity;
  }

  var test = compileTest(options);
  return test ? querying_1.filter(test, nodes, recurse, limit) : [];
}

exports.getElements = getElements;

function getElementById(id, nodes, recurse) {
  if (recurse === void 0) {
    recurse = true;
  }

  if (!Array.isArray(nodes)) nodes = [nodes];
  return querying_1.findOne(getAttribCheck("id", id), nodes, recurse);
}

exports.getElementById = getElementById;

function getElementsByTagName(tagName, nodes, recurse, limit) {
  if (recurse === void 0) {
    recurse = true;
  }

  if (limit === void 0) {
    limit = Infinity;
  }

  return querying_1.filter(Checks.tag_name(tagName), nodes, recurse, limit);
}

exports.getElementsByTagName = getElementsByTagName;

function getElementsByTagType(type, nodes, recurse, limit) {
  if (recurse === void 0) {
    recurse = true;
  }

  if (limit === void 0) {
    limit = Infinity;
  }

  return querying_1.filter(Checks.tag_type(type), nodes, recurse, limit);
}

exports.getElementsByTagType = getElementsByTagType;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxlZ2FjeS5qcyJdLCJuYW1lcyI6WyJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImV4cG9ydHMiLCJ2YWx1ZSIsImdldEVsZW1lbnRzQnlUYWdUeXBlIiwiZ2V0RWxlbWVudHNCeVRhZ05hbWUiLCJnZXRFbGVtZW50QnlJZCIsImdldEVsZW1lbnRzIiwidGVzdEVsZW1lbnQiLCJxdWVyeWluZ18xIiwicmVxdWlyZSIsInRhZ3R5cGVzXzEiLCJDaGVja3MiLCJ0YWdfbmFtZSIsIm5hbWUiLCJlbGVtIiwiaXNUYWciLCJ0YWdfdHlwZSIsInR5cGUiLCJ0YWdfY29udGFpbnMiLCJkYXRhIiwiaXNUZXh0IiwiZ2V0QXR0cmliQ2hlY2siLCJhdHRyaWIiLCJhdHRyaWJzIiwiY29tYmluZUZ1bmNzIiwiYSIsImIiLCJjb21waWxlVGVzdCIsIm9wdGlvbnMiLCJmdW5jcyIsImtleXMiLCJtYXAiLCJrZXkiLCJsZW5ndGgiLCJyZWR1Y2UiLCJub2RlIiwidGVzdCIsIm5vZGVzIiwicmVjdXJzZSIsImxpbWl0IiwiSW5maW5pdHkiLCJmaWx0ZXIiLCJpZCIsIkFycmF5IiwiaXNBcnJheSIsImZpbmRPbmUiLCJ0YWdOYW1lIl0sIm1hcHBpbmdzIjoiQUFBQTs7QUFDQUEsTUFBTSxDQUFDQyxjQUFQLENBQXNCQyxPQUF0QixFQUErQixZQUEvQixFQUE2QztBQUFFQyxFQUFBQSxLQUFLLEVBQUU7QUFBVCxDQUE3QztBQUNBRCxPQUFPLENBQUNFLG9CQUFSLEdBQStCRixPQUFPLENBQUNHLG9CQUFSLEdBQStCSCxPQUFPLENBQUNJLGNBQVIsR0FBeUJKLE9BQU8sQ0FBQ0ssV0FBUixHQUFzQkwsT0FBTyxDQUFDTSxXQUFSLEdBQXNCLEtBQUssQ0FBeEk7O0FBQ0EsSUFBSUMsVUFBVSxHQUFHQyxPQUFPLENBQUMsWUFBRCxDQUF4Qjs7QUFDQSxJQUFJQyxVQUFVLEdBQUdELE9BQU8sQ0FBQyxZQUFELENBQXhCOztBQUNBLElBQUlFLE1BQU0sR0FBRztBQUNUQyxFQUFBQSxR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dFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5nZXRFbGVtZW50c0J5VGFnVHlwZSA9IGV4cG9ydHMuZ2V0RWxlbWVudHNCeVRhZ05hbWUgPSBleHBvcnRzLmdldEVsZW1lbnRCeUlkID0gZXhwb3J0cy5nZXRFbGVtZW50cyA9IGV4cG9ydHMudGVzdEVsZW1lbnQgPSB2b2lkIDA7XG52YXIgcXVlcnlpbmdfMSA9IHJlcXVpcmUoXCIuL3F1ZXJ5aW5nXCIpO1xudmFyIHRhZ3R5cGVzXzEgPSByZXF1aXJlKFwiLi90YWd0eXBlc1wiKTtcbnZhciBDaGVja3MgPSB7XG4gICAgdGFnX25hbWU6IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICAgIGlmICh0eXBlb2YgbmFtZSA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGVsZW0pIHsgcmV0dXJuIHRhZ3R5cGVzXzEuaXNUYWcoZWxlbSkgJiYgbmFtZShlbGVtLm5hbWUpOyB9O1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKG5hbWUgPT09IFwiKlwiKSB7XG4gICAgICAgICAgICByZXR1cm4gdGFndHlwZXNfMS5pc1RhZztcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGVsZW0pIHsgcmV0dXJuIHRhZ3R5cGVzXzEuaXNUYWcoZWxlbSkgJiYgZWxlbS5uYW1lID09PSBuYW1lOyB9O1xuICAgIH0sXG4gICAgdGFnX3R5cGU6IGZ1bmN0aW9uICh0eXBlKSB7XG4gICAgICAgIGlmICh0eXBlb2YgdHlwZSA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGVsZW0pIHsgcmV0dXJuIHR5cGUoZWxlbS50eXBlKTsgfTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGVsZW0pIHsgcmV0dXJuIGVsZW0udHlwZSA9PT0gdHlwZTsgfTtcbiAgICB9LFxuICAgIHRhZ19jb250YWluczogZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgaWYgKHR5cGVvZiBkYXRhID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoZWxlbSkgeyByZXR1cm4gdGFndHlwZXNfMS5pc1RleHQoZWxlbSkgJiYgZGF0YShlbGVtLmRhdGEpOyB9O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAoZWxlbSkgeyByZXR1cm4gdGFndHlwZXNfMS5pc1RleHQoZWxlbSkgJiYgZWxlbS5kYXRhID09PSBkYXRhOyB9O1xuICAgIH0sXG59O1xuLyoqXG4gKiBAcGFyYW0gYXR0cmliIEF0dHJpYnV0ZSB0byBjaGVjay5cbiAqIEBwYXJhbSB2YWx1ZSBBdHRyaWJ1dGUgdmFsdWUgdG8gbG9vayBmb3IuXG4gKiBAcmV0dXJucyBBIGZ1bmN0aW9uIHRvIGNoZWNrIHdoZXRoZXIgdGhlIGEgbm9kZSBoYXMgYW4gYXR0cmlidXRlIHdpdGggYSBwYXJ0aWN1bGFyIHZhbHVlLlxuICovXG5mdW5jdGlvbiBnZXRBdHRyaWJDaGVjayhhdHRyaWIsIHZhbHVlKSB7XG4gICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAoZWxlbSkgeyByZXR1cm4gdGFndHlwZXNfMS5pc1RhZyhlbGVtKSAmJiB2YWx1ZShlbGVtLmF0dHJpYnNbYXR0cmliXSk7IH07XG4gICAgfVxuICAgIHJldHVybiBmdW5jdGlvbiAoZWxlbSkgeyByZXR1cm4gdGFndHlwZXNfMS5pc1RhZyhlbGVtKSAmJiBlbGVtLmF0dHJpYnNbYXR0cmliXSA9PT0gdmFsdWU7IH07XG59XG4vKipcbiAqIEBwYXJhbSBhIEZpcnN0IGZ1bmN0aW9uIHRvIGNvbWJpbmUuXG4gKiBAcGFyYW0gYiBTZWNvbmQgZnVuY3Rpb24gdG8gY29tYmluZS5cbiAqIEByZXR1cm5zIEEgZnVuY3Rpb24gdGFraW5nIGEgbm9kZSBhbmQgcmV0dXJuaW5nIGB0cnVlYCBpZiBlaXRoZXJcbiAqIG9mIHRoZSBpbnB1dCBmdW5jdGlvbnMgcmV0dXJucyBgdHJ1ZWAgZm9yIHRoZSBub2RlLlxuICovXG5mdW5jdGlvbiBjb21iaW5lRnVuY3MoYSwgYikge1xuICAgIHJldHVybiBmdW5jdGlvbiAoZWxlbSkgeyByZXR1cm4gYShlbGVtKSB8fCBiKGVsZW0pOyB9O1xufVxuLyoqXG4gKiBAcGFyYW0gb3B0aW9ucyBBbiBvYmplY3QgZGVzY3JpYmluZyBub2RlcyB0byBsb29rIGZvci5cbiAqIEByZXR1cm5zIEEgZnVuY3Rpb24gZXhlY3V0aW5nIGFsbCBjaGVja3MgaW4gYG9wdGlvbnNgIGFuZCByZXR1cm5pbmcgYHRydWVgXG4gKiBpZiBhbnkgb2YgdGhlbSBtYXRjaCBhIG5vZGUuXG4gKi9cbmZ1bmN0aW9uIGNvbXBpbGVUZXN0KG9wdGlvbnMpIHtcbiAgICB2YXIgZnVuY3MgPSBPYmplY3Qua2V5cyhvcHRpb25zKS5tYXAoZnVuY3Rpb24gKGtleSkge1xuICAgICAgICB2YXIgdmFsdWUgPSBvcHRpb25zW2tleV07XG4gICAgICAgIHJldHVybiBrZXkgaW4gQ2hlY2tzXG4gICAgICAgICAgICA/IENoZWNrc1trZXldKHZhbHVlKVxuICAgICAgICAgICAgOiBnZXRBdHRyaWJDaGVjayhrZXksIHZhbHVlKTtcbiAgICB9KTtcbiAgICByZXR1cm4gZnVuY3MubGVuZ3RoID09PSAwID8gbnVsbCA6IGZ1bmNzLnJlZHVjZShjb21iaW5lRnVuY3MpO1xufVxuLyoqXG4gKiBAcGFyYW0gb3B0aW9ucyBBbiBvYmplY3QgZGVzY3JpYmluZyBub2RlcyB0byBsb29rIGZvci5cbiAqIEBwYXJhbSBub2RlIFRoZSBlbGVtZW50IHRvIHRlc3QuXG4gKiBAcmV0dXJucyBXaGV0aGVyIHRoZSBlbGVtZW50IG1hdGNoZXMgdGhlIGRlc2NyaXB0aW9uIGluIGBvcHRpb25zYC5cbiAqL1xuZnVuY3Rpb24gdGVzdEVsZW1lbnQob3B0aW9ucywgbm9kZSkge1xuICAgIHZhciB0ZXN0ID0gY29tcGlsZVRlc3Qob3B0aW9ucyk7XG4gICAgcmV0dXJuIHRlc3QgPyB0ZXN0KG5vZGUpIDogdHJ1ZTtcbn1cbmV4cG9ydHMudGVzdEVsZW1lbnQgPSB0ZXN0RWxlbWVudDtcbi8qKlxuICogQHBhcmFtIG9wdGlvbnMgQW4gb2JqZWN0IGRlc2NyaWJpbmcgbm9kZXMgdG8gbG9vayBmb3IuXG4gKiBAcGFyYW0gbm9kZXMgTm9kZXMgdG8gc2VhcmNoIHRocm91Z2guXG4gKiBAcGFyYW0gcmVjdXJzZSBBbHNvIGNvbnNpZGVyIGNoaWxkIG5vZGVzLlxuICogQHBhcmFtIGxpbWl0IE1heGltdW0gbnVtYmVyIG9mIG5vZGVzIHRvIHJldHVybi5cbiAqIEByZXR1cm5zIEFsbCBub2RlcyB0aGF0IG1hdGNoIGBvcHRpb25zYC5cbiAqL1xuZnVuY3Rpb24gZ2V0RWxlbWVudHMob3B0aW9ucywgbm9kZXMsIHJlY3Vyc2UsIGxpbWl0KSB7XG4gICAgaWYgKGxpbWl0ID09PSB2b2lkIDApIHsgbGltaXQgPSBJbmZpbml0eTsgfVxuICAgIHZhciB0ZXN0ID0gY29tcGlsZVRlc3Qob3B0aW9ucyk7XG4gICAgcmV0dXJuIHRlc3QgPyBxdWVyeWluZ18xLmZpbHRlcih0ZXN0LCBub2RlcywgcmVjdXJzZSwgbGltaXQpIDogW107XG59XG5leHBvcnRzLmdldEVsZW1lbnRzID0gZ2V0RWxlbWVudHM7XG4vKipcbiAqIEBwYXJhbSBpZCBUaGUgdW5pcXVlIElEIGF0dHJpYnV0ZSB2YWx1ZSB0byBsb29rIGZvci5cbiAqIEBwYXJhbSBub2RlcyBOb2RlcyB0byBzZWFyY2ggdGhyb3VnaC5cbiAqIEBwYXJhbSByZWN1cnNlIEFsc28gY29uc2lkZXIgY2hpbGQgbm9kZXMuXG4gKiBAcmV0dXJucyBUaGUgbm9kZSB3aXRoIHRoZSBzdXBwbGllZCBJRC5cbiAqL1xuZnVuY3Rpb24gZ2V0RWxlbWVudEJ5SWQoaWQsIG5vZGVzLCByZWN1cnNlKSB7XG4gICAgaWYgKHJlY3Vyc2UgPT09IHZvaWQgMCkgeyByZWN1cnNlID0gdHJ1ZTsgfVxuICAgIGlmICghQXJyYXkuaXNBcnJheShub2RlcykpXG4gICAgICAgIG5vZGVzID0gW25vZGVzXTtcbiAgICByZXR1cm4gcXVlcnlpbmdfMS5maW5kT25lKGdldEF0dHJpYkNoZWNrKFwiaWRcIiwgaWQpLCBub2RlcywgcmVjdXJzZSk7XG59XG5leHBvcnRzLmdldEVsZW1lbnRCeUlkID0gZ2V0RWxlbWVudEJ5SWQ7XG4vKipcbiAqIEBwYXJhbSB0YWdOYW1lIFRhZyBuYW1lIHRvIHNlYXJjaCBmb3IuXG4gKiBAcGFyYW0gbm9kZXMgTm9kZXMgdG8gc2VhcmNoIHRocm91Z2guXG4gKiBAcGFyYW0gcmVjdXJzZSBBbHNvIGNvbnNpZGVyIGNoaWxkIG5vZGVzLlxuICogQHBhcmFtIGxpbWl0IE1heGltdW0gbnVtYmVyIG9mIG5vZGVzIHRvIHJldHVybi5cbiAqIEByZXR1cm5zIEFsbCBub2RlcyB3aXRoIHRoZSBzdXBwbGllZCBgdGFnTmFtZWAuXG4gKi9cbmZ1bmN0aW9uIGdldEVsZW1lbnRzQnlUYWdOYW1lKHRhZ05hbWUsIG5vZGVzLCByZWN1cnNlLCBsaW1pdCkge1xuICAgIGlmIChyZWN1cnNlID09PSB2b2lkIDApIHsgcmVjdXJzZSA9IHRydWU7IH1cbiAgICBpZiAobGltaXQgPT09IHZvaWQgMCkgeyBsaW1pdCA9IEluZmluaXR5OyB9XG4gICAgcmV0dXJuIHF1ZXJ5aW5nXzEuZmlsdGVyKENoZWNrcy50YWdfbmFtZSh0YWdOYW1lKSwgbm9kZXMsIHJlY3Vyc2UsIGxpbWl0KTtcbn1cbmV4cG9ydHMuZ2V0RWxlbWVudHNCeVRhZ05hbWUgPSBnZXRFbGVtZW50c0J5VGFnTmFtZTtcbi8qKlxuICogQHBhcmFtIHR5cGUgRWxlbWVudCB0eXBlIHRvIGxvb2sgZm9yLlxuICogQHBhcmFtIG5vZGVzIE5vZGVzIHRvIHNlYXJjaCB0aHJvdWdoLlxuICogQHBhcmFtIHJlY3Vyc2UgQWxzbyBjb25zaWRlciBjaGlsZCBub2Rlcy5cbiAqIEBwYXJhbSBsaW1pdCBNYXhpbXVtIG51bWJlciBvZiBub2RlcyB0byByZXR1cm4uXG4gKiBAcmV0dXJucyBBbGwgbm9kZXMgd2l0aCB0aGUgc3VwcGxpZWQgYHR5cGVgLlxuICovXG5mdW5jdGlvbiBnZXRFbGVtZW50c0J5VGFnVHlwZSh0eXBlLCBub2RlcywgcmVjdXJzZSwgbGltaXQpIHtcbiAgICBpZiAocmVjdXJzZSA9PT0gdm9pZCAwKSB7IHJlY3Vyc2UgPSB0cnVlOyB9XG4gICAgaWYgKGxpbWl0ID09PSB2b2lkIDApIHsgbGltaXQgPSBJbmZpbml0eTsgfVxuICAgIHJldHVybiBxdWVyeWluZ18xLmZpbHRlcihDaGVja3MudGFnX3R5cGUodHlwZSksIG5vZGVzLCByZWN1cnNlLCBsaW1pdCk7XG59XG5leHBvcnRzLmdldEVsZW1lbnRzQnlUYWdUeXBlID0gZ2V0RWxlbWVudHNCeVRhZ1R5cGU7XG4iXX0=