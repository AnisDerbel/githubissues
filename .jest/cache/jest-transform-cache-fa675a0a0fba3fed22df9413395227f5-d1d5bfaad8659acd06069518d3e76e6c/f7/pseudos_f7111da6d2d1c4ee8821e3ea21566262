0cc411b56095a42b215e79dadee2416b
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.verifyPseudoArgs = exports.pseudos = void 0;
var isLinkTag = namePseudo(["a", "area", "link"]);
exports.pseudos = {
  empty: function empty(elem, _a) {
    var adapter = _a.adapter;
    return !adapter.getChildren(elem).some(function (elem) {
      return adapter.isTag(elem) || adapter.getText(elem) !== "";
    });
  },
  "first-child": function firstChild(elem, _a) {
    var adapter = _a.adapter,
        equals = _a.equals;
    var firstChild = adapter.getSiblings(elem).find(function (elem) {
      return adapter.isTag(elem);
    });
    return firstChild != null && equals(elem, firstChild);
  },
  "last-child": function lastChild(elem, _a) {
    var adapter = _a.adapter,
        equals = _a.equals;
    var siblings = adapter.getSiblings(elem);

    for (var i = siblings.length - 1; i >= 0; i--) {
      if (equals(elem, siblings[i])) return true;
      if (adapter.isTag(siblings[i])) break;
    }

    return false;
  },
  "first-of-type": function firstOfType(elem, _a) {
    var adapter = _a.adapter,
        equals = _a.equals;
    var siblings = adapter.getSiblings(elem);
    var elemName = adapter.getName(elem);

    for (var i = 0; i < siblings.length; i++) {
      var currentSibling = siblings[i];
      if (equals(elem, currentSibling)) return true;

      if (adapter.isTag(currentSibling) && adapter.getName(currentSibling) === elemName) {
        break;
      }
    }

    return false;
  },
  "last-of-type": function lastOfType(elem, _a) {
    var adapter = _a.adapter,
        equals = _a.equals;
    var siblings = adapter.getSiblings(elem);
    var elemName = adapter.getName(elem);

    for (var i = siblings.length - 1; i >= 0; i--) {
      var currentSibling = siblings[i];
      if (equals(elem, currentSibling)) return true;

      if (adapter.isTag(currentSibling) && adapter.getName(currentSibling) === elemName) {
        break;
      }
    }

    return false;
  },
  "only-of-type": function onlyOfType(elem, _a) {
    var adapter = _a.adapter,
        equals = _a.equals;
    var elemName = adapter.getName(elem);
    return adapter.getSiblings(elem).every(function (sibling) {
      return equals(elem, sibling) || !adapter.isTag(sibling) || adapter.getName(sibling) !== elemName;
    });
  },
  "only-child": function onlyChild(elem, _a) {
    var adapter = _a.adapter,
        equals = _a.equals;
    return adapter.getSiblings(elem).every(function (sibling) {
      return equals(elem, sibling) || !adapter.isTag(sibling);
    });
  },
  "any-link": function anyLink(elem, options) {
    return isLinkTag(elem, options) && options.adapter.hasAttrib(elem, "href");
  },
  link: function link(elem, options) {
    var _a, _b;

    return ((_b = (_a = options.adapter).isVisited) === null || _b === void 0 ? void 0 : _b.call(_a, elem)) !== true && exports.pseudos["any-link"](elem, options);
  },
  selected: function selected(elem, _a) {
    var adapter = _a.adapter,
        equals = _a.equals;
    if (adapter.hasAttrib(elem, "selected")) return true;else if (adapter.getName(elem) !== "option") return false;
    var parent = adapter.getParent(elem);

    if (!parent || !adapter.isTag(parent) || adapter.getName(parent) !== "select" || adapter.hasAttrib(parent, "multiple")) {
      return false;
    }

    var siblings = adapter.getChildren(parent);
    var sawElem = false;

    for (var i = 0; i < siblings.length; i++) {
      var currentSibling = siblings[i];

      if (adapter.isTag(currentSibling)) {
        if (equals(elem, currentSibling)) {
          sawElem = true;
        } else if (!sawElem) {
          return false;
        } else if (adapter.hasAttrib(currentSibling, "selected")) {
          return false;
        }
      }
    }

    return sawElem;
  },
  disabled: function disabled(elem, _a) {
    var adapter = _a.adapter;
    return adapter.hasAttrib(elem, "disabled");
  },
  enabled: function enabled(elem, _a) {
    var adapter = _a.adapter;
    return !adapter.hasAttrib(elem, "disabled");
  },
  checked: function checked(elem, options) {
    return options.adapter.hasAttrib(elem, "checked") || exports.pseudos.selected(elem, options);
  },
  required: function required(elem, _a) {
    var adapter = _a.adapter;
    return adapter.hasAttrib(elem, "required");
  },
  optional: function optional(elem, _a) {
    var adapter = _a.adapter;
    return !adapter.hasAttrib(elem, "required");
  },
  parent: function parent(elem, options) {
    return !exports.pseudos.empty(elem, options);
  },
  header: namePseudo(["h1", "h2", "h3", "h4", "h5", "h6"]),
  button: function button(elem, _a) {
    var adapter = _a.adapter;
    var name = adapter.getName(elem);
    return name === "button" || name === "input" && adapter.getAttributeValue(elem, "type") === "button";
  },
  input: namePseudo(["input", "textarea", "select", "button"]),
  text: function text(elem, _a) {
    var adapter = _a.adapter;
    var type = adapter.getAttributeValue(elem, "type");
    return adapter.getName(elem) === "input" && (!type || type.toLowerCase() === "text");
  }
};

function namePseudo(names) {
  if (typeof Set !== "undefined") {
    var nameSet_1 = new Set(names);
    return function (elem, _a) {
      var adapter = _a.adapter;
      return nameSet_1.has(adapter.getName(elem));
    };
  }

  return function (elem, _a) {
    var adapter = _a.adapter;
    return names.includes(adapter.getName(elem));
  };
}

function verifyPseudoArgs(func, name, subselect) {
  if (subselect === null) {
    if (func.length > 2 && name !== "scope") {
      throw new Error("pseudo-selector :" + name + " requires an argument");
    }
  } else {
    if (func.length === 2) {
      throw new Error("pseudo-selector :" + name + " doesn't have any arguments");
    }
  }
}

exports.verifyPseudoArgs = verifyPseudoArgs;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInBzZXVkb3MuanMiXSwibmFtZXMiOlsiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJleHBvcnRzIiwidmFsdWUiLCJ2ZXJpZnlQc2V1ZG9BcmdzIiwicHNldWRvcyIsImlzTGlua1RhZyIsIm5hbWVQc2V1ZG8iLCJlbXB0eSIsImVsZW0iLCJfYSIsImFkYXB0ZXIiLCJnZXRDaGlsZHJlbiIsInNvbWUiLCJpc1RhZyIsImdldFRleHQiLCJlcXVhbHMiLCJmaXJzdENoaWxkIiwiZ2V0U2libGluZ3MiLCJmaW5kIiwic2libGluZ3MiLCJpIiwibGVuZ3RoIiwiZWxlbU5hbWUiLCJnZXROYW1lIiwiY3VycmVudFNpYmxpbmciLCJldmVyeSIsInNpYmxpbmciLCJvcHRpb25zIiwiaGFzQXR0cmliIiwibGluayIsIl9iIiwiaXNWaXNpdGVkIiwiY2FsbCIsInNlbGVjdGVkIiwicGFyZW50IiwiZ2V0UGFyZW50Iiwic2F3RWxlbSIsImRpc2FibGVkIiwiZW5hYmxlZCIsImNoZWNrZWQiLCJyZXF1aXJlZCIsIm9wdGlvbmFsIiwiaGVhZGVyIiwiYnV0dG9uIiwibmFtZSIsImdldEF0dHJpYnV0ZVZhbHVlIiwiaW5wdXQiLCJ0ZXh0IiwidHlwZSIsInRvTG93ZXJDYXNlIiwibmFtZXMiLCJTZXQiLCJuYW1lU2V0XzEiLCJoYXMiLCJpbmNsdWRlcyIsImZ1bmMiLCJzdWJzZWxlY3QiLCJFcnJvciJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBQ0FBLE1BQU0sQ0FBQ0MsY0FBUCxDQUFzQkMsT0FBdEIsRUFBK0IsWUFBL0IsRUFBNkM7QUFBRUMsRUFBQUEsS0FBSyxFQUFFO0FBQVQsQ0FBN0M7QUFDQUQsT0FBTyxDQUFDRSxnQkFBUixHQUEyQkYsT0FBTyxDQUFDRyxPQUFSLEdBQWtCLEtBQUssQ0FBbEQ7QUFDQSxJQUFJQyxTQUFTLEdBQUdDLFVBQVUsQ0FBQyxDQUFDLEdBQUQsRUFBTSxNQUFOLEVBQWMsTUFBZCxDQUFELENBQTFCO0FBRUFMLE9BQU8sQ0FBQ0csT0FBUixH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QUNKOztBQUNEM0MsT0FBTyxDQUFDRSxnQkFBUixHQUEyQkEsZ0JBQTNCIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLnZlcmlmeVBzZXVkb0FyZ3MgPSBleHBvcnRzLnBzZXVkb3MgPSB2b2lkIDA7XG52YXIgaXNMaW5rVGFnID0gbmFtZVBzZXVkbyhbXCJhXCIsIFwiYXJlYVwiLCBcImxpbmtcIl0pO1xuLy8gV2hpbGUgZmlsdGVycyBhcmUgcHJlY29tcGlsZWQsIHBzZXVkb3MgZ2V0IGNhbGxlZCB3aGVuIHRoZXkgYXJlIG5lZWRlZFxuZXhwb3J0cy5wc2V1ZG9zID0ge1xuICAgIGVtcHR5OiBmdW5jdGlvbiAoZWxlbSwgX2EpIHtcbiAgICAgICAgdmFyIGFkYXB0ZXIgPSBfYS5hZGFwdGVyO1xuICAgICAgICByZXR1cm4gIWFkYXB0ZXIuZ2V0Q2hpbGRyZW4oZWxlbSkuc29tZShmdW5jdGlvbiAoZWxlbSkge1xuICAgICAgICAgICAgLy8gRklYTUU6IGBnZXRUZXh0YCBjYWxsIGlzIHBvdGVudGlhbGx5IGV4cGVuc2l2ZS5cbiAgICAgICAgICAgIHJldHVybiBhZGFwdGVyLmlzVGFnKGVsZW0pIHx8IGFkYXB0ZXIuZ2V0VGV4dChlbGVtKSAhPT0gXCJcIjtcbiAgICAgICAgfSk7XG4gICAgfSxcbiAgICBcImZpcnN0LWNoaWxkXCI6IGZ1bmN0aW9uIChlbGVtLCBfYSkge1xuICAgICAgICB2YXIgYWRhcHRlciA9IF9hLmFkYXB0ZXIsIGVxdWFscyA9IF9hLmVxdWFscztcbiAgICAgICAgdmFyIGZpcnN0Q2hpbGQgPSBhZGFwdGVyXG4gICAgICAgICAgICAuZ2V0U2libGluZ3MoZWxlbSlcbiAgICAgICAgICAgIC5maW5kKGZ1bmN0aW9uIChlbGVtKSB7IHJldHVybiBhZGFwdGVyLmlzVGFnKGVsZW0pOyB9KTtcbiAgICAgICAgcmV0dXJuIGZpcnN0Q2hpbGQgIT0gbnVsbCAmJiBlcXVhbHMoZWxlbSwgZmlyc3RDaGlsZCk7XG4gICAgfSxcbiAgICBcImxhc3QtY2hpbGRcIjogZnVuY3Rpb24gKGVsZW0sIF9hKSB7XG4gICAgICAgIHZhciBhZGFwdGVyID0gX2EuYWRhcHRlciwgZXF1YWxzID0gX2EuZXF1YWxzO1xuICAgICAgICB2YXIgc2libGluZ3MgPSBhZGFwdGVyLmdldFNpYmxpbmdzKGVsZW0pO1xuICAgICAgICBmb3IgKHZhciBpID0gc2libGluZ3MubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHtcbiAgICAgICAgICAgIGlmIChlcXVhbHMoZWxlbSwgc2libGluZ3NbaV0pKVxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgaWYgKGFkYXB0ZXIuaXNUYWcoc2libGluZ3NbaV0pKVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9LFxuICAgIFwiZmlyc3Qtb2YtdHlwZVwiOiBmdW5jdGlvbiAoZWxlbSwgX2EpIHtcbiAgICAgICAgdmFyIGFkYXB0ZXIgPSBfYS5hZGFwdGVyLCBlcXVhbHMgPSBfYS5lcXVhbHM7XG4gICAgICAgIHZhciBzaWJsaW5ncyA9IGFkYXB0ZXIuZ2V0U2libGluZ3MoZWxlbSk7XG4gICAgICAgIHZhciBlbGVtTmFtZSA9IGFkYXB0ZXIuZ2V0TmFtZShlbGVtKTtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzaWJsaW5ncy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdmFyIGN1cnJlbnRTaWJsaW5nID0gc2libGluZ3NbaV07XG4gICAgICAgICAgICBpZiAoZXF1YWxzKGVsZW0sIGN1cnJlbnRTaWJsaW5nKSlcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIGlmIChhZGFwdGVyLmlzVGFnKGN1cnJlbnRTaWJsaW5nKSAmJlxuICAgICAgICAgICAgICAgIGFkYXB0ZXIuZ2V0TmFtZShjdXJyZW50U2libGluZykgPT09IGVsZW1OYW1lKSB7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0sXG4gICAgXCJsYXN0LW9mLXR5cGVcIjogZnVuY3Rpb24gKGVsZW0sIF9hKSB7XG4gICAgICAgIHZhciBhZGFwdGVyID0gX2EuYWRhcHRlciwgZXF1YWxzID0gX2EuZXF1YWxzO1xuICAgICAgICB2YXIgc2libGluZ3MgPSBhZGFwdGVyLmdldFNpYmxpbmdzKGVsZW0pO1xuICAgICAgICB2YXIgZWxlbU5hbWUgPSBhZGFwdGVyLmdldE5hbWUoZWxlbSk7XG4gICAgICAgIGZvciAodmFyIGkgPSBzaWJsaW5ncy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuICAgICAgICAgICAgdmFyIGN1cnJlbnRTaWJsaW5nID0gc2libGluZ3NbaV07XG4gICAgICAgICAgICBpZiAoZXF1YWxzKGVsZW0sIGN1cnJlbnRTaWJsaW5nKSlcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIGlmIChhZGFwdGVyLmlzVGFnKGN1cnJlbnRTaWJsaW5nKSAmJlxuICAgICAgICAgICAgICAgIGFkYXB0ZXIuZ2V0TmFtZShjdXJyZW50U2libGluZykgPT09IGVsZW1OYW1lKSB7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0sXG4gICAgXCJvbmx5LW9mLXR5cGVcIjogZnVuY3Rpb24gKGVsZW0sIF9hKSB7XG4gICAgICAgIHZhciBhZGFwdGVyID0gX2EuYWRhcHRlciwgZXF1YWxzID0gX2EuZXF1YWxzO1xuICAgICAgICB2YXIgZWxlbU5hbWUgPSBhZGFwdGVyLmdldE5hbWUoZWxlbSk7XG4gICAgICAgIHJldHVybiBhZGFwdGVyXG4gICAgICAgICAgICAuZ2V0U2libGluZ3MoZWxlbSlcbiAgICAgICAgICAgIC5ldmVyeShmdW5jdGlvbiAoc2libGluZykge1xuICAgICAgICAgICAgcmV0dXJuIGVxdWFscyhlbGVtLCBzaWJsaW5nKSB8fFxuICAgICAgICAgICAgICAgICFhZGFwdGVyLmlzVGFnKHNpYmxpbmcpIHx8XG4gICAgICAgICAgICAgICAgYWRhcHRlci5nZXROYW1lKHNpYmxpbmcpICE9PSBlbGVtTmFtZTtcbiAgICAgICAgfSk7XG4gICAgfSxcbiAgICBcIm9ubHktY2hpbGRcIjogZnVuY3Rpb24gKGVsZW0sIF9hKSB7XG4gICAgICAgIHZhciBhZGFwdGVyID0gX2EuYWRhcHRlciwgZXF1YWxzID0gX2EuZXF1YWxzO1xuICAgICAgICByZXR1cm4gYWRhcHRlclxuICAgICAgICAgICAgLmdldFNpYmxpbmdzKGVsZW0pXG4gICAgICAgICAgICAuZXZlcnkoZnVuY3Rpb24gKHNpYmxpbmcpIHsgcmV0dXJuIGVxdWFscyhlbGVtLCBzaWJsaW5nKSB8fCAhYWRhcHRlci5pc1RhZyhzaWJsaW5nKTsgfSk7XG4gICAgfSxcbiAgICAvLyA6bWF0Y2hlcyhhLCBhcmVhLCBsaW5rKVtocmVmXVxuICAgIFwiYW55LWxpbmtcIjogZnVuY3Rpb24gKGVsZW0sIG9wdGlvbnMpIHtcbiAgICAgICAgcmV0dXJuIChpc0xpbmtUYWcoZWxlbSwgb3B0aW9ucykgJiYgb3B0aW9ucy5hZGFwdGVyLmhhc0F0dHJpYihlbGVtLCBcImhyZWZcIikpO1xuICAgIH0sXG4gICAgLy8gOmFueS1saW5rOm5vdCg6dmlzaXRlZClcbiAgICBsaW5rOiBmdW5jdGlvbiAoZWxlbSwgb3B0aW9ucykge1xuICAgICAgICB2YXIgX2EsIF9iO1xuICAgICAgICByZXR1cm4gKCgoX2IgPSAoX2EgPSBvcHRpb25zLmFkYXB0ZXIpLmlzVmlzaXRlZCkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLmNhbGwoX2EsIGVsZW0pKSAhPT0gdHJ1ZSAmJlxuICAgICAgICAgICAgZXhwb3J0cy5wc2V1ZG9zW1wiYW55LWxpbmtcIl0oZWxlbSwgb3B0aW9ucykpO1xuICAgIH0sXG4gICAgLypcbiAgICAgKiBGb3Jtc1xuICAgICAqIHRvIGNvbnNpZGVyOiA6dGFyZ2V0XG4gICAgICovXG4gICAgLy8gOm1hdGNoZXMoW3NlbGVjdGVkXSwgc2VsZWN0Om5vdChbbXVsdGlwbGVdKTpub3QoPiBvcHRpb25bc2VsZWN0ZWRdKSA+IG9wdGlvbjpmaXJzdC1vZi10eXBlKVxuICAgIHNlbGVjdGVkOiBmdW5jdGlvbiAoZWxlbSwgX2EpIHtcbiAgICAgICAgdmFyIGFkYXB0ZXIgPSBfYS5hZGFwdGVyLCBlcXVhbHMgPSBfYS5lcXVhbHM7XG4gICAgICAgIGlmIChhZGFwdGVyLmhhc0F0dHJpYihlbGVtLCBcInNlbGVjdGVkXCIpKVxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIGVsc2UgaWYgKGFkYXB0ZXIuZ2V0TmFtZShlbGVtKSAhPT0gXCJvcHRpb25cIilcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgLy8gVGhlIGZpcnN0IDxvcHRpb24+IGluIGEgPHNlbGVjdD4gaXMgYWxzbyBzZWxlY3RlZFxuICAgICAgICB2YXIgcGFyZW50ID0gYWRhcHRlci5nZXRQYXJlbnQoZWxlbSk7XG4gICAgICAgIGlmICghcGFyZW50IHx8XG4gICAgICAgICAgICAhYWRhcHRlci5pc1RhZyhwYXJlbnQpIHx8XG4gICAgICAgICAgICBhZGFwdGVyLmdldE5hbWUocGFyZW50KSAhPT0gXCJzZWxlY3RcIiB8fFxuICAgICAgICAgICAgYWRhcHRlci5oYXNBdHRyaWIocGFyZW50LCBcIm11bHRpcGxlXCIpKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIHNpYmxpbmdzID0gYWRhcHRlci5nZXRDaGlsZHJlbihwYXJlbnQpO1xuICAgICAgICB2YXIgc2F3RWxlbSA9IGZhbHNlO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNpYmxpbmdzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICB2YXIgY3VycmVudFNpYmxpbmcgPSBzaWJsaW5nc1tpXTtcbiAgICAgICAgICAgIGlmIChhZGFwdGVyLmlzVGFnKGN1cnJlbnRTaWJsaW5nKSkge1xuICAgICAgICAgICAgICAgIGlmIChlcXVhbHMoZWxlbSwgY3VycmVudFNpYmxpbmcpKSB7XG4gICAgICAgICAgICAgICAgICAgIHNhd0VsZW0gPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmICghc2F3RWxlbSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKGFkYXB0ZXIuaGFzQXR0cmliKGN1cnJlbnRTaWJsaW5nLCBcInNlbGVjdGVkXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHNhd0VsZW07XG4gICAgfSxcbiAgICAvKlxuICAgICAqIGh0dHBzOi8vaHRtbC5zcGVjLndoYXR3Zy5vcmcvbXVsdGlwYWdlL3NjcmlwdGluZy5odG1sI2Rpc2FibGVkLWVsZW1lbnRzXG4gICAgICogOm1hdGNoZXMoXG4gICAgICogICA6bWF0Y2hlcyhidXR0b24sIGlucHV0LCBzZWxlY3QsIHRleHRhcmVhLCBtZW51aXRlbSwgb3B0Z3JvdXAsIG9wdGlvbilbZGlzYWJsZWRdLFxuICAgICAqICAgb3B0Z3JvdXBbZGlzYWJsZWRdID4gb3B0aW9uKSxcbiAgICAgKiAgZmllbGRzZXRbZGlzYWJsZWRdICogLy9UT0RPIG5vdCBjaGlsZCBvZiBmaXJzdCA8bGVnZW5kPlxuICAgICAqIClcbiAgICAgKi9cbiAgICBkaXNhYmxlZDogZnVuY3Rpb24gKGVsZW0sIF9hKSB7XG4gICAgICAgIHZhciBhZGFwdGVyID0gX2EuYWRhcHRlcjtcbiAgICAgICAgcmV0dXJuIGFkYXB0ZXIuaGFzQXR0cmliKGVsZW0sIFwiZGlzYWJsZWRcIik7XG4gICAgfSxcbiAgICBlbmFibGVkOiBmdW5jdGlvbiAoZWxlbSwgX2EpIHtcbiAgICAgICAgdmFyIGFkYXB0ZXIgPSBfYS5hZGFwdGVyO1xuICAgICAgICByZXR1cm4gIWFkYXB0ZXIuaGFzQXR0cmliKGVsZW0sIFwiZGlzYWJsZWRcIik7XG4gICAgfSxcbiAgICAvLyA6bWF0Y2hlcyg6bWF0Y2hlcyg6cmFkaW8sIDpjaGVja2JveClbY2hlY2tlZF0sIDpzZWxlY3RlZCkgKFRPRE8gbWVudWl0ZW0pXG4gICAgY2hlY2tlZDogZnVuY3Rpb24gKGVsZW0sIG9wdGlvbnMpIHtcbiAgICAgICAgcmV0dXJuIChvcHRpb25zLmFkYXB0ZXIuaGFzQXR0cmliKGVsZW0sIFwiY2hlY2tlZFwiKSB8fFxuICAgICAgICAgICAgZXhwb3J0cy5wc2V1ZG9zLnNlbGVjdGVkKGVsZW0sIG9wdGlvbnMpKTtcbiAgICB9LFxuICAgIC8vIDptYXRjaGVzKGlucHV0LCBzZWxlY3QsIHRleHRhcmVhKVtyZXF1aXJlZF1cbiAgICByZXF1aXJlZDogZnVuY3Rpb24gKGVsZW0sIF9hKSB7XG4gICAgICAgIHZhciBhZGFwdGVyID0gX2EuYWRhcHRlcjtcbiAgICAgICAgcmV0dXJuIGFkYXB0ZXIuaGFzQXR0cmliKGVsZW0sIFwicmVxdWlyZWRcIik7XG4gICAgfSxcbiAgICAvLyA6bWF0Y2hlcyhpbnB1dCwgc2VsZWN0LCB0ZXh0YXJlYSk6bm90KFtyZXF1aXJlZF0pXG4gICAgb3B0aW9uYWw6IGZ1bmN0aW9uIChlbGVtLCBfYSkge1xuICAgICAgICB2YXIgYWRhcHRlciA9IF9hLmFkYXB0ZXI7XG4gICAgICAgIHJldHVybiAhYWRhcHRlci5oYXNBdHRyaWIoZWxlbSwgXCJyZXF1aXJlZFwiKTtcbiAgICB9LFxuICAgIC8vIEpRdWVyeSBleHRlbnNpb25zXG4gICAgLy8gOm5vdCg6ZW1wdHkpXG4gICAgcGFyZW50OiBmdW5jdGlvbiAoZWxlbSwgb3B0aW9ucykge1xuICAgICAgICByZXR1cm4gIWV4cG9ydHMucHNldWRvcy5lbXB0eShlbGVtLCBvcHRpb25zKTtcbiAgICB9LFxuICAgIC8vIDptYXRjaGVzKGgxLCBoMiwgaDMsIGg0LCBoNSwgaDYpXG4gICAgaGVhZGVyOiBuYW1lUHNldWRvKFtcImgxXCIsIFwiaDJcIiwgXCJoM1wiLCBcImg0XCIsIFwiaDVcIiwgXCJoNlwiXSksXG4gICAgLy8gOm1hdGNoZXMoYnV0dG9uLCBpbnB1dFt0eXBlPWJ1dHRvbl0pXG4gICAgYnV0dG9uOiBmdW5jdGlvbiAoZWxlbSwgX2EpIHtcbiAgICAgICAgdmFyIGFkYXB0ZXIgPSBfYS5hZGFwdGVyO1xuICAgICAgICB2YXIgbmFtZSA9IGFkYXB0ZXIuZ2V0TmFtZShlbGVtKTtcbiAgICAgICAgcmV0dXJuIChuYW1lID09PSBcImJ1dHRvblwiIHx8XG4gICAgICAgICAgICAobmFtZSA9PT0gXCJpbnB1dFwiICYmXG4gICAgICAgICAgICAgICAgYWRhcHRlci5nZXRBdHRyaWJ1dGVWYWx1ZShlbGVtLCBcInR5cGVcIikgPT09IFwiYnV0dG9uXCIpKTtcbiAgICB9LFxuICAgIC8vIDptYXRjaGVzKGlucHV0LCB0ZXh0YXJlYSwgc2VsZWN0LCBidXR0b24pXG4gICAgaW5wdXQ6IG5hbWVQc2V1ZG8oW1wiaW5wdXRcIiwgXCJ0ZXh0YXJlYVwiLCBcInNlbGVjdFwiLCBcImJ1dHRvblwiXSksXG4gICAgLy8gYGlucHV0Om1hdGNoZXMoOm5vdChbdHlwZSE9JyddKSwgW3R5cGU9J3RleHQnIGldKWBcbiAgICB0ZXh0OiBmdW5jdGlvbiAoZWxlbSwgX2EpIHtcbiAgICAgICAgdmFyIGFkYXB0ZXIgPSBfYS5hZGFwdGVyO1xuICAgICAgICB2YXIgdHlwZSA9IGFkYXB0ZXIuZ2V0QXR0cmlidXRlVmFsdWUoZWxlbSwgXCJ0eXBlXCIpO1xuICAgICAgICByZXR1cm4gKGFkYXB0ZXIuZ2V0TmFtZShlbGVtKSA9PT0gXCJpbnB1dFwiICYmXG4gICAgICAgICAgICAoIXR5cGUgfHwgdHlwZS50b0xvd2VyQ2FzZSgpID09PSBcInRleHRcIikpO1xuICAgIH0sXG59O1xuZnVuY3Rpb24gbmFtZVBzZXVkbyhuYW1lcykge1xuICAgIGlmICh0eXBlb2YgU2V0ICE9PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICAgIHZhciBuYW1lU2V0XzEgPSBuZXcgU2V0KG5hbWVzKTtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChlbGVtLCBfYSkge1xuICAgICAgICAgICAgdmFyIGFkYXB0ZXIgPSBfYS5hZGFwdGVyO1xuICAgICAgICAgICAgcmV0dXJuIG5hbWVTZXRfMS5oYXMoYWRhcHRlci5nZXROYW1lKGVsZW0pKTtcbiAgICAgICAgfTtcbiAgICB9XG4gICAgcmV0dXJuIGZ1bmN0aW9uIChlbGVtLCBfYSkge1xuICAgICAgICB2YXIgYWRhcHRlciA9IF9hLmFkYXB0ZXI7XG4gICAgICAgIHJldHVybiBuYW1lcy5pbmNsdWRlcyhhZGFwdGVyLmdldE5hbWUoZWxlbSkpO1xuICAgIH07XG59XG5mdW5jdGlvbiB2ZXJpZnlQc2V1ZG9BcmdzKGZ1bmMsIG5hbWUsIHN1YnNlbGVjdCkge1xuICAgIGlmIChzdWJzZWxlY3QgPT09IG51bGwpIHtcbiAgICAgICAgaWYgKGZ1bmMubGVuZ3RoID4gMiAmJiBuYW1lICE9PSBcInNjb3BlXCIpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcInBzZXVkby1zZWxlY3RvciA6XCIgKyBuYW1lICsgXCIgcmVxdWlyZXMgYW4gYXJndW1lbnRcIik7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGlmIChmdW5jLmxlbmd0aCA9PT0gMikge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwicHNldWRvLXNlbGVjdG9yIDpcIiArIG5hbWUgKyBcIiBkb2Vzbid0IGhhdmUgYW55IGFyZ3VtZW50c1wiKTtcbiAgICAgICAgfVxuICAgIH1cbn1cbmV4cG9ydHMudmVyaWZ5UHNldWRvQXJncyA9IHZlcmlmeVBzZXVkb0FyZ3M7XG4iXX0=