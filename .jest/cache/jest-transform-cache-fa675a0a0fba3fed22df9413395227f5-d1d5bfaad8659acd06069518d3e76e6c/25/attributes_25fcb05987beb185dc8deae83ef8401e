924b6f0a17c6dd5cffdd4b3d8bea9c2d
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var text = require('../static').text;

var utils = require('../utils');

var isTag = utils.isTag;
var domEach = utils.domEach;
var hasOwn = Object.prototype.hasOwnProperty;
var camelCase = utils.camelCase;
var cssCase = utils.cssCase;
var rspace = /\s+/;
var dataAttrPrefix = 'data-';
var primitives = {
  null: null,
  true: true,
  false: false
};
var rboolean = /^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i;
var rbrace = /^(?:\{[\w\W]*\}|\[[\w\W]*\])$/;

var getAttr = function getAttr(elem, name) {
  if (!elem || !isTag(elem)) return;

  if (!elem.attribs) {
    elem.attribs = {};
  }

  if (!name) {
    return elem.attribs;
  }

  if (hasOwn.call(elem.attribs, name)) {
    return rboolean.test(name) ? name : elem.attribs[name];
  }

  if (elem.name === 'option' && name === 'value') {
    return text(elem.children);
  }

  if (elem.name === 'input' && (elem.attribs.type === 'radio' || elem.attribs.type === 'checkbox') && name === 'value') {
    return 'on';
  }
};

var setAttr = function setAttr(el, name, value) {
  if (value === null) {
    removeAttribute(el, name);
  } else {
    el.attribs[name] = value + '';
  }
};

exports.attr = function (name, value) {
  if (typeof name === 'object' || value !== undefined) {
    if (typeof value === 'function') {
      return domEach(this, function (i, el) {
        setAttr(el, name, value.call(el, i, el.attribs[name]));
      });
    }

    return domEach(this, function (i, el) {
      if (!isTag(el)) return;

      if (typeof name === 'object') {
        Object.keys(name).forEach(function (objName) {
          var objValue = name[objName];
          setAttr(el, objName, objValue);
        });
      } else {
        setAttr(el, name, value);
      }
    });
  }

  return getAttr(this[0], name);
};

var getProp = function getProp(el, name) {
  if (!el || !isTag(el)) return;
  return name in el ? el[name] : rboolean.test(name) ? getAttr(el, name) !== undefined : getAttr(el, name);
};

var setProp = function setProp(el, name, value) {
  el[name] = rboolean.test(name) ? !!value : value;
};

exports.prop = function (name, value) {
  var i = 0;
  var property;

  if (typeof name === 'string' && value === undefined) {
    switch (name) {
      case 'style':
        property = this.css();
        Object.keys(property).forEach(function (p) {
          property[i++] = p;
        });
        property.length = i;
        break;

      case 'tagName':
      case 'nodeName':
        property = this[0].name.toUpperCase();
        break;

      case 'outerHTML':
        property = this.clone().wrap('<container />').parent().html();
        break;

      default:
        property = getProp(this[0], name);
    }

    return property;
  }

  if (typeof name === 'object' || value !== undefined) {
    if (typeof value === 'function') {
      return domEach(this, function (j, el) {
        setProp(el, name, value.call(el, j, getProp(el, name)));
      });
    }

    return domEach(this, function (__, el) {
      if (!isTag(el)) return;

      if (typeof name === 'object') {
        Object.keys(name).forEach(function (key) {
          var val = name[key];
          setProp(el, key, val);
        });
      } else {
        setProp(el, name, value);
      }
    });
  }
};

var setData = function setData(el, name, value) {
  if (!el.data) {
    el.data = {};
  }

  if (typeof name === 'object') return (0, _extends2.default)(el.data, name);

  if (typeof name === 'string' && value !== undefined) {
    el.data[name] = value;
  }
};

var readData = function readData(el, name) {
  var readAll = arguments.length === 1;
  var domNames;
  var domName;
  var jsNames;
  var jsName;
  var value;
  var idx;
  var length;

  if (readAll) {
    domNames = Object.keys(el.attribs).filter(function (attrName) {
      return attrName.slice(0, dataAttrPrefix.length) === dataAttrPrefix;
    });
    jsNames = domNames.map(function (_domName) {
      return camelCase(_domName.slice(dataAttrPrefix.length));
    });
  } else {
    domNames = [dataAttrPrefix + cssCase(name)];
    jsNames = [name];
  }

  for (idx = 0, length = domNames.length; idx < length; ++idx) {
    domName = domNames[idx];
    jsName = jsNames[idx];

    if (hasOwn.call(el.attribs, domName) && !hasOwn.call(el.data, jsName)) {
      value = el.attribs[domName];

      if (hasOwn.call(primitives, value)) {
        value = primitives[value];
      } else if (value === String(Number(value))) {
        value = Number(value);
      } else if (rbrace.test(value)) {
        try {
          value = JSON.parse(value);
        } catch (e) {}
      }

      el.data[jsName] = value;
    }
  }

  return readAll ? el.data : value;
};

exports.data = function (name, value) {
  var elem = this[0];
  if (!elem || !isTag(elem)) return;

  if (!elem.data) {
    elem.data = {};
  }

  if (!name) {
    return readData(elem);
  }

  if (typeof name === 'object' || value !== undefined) {
    domEach(this, function (i, el) {
      setData(el, name, value);
    });
    return this;
  } else if (hasOwn.call(elem.data, name)) {
    return elem.data[name];
  }

  return readData(elem, name);
};

exports.val = function (value) {
  var querying = arguments.length === 0;
  var element = this[0];
  if (!element) return;

  switch (element.name) {
    case 'textarea':
      return this.text(value);

    case 'input':
      if (this.attr('type') === 'radio') {
        if (querying) {
          return this.attr('value');
        }

        this.attr('value', value);
        return this;
      }

      return this.attr('value', value);

    case 'select':
      var option = this.find('option:selected');
      var returnValue;
      if (option === undefined) return undefined;

      if (!querying) {
        if (!hasOwn.call(this.attr(), 'multiple') && typeof value == 'object') {
          return this;
        }

        if (typeof value != 'object') {
          value = [value];
        }

        this.find('option').removeAttr('selected');

        for (var i = 0; i < value.length; i++) {
          this.find('option[value="' + value[i] + '"]').attr('selected', '');
        }

        return this;
      }

      returnValue = option.attr('value');

      if (hasOwn.call(this.attr(), 'multiple')) {
        returnValue = [];
        domEach(option, function (__, el) {
          returnValue.push(getAttr(el, 'value'));
        });
      }

      return returnValue;

    case 'option':
      if (!querying) {
        this.attr('value', value);
        return this;
      }

      return this.attr('value');
  }
};

var removeAttribute = function removeAttribute(elem, name) {
  if (!elem.attribs || !hasOwn.call(elem.attribs, name)) return;
  delete elem.attribs[name];
};

var splitNames = function splitNames(names) {
  return names ? names.trim().split(rspace) : [];
};

exports.removeAttr = function (name) {
  var attrNames = splitNames(name);

  for (var i = 0; i < attrNames.length; i++) {
    domEach(this, function (j, elem) {
      removeAttribute(elem, attrNames[i]);
    });
  }

  return this;
};

exports.hasClass = function (className) {
  return this.toArray().some(function (elem) {
    var attrs = elem.attribs;
    var clazz = attrs && attrs['class'];
    var idx = -1;
    var end;

    if (clazz && className.length) {
      while ((idx = clazz.indexOf(className, idx + 1)) > -1) {
        end = idx + className.length;

        if ((idx === 0 || rspace.test(clazz[idx - 1])) && (end === clazz.length || rspace.test(clazz[end]))) {
          return true;
        }
      }
    }
  });
};

exports.addClass = function (value) {
  if (typeof value === 'function') {
    return domEach(this, function (i, el) {
      var className = el.attribs['class'] || '';
      exports.addClass.call([el], value.call(el, i, className));
    });
  }

  if (!value || typeof value !== 'string') return this;
  var classNames = value.split(rspace);
  var numElements = this.length;

  for (var i = 0; i < numElements; i++) {
    if (!isTag(this[i])) continue;
    var className = getAttr(this[i], 'class');
    var numClasses;
    var setClass;

    if (!className) {
      setAttr(this[i], 'class', classNames.join(' ').trim());
    } else {
      setClass = ' ' + className + ' ';
      numClasses = classNames.length;

      for (var j = 0; j < numClasses; j++) {
        var appendClass = classNames[j] + ' ';
        if (setClass.indexOf(' ' + appendClass) < 0) setClass += appendClass;
      }

      setAttr(this[i], 'class', setClass.trim());
    }
  }

  return this;
};

exports.removeClass = function (value) {
  var classes;
  var numClasses;
  var removeAll;

  if (typeof value === 'function') {
    return domEach(this, function (i, el) {
      exports.removeClass.call([el], value.call(el, i, el.attribs['class'] || ''));
    });
  }

  classes = splitNames(value);
  numClasses = classes.length;
  removeAll = arguments.length === 0;
  return domEach(this, function (i, el) {
    if (!isTag(el)) return;

    if (removeAll) {
      el.attribs.class = '';
    } else {
      var elClasses = splitNames(el.attribs.class);
      var index;
      var changed;

      for (var j = 0; j < numClasses; j++) {
        index = elClasses.indexOf(classes[j]);

        if (index >= 0) {
          elClasses.splice(index, 1);
          changed = true;
          j--;
        }
      }

      if (changed) {
        el.attribs.class = elClasses.join(' ');
      }
    }
  });
};

exports.toggleClass = function (value, stateVal) {
  if (typeof value === 'function') {
    return domEach(this, function (i, el) {
      exports.toggleClass.call([el], value.call(el, i, el.attribs['class'] || '', stateVal), stateVal);
    });
  }

  if (!value || typeof value !== 'string') return this;
  var classNames = value.split(rspace);
  var numClasses = classNames.length;
  var state = typeof stateVal === 'boolean' ? stateVal ? 1 : -1 : 0;
  var numElements = this.length;
  var elementClasses;
  var index;

  for (var i = 0; i < numElements; i++) {
    if (!isTag(this[i])) continue;
    elementClasses = splitNames(this[i].attribs.class);

    for (var j = 0; j < numClasses; j++) {
      index = elementClasses.indexOf(classNames[j]);

      if (state >= 0 && index < 0) {
        elementClasses.push(classNames[j]);
      } else if (state <= 0 && index >= 0) {
        elementClasses.splice(index, 1);
      }
    }

    this[i].attribs.class = elementClasses.join(' ');
  }

  return this;
};

exports.is = function (selector) {
  if (selector) {
    return this.filter(selector).length > 0;
  }

  return false;
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF0dHJpYnV0ZXMuanMiXSwibmFtZXMiOlsidGV4dCIsInJlcXVpcmUiLCJ1dGlscyIsImlzVGFnIiwiZG9tRWFjaCIsImhhc093biIsIk9iamVjdCIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwiY2FtZWxDYXNlIiwiY3NzQ2FzZSIsInJzcGFjZSIsImRhdGFBdHRyUHJlZml4IiwicHJpbWl0aXZlcyIsIm51bGwiLCJ0cnVlIiwiZmFsc2UiLCJyYm9vbGVhbiIsInJicmFjZSIsImdldEF0dHIiLCJlbGVtIiwibmFtZSIsImF0dHJpYnMiLCJjYWxsIiwidGVzdCIsImNoaWxkcmVuIiwidHlwZSIsInNldEF0dHIiLCJlbCIsInZhbHVlIiwicmVtb3ZlQXR0cmlidXRlIiwiZXhwb3J0cyIsImF0dHIiLCJ1bmRlZmluZWQiLCJpIiwia2V5cyIsImZvckVhY2giLCJvYmpOYW1lIiwib2JqVmFsdWUiLCJnZXRQcm9wIiwic2V0UHJvcCIsInByb3AiLCJwcm9wZXJ0eSIsImNzcyIsInAiLCJsZW5ndGgiLCJ0b1VwcGVyQ2FzZSIsImNsb25lIiwid3JhcCIsInBhcmVudCIsImh0bWwiLCJqIiwiX18iLCJrZXkiLCJ2YWwiLCJzZXREYXRhIiwiZGF0YSIsInJlYWREYXRhIiwicmVhZEFsbCIsImFyZ3VtZW50cyIsImRvbU5hbWVzIiwiZG9tTmFtZSIsImpzTmFtZXMiLCJqc05hbWUiLCJpZHgiLCJmaWx0ZXIiLCJhdHRyTmFtZSIsInNsaWNlIiwibWFwIiwiX2RvbU5hbWUiLCJTdHJpbmciLCJOdW1iZXIiLCJKU09OIiwicGFyc2UiLCJlIiwicXVlcnlpbmciLCJlbGVtZW50Iiwib3B0aW9uIiwiZmluZCIsInJldHVyblZhbHVlIiwicmVtb3ZlQXR0ciIsInB1c2giLCJzcGxpdE5hbWVzIiwibmFtZXMiLCJ0cmltIiwic3BsaXQiLCJhdHRyTmFtZXMiLCJoYXNDbGFzcyIsImNsYXNzTmFtZSIsInRvQXJyYXkiLCJzb21lIiwiYXR0cnMiLCJjbGF6eiIsImVuZCIsImluZGV4T2YiLCJhZGRDbGFzcyIsImNsYXNzTmFtZXMiLCJudW1FbGVtZW50cyIsIm51bUNsYXNzZXMiLCJzZXRDbGFzcyIsImpvaW4iLCJhcHBlbmRDbGFzcyIsInJlbW92ZUNsYXNzIiwiY2xhc3NlcyIsInJlbW92ZUFsbCIsImNsYXNzIiwiZWxDbGFzc2VzIiwiaW5kZXgiLCJjaGFuZ2VkIiwic3BsaWNlIiwidG9nZ2xlQ2xhc3MiLCJzdGF0ZVZhbCIsInN0YXRlIiwiZWxlbWVudENsYXNzZXMiLCJpcyIsInNlbGVjdG9yIl0sIm1hcHBpbmdzIjoiOzs7O0FBTUEsSUFBSUEsSUFBSSxHQUFHQyxPQUFPLENBQUMsV0FBRCxDQUFQLENBQXFCRCxJQUFoQzs7QUFDQSxJQUFJRSxLQUFLLEdBQUdELE9BQU8sQ0FBQyxVQUFELENBQW5COztBQUNBLElBQUlFLEtBQUssR0FBR0QsS0FBSyxDQUFDQyxLQUFsQjtBQUNBLElBQUlDLE9BQU8sR0FBR0YsS0FBSyxDQUFDRSxPQUFwQjtBQUNBLElBQUlDLE1BQU0sR0FBR0MsTUFBTSxDQUFDQyxTQUFQLENBQWlCQyxjQUE5QjtBQUNBLElBQUlDLFNBQVMsR0FBR1AsS0FBSyxDQUFDTyxTQUF0QjtBQUNBLElBQUlDLE9BQU8sR0FBR1IsS0FBSyxDQUFDUSxPQUFwQjtBQUNBLElBQUlDLE1BQU0sR0FBRyxLQUFiO0FBQ0EsSUFBSUMsY0FBYyxHQUFHLE9BQXJCO0FBR0EsSUFBSUMsVUFBVSxHQUFHO0FBQ2ZDLEVBQUFBLElBQUksRUFBRSxJQURTO0FBRWZDLEVBQUFBLElBQUksRUFBRSxJQUZTO0FBR2ZDLEVBQUFBLEtBQUssRUFBRTtBQUhRLENBQWpCO0FBTUEsSUFBSUMsUUFBUSxHQUFHLDZIQUFmO0FBRUEsSUFBSUMsTUFBTSxHQUFHLCtCQUFiOztBQUVBLElBQUlDLE9BQU8sR0FBRyxTQUFWQSxPQUFVLENBQVVDLElBQVYsRUFBZ0JDLElBQWhCLEVBQXNCO0FBQ2xDLE1BQUksQ0FBQ0QsSUFBRCxJQUFTLENBQUNqQixLQUFLLENBQUNpQixJQUFELENB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QjtBQUVuQ00sUUFBQUEsY0FBYyxDQUFDSixNQUFmLENBQXNCRixLQUF0QixFQUE2QixDQUE3QjtBQUNEO0FBQ0Y7O0FBRUQsU0FBS3pFLENBQUwsRUFBUVosT0FBUixDQUFnQm1GLEtBQWhCLEdBQXdCUSxjQUFjLENBQUNiLElBQWYsQ0FBb0IsR0FBcEIsQ0FBeEI7QUFDRDs7QUFFRCxTQUFPLElBQVA7QUFDRCxDQTlDRDs7QUEyREFyRSxPQUFPLENBQUNtRixFQUFSLEdBQWEsVUFBVUMsUUFBVixFQUFvQjtBQUMvQixNQUFJQSxRQUFKLEVBQWM7QUFDWixXQUFPLEtBQUtsRCxNQUFMLENBQVlrRCxRQUFaLEVBQXNCdEUsTUFBdEIsR0FBK0IsQ0FBdEM7QUFDRDs7QUFDRCxTQUFPLEtBQVA7QUFDRCxDQUxEIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBNZXRob2RzIGZvciBnZXR0aW5nIGFuZCBtb2RpZnlpbmcgYXR0cmlidXRlcy5cbiAqXG4gKiBAbW9kdWxlIGNoZWVyaW8vYXR0cmlidXRlc1xuICovXG5cbnZhciB0ZXh0ID0gcmVxdWlyZSgnLi4vc3RhdGljJykudGV4dDtcbnZhciB1dGlscyA9IHJlcXVpcmUoJy4uL3V0aWxzJyk7XG52YXIgaXNUYWcgPSB1dGlscy5pc1RhZztcbnZhciBkb21FYWNoID0gdXRpbHMuZG9tRWFjaDtcbnZhciBoYXNPd24gPSBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5O1xudmFyIGNhbWVsQ2FzZSA9IHV0aWxzLmNhbWVsQ2FzZTtcbnZhciBjc3NDYXNlID0gdXRpbHMuY3NzQ2FzZTtcbnZhciByc3BhY2UgPSAvXFxzKy87XG52YXIgZGF0YUF0dHJQcmVmaXggPSAnZGF0YS0nO1xuLy8gTG9va3VwIHRhYmxlIGZvciBjb2VyY2luZyBzdHJpbmcgZGF0YS0qIGF0dHJpYnV0ZXMgdG8gdGhlaXIgY29ycmVzcG9uZGluZ1xuLy8gSmF2YVNjcmlwdCBwcmltaXRpdmVzXG52YXIgcHJpbWl0aXZlcyA9IHtcbiAgbnVsbDogbnVsbCxcbiAgdHJ1ZTogdHJ1ZSxcbiAgZmFsc2U6IGZhbHNlLFxufTtcbi8vIEF0dHJpYnV0ZXMgdGhhdCBhcmUgYm9vbGVhbnNcbnZhciByYm9vbGVhbiA9IC9eKD86YXV0b2ZvY3VzfGF1dG9wbGF5fGFzeW5jfGNoZWNrZWR8Y29udHJvbHN8ZGVmZXJ8ZGlzYWJsZWR8aGlkZGVufGxvb3B8bXVsdGlwbGV8b3BlbnxyZWFkb25seXxyZXF1aXJlZHxzY29wZWR8c2VsZWN0ZWQpJC9pO1xuLy8gTWF0Y2hlcyBzdHJpbmdzIHRoYXQgbG9vayBsaWtlIEpTT04gb2JqZWN0cyBvciBhcnJheXNcbnZhciByYnJhY2UgPSAvXig/Olxce1tcXHdcXFddKlxcfXxcXFtbXFx3XFxXXSpcXF0pJC87XG5cbnZhciBnZXRBdHRyID0gZnVuY3Rpb24gKGVsZW0sIG5hbWUpIHtcbiAgaWYgKCFlbGVtIHx8ICFpc1RhZyhlbGVtKSkgcmV0dXJuO1xuXG4gIGlmICghZWxlbS5hdHRyaWJzKSB7XG4gICAgZWxlbS5hdHRyaWJzID0ge307XG4gIH1cblxuICAvLyBSZXR1cm4gdGhlIGVudGlyZSBhdHRyaWJzIG9iamVjdCBpZiBubyBhdHRyaWJ1dGUgc3BlY2lmaWVkXG4gIGlmICghbmFtZSkge1xuICAgIHJldHVybiBlbGVtLmF0dHJpYnM7XG4gIH1cblxuICBpZiAoaGFzT3duLmNhbGwoZWxlbS5hdHRyaWJzLCBuYW1lKSkge1xuICAgIC8vIEdldCB0aGUgKGRlY29kZWQpIGF0dHJpYnV0ZVxuICAgIHJldHVybiByYm9vbGVhbi50ZXN0KG5hbWUpID8gbmFtZSA6IGVsZW0uYXR0cmlic1tuYW1lXTtcbiAgfVxuXG4gIC8vIE1pbWljIHRoZSBET00gYW5kIHJldHVybiB0ZXh0IGNvbnRlbnQgYXMgdmFsdWUgZm9yIGBvcHRpb24nc2BcbiAgaWYgKGVsZW0ubmFtZSA9PT0gJ29wdGlvbicgJiYgbmFtZSA9PT0gJ3ZhbHVlJykge1xuICAgIHJldHVybiB0ZXh0KGVsZW0uY2hpbGRyZW4pO1xuICB9XG5cbiAgLy8gTWltaWMgRE9NIHdpdGggZGVmYXVsdCB2YWx1ZSBmb3IgcmFkaW9zL2NoZWNrYm94ZXNcbiAgaWYgKFxuICAgIGVsZW0ubmFtZSA9PT0gJ2lucHV0JyAmJlxuICAgIChlbGVtLmF0dHJpYnMudHlwZSA9PT0gJ3JhZGlvJyB8fCBlbGVtLmF0dHJpYnMudHlwZSA9PT0gJ2NoZWNrYm94JykgJiZcbiAgICBuYW1lID09PSAndmFsdWUnXG4gICkge1xuICAgIHJldHVybiAnb24nO1xuICB9XG59O1xuXG52YXIgc2V0QXR0ciA9IGZ1bmN0aW9uIChlbCwgbmFtZSwgdmFsdWUpIHtcbiAgaWYgKHZhbHVlID09PSBudWxsKSB7XG4gICAgcmVtb3ZlQXR0cmlidXRlKGVsLCBuYW1lKTtcbiAgfSBlbHNlIHtcbiAgICBlbC5hdHRyaWJzW25hbWVdID0gdmFsdWUgKyAnJztcbiAgfVxufTtcblxuLyoqXG4gKiBNZXRob2QgZm9yIGdldHRpbmcgYW5kIHNldHRpbmcgYXR0cmlidXRlcy4gR2V0cyB0aGUgYXR0cmlidXRlIHZhbHVlIGZvciBvbmx5XG4gKiB0aGUgZmlyc3QgZWxlbWVudCBpbiB0aGUgbWF0Y2hlZCBzZXQuIElmIHlvdSBzZXQgYW4gYXR0cmlidXRlJ3MgdmFsdWUgdG9cbiAqIGBudWxsYCwgeW91IHJlbW92ZSB0aGF0IGF0dHJpYnV0ZS4gWW91IG1heSBhbHNvIHBhc3MgYSBgbWFwYCBhbmQgYGZ1bmN0aW9uYFxuICogbGlrZSBqUXVlcnkuXG4gKlxuICogQGV4YW1wbGVcbiAqXG4gKiAkKCd1bCcpLmF0dHIoJ2lkJylcbiAqIC8vPT4gZnJ1aXRzXG4gKlxuICogJCgnLmFwcGxlJykuYXR0cignaWQnLCAnZmF2b3JpdGUnKS5odG1sKClcbiAqIC8vPT4gPGxpIGNsYXNzPVwiYXBwbGVcIiBpZD1cImZhdm9yaXRlXCI+QXBwbGU8L2xpPlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lIC0gTmFtZSBvZiB0aGUgYXR0cmlidXRlLlxuICogQHBhcmFtIHtzdHJpbmd9IFt2YWx1ZV0gLSBJZiBzcGVjaWZpZWQgc2V0cyB0aGUgdmFsdWUgb2YgdGhlIGF0dHJpYnV0ZS5cbiAqXG4gKiBAc2VlIHtAbGluayBodHRwOi8vYXBpLmpxdWVyeS5jb20vYXR0ci99XG4gKi9cbmV4cG9ydHMuYXR0ciA9IGZ1bmN0aW9uIChuYW1lLCB2YWx1ZSkge1xuICAvLyBTZXQgdGhlIHZhbHVlICh3aXRoIGF0dHIgbWFwIHN1cHBvcnQpXG4gIGlmICh0eXBlb2YgbmFtZSA9PT0gJ29iamVjdCcgfHwgdmFsdWUgIT09IHVuZGVmaW5lZCkge1xuICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgIHJldHVybiBkb21FYWNoKHRoaXMsIGZ1bmN0aW9uIChpLCBlbCkge1xuICAgICAgICBzZXRBdHRyKGVsLCBuYW1lLCB2YWx1ZS5jYWxsKGVsLCBpLCBlbC5hdHRyaWJzW25hbWVdKSk7XG4gICAgICB9KTtcbiAgICB9XG4gICAgcmV0dXJuIGRvbUVhY2godGhpcywgZnVuY3Rpb24gKGksIGVsKSB7XG4gICAgICBpZiAoIWlzVGFnKGVsKSkgcmV0dXJuO1xuXG4gICAgICBpZiAodHlwZW9mIG5hbWUgPT09ICdvYmplY3QnKSB7XG4gICAgICAgIE9iamVjdC5rZXlzKG5hbWUpLmZvckVhY2goZnVuY3Rpb24gKG9iak5hbWUpIHtcbiAgICAgICAgICB2YXIgb2JqVmFsdWUgPSBuYW1lW29iak5hbWVdO1xuICAgICAgICAgIHNldEF0dHIoZWwsIG9iak5hbWUsIG9ialZhbHVlKTtcbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBzZXRBdHRyKGVsLCBuYW1lLCB2YWx1ZSk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICByZXR1cm4gZ2V0QXR0cih0aGlzWzBdLCBuYW1lKTtcbn07XG5cbnZhciBnZXRQcm9wID0gZnVuY3Rpb24gKGVsLCBuYW1lKSB7XG4gIGlmICghZWwgfHwgIWlzVGFnKGVsKSkgcmV0dXJuO1xuXG4gIHJldHVybiBuYW1lIGluIGVsXG4gICAgPyBlbFtuYW1lXVxuICAgIDogcmJvb2xlYW4udGVzdChuYW1lKVxuICAgID8gZ2V0QXR0cihlbCwgbmFtZSkgIT09IHVuZGVmaW5lZFxuICAgIDogZ2V0QXR0cihlbCwgbmFtZSk7XG59O1xuXG52YXIgc2V0UHJvcCA9IGZ1bmN0aW9uIChlbCwgbmFtZSwgdmFsdWUpIHtcbiAgZWxbbmFtZV0gPSByYm9vbGVhbi50ZXN0KG5hbWUpID8gISF2YWx1ZSA6IHZhbHVlO1xufTtcblxuLyoqXG4gKiBNZXRob2QgZm9yIGdldHRpbmcgYW5kIHNldHRpbmcgcHJvcGVydGllcy4gR2V0cyB0aGUgcHJvcGVydHkgdmFsdWUgZm9yIG9ubHlcbiAqIHRoZSBmaXJzdCBlbGVtZW50IGluIHRoZSBtYXRjaGVkIHNldC5cbiAqXG4gKiBAZXhhbXBsZVxuICpcbiAqICQoJ2lucHV0W3R5cGU9XCJjaGVja2JveFwiXScpLnByb3AoJ2NoZWNrZWQnKVxuICogLy89PiBmYWxzZVxuICpcbiAqICQoJ2lucHV0W3R5cGU9XCJjaGVja2JveFwiXScpLnByb3AoJ2NoZWNrZWQnLCB0cnVlKS52YWwoKVxuICogLy89PiBva1xuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lIC0gTmFtZSBvZiB0aGUgcHJvcGVydHkuXG4gKiBAcGFyYW0ge2FueX0gW3ZhbHVlXSAtIElmIHNwZWNpZmllZCBzZXQgdGhlIHByb3BlcnR5IHRvIHRoaXMuXG4gKlxuICogQHNlZSB7QGxpbmsgaHR0cDovL2FwaS5qcXVlcnkuY29tL3Byb3AvfVxuICovXG5leHBvcnRzLnByb3AgPSBmdW5jdGlvbiAobmFtZSwgdmFsdWUpIHtcbiAgdmFyIGkgPSAwO1xuICB2YXIgcHJvcGVydHk7XG5cbiAgaWYgKHR5cGVvZiBuYW1lID09PSAnc3RyaW5nJyAmJiB2YWx1ZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgc3dpdGNoIChuYW1lKSB7XG4gICAgICBjYXNlICdzdHlsZSc6XG4gICAgICAgIHByb3BlcnR5ID0gdGhpcy5jc3MoKTtcblxuICAgICAgICBPYmplY3Qua2V5cyhwcm9wZXJ0eSkuZm9yRWFjaChmdW5jdGlvbiAocCkge1xuICAgICAgICAgIHByb3BlcnR5W2krK10gPSBwO1xuICAgICAgICB9KTtcblxuICAgICAgICBwcm9wZXJ0eS5sZW5ndGggPSBpO1xuXG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAndGFnTmFtZSc6XG4gICAgICBjYXNlICdub2RlTmFtZSc6XG4gICAgICAgIHByb3BlcnR5ID0gdGhpc1swXS5uYW1lLnRvVXBwZXJDYXNlKCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnb3V0ZXJIVE1MJzpcbiAgICAgICAgcHJvcGVydHkgPSB0aGlzLmNsb25lKCkud3JhcCgnPGNvbnRhaW5lciAvPicpLnBhcmVudCgpLmh0bWwoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBwcm9wZXJ0eSA9IGdldFByb3AodGhpc1swXSwgbmFtZSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHByb3BlcnR5O1xuICB9XG5cbiAgaWYgKHR5cGVvZiBuYW1lID09PSAnb2JqZWN0JyB8fCB2YWx1ZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgcmV0dXJuIGRvbUVhY2godGhpcywgZnVuY3Rpb24gKGosIGVsKSB7XG4gICAgICAgIHNldFByb3AoZWwsIG5hbWUsIHZhbHVlLmNhbGwoZWwsIGosIGdldFByb3AoZWwsIG5hbWUpKSk7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICByZXR1cm4gZG9tRWFjaCh0aGlzLCBmdW5jdGlvbiAoX18sIGVsKSB7XG4gICAgICBpZiAoIWlzVGFnKGVsKSkgcmV0dXJuO1xuXG4gICAgICBpZiAodHlwZW9mIG5hbWUgPT09ICdvYmplY3QnKSB7XG4gICAgICAgIE9iamVjdC5rZXlzKG5hbWUpLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuICAgICAgICAgIHZhciB2YWwgPSBuYW1lW2tleV07XG4gICAgICAgICAgc2V0UHJvcChlbCwga2V5LCB2YWwpO1xuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHNldFByb3AoZWwsIG5hbWUsIHZhbHVlKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxufTtcblxudmFyIHNldERhdGEgPSBmdW5jdGlvbiAoZWwsIG5hbWUsIHZhbHVlKSB7XG4gIGlmICghZWwuZGF0YSkge1xuICAgIGVsLmRhdGEgPSB7fTtcbiAgfVxuXG4gIGlmICh0eXBlb2YgbmFtZSA9PT0gJ29iamVjdCcpIHJldHVybiBPYmplY3QuYXNzaWduKGVsLmRhdGEsIG5hbWUpO1xuICBpZiAodHlwZW9mIG5hbWUgPT09ICdzdHJpbmcnICYmIHZhbHVlICE9PSB1bmRlZmluZWQpIHtcbiAgICBlbC5kYXRhW25hbWVdID0gdmFsdWU7XG4gIH1cbn07XG5cbi8vIFJlYWQgdGhlIHNwZWNpZmllZCBhdHRyaWJ1dGUgZnJvbSB0aGUgZXF1aXZhbGVudCBIVE1MNSBgZGF0YS0qYCBhdHRyaWJ1dGUsXG4vLyBhbmQgKGlmIHByZXNlbnQpIGNhY2hlIHRoZSB2YWx1ZSBpbiB0aGUgbm9kZSdzIGludGVybmFsIGRhdGEgc3RvcmUuIElmIG5vXG4vLyBhdHRyaWJ1dGUgbmFtZSBpcyBzcGVjaWZpZWQsIHJlYWQgKmFsbCogSFRNTDUgYGRhdGEtKmAgYXR0cmlidXRlcyBpbiB0aGlzXG4vLyBtYW5uZXIuXG52YXIgcmVhZERhdGEgPSBmdW5jdGlvbiAoZWwsIG5hbWUpIHtcbiAgdmFyIHJlYWRBbGwgPSBhcmd1bWVudHMubGVuZ3RoID09PSAxO1xuICB2YXIgZG9tTmFtZXM7XG4gIHZhciBkb21OYW1lO1xuICB2YXIganNOYW1lcztcbiAgdmFyIGpzTmFtZTtcbiAgdmFyIHZhbHVlO1xuICB2YXIgaWR4O1xuICB2YXIgbGVuZ3RoO1xuXG4gIGlmIChyZWFkQWxsKSB7XG4gICAgZG9tTmFtZXMgPSBPYmplY3Qua2V5cyhlbC5hdHRyaWJzKS5maWx0ZXIoZnVuY3Rpb24gKGF0dHJOYW1lKSB7XG4gICAgICByZXR1cm4gYXR0ck5hbWUuc2xpY2UoMCwgZGF0YUF0dHJQcmVmaXgubGVuZ3RoKSA9PT0gZGF0YUF0dHJQcmVmaXg7XG4gICAgfSk7XG4gICAganNOYW1lcyA9IGRvbU5hbWVzLm1hcChmdW5jdGlvbiAoX2RvbU5hbWUpIHtcbiAgICAgIHJldHVybiBjYW1lbENhc2UoX2RvbU5hbWUuc2xpY2UoZGF0YUF0dHJQcmVmaXgubGVuZ3RoKSk7XG4gICAgfSk7XG4gIH0gZWxzZSB7XG4gICAgZG9tTmFtZXMgPSBbZGF0YUF0dHJQcmVmaXggKyBjc3NDYXNlKG5hbWUpXTtcbiAgICBqc05hbWVzID0gW25hbWVdO1xuICB9XG5cbiAgZm9yIChpZHggPSAwLCBsZW5ndGggPSBkb21OYW1lcy5sZW5ndGg7IGlkeCA8IGxlbmd0aDsgKytpZHgpIHtcbiAgICBkb21OYW1lID0gZG9tTmFtZXNbaWR4XTtcbiAgICBqc05hbWUgPSBqc05hbWVzW2lkeF07XG4gICAgaWYgKGhhc093bi5jYWxsKGVsLmF0dHJpYnMsIGRvbU5hbWUpICYmICFoYXNPd24uY2FsbChlbC5kYXRhLCBqc05hbWUpKSB7XG4gICAgICB2YWx1ZSA9IGVsLmF0dHJpYnNbZG9tTmFtZV07XG5cbiAgICAgIGlmIChoYXNPd24uY2FsbChwcmltaXRpdmVzLCB2YWx1ZSkpIHtcbiAgICAgICAgdmFsdWUgPSBwcmltaXRpdmVzW3ZhbHVlXTtcbiAgICAgIH0gZWxzZSBpZiAodmFsdWUgPT09IFN0cmluZyhOdW1iZXIodmFsdWUpKSkge1xuICAgICAgICB2YWx1ZSA9IE51bWJlcih2YWx1ZSk7XG4gICAgICB9IGVsc2UgaWYgKHJicmFjZS50ZXN0KHZhbHVlKSkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIHZhbHVlID0gSlNPTi5wYXJzZSh2YWx1ZSk7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAvKiBpZ25vcmUgKi9cbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBlbC5kYXRhW2pzTmFtZV0gPSB2YWx1ZTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gcmVhZEFsbCA/IGVsLmRhdGEgOiB2YWx1ZTtcbn07XG5cbi8qKlxuICogTWV0aG9kIGZvciBnZXR0aW5nIGFuZCBzZXR0aW5nIGRhdGEgYXR0cmlidXRlcy4gR2V0cyBvciBzZXRzIHRoZSBkYXRhXG4gKiBhdHRyaWJ1dGUgdmFsdWUgZm9yIG9ubHkgdGhlIGZpcnN0IGVsZW1lbnQgaW4gdGhlIG1hdGNoZWQgc2V0LlxuICpcbiAqIEBleGFtcGxlXG4gKlxuICogJCgnPGRpdiBkYXRhLWFwcGxlLWNvbG9yPVwicmVkXCI+PC9kaXY+JykuZGF0YSgpXG4gKiAvLz0+IHsgYXBwbGVDb2xvcjogJ3JlZCcgfVxuICpcbiAqICQoJzxkaXYgZGF0YS1hcHBsZS1jb2xvcj1cInJlZFwiPjwvZGl2PicpLmRhdGEoJ2FwcGxlLWNvbG9yJylcbiAqIC8vPT4gJ3JlZCdcbiAqXG4gKiBjb25zdCBhcHBsZSA9ICQoJy5hcHBsZScpLmRhdGEoJ2tpbmQnLCAnbWFjJylcbiAqIGFwcGxlLmRhdGEoJ2tpbmQnKVxuICogLy89PiAnbWFjJ1xuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lIC0gTmFtZSBvZiB0aGUgYXR0cmlidXRlLlxuICogQHBhcmFtIHthbnl9IFt2YWx1ZV0gLSBJZiBzcGVjaWZpZWQgbmV3IHZhbHVlLlxuICpcbiAqIEBzZWUge0BsaW5rIGh0dHA6Ly9hcGkuanF1ZXJ5LmNvbS9kYXRhL31cbiAqL1xuZXhwb3J0cy5kYXRhID0gZnVuY3Rpb24gKG5hbWUsIHZhbHVlKSB7XG4gIHZhciBlbGVtID0gdGhpc1swXTtcblxuICBpZiAoIWVsZW0gfHwgIWlzVGFnKGVsZW0pKSByZXR1cm47XG5cbiAgaWYgKCFlbGVtLmRhdGEpIHtcbiAgICBlbGVtLmRhdGEgPSB7fTtcbiAgfVxuXG4gIC8vIFJldHVybiB0aGUgZW50aXJlIGRhdGEgb2JqZWN0IGlmIG5vIGRhdGEgc3BlY2lmaWVkXG4gIGlmICghbmFtZSkge1xuICAgIHJldHVybiByZWFkRGF0YShlbGVtKTtcbiAgfVxuXG4gIC8vIFNldCB0aGUgdmFsdWUgKHdpdGggYXR0ciBtYXAgc3VwcG9ydClcbiAgaWYgKHR5cGVvZiBuYW1lID09PSAnb2JqZWN0JyB8fCB2YWx1ZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgZG9tRWFjaCh0aGlzLCBmdW5jdGlvbiAoaSwgZWwpIHtcbiAgICAgIHNldERhdGEoZWwsIG5hbWUsIHZhbHVlKTtcbiAgICB9KTtcbiAgICByZXR1cm4gdGhpcztcbiAgfSBlbHNlIGlmIChoYXNPd24uY2FsbChlbGVtLmRhdGEsIG5hbWUpKSB7XG4gICAgcmV0dXJuIGVsZW0uZGF0YVtuYW1lXTtcbiAgfVxuXG4gIHJldHVybiByZWFkRGF0YShlbGVtLCBuYW1lKTtcbn07XG5cbi8qKlxuICogTWV0aG9kIGZvciBnZXR0aW5nIGFuZCBzZXR0aW5nIHRoZSB2YWx1ZSBvZiBpbnB1dCwgc2VsZWN0LCBhbmQgdGV4dGFyZWEuXG4gKiBOb3RlOiBTdXBwb3J0IGZvciBgbWFwYCwgYW5kIGBmdW5jdGlvbmAgaGFzIG5vdCBiZWVuIGFkZGVkIHlldC5cbiAqXG4gKiBAZXhhbXBsZVxuICpcbiAqICQoJ2lucHV0W3R5cGU9XCJ0ZXh0XCJdJykudmFsKClcbiAqIC8vPT4gaW5wdXRfdGV4dFxuICpcbiAqICQoJ2lucHV0W3R5cGU9XCJ0ZXh0XCJdJykudmFsKCd0ZXN0JykuaHRtbCgpXG4gKiAvLz0+IDxpbnB1dCB0eXBlPVwidGV4dFwiIHZhbHVlPVwidGVzdFwiLz5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gW3ZhbHVlXSAtIElmIHNwZWNpZmllZCBuZXcgdmFsdWUuXG4gKlxuICogQHNlZSB7QGxpbmsgaHR0cDovL2FwaS5qcXVlcnkuY29tL3ZhbC99XG4gKi9cbmV4cG9ydHMudmFsID0gZnVuY3Rpb24gKHZhbHVlKSB7XG4gIHZhciBxdWVyeWluZyA9IGFyZ3VtZW50cy5sZW5ndGggPT09IDA7XG4gIHZhciBlbGVtZW50ID0gdGhpc1swXTtcblxuICBpZiAoIWVsZW1lbnQpIHJldHVybjtcblxuICBzd2l0Y2ggKGVsZW1lbnQubmFtZSkge1xuICAgIGNhc2UgJ3RleHRhcmVhJzpcbiAgICAgIHJldHVybiB0aGlzLnRleHQodmFsdWUpO1xuICAgIGNhc2UgJ2lucHV0JzpcbiAgICAgIGlmICh0aGlzLmF0dHIoJ3R5cGUnKSA9PT0gJ3JhZGlvJykge1xuICAgICAgICBpZiAocXVlcnlpbmcpIHtcbiAgICAgICAgICByZXR1cm4gdGhpcy5hdHRyKCd2YWx1ZScpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5hdHRyKCd2YWx1ZScsIHZhbHVlKTtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB0aGlzLmF0dHIoJ3ZhbHVlJywgdmFsdWUpO1xuICAgIGNhc2UgJ3NlbGVjdCc6XG4gICAgICB2YXIgb3B0aW9uID0gdGhpcy5maW5kKCdvcHRpb246c2VsZWN0ZWQnKTtcbiAgICAgIHZhciByZXR1cm5WYWx1ZTtcbiAgICAgIGlmIChvcHRpb24gPT09IHVuZGVmaW5lZCkgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICAgIGlmICghcXVlcnlpbmcpIHtcbiAgICAgICAgaWYgKCFoYXNPd24uY2FsbCh0aGlzLmF0dHIoKSwgJ211bHRpcGxlJykgJiYgdHlwZW9mIHZhbHVlID09ICdvYmplY3QnKSB7XG4gICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSAhPSAnb2JqZWN0Jykge1xuICAgICAgICAgIHZhbHVlID0gW3ZhbHVlXTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmZpbmQoJ29wdGlvbicpLnJlbW92ZUF0dHIoJ3NlbGVjdGVkJyk7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdmFsdWUubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICB0aGlzLmZpbmQoJ29wdGlvblt2YWx1ZT1cIicgKyB2YWx1ZVtpXSArICdcIl0nKS5hdHRyKCdzZWxlY3RlZCcsICcnKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgIH1cbiAgICAgIHJldHVyblZhbHVlID0gb3B0aW9uLmF0dHIoJ3ZhbHVlJyk7XG4gICAgICBpZiAoaGFzT3duLmNhbGwodGhpcy5hdHRyKCksICdtdWx0aXBsZScpKSB7XG4gICAgICAgIHJldHVyblZhbHVlID0gW107XG4gICAgICAgIGRvbUVhY2gob3B0aW9uLCBmdW5jdGlvbiAoX18sIGVsKSB7XG4gICAgICAgICAgcmV0dXJuVmFsdWUucHVzaChnZXRBdHRyKGVsLCAndmFsdWUnKSk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHJldHVyblZhbHVlO1xuICAgIGNhc2UgJ29wdGlvbic6XG4gICAgICBpZiAoIXF1ZXJ5aW5nKSB7XG4gICAgICAgIHRoaXMuYXR0cigndmFsdWUnLCB2YWx1ZSk7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHRoaXMuYXR0cigndmFsdWUnKTtcbiAgfVxufTtcblxuLyoqXG4gKiBSZW1vdmUgYW4gYXR0cmlidXRlLlxuICpcbiAqIEBwcml2YXRlXG4gKiBAcGFyYW0ge25vZGV9IGVsZW0gLSBOb2RlIHRvIHJlbW92ZSBhdHRyaWJ1dGUgZnJvbS5cbiAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lIC0gTmFtZSBvZiB0aGUgYXR0cmlidXRlIHRvIHJlbW92ZS5cbiAqL1xudmFyIHJlbW92ZUF0dHJpYnV0ZSA9IGZ1bmN0aW9uIChlbGVtLCBuYW1lKSB7XG4gIGlmICghZWxlbS5hdHRyaWJzIHx8ICFoYXNPd24uY2FsbChlbGVtLmF0dHJpYnMsIG5hbWUpKSByZXR1cm47XG5cbiAgZGVsZXRlIGVsZW0uYXR0cmlic1tuYW1lXTtcbn07XG5cbi8qKlxuICogU3BsaXRzIGEgc3BhY2Utc2VwYXJhdGVkIGxpc3Qgb2YgbmFtZXMgdG8gaW5kaXZpZHVhbFxuICogbmFtZXMuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IG5hbWVzIC0gIE5hbWVzIHRvIHNwbGl0LlxuICogQHJldHVybnMge3N0cmluZ1tdfSAtIFNwbGl0IG5hbWVzLlxuICovXG52YXIgc3BsaXROYW1lcyA9IGZ1bmN0aW9uIChuYW1lcykge1xuICByZXR1cm4gbmFtZXMgPyBuYW1lcy50cmltKCkuc3BsaXQocnNwYWNlKSA6IFtdO1xufTtcblxuLyoqXG4gKiBNZXRob2QgZm9yIHJlbW92aW5nIGF0dHJpYnV0ZXMgYnkgYG5hbWVgLlxuICpcbiAqIEBleGFtcGxlXG4gKlxuICogJCgnLnBlYXInKS5yZW1vdmVBdHRyKCdjbGFzcycpLmh0bWwoKVxuICogLy89PiA8bGk+UGVhcjwvbGk+XG4gKlxuICogJCgnLmFwcGxlJykuYXR0cignaWQnLCAnZmF2b3JpdGUnKVxuICogJCgnLmFwcGxlJykucmVtb3ZlQXR0cignaWQgY2xhc3MnKS5odG1sKClcbiAqIC8vPT4gPGxpPkFwcGxlPC9saT5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gbmFtZSAtIE5hbWUgb2YgdGhlIGF0dHJpYnV0ZS5cbiAqXG4gKiBAc2VlIHtAbGluayBodHRwOi8vYXBpLmpxdWVyeS5jb20vcmVtb3ZlQXR0ci99XG4gKi9cbmV4cG9ydHMucmVtb3ZlQXR0ciA9IGZ1bmN0aW9uIChuYW1lKSB7XG4gIHZhciBhdHRyTmFtZXMgPSBzcGxpdE5hbWVzKG5hbWUpO1xuXG4gIGZvciAodmFyIGkgPSAwOyBpIDwgYXR0ck5hbWVzLmxlbmd0aDsgaSsrKSB7XG4gICAgZG9tRWFjaCh0aGlzLCBmdW5jdGlvbiAoaiwgZWxlbSkge1xuICAgICAgcmVtb3ZlQXR0cmlidXRlKGVsZW0sIGF0dHJOYW1lc1tpXSk7XG4gICAgfSk7XG4gIH1cblxuICByZXR1cm4gdGhpcztcbn07XG5cbi8qKlxuICogQ2hlY2sgdG8gc2VlIGlmICphbnkqIG9mIHRoZSBtYXRjaGVkIGVsZW1lbnRzIGhhdmUgdGhlIGdpdmVuIGBjbGFzc05hbWVgLlxuICpcbiAqIEBleGFtcGxlXG4gKlxuICogJCgnLnBlYXInKS5oYXNDbGFzcygncGVhcicpXG4gKiAvLz0+IHRydWVcbiAqXG4gKiAkKCdhcHBsZScpLmhhc0NsYXNzKCdmcnVpdCcpXG4gKiAvLz0+IGZhbHNlXG4gKlxuICogJCgnbGknKS5oYXNDbGFzcygncGVhcicpXG4gKiAvLz0+IHRydWVcbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gY2xhc3NOYW1lIC0gTmFtZSBvZiB0aGUgY2xhc3MuXG4gKlxuICogQHNlZSB7QGxpbmsgaHR0cDovL2FwaS5qcXVlcnkuY29tL2hhc0NsYXNzL31cbiAqL1xuZXhwb3J0cy5oYXNDbGFzcyA9IGZ1bmN0aW9uIChjbGFzc05hbWUpIHtcbiAgcmV0dXJuIHRoaXMudG9BcnJheSgpLnNvbWUoZnVuY3Rpb24gKGVsZW0pIHtcbiAgICB2YXIgYXR0cnMgPSBlbGVtLmF0dHJpYnM7XG4gICAgdmFyIGNsYXp6ID0gYXR0cnMgJiYgYXR0cnNbJ2NsYXNzJ107XG4gICAgdmFyIGlkeCA9IC0xO1xuICAgIHZhciBlbmQ7XG5cbiAgICBpZiAoY2xhenogJiYgY2xhc3NOYW1lLmxlbmd0aCkge1xuICAgICAgd2hpbGUgKChpZHggPSBjbGF6ei5pbmRleE9mKGNsYXNzTmFtZSwgaWR4ICsgMSkpID4gLTEpIHtcbiAgICAgICAgZW5kID0gaWR4ICsgY2xhc3NOYW1lLmxlbmd0aDtcblxuICAgICAgICBpZiAoXG4gICAgICAgICAgKGlkeCA9PT0gMCB8fCByc3BhY2UudGVzdChjbGF6eltpZHggLSAxXSkpICYmXG4gICAgICAgICAgKGVuZCA9PT0gY2xhenoubGVuZ3RoIHx8IHJzcGFjZS50ZXN0KGNsYXp6W2VuZF0pKVxuICAgICAgICApIHtcbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfSk7XG59O1xuXG4vKipcbiAqIEFkZHMgY2xhc3MoZXMpIHRvIGFsbCBvZiB0aGUgbWF0Y2hlZCBlbGVtZW50cy4gQWxzbyBhY2NlcHRzIGEgYGZ1bmN0aW9uYFxuICogbGlrZSBqUXVlcnkuXG4gKlxuICogQGV4YW1wbGVcbiAqXG4gKiAkKCcucGVhcicpLmFkZENsYXNzKCdmcnVpdCcpLmh0bWwoKVxuICogLy89PiA8bGkgY2xhc3M9XCJwZWFyIGZydWl0XCI+UGVhcjwvbGk+XG4gKlxuICogJCgnLmFwcGxlJykuYWRkQ2xhc3MoJ2ZydWl0IHJlZCcpLmh0bWwoKVxuICogLy89PiA8bGkgY2xhc3M9XCJhcHBsZSBmcnVpdCByZWRcIj5BcHBsZTwvbGk+XG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHZhbHVlIC0gTmFtZSBvZiBuZXcgY2xhc3MuXG4gKlxuICogQHNlZSB7QGxpbmsgaHR0cDovL2FwaS5qcXVlcnkuY29tL2FkZENsYXNzL31cbiAqL1xuZXhwb3J0cy5hZGRDbGFzcyA9IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAvLyBTdXBwb3J0IGZ1bmN0aW9uc1xuICBpZiAodHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgcmV0dXJuIGRvbUVhY2godGhpcywgZnVuY3Rpb24gKGksIGVsKSB7XG4gICAgICB2YXIgY2xhc3NOYW1lID0gZWwuYXR0cmlic1snY2xhc3MnXSB8fCAnJztcbiAgICAgIGV4cG9ydHMuYWRkQ2xhc3MuY2FsbChbZWxdLCB2YWx1ZS5jYWxsKGVsLCBpLCBjbGFzc05hbWUpKTtcbiAgICB9KTtcbiAgfVxuXG4gIC8vIFJldHVybiBpZiBubyB2YWx1ZSBvciBub3QgYSBzdHJpbmcgb3IgZnVuY3Rpb25cbiAgaWYgKCF2YWx1ZSB8fCB0eXBlb2YgdmFsdWUgIT09ICdzdHJpbmcnKSByZXR1cm4gdGhpcztcblxuICB2YXIgY2xhc3NOYW1lcyA9IHZhbHVlLnNwbGl0KHJzcGFjZSk7XG4gIHZhciBudW1FbGVtZW50cyA9IHRoaXMubGVuZ3RoO1xuXG4gIGZvciAodmFyIGkgPSAwOyBpIDwgbnVtRWxlbWVudHM7IGkrKykge1xuICAgIC8vIElmIHNlbGVjdGVkIGVsZW1lbnQgaXNuJ3QgYSB0YWcsIG1vdmUgb25cbiAgICBpZiAoIWlzVGFnKHRoaXNbaV0pKSBjb250aW51ZTtcblxuICAgIC8vIElmIHdlIGRvbid0IGFscmVhZHkgaGF2ZSBjbGFzc2VzXG4gICAgdmFyIGNsYXNzTmFtZSA9IGdldEF0dHIodGhpc1tpXSwgJ2NsYXNzJyk7XG4gICAgdmFyIG51bUNsYXNzZXM7XG4gICAgdmFyIHNldENsYXNzO1xuXG4gICAgaWYgKCFjbGFzc05hbWUpIHtcbiAgICAgIHNldEF0dHIodGhpc1tpXSwgJ2NsYXNzJywgY2xhc3NOYW1lcy5qb2luKCcgJykudHJpbSgpKTtcbiAgICB9IGVsc2Uge1xuICAgICAgc2V0Q2xhc3MgPSAnICcgKyBjbGFzc05hbWUgKyAnICc7XG4gICAgICBudW1DbGFzc2VzID0gY2xhc3NOYW1lcy5sZW5ndGg7XG5cbiAgICAgIC8vIENoZWNrIGlmIGNsYXNzIGFscmVhZHkgZXhpc3RzXG4gICAgICBmb3IgKHZhciBqID0gMDsgaiA8IG51bUNsYXNzZXM7IGorKykge1xuICAgICAgICB2YXIgYXBwZW5kQ2xhc3MgPSBjbGFzc05hbWVzW2pdICsgJyAnO1xuICAgICAgICBpZiAoc2V0Q2xhc3MuaW5kZXhPZignICcgKyBhcHBlbmRDbGFzcykgPCAwKSBzZXRDbGFzcyArPSBhcHBlbmRDbGFzcztcbiAgICAgIH1cblxuICAgICAgc2V0QXR0cih0aGlzW2ldLCAnY2xhc3MnLCBzZXRDbGFzcy50cmltKCkpO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiB0aGlzO1xufTtcblxuLyoqXG4gKiBSZW1vdmVzIG9uZSBvciBtb3JlIHNwYWNlLXNlcGFyYXRlZCBjbGFzc2VzIGZyb20gdGhlIHNlbGVjdGVkIGVsZW1lbnRzLiBJZlxuICogbm8gYGNsYXNzTmFtZWAgaXMgZGVmaW5lZCwgYWxsIGNsYXNzZXMgd2lsbCBiZSByZW1vdmVkLiBBbHNvIGFjY2VwdHMgYVxuICogYGZ1bmN0aW9uYCBsaWtlIGpRdWVyeS5cbiAqXG4gKiBAZXhhbXBsZVxuICpcbiAqICQoJy5wZWFyJykucmVtb3ZlQ2xhc3MoJ3BlYXInKS5odG1sKClcbiAqIC8vPT4gPGxpIGNsYXNzPVwiXCI+UGVhcjwvbGk+XG4gKlxuICogJCgnLmFwcGxlJykuYWRkQ2xhc3MoJ3JlZCcpLnJlbW92ZUNsYXNzKCkuaHRtbCgpXG4gKiAvLz0+IDxsaSBjbGFzcz1cIlwiPkFwcGxlPC9saT5cbiAqIEBwYXJhbSB7c3RyaW5nfSB2YWx1ZSAtIE5hbWUgb2YgdGhlIGNsYXNzLlxuICpcbiAqIEBzZWUge0BsaW5rIGh0dHA6Ly9hcGkuanF1ZXJ5LmNvbS9yZW1vdmVDbGFzcy99XG4gKi9cbmV4cG9ydHMucmVtb3ZlQ2xhc3MgPSBmdW5jdGlvbiAodmFsdWUpIHtcbiAgdmFyIGNsYXNzZXM7XG4gIHZhciBudW1DbGFzc2VzO1xuICB2YXIgcmVtb3ZlQWxsO1xuXG4gIC8vIEhhbmRsZSBpZiB2YWx1ZSBpcyBhIGZ1bmN0aW9uXG4gIGlmICh0eXBlb2YgdmFsdWUgPT09ICdmdW5jdGlvbicpIHtcbiAgICByZXR1cm4gZG9tRWFjaCh0aGlzLCBmdW5jdGlvbiAoaSwgZWwpIHtcbiAgICAgIGV4cG9ydHMucmVtb3ZlQ2xhc3MuY2FsbChcbiAgICAgICAgW2VsXSxcbiAgICAgICAgdmFsdWUuY2FsbChlbCwgaSwgZWwuYXR0cmlic1snY2xhc3MnXSB8fCAnJylcbiAgICAgICk7XG4gICAgfSk7XG4gIH1cblxuICBjbGFzc2VzID0gc3BsaXROYW1lcyh2YWx1ZSk7XG4gIG51bUNsYXNzZXMgPSBjbGFzc2VzLmxlbmd0aDtcbiAgcmVtb3ZlQWxsID0gYXJndW1lbnRzLmxlbmd0aCA9PT0gMDtcblxuICByZXR1cm4gZG9tRWFjaCh0aGlzLCBmdW5jdGlvbiAoaSwgZWwpIHtcbiAgICBpZiAoIWlzVGFnKGVsKSkgcmV0dXJuO1xuXG4gICAgaWYgKHJlbW92ZUFsbCkge1xuICAgICAgLy8gU2hvcnQgY2lyY3VpdCB0aGUgcmVtb3ZlIGFsbCBjYXNlIGFzIHRoaXMgaXMgdGhlIG5pY2Ugb25lXG4gICAgICBlbC5hdHRyaWJzLmNsYXNzID0gJyc7XG4gICAgfSBlbHNlIHtcbiAgICAgIHZhciBlbENsYXNzZXMgPSBzcGxpdE5hbWVzKGVsLmF0dHJpYnMuY2xhc3MpO1xuICAgICAgdmFyIGluZGV4O1xuICAgICAgdmFyIGNoYW5nZWQ7XG5cbiAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgbnVtQ2xhc3NlczsgaisrKSB7XG4gICAgICAgIGluZGV4ID0gZWxDbGFzc2VzLmluZGV4T2YoY2xhc3Nlc1tqXSk7XG5cbiAgICAgICAgaWYgKGluZGV4ID49IDApIHtcbiAgICAgICAgICBlbENsYXNzZXMuc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgICBjaGFuZ2VkID0gdHJ1ZTtcblxuICAgICAgICAgIC8vIFdlIGhhdmUgdG8gZG8gYW5vdGhlciBwYXNzIHRvIGVuc3VyZSB0aGF0IHRoZXJlIGFyZSBub3QgZHVwbGljYXRlXG4gICAgICAgICAgLy8gY2xhc3NlcyBsaXN0ZWRcbiAgICAgICAgICBqLS07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmIChjaGFuZ2VkKSB7XG4gICAgICAgIGVsLmF0dHJpYnMuY2xhc3MgPSBlbENsYXNzZXMuam9pbignICcpO1xuICAgICAgfVxuICAgIH1cbiAgfSk7XG59O1xuXG4vKipcbiAqIEFkZCBvciByZW1vdmUgY2xhc3MoZXMpIGZyb20gdGhlIG1hdGNoZWQgZWxlbWVudHMsIGRlcGVuZGluZyBvbiBlaXRoZXIgdGhlXG4gKiBjbGFzcydzIHByZXNlbmNlIG9yIHRoZSB2YWx1ZSBvZiB0aGUgc3dpdGNoIGFyZ3VtZW50LiBBbHNvIGFjY2VwdHMgYVxuICogYGZ1bmN0aW9uYCBsaWtlIGpRdWVyeS5cbiAqXG4gKiBAZXhhbXBsZVxuICpcbiAqICQoJy5hcHBsZS5ncmVlbicpLnRvZ2dsZUNsYXNzKCdmcnVpdCBncmVlbiByZWQnKS5odG1sKClcbiAqIC8vPT4gPGxpIGNsYXNzPVwiYXBwbGUgZnJ1aXQgcmVkXCI+QXBwbGU8L2xpPlxuICpcbiAqICQoJy5hcHBsZS5ncmVlbicpLnRvZ2dsZUNsYXNzKCdmcnVpdCBncmVlbiByZWQnLCB0cnVlKS5odG1sKClcbiAqIC8vPT4gPGxpIGNsYXNzPVwiYXBwbGUgZ3JlZW4gZnJ1aXQgcmVkXCI+QXBwbGU8L2xpPlxuICpcbiAqIEBwYXJhbSB7KHN0cmluZ3xGdW5jdGlvbil9IHZhbHVlIC0gTmFtZSBvZiB0aGUgY2xhc3MuIENhbiBhbHNvIGJlIGEgZnVuY3Rpb24uXG4gKiBAcGFyYW0ge2Jvb2xlYW59IFtzdGF0ZVZhbF0gLSBJZiBzcGVjaWZpZWQgdGhlIHN0YXRlIG9mIHRoZSBjbGFzcy5cbiAqXG4gKiBAc2VlIHtAbGluayBodHRwOi8vYXBpLmpxdWVyeS5jb20vdG9nZ2xlQ2xhc3MvfVxuICovXG5leHBvcnRzLnRvZ2dsZUNsYXNzID0gZnVuY3Rpb24gKHZhbHVlLCBzdGF0ZVZhbCkge1xuICAvLyBTdXBwb3J0IGZ1bmN0aW9uc1xuICBpZiAodHlwZW9mIHZhbHVlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgcmV0dXJuIGRvbUVhY2godGhpcywgZnVuY3Rpb24gKGksIGVsKSB7XG4gICAgICBleHBvcnRzLnRvZ2dsZUNsYXNzLmNhbGwoXG4gICAgICAgIFtlbF0sXG4gICAgICAgIHZhbHVlLmNhbGwoZWwsIGksIGVsLmF0dHJpYnNbJ2NsYXNzJ10gfHwgJycsIHN0YXRlVmFsKSxcbiAgICAgICAgc3RhdGVWYWxcbiAgICAgICk7XG4gICAgfSk7XG4gIH1cblxuICAvLyBSZXR1cm4gaWYgbm8gdmFsdWUgb3Igbm90IGEgc3RyaW5nIG9yIGZ1bmN0aW9uXG4gIGlmICghdmFsdWUgfHwgdHlwZW9mIHZhbHVlICE9PSAnc3RyaW5nJykgcmV0dXJuIHRoaXM7XG5cbiAgdmFyIGNsYXNzTmFtZXMgPSB2YWx1ZS5zcGxpdChyc3BhY2UpO1xuICB2YXIgbnVtQ2xhc3NlcyA9IGNsYXNzTmFtZXMubGVuZ3RoO1xuICB2YXIgc3RhdGUgPSB0eXBlb2Ygc3RhdGVWYWwgPT09ICdib29sZWFuJyA/IChzdGF0ZVZhbCA/IDEgOiAtMSkgOiAwO1xuICB2YXIgbnVtRWxlbWVudHMgPSB0aGlzLmxlbmd0aDtcbiAgdmFyIGVsZW1lbnRDbGFzc2VzO1xuICB2YXIgaW5kZXg7XG5cbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBudW1FbGVtZW50czsgaSsrKSB7XG4gICAgLy8gSWYgc2VsZWN0ZWQgZWxlbWVudCBpc24ndCBhIHRhZywgbW92ZSBvblxuICAgIGlmICghaXNUYWcodGhpc1tpXSkpIGNvbnRpbnVlO1xuXG4gICAgZWxlbWVudENsYXNzZXMgPSBzcGxpdE5hbWVzKHRoaXNbaV0uYXR0cmlicy5jbGFzcyk7XG5cbiAgICAvLyBDaGVjayBpZiBjbGFzcyBhbHJlYWR5IGV4aXN0c1xuICAgIGZvciAodmFyIGogPSAwOyBqIDwgbnVtQ2xhc3NlczsgaisrKSB7XG4gICAgICAvLyBDaGVjayBpZiB0aGUgY2xhc3MgbmFtZSBpcyBjdXJyZW50bHkgZGVmaW5lZFxuICAgICAgaW5kZXggPSBlbGVtZW50Q2xhc3Nlcy5pbmRleE9mKGNsYXNzTmFtZXNbal0pO1xuXG4gICAgICAvLyBBZGQgaWYgc3RhdGVWYWx1ZSA9PT0gdHJ1ZSBvciB3ZSBhcmUgdG9nZ2xpbmcgYW5kIHRoZXJlIGlzIG5vIHZhbHVlXG4gICAgICBpZiAoc3RhdGUgPj0gMCAmJiBpbmRleCA8IDApIHtcbiAgICAgICAgZWxlbWVudENsYXNzZXMucHVzaChjbGFzc05hbWVzW2pdKTtcbiAgICAgIH0gZWxzZSBpZiAoc3RhdGUgPD0gMCAmJiBpbmRleCA+PSAwKSB7XG4gICAgICAgIC8vIE90aGVyd2lzZSByZW1vdmUgYnV0IG9ubHkgaWYgdGhlIGl0ZW0gZXhpc3RzXG4gICAgICAgIGVsZW1lbnRDbGFzc2VzLnNwbGljZShpbmRleCwgMSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgdGhpc1tpXS5hdHRyaWJzLmNsYXNzID0gZWxlbWVudENsYXNzZXMuam9pbignICcpO1xuICB9XG5cbiAgcmV0dXJuIHRoaXM7XG59O1xuXG4vKipcbiAqIENoZWNrcyB0aGUgY3VycmVudCBsaXN0IG9mIGVsZW1lbnRzIGFuZCByZXR1cm5zIGB0cnVlYCBpZiBfYW55XyBvZiB0aGVcbiAqIGVsZW1lbnRzIG1hdGNoIHRoZSBzZWxlY3Rvci4gSWYgdXNpbmcgYW4gZWxlbWVudCBvciBDaGVlcmlvIHNlbGVjdGlvbixcbiAqIHJldHVybnMgYHRydWVgIGlmIF9hbnlfIG9mIHRoZSBlbGVtZW50cyBtYXRjaC4gSWYgdXNpbmcgYSBwcmVkaWNhdGVcbiAqIGZ1bmN0aW9uLCB0aGUgZnVuY3Rpb24gaXMgZXhlY3V0ZWQgaW4gdGhlIGNvbnRleHQgb2YgdGhlIHNlbGVjdGVkIGVsZW1lbnQsXG4gKiBzbyBgdGhpc2AgcmVmZXJzIHRvIHRoZSBjdXJyZW50IGVsZW1lbnQuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd8RnVuY3Rpb258Y2hlZXJpb3xub2RlfSBzZWxlY3RvciAtIFNlbGVjdG9yIGZvciB0aGUgc2VsZWN0aW9uLlxuICpcbiAqIEBzZWUge0BsaW5rIGh0dHA6Ly9hcGkuanF1ZXJ5LmNvbS9pcy99XG4gKi9cbmV4cG9ydHMuaXMgPSBmdW5jdGlvbiAoc2VsZWN0b3IpIHtcbiAgaWYgKHNlbGVjdG9yKSB7XG4gICAgcmV0dXJuIHRoaXMuZmlsdGVyKHNlbGVjdG9yKS5sZW5ndGggPiAwO1xuICB9XG4gIHJldHVybiBmYWxzZTtcbn07XG4iXX0=