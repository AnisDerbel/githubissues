107bf4bfd8b25649640819361434b303
"use strict";

var _interopRequireDefault2 = require("@babel/runtime/helpers/interopRequireDefault");

var _defineProperty2 = _interopRequireDefault2(require("@babel/runtime/helpers/defineProperty"));

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.isSagaWrapper = isSagaWrapper;
exports.default = createSagaWrapper;

var _fsmIterator = _interopRequireDefault(require("fsm-iterator"));

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : {
    default: obj
  };
}

var INIT = 'INIT';
var REFINE = 'REFINE';
var NEXT = 'NEXT';
var LOOP = 'LOOP';
var FALSY = '@@redux-saga-test-plan/falsy';
var SAGA_WRAPPER = '@@redux-saga-test-plan/saga-wrapper';

function wrapFalsy(value) {
  if (!value && value != null) {
    var _ref;

    return _ref = {}, (0, _defineProperty2.default)(_ref, FALSY, true), (0, _defineProperty2.default)(_ref, "value", value), _ref;
  }

  return value;
}

function unwrapFalsy(value) {
  if (value && typeof value === 'object' && value[FALSY]) {
    return value.value;
  }

  return value;
}

function isSagaWrapper(saga) {
  return saga[SAGA_WRAPPER];
}

function createSagaWrapper() {
  var name = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'sagaWrapper';

  function sagaWrapper(wrappedIterator, refineYieldedValue, onReturn, onError) {
    var _ref2;

    var result;

    function getNext() {
      try {
        return wrappedIterator.next.apply(wrappedIterator, arguments);
      } catch (e) {
        if (typeof onError === 'function') {
          onError(e);
        }

        throw e;
      }
    }

    function complete() {
      if (typeof onReturn === 'function') {
        onReturn(result.value);
      }

      return {
        value: result.value,
        done: true
      };
    }

    return (0, _fsmIterator.default)(INIT, (_ref2 = {}, (0, _defineProperty2.default)(_ref2, INIT, function (_, fsm) {
      result = getNext();
      return fsm[REFINE](undefined, fsm);
    }), (0, _defineProperty2.default)(_ref2, REFINE, function (_, fsm) {
      try {
        if (result.done) {
          return complete();
        }

        var value = refineYieldedValue(result.value);
        value = Array.isArray(value) ? value.map(wrapFalsy) : wrapFalsy(value);
        return {
          value: value,
          next: NEXT
        };
      } catch (e) {
        return fsm.throw(e, fsm);
      }
    }), (0, _defineProperty2.default)(_ref2, NEXT, function (response, fsm) {
      var finalResponse = Array.isArray(response) ? response.map(unwrapFalsy) : unwrapFalsy(response);
      result = getNext(finalResponse);
      return fsm[LOOP](undefined, fsm);
    }), (0, _defineProperty2.default)(_ref2, LOOP, function (_, fsm) {
      if (result.done) {
        return complete();
      }

      return fsm[REFINE](undefined, fsm);
    }), (0, _defineProperty2.default)(_ref2, "return", function _return(value, fsm) {
      result = wrappedIterator.return(value);
      return fsm[LOOP](undefined, fsm);
    }), (0, _defineProperty2.default)(_ref2, "throw", function _throw(e, fsm) {
      try {
        result = wrappedIterator.throw(e);
      } catch (innerError) {
        if (typeof onError === 'function') {
          onError(innerError);
        }

        throw innerError;
      }

      return fsm[LOOP](undefined, fsm);
    }), _ref2));
  }

  sagaWrapper[SAGA_WRAPPER] = true;

  try {
    Object.defineProperty(sagaWrapper, 'name', {
      value: name
    });
  } catch (e) {}

  return sagaWrapper;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNhZ2FXcmFwcGVyLmpzIl0sIm5hbWVzIjpbIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZXhwb3J0cyIsInZhbHVlIiwiaXNTYWdhV3JhcHBlciIsImRlZmF1bHQiLCJjcmVhdGVTYWdhV3JhcHBlciIsIl9mc21JdGVyYXRvciIsIl9pbnRlcm9wUmVxdWlyZURlZmF1bHQiLCJyZXF1aXJlIiwib2JqIiwiX19lc01vZHVsZSIsIklOSVQiLCJSRUZJTkUiLCJORVhUIiwiTE9PUCIsIkZBTFNZIiwiU0FHQV9XUkFQUEVSIiwid3JhcEZhbHN5IiwidW53cmFwRmFsc3kiLCJzYWdhIiwibmFtZSIsInNhZ2FXcmFwcGVyIiwid3JhcHBlZEl0ZXJhdG9yIiwicmVmaW5lWWllbGRlZFZhbHVlIiwib25SZXR1cm4iLCJvbkVycm9yIiwicmVzdWx0IiwiZ2V0TmV4dCIsIm5leHQiLCJlIiwiY29tcGxldGUiLCJkb25lIiwiXyIsImZzbSIsInVuZGVmaW5lZCIsIkFycmF5IiwiaXNBcnJheSIsIm1hcCIsInRocm93IiwicmVzcG9uc2UiLCJmaW5hbFJlc3BvbnNlIiwicmV0dXJuIiwiaW5uZXJFcnJvciJdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7OztBQUVBQSxNQUFNLENBQUNDLGNBQVAsQ0FBc0JDLE9BQXRCLEVBQStCLFlBQS9CLEVBQTZDO0FBQzNDQyxFQUFBQSxLQUFLLEVBQUU7QUFEb0MsQ0FBN0M7QUFHQUQsT0FBTyxDQUFDRSxhQUFSLEdBQXdCQSxhQUF4QjtBQUNBRixPQUFPLENBQUNHLE9BQVIsR0FBa0JDLGlCQUFsQjs7QUFFQSxJQUFJQyxZQUFZLEdBQUdDLHNCQUFzQixDQUFDQyxPQUFPLENBQUMsY0FBRCxDQUFSLENBQXpDOztBQUVBLFNBQVNELHNCQUFULENBQWdDRSxHQUFoQyxFQUFxQztBQUFFLFNBQU9BLEdBQUcsSUFBSUEsR0FBRyxDQUFDQyxVQUFYLEdBQXdCRCxHQUF4QixHQUE4QjtBQUFFTCxJQUFBQSxPQUFPLEVBQUVLO0FBQVgsR0FBckM7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YUFBT1QsR0FBRyxDQUFDbkIsSUFBRCxDQUFILENBQVVvQixTQUFWLEVBQXFCRCxHQUFyQixDQUFQO0FBQ0QsS0F0REksVUFBUDtBQXlERDs7QUFFRFosRUFBQUEsV0FBVyxDQUFDTCxZQUFELENBQVgsR0FBNEIsSUFBNUI7O0FBRUEsTUFBSTtBQUNGakIsSUFBQUEsTUFBTSxDQUFDQyxjQUFQLENBQXNCcUIsV0FBdEIsRUFBbUMsTUFBbkMsRUFBMkM7QUFDekNuQixNQUFBQSxLQUFLLEVBQUVrQjtBQURrQyxLQUEzQztBQUdELEdBSkQsQ0FJRSxPQUFPUyxDQUFQLEVBQVUsQ0FBRTs7QUFFZCxTQUFPUixXQUFQO0FBQ0QiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcblxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7XG4gIHZhbHVlOiB0cnVlXG59KTtcbmV4cG9ydHMuaXNTYWdhV3JhcHBlciA9IGlzU2FnYVdyYXBwZXI7XG5leHBvcnRzLmRlZmF1bHQgPSBjcmVhdGVTYWdhV3JhcHBlcjtcblxudmFyIF9mc21JdGVyYXRvciA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZShcImZzbS1pdGVyYXRvclwiKSk7XG5cbmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7IGRlZmF1bHQ6IG9iaiB9OyB9XG5cbmNvbnN0IElOSVQgPSAnSU5JVCc7XG5jb25zdCBSRUZJTkUgPSAnUkVGSU5FJztcbmNvbnN0IE5FWFQgPSAnTkVYVCc7XG5jb25zdCBMT09QID0gJ0xPT1AnO1xuY29uc3QgRkFMU1kgPSAnQEByZWR1eC1zYWdhLXRlc3QtcGxhbi9mYWxzeSc7XG5jb25zdCBTQUdBX1dSQVBQRVIgPSAnQEByZWR1eC1zYWdhLXRlc3QtcGxhbi9zYWdhLXdyYXBwZXInOyAvLyBUYWdnaW5nIGZhbHN5IHZhbHVlcyB0aGF0IGFyZW4ndCBudWxsIG9yIHVuZGVmaW5lZCBiZWNhdXNlXG4vLyByZWR1eC1zYWdhIGJsb2NrcyB3aGVuIHRoZXkgYXJlIHlpZWxkZWQuXG4vLyBodHRwczovL2dpdGh1Yi5jb20vamZhaXJiYW5rL3JlZHV4LXNhZ2EtdGVzdC1wbGFuL2lzc3Vlcy85NFxuXG5mdW5jdGlvbiB3cmFwRmFsc3kodmFsdWUpIHtcbiAgaWYgKCF2YWx1ZSAmJiB2YWx1ZSAhPSBudWxsKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIFtGQUxTWV06IHRydWUsXG4gICAgICB2YWx1ZVxuICAgIH07XG4gIH1cblxuICByZXR1cm4gdmFsdWU7XG59XG5cbmZ1bmN0aW9uIHVud3JhcEZhbHN5KHZhbHVlKSB7XG4gIGlmICh2YWx1ZSAmJiB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIHZhbHVlW0ZBTFNZXSkge1xuICAgIHJldHVybiB2YWx1ZS52YWx1ZTtcbiAgfVxuXG4gIHJldHVybiB2YWx1ZTtcbn1cblxuZnVuY3Rpb24gaXNTYWdhV3JhcHBlcihzYWdhKSB7XG4gIHJldHVybiBzYWdhW1NBR0FfV1JBUFBFUl07XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZVNhZ2FXcmFwcGVyKG5hbWUgPSAnc2FnYVdyYXBwZXInKSB7XG4gIGZ1bmN0aW9uIHNhZ2FXcmFwcGVyKHdyYXBwZWRJdGVyYXRvciwgcmVmaW5lWWllbGRlZFZhbHVlLCBvblJldHVybiwgb25FcnJvcikge1xuICAgIGxldCByZXN1bHQ7XG5cbiAgICBmdW5jdGlvbiBnZXROZXh0KC4uLmFyZ3MpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIHJldHVybiB3cmFwcGVkSXRlcmF0b3IubmV4dCguLi5hcmdzKTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgaWYgKHR5cGVvZiBvbkVycm9yID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgb25FcnJvcihlKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRocm93IGU7XG4gICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gY29tcGxldGUoKSB7XG4gICAgICBpZiAodHlwZW9mIG9uUmV0dXJuID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgIG9uUmV0dXJuKHJlc3VsdC52YWx1ZSk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHZhbHVlOiByZXN1bHQudmFsdWUsXG4gICAgICAgIGRvbmU6IHRydWVcbiAgICAgIH07XG4gICAgfVxuXG4gICAgcmV0dXJuICgwLCBfZnNtSXRlcmF0b3IuZGVmYXVsdCkoSU5JVCwge1xuICAgICAgW0lOSVRdKF8sIGZzbSkge1xuICAgICAgICByZXN1bHQgPSBnZXROZXh0KCk7XG4gICAgICAgIHJldHVybiBmc21bUkVGSU5FXSh1bmRlZmluZWQsIGZzbSk7XG4gICAgICB9LFxuXG4gICAgICBbUkVGSU5FXShfLCBmc20pIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBpZiAocmVzdWx0LmRvbmUpIHtcbiAgICAgICAgICAgIHJldHVybiBjb21wbGV0ZSgpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGxldCB2YWx1ZSA9IHJlZmluZVlpZWxkZWRWYWx1ZShyZXN1bHQudmFsdWUpO1xuICAgICAgICAgIHZhbHVlID0gQXJyYXkuaXNBcnJheSh2YWx1ZSkgPyB2YWx1ZS5tYXAod3JhcEZhbHN5KSA6IHdyYXBGYWxzeSh2YWx1ZSk7XG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHZhbHVlLFxuICAgICAgICAgICAgbmV4dDogTkVYVFxuICAgICAgICAgIH07XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICByZXR1cm4gZnNtLnRocm93KGUsIGZzbSk7XG4gICAgICAgIH1cbiAgICAgIH0sXG5cbiAgICAgIFtORVhUXShyZXNwb25zZSwgZnNtKSB7XG4gICAgICAgIGNvbnN0IGZpbmFsUmVzcG9uc2UgPSBBcnJheS5pc0FycmF5KHJlc3BvbnNlKSA/IHJlc3BvbnNlLm1hcCh1bndyYXBGYWxzeSkgOiB1bndyYXBGYWxzeShyZXNwb25zZSk7XG4gICAgICAgIHJlc3VsdCA9IGdldE5leHQoZmluYWxSZXNwb25zZSk7XG4gICAgICAgIHJldHVybiBmc21bTE9PUF0odW5kZWZpbmVkLCBmc20pO1xuICAgICAgfSxcblxuICAgICAgW0xPT1BdKF8sIGZzbSkge1xuICAgICAgICBpZiAocmVzdWx0LmRvbmUpIHtcbiAgICAgICAgICByZXR1cm4gY29tcGxldGUoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBmc21bUkVGSU5FXSh1bmRlZmluZWQsIGZzbSk7XG4gICAgICB9LFxuXG4gICAgICByZXR1cm4odmFsdWUsIGZzbSkge1xuICAgICAgICByZXN1bHQgPSB3cmFwcGVkSXRlcmF0b3IucmV0dXJuKHZhbHVlKTtcbiAgICAgICAgcmV0dXJuIGZzbVtMT09QXSh1bmRlZmluZWQsIGZzbSk7XG4gICAgICB9LFxuXG4gICAgICB0aHJvdyhlLCBmc20pIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICByZXN1bHQgPSB3cmFwcGVkSXRlcmF0b3IudGhyb3coZSk7XG4gICAgICAgIH0gY2F0Y2ggKGlubmVyRXJyb3IpIHtcbiAgICAgICAgICBpZiAodHlwZW9mIG9uRXJyb3IgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIG9uRXJyb3IoaW5uZXJFcnJvcik7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgdGhyb3cgaW5uZXJFcnJvcjtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBmc21bTE9PUF0odW5kZWZpbmVkLCBmc20pO1xuICAgICAgfVxuXG4gICAgfSk7XG4gIH1cblxuICBzYWdhV3JhcHBlcltTQUdBX1dSQVBQRVJdID0gdHJ1ZTtcblxuICB0cnkge1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShzYWdhV3JhcHBlciwgJ25hbWUnLCB7XG4gICAgICB2YWx1ZTogbmFtZVxuICAgIH0pOyAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tZW1wdHlcbiAgfSBjYXRjaCAoZSkge31cblxuICByZXR1cm4gc2FnYVdyYXBwZXI7XG59Il19