9a1d94416f3075208e7de11cd1d75916
"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

exports.__esModule = true;
exports["default"] = createConnectedFields;

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _objectWithoutPropertiesLoose2 = _interopRequireDefault(require("@babel/runtime/helpers/objectWithoutPropertiesLoose"));

var _inheritsLoose2 = _interopRequireDefault(require("@babel/runtime/helpers/inheritsLoose"));

var _react = _interopRequireDefault(require("react"));

var _propTypes = _interopRequireDefault(require("prop-types"));

var _reactRedux = require("react-redux");

var _createFieldProps2 = _interopRequireDefault(require("./createFieldProps"));

var _plain = _interopRequireDefault(require("./structure/plain"));

var _onChangeValue = _interopRequireDefault(require("./events/onChangeValue"));

var _validateComponentProp = _interopRequireDefault(require("./util/validateComponentProp"));

var propsToNotUpdateFor = ['_reduxForm'];

function createConnectedFields(structure) {
  var deepEqual = structure.deepEqual,
      getIn = structure.getIn,
      size = structure.size;

  var getSyncError = function getSyncError(syncErrors, name) {
    return _plain["default"].getIn(syncErrors, name + "._error") || _plain["default"].getIn(syncErrors, name);
  };

  var getSyncWarning = function getSyncWarning(syncWarnings, name) {
    var warning = getIn(syncWarnings, name);
    return warning && warning._warning ? warning._warning : warning;
  };

  var ConnectedFields = function (_React$Component) {
    (0, _inheritsLoose2["default"])(ConnectedFields, _React$Component);

    function ConnectedFields(props) {
      var _this;

      _this = _React$Component.call(this, props) || this;
      _this.onChangeFns = {};
      _this.onFocusFns = {};
      _this.onBlurFns = {};
      _this.ref = _react["default"].createRef();

      _this.prepareEventHandlers = function (_ref) {
        var names = _ref.names;
        return names.forEach(function (name) {
          _this.onChangeFns[name] = function (event) {
            return _this.handleChange(name, event);
          };

          _this.onFocusFns[name] = function () {
            return _this.handleFocus(name);
          };

          _this.onBlurFns[name] = function (event) {
            return _this.handleBlur(name, event);
          };
        });
      };

      _this.handleChange = function (name, event) {
        var _this$props = _this.props,
            dispatch = _this$props.dispatch,
            parse = _this$props.parse,
            _reduxForm = _this$props._reduxForm;
        var value = (0, _onChangeValue["default"])(event, {
          name: name,
          parse: parse
        });
        dispatch(_reduxForm.change(name, value));

        if (_reduxForm.asyncValidate) {
          _reduxForm.asyncValidate(name, value, 'change');
        }
      };

      _this.handleFocus = function (name) {
        var _this$props2 = _this.props,
            dispatch = _this$props2.dispatch,
            _reduxForm = _this$props2._reduxForm;
        dispatch(_reduxForm.focus(name));
      };

      _this.handleBlur = function (name, event) {
        var _this$props3 = _this.props,
            dispatch = _this$props3.dispatch,
            parse = _this$props3.parse,
            _reduxForm = _this$props3._reduxForm;
        var value = (0, _onChangeValue["default"])(event, {
          name: name,
          parse: parse
        });
        dispatch(_reduxForm.blur(name, value));

        if (_reduxForm.asyncValidate) {
          _reduxForm.asyncValidate(name, value, 'blur');
        }
      };

      _this.prepareEventHandlers(props);

      return _this;
    }

    var _proto = ConnectedFields.prototype;

    _proto.UNSAFE_componentWillReceiveProps = function UNSAFE_componentWillReceiveProps(nextProps) {
      var _this2 = this;

      if (this.props.names !== nextProps.names && (size(this.props.names) !== size(nextProps.names) || nextProps.names.some(function (nextName) {
        return !_this2.props._fields[nextName];
      }))) {
        this.prepareEventHandlers(nextProps);
      }
    };

    _proto.shouldComponentUpdate = function shouldComponentUpdate(nextProps) {
      var _this3 = this;

      var nextPropsKeys = Object.keys(nextProps);
      var thisPropsKeys = Object.keys(this.props);
      return !!(this.props.children || nextProps.children || nextPropsKeys.length !== thisPropsKeys.length || nextPropsKeys.some(function (prop) {
        return !~propsToNotUpdateFor.indexOf(prop) && !deepEqual(_this3.props[prop], nextProps[prop]);
      }));
    };

    _proto.isDirty = function isDirty() {
      var _fields = this.props._fields;
      return Object.keys(_fields).some(function (name) {
        return _fields[name].dirty;
      });
    };

    _proto.getValues = function getValues() {
      var _fields = this.props._fields;
      return Object.keys(_fields).reduce(function (accumulator, name) {
        return _plain["default"].setIn(accumulator, name, _fields[name].value);
      }, {});
    };

    _proto.getRenderedComponent = function getRenderedComponent() {
      return this.ref.current;
    };

    _proto.render = function render() {
      var _this4 = this;

      var _this$props4 = this.props,
          component = _this$props4.component,
          forwardRef = _this$props4.forwardRef,
          _fields = _this$props4._fields,
          _reduxForm = _this$props4._reduxForm,
          rest = (0, _objectWithoutPropertiesLoose2["default"])(_this$props4, ["component", "forwardRef", "_fields", "_reduxForm"]);
      var sectionPrefix = _reduxForm.sectionPrefix,
          form = _reduxForm.form;

      var _Object$keys$reduce = Object.keys(_fields).reduce(function (accumulator, name) {
        var connectedProps = _fields[name];

        var _createFieldProps = (0, _createFieldProps2["default"])(structure, name, (0, _extends2["default"])({}, connectedProps, {}, rest, {
          form: form,
          onBlur: _this4.onBlurFns[name],
          onChange: _this4.onChangeFns[name],
          onFocus: _this4.onFocusFns[name]
        })),
            custom = _createFieldProps.custom,
            fieldProps = (0, _objectWithoutPropertiesLoose2["default"])(_createFieldProps, ["custom"]);

        accumulator.custom = custom;
        var fieldName = sectionPrefix ? name.replace(sectionPrefix + ".", '') : name;
        return _plain["default"].setIn(accumulator, fieldName, fieldProps);
      }, {}),
          custom = _Object$keys$reduce.custom,
          props = (0, _objectWithoutPropertiesLoose2["default"])(_Object$keys$reduce, ["custom"]);

      if (forwardRef) {
        props.ref = this.ref;
      }

      return _react["default"].createElement(component, (0, _extends2["default"])({}, props, {}, custom));
    };

    return ConnectedFields;
  }(_react["default"].Component);

  ConnectedFields.propTypes = {
    component: _validateComponentProp["default"],
    _fields: _propTypes["default"].object.isRequired,
    props: _propTypes["default"].object
  };
  var connector = (0, _reactRedux.connect)(function (state, ownProps) {
    var names = ownProps.names,
        _ownProps$_reduxForm = ownProps._reduxForm,
        initialValues = _ownProps$_reduxForm.initialValues,
        getFormState = _ownProps$_reduxForm.getFormState;
    var formState = getFormState(state);
    return {
      _fields: names.reduce(function (accumulator, name) {
        var initialState = getIn(formState, "initial." + name);
        var initial = initialState !== undefined ? initialState : initialValues && getIn(initialValues, name);
        var value = getIn(formState, "values." + name);
        var syncError = getSyncError(getIn(formState, 'syncErrors'), name);
        var syncWarning = getSyncWarning(getIn(formState, 'syncWarnings'), name);
        var submitting = getIn(formState, 'submitting');
        var pristine = value === initial;
        accumulator[name] = {
          asyncError: getIn(formState, "asyncErrors." + name),
          asyncValidating: getIn(formState, 'asyncValidating') === name,
          dirty: !pristine,
          initial: initial,
          pristine: pristine,
          state: getIn(formState, "fields." + name),
          submitError: getIn(formState, "submitErrors." + name),
          submitFailed: getIn(formState, 'submitFailed'),
          submitting: submitting,
          syncError: syncError,
          syncWarning: syncWarning,
          value: value,
          _value: ownProps.value
        };
        return accumulator;
      }, {})
    };
  }, undefined, undefined, {
    forwardRef: true
  });
  return connector(ConnectedFields);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkNvbm5lY3RlZEZpZWxkcy5qcyJdLCJuYW1lcyI6WyJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsImV4cG9ydHMiLCJfX2VzTW9kdWxlIiwiY3JlYXRlQ29ubmVjdGVkRmllbGRzIiwiX2V4dGVuZHMyIiwiX29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzTG9vc2UyIiwiX2luaGVyaXRzTG9vc2UyIiwiX3JlYWN0IiwiX3Byb3BUeXBlcyIsIl9yZWFjdFJlZHV4IiwiX2NyZWF0ZUZpZWxkUHJvcHMyIiwiX3BsYWluIiwiX29uQ2hhbmdlVmFsdWUiLCJfdmFsaWRhdGVDb21wb25lbnRQcm9wIiwicHJvcHNUb05vdFVwZGF0ZUZvciIsInN0cnVjdHVyZSIsImRlZXBFcXVhbCIsImdldEluIiwic2l6ZSIsImdldFN5bmNFcnJvciIsInN5bmNFcnJvcnMiLCJuYW1lIiwiZ2V0U3luY1dhcm5pbmciLCJzeW5jV2FybmluZ3MiLCJ3YXJuaW5nIiwiX3dhcm5pbmciLCJDb25uZWN0ZWRGaWVsZHMiLCJfUmVhY3QkQ29tcG9uZW50IiwicHJvcHMiLCJfdGhpcyIsImNhbGwiLCJvbkNoYW5nZUZucyIsIm9uRm9jdXNGbnMiLCJvbkJsdXJGbnMiLCJyZWYiLCJjcmVhdGVSZWYiLCJwcmVwYXJlRXZlbnRIYW5kbGVycyIsIl9yZWYiLCJuYW1lcyIsImZvckVhY2giLCJldmVudCIsImhhbmRsZUNoYW5nZSIsImhhbmRsZUZvY3VzIiwiaGFuZGxlQmx1ciIsIl90aGlzJHByb3BzIiwiZGlzcGF0Y2giLCJwYXJzZSIsIl9yZWR1eEZvcm0iLCJ2YWx1ZSIsImNoYW5nZSIsImFzeW5jVmFsaWRhdGUiLCJfdGhpcyRwcm9wczIiLCJmb2N1cyIsIl90aGlzJHByb3BzMyIsImJsdXIiLCJfcHJvdG8iLCJwcm90b3R5cGUiLCJVTlNBRkVfY29tcG9uZW50V2lsbFJlY2VpdmVQcm9wcyIsIm5leHRQcm9wcyIsIl90aGlzMiIsInNvbWUiLCJuZXh0TmFtZSIsIl9maWVsZHMiLCJzaG91bGRDb21wb25lbnRVcGRhdGUiLCJfdGhpczMiLCJuZXh0UHJvcHNLZXlzIiwiT2JqZWN0Iiwia2V5cyIsInRoaXNQcm9wc0tleXMiLCJjaGlsZHJlbiIsImxlbmd0aCIsInByb3AiLCJpbmRleE9mIiwiaXNEaXJ0eSIsImRpcnR5IiwiZ2V0VmFsdWVzIiwicmVkdWNlIiwiYWNjdW11bGF0b3IiLCJzZXRJbiIsImdldFJlbmRlcmVkQ29tcG9uZW50IiwiY3VycmVudCIsInJlbmRlciIsIl90aGlzNCIsIl90aGlzJHByb3BzNCIsImNvbXBvbmVudCIsImZvcndhcmRSZWYiLCJyZXN0Iiwic2VjdGlvblByZWZpeCIsImZvcm0iLCJfT2JqZWN0JGtleXMkcmVkdWNlIiwiY29ubmVjdGVkUHJvcHMiLCJfY3JlYXRlRmllbGRQcm9wcyIsIm9uQmx1ciIsIm9uQ2hhbmdlIiwib25Gb2N1cyIsImN1c3RvbSIsImZpZWxkUHJvcHMiLCJmaWVsZE5hbWUiLCJyZXBsYWNlIiwiY3JlYXRlRWxlbWVudCIsIkNvbXBvbmVudCIsInByb3BUeXBlcyIsIm9iamVjdCIsImlzUmVxdWlyZWQiLCJjb25uZWN0b3IiLCJjb25uZWN0Iiwic3RhdGUiLCJvd25Qcm9wcyIsIl9vd25Qcm9wcyRfcmVkdXhGb3JtIiwiaW5pdGlhbFZhbHVlcyIsImdldEZvcm1TdGF0ZSIsImZvcm1TdGF0ZSIsImluaXRpYWxTdGF0ZSIsImluaXRpYWwiLCJ1bmRlZmluZWQiLCJzeW5jRXJyb3IiLCJzeW5jV2FybmluZyIsInN1Ym1pdHRpbmciLCJwcmlzdGluZSIsImFzeW5jRXJyb3IiLCJhc3luY1ZhbGlkYXRpbmciLCJzdWJtaXRFcnJvciIsInN1Ym1pdEZhaWxlZCIsIl92YWx1ZSJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUEsSUFBSUEsc0JBQXNCLEdBQUdDLE9BQU8sQ0FBQyw4Q0FBRCxDQUFwQzs7QUFFQUMsT0FBTyxDQUFDQyxVQUFSLEdBQXFCLElBQXJCO0FBQ0FELE9BQU8sQ0FBQyxTQUFELENBQVAsR0FBcUJFLHFCQUFyQjs7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LFNBVk87QUFXbEJDLFVBQUFBLFdBQVcsRUFBRUEsV0FYSztBQVlsQnBFLFVBQUFBLEtBQUssRUFBRUEsS0FaVztBQWFsQjJFLFVBQUFBLE1BQU0sRUFBRWhCLFFBQVEsQ0FBQzNEO0FBYkMsU0FBcEI7QUFnQkEsZUFBTzZCLFdBQVA7QUFDRCxPQXpCUSxFQXlCTixFQXpCTTtBQURKLEtBQVA7QUE0QkQsR0FsQ2UsRUFrQ2JxQyxTQWxDYSxFQWtDRkEsU0FsQ0UsRUFrQ1M7QUFDdkI3QixJQUFBQSxVQUFVLEVBQUU7QUFEVyxHQWxDVCxDQUFoQjtBQXFDQSxTQUFPbUIsU0FBUyxDQUFDOUUsZUFBRCxDQUFoQjtBQUNEIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5cbnZhciBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0ID0gcmVxdWlyZShcIkBiYWJlbC9ydW50aW1lL2hlbHBlcnMvaW50ZXJvcFJlcXVpcmVEZWZhdWx0XCIpO1xuXG5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlO1xuZXhwb3J0c1tcImRlZmF1bHRcIl0gPSBjcmVhdGVDb25uZWN0ZWRGaWVsZHM7XG5cbnZhciBfZXh0ZW5kczIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoXCJAYmFiZWwvcnVudGltZS9oZWxwZXJzL2V4dGVuZHNcIikpO1xuXG52YXIgX29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzTG9vc2UyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKFwiQGJhYmVsL3J1bnRpbWUvaGVscGVycy9vYmplY3RXaXRob3V0UHJvcGVydGllc0xvb3NlXCIpKTtcblxudmFyIF9pbmhlcml0c0xvb3NlMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZShcIkBiYWJlbC9ydW50aW1lL2hlbHBlcnMvaW5oZXJpdHNMb29zZVwiKSk7XG5cbnZhciBfcmVhY3QgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoXCJyZWFjdFwiKSk7XG5cbnZhciBfcHJvcFR5cGVzID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKFwicHJvcC10eXBlc1wiKSk7XG5cbnZhciBfcmVhY3RSZWR1eCA9IHJlcXVpcmUoXCJyZWFjdC1yZWR1eFwiKTtcblxudmFyIF9jcmVhdGVGaWVsZFByb3BzMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZShcIi4vY3JlYXRlRmllbGRQcm9wc1wiKSk7XG5cbnZhciBfcGxhaW4gPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoXCIuL3N0cnVjdHVyZS9wbGFpblwiKSk7XG5cbnZhciBfb25DaGFuZ2VWYWx1ZSA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZShcIi4vZXZlbnRzL29uQ2hhbmdlVmFsdWVcIikpO1xuXG52YXIgX3ZhbGlkYXRlQ29tcG9uZW50UHJvcCA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZShcIi4vdXRpbC92YWxpZGF0ZUNvbXBvbmVudFByb3BcIikpO1xuXG52YXIgcHJvcHNUb05vdFVwZGF0ZUZvciA9IFsnX3JlZHV4Rm9ybSddO1xuXG5mdW5jdGlvbiBjcmVhdGVDb25uZWN0ZWRGaWVsZHMoc3RydWN0dXJlKSB7XG4gIHZhciBkZWVwRXF1YWwgPSBzdHJ1Y3R1cmUuZGVlcEVxdWFsLFxuICAgICAgZ2V0SW4gPSBzdHJ1Y3R1cmUuZ2V0SW4sXG4gICAgICBzaXplID0gc3RydWN0dXJlLnNpemU7XG5cbiAgdmFyIGdldFN5bmNFcnJvciA9IGZ1bmN0aW9uIGdldFN5bmNFcnJvcihzeW5jRXJyb3JzLCBuYW1lKSB7XG4gICAgLy8gQmVjYXVzZSB0aGUgZXJyb3IgZm9yIHRoaXMgZmllbGQgbWlnaHQgbm90IGJlIGF0IGEgbGV2ZWwgaW4gdGhlIGVycm9yIHN0cnVjdHVyZSB3aGVyZVxuICAgIC8vIGl0IGNhbiBiZSBzZXQgZGlyZWN0bHksIGl0IG1pZ2h0IG5lZWQgdG8gYmUgdW53cmFwcGVkIGZyb20gdGhlIF9lcnJvciBwcm9wZXJ0eVxuICAgIHJldHVybiBfcGxhaW5bXCJkZWZhdWx0XCJdLmdldEluKHN5bmNFcnJvcnMsIG5hbWUgKyBcIi5fZXJyb3JcIikgfHwgX3BsYWluW1wiZGVmYXVsdFwiXS5nZXRJbihzeW5jRXJyb3JzLCBuYW1lKTtcbiAgfTtcblxuICB2YXIgZ2V0U3luY1dhcm5pbmcgPSBmdW5jdGlvbiBnZXRTeW5jV2FybmluZyhzeW5jV2FybmluZ3MsIG5hbWUpIHtcbiAgICB2YXIgd2FybmluZyA9IGdldEluKHN5bmNXYXJuaW5ncywgbmFtZSk7IC8vIEJlY2F1c2UgdGhlIHdhcm5pbmcgZm9yIHRoaXMgZmllbGQgbWlnaHQgbm90IGJlIGF0IGEgbGV2ZWwgaW4gdGhlIHdhcm5pbmcgc3RydWN0dXJlIHdoZXJlXG4gICAgLy8gaXQgY2FuIGJlIHNldCBkaXJlY3RseSwgaXQgbWlnaHQgbmVlZCB0byBiZSB1bndyYXBwZWQgZnJvbSB0aGUgX3dhcm5pbmcgcHJvcGVydHlcblxuICAgIHJldHVybiB3YXJuaW5nICYmIHdhcm5pbmcuX3dhcm5pbmcgPyB3YXJuaW5nLl93YXJuaW5nIDogd2FybmluZztcbiAgfTtcblxuICB2YXIgQ29ubmVjdGVkRmllbGRzID0gLyojX19QVVJFX18qL2Z1bmN0aW9uIChfUmVhY3QkQ29tcG9uZW50KSB7XG4gICAgKDAsIF9pbmhlcml0c0xvb3NlMltcImRlZmF1bHRcIl0pKENvbm5lY3RlZEZpZWxkcywgX1JlYWN0JENvbXBvbmVudCk7XG5cbiAgICBmdW5jdGlvbiBDb25uZWN0ZWRGaWVsZHMocHJvcHMpIHtcbiAgICAgIHZhciBfdGhpcztcblxuICAgICAgX3RoaXMgPSBfUmVhY3QkQ29tcG9uZW50LmNhbGwodGhpcywgcHJvcHMpIHx8IHRoaXM7XG4gICAgICBfdGhpcy5vbkNoYW5nZUZucyA9IHt9O1xuICAgICAgX3RoaXMub25Gb2N1c0ZucyA9IHt9O1xuICAgICAgX3RoaXMub25CbHVyRm5zID0ge307XG4gICAgICBfdGhpcy5yZWYgPSBfcmVhY3RbXCJkZWZhdWx0XCJdLmNyZWF0ZVJlZigpO1xuXG4gICAgICBfdGhpcy5wcmVwYXJlRXZlbnRIYW5kbGVycyA9IGZ1bmN0aW9uIChfcmVmKSB7XG4gICAgICAgIHZhciBuYW1lcyA9IF9yZWYubmFtZXM7XG4gICAgICAgIHJldHVybiBuYW1lcy5mb3JFYWNoKGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICAgICAgX3RoaXMub25DaGFuZ2VGbnNbbmFtZV0gPSBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgICAgIHJldHVybiBfdGhpcy5oYW5kbGVDaGFuZ2UobmFtZSwgZXZlbnQpO1xuICAgICAgICAgIH07XG5cbiAgICAgICAgICBfdGhpcy5vbkZvY3VzRm5zW25hbWVdID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIF90aGlzLmhhbmRsZUZvY3VzKG5hbWUpO1xuICAgICAgICAgIH07XG5cbiAgICAgICAgICBfdGhpcy5vbkJsdXJGbnNbbmFtZV0gPSBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgICAgIHJldHVybiBfdGhpcy5oYW5kbGVCbHVyKG5hbWUsIGV2ZW50KTtcbiAgICAgICAgICB9O1xuICAgICAgICB9KTtcbiAgICAgIH07XG5cbiAgICAgIF90aGlzLmhhbmRsZUNoYW5nZSA9IGZ1bmN0aW9uIChuYW1lLCBldmVudCkge1xuICAgICAgICB2YXIgX3RoaXMkcHJvcHMgPSBfdGhpcy5wcm9wcyxcbiAgICAgICAgICAgIGRpc3BhdGNoID0gX3RoaXMkcHJvcHMuZGlzcGF0Y2gsXG4gICAgICAgICAgICBwYXJzZSA9IF90aGlzJHByb3BzLnBhcnNlLFxuICAgICAgICAgICAgX3JlZHV4Rm9ybSA9IF90aGlzJHByb3BzLl9yZWR1eEZvcm07XG4gICAgICAgIHZhciB2YWx1ZSA9ICgwLCBfb25DaGFuZ2VWYWx1ZVtcImRlZmF1bHRcIl0pKGV2ZW50LCB7XG4gICAgICAgICAgbmFtZTogbmFtZSxcbiAgICAgICAgICBwYXJzZTogcGFyc2VcbiAgICAgICAgfSk7XG4gICAgICAgIGRpc3BhdGNoKF9yZWR1eEZvcm0uY2hhbmdlKG5hbWUsIHZhbHVlKSk7IC8vIGNhbGwgcG9zdC1jaGFuZ2UgY2FsbGJhY2tcblxuICAgICAgICBpZiAoX3JlZHV4Rm9ybS5hc3luY1ZhbGlkYXRlKSB7XG4gICAgICAgICAgX3JlZHV4Rm9ybS5hc3luY1ZhbGlkYXRlKG5hbWUsIHZhbHVlLCAnY2hhbmdlJyk7XG4gICAgICAgIH1cbiAgICAgIH07XG5cbiAgICAgIF90aGlzLmhhbmRsZUZvY3VzID0gZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgICAgdmFyIF90aGlzJHByb3BzMiA9IF90aGlzLnByb3BzLFxuICAgICAgICAgICAgZGlzcGF0Y2ggPSBfdGhpcyRwcm9wczIuZGlzcGF0Y2gsXG4gICAgICAgICAgICBfcmVkdXhGb3JtID0gX3RoaXMkcHJvcHMyLl9yZWR1eEZvcm07XG4gICAgICAgIGRpc3BhdGNoKF9yZWR1eEZvcm0uZm9jdXMobmFtZSkpO1xuICAgICAgfTtcblxuICAgICAgX3RoaXMuaGFuZGxlQmx1ciA9IGZ1bmN0aW9uIChuYW1lLCBldmVudCkge1xuICAgICAgICB2YXIgX3RoaXMkcHJvcHMzID0gX3RoaXMucHJvcHMsXG4gICAgICAgICAgICBkaXNwYXRjaCA9IF90aGlzJHByb3BzMy5kaXNwYXRjaCxcbiAgICAgICAgICAgIHBhcnNlID0gX3RoaXMkcHJvcHMzLnBhcnNlLFxuICAgICAgICAgICAgX3JlZHV4Rm9ybSA9IF90aGlzJHByb3BzMy5fcmVkdXhGb3JtO1xuICAgICAgICB2YXIgdmFsdWUgPSAoMCwgX29uQ2hhbmdlVmFsdWVbXCJkZWZhdWx0XCJdKShldmVudCwge1xuICAgICAgICAgIG5hbWU6IG5hbWUsXG4gICAgICAgICAgcGFyc2U6IHBhcnNlXG4gICAgICAgIH0pOyAvLyBkaXNwYXRjaCBibHVyIGFjdGlvblxuXG4gICAgICAgIGRpc3BhdGNoKF9yZWR1eEZvcm0uYmx1cihuYW1lLCB2YWx1ZSkpOyAvLyBjYWxsIHBvc3QtYmx1ciBjYWxsYmFja1xuXG4gICAgICAgIGlmIChfcmVkdXhGb3JtLmFzeW5jVmFsaWRhdGUpIHtcbiAgICAgICAgICBfcmVkdXhGb3JtLmFzeW5jVmFsaWRhdGUobmFtZSwgdmFsdWUsICdibHVyJyk7XG4gICAgICAgIH1cbiAgICAgIH07XG5cbiAgICAgIF90aGlzLnByZXBhcmVFdmVudEhhbmRsZXJzKHByb3BzKTtcblxuICAgICAgcmV0dXJuIF90aGlzO1xuICAgIH1cblxuICAgIHZhciBfcHJvdG8gPSBDb25uZWN0ZWRGaWVsZHMucHJvdG90eXBlO1xuXG4gICAgX3Byb3RvLlVOU0FGRV9jb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzID0gZnVuY3Rpb24gVU5TQUZFX2NvbXBvbmVudFdpbGxSZWNlaXZlUHJvcHMobmV4dFByb3BzKSB7XG4gICAgICB2YXIgX3RoaXMyID0gdGhpcztcblxuICAgICAgaWYgKHRoaXMucHJvcHMubmFtZXMgIT09IG5leHRQcm9wcy5uYW1lcyAmJiAoc2l6ZSh0aGlzLnByb3BzLm5hbWVzKSAhPT0gc2l6ZShuZXh0UHJvcHMubmFtZXMpIHx8IG5leHRQcm9wcy5uYW1lcy5zb21lKGZ1bmN0aW9uIChuZXh0TmFtZSkge1xuICAgICAgICByZXR1cm4gIV90aGlzMi5wcm9wcy5fZmllbGRzW25leHROYW1lXTtcbiAgICAgIH0pKSkge1xuICAgICAgICAvLyBuYW1lcyBoYXMgY2hhbmdlZC4gVGhlIGNhY2hlZCBldmVudCBoYW5kbGVycyBuZWVkIHRvIGJlIHVwZGF0ZWRcbiAgICAgICAgdGhpcy5wcmVwYXJlRXZlbnRIYW5kbGVycyhuZXh0UHJvcHMpO1xuICAgICAgfVxuICAgIH07XG5cbiAgICBfcHJvdG8uc2hvdWxkQ29tcG9uZW50VXBkYXRlID0gZnVuY3Rpb24gc2hvdWxkQ29tcG9uZW50VXBkYXRlKG5leHRQcm9wcykge1xuICAgICAgdmFyIF90aGlzMyA9IHRoaXM7XG5cbiAgICAgIHZhciBuZXh0UHJvcHNLZXlzID0gT2JqZWN0LmtleXMobmV4dFByb3BzKTtcbiAgICAgIHZhciB0aGlzUHJvcHNLZXlzID0gT2JqZWN0LmtleXModGhpcy5wcm9wcyk7IC8vIGlmIHdlIGhhdmUgY2hpbGRyZW4sIHdlIE1VU1QgdXBkYXRlIGluIFJlYWN0IDE2XG4gICAgICAvLyBodHRwczovL3R3aXR0ZXIuY29tL2VyaWtyYXMvc3RhdHVzLzkxNTg2NjU0NDU1ODc4ODYwOFxuXG4gICAgICByZXR1cm4gISEodGhpcy5wcm9wcy5jaGlsZHJlbiB8fCBuZXh0UHJvcHMuY2hpbGRyZW4gfHwgbmV4dFByb3BzS2V5cy5sZW5ndGggIT09IHRoaXNQcm9wc0tleXMubGVuZ3RoIHx8IG5leHRQcm9wc0tleXMuc29tZShmdW5jdGlvbiAocHJvcCkge1xuICAgICAgICByZXR1cm4gIX5wcm9wc1RvTm90VXBkYXRlRm9yLmluZGV4T2YocHJvcCkgJiYgIWRlZXBFcXVhbChfdGhpczMucHJvcHNbcHJvcF0sIG5leHRQcm9wc1twcm9wXSk7XG4gICAgICB9KSk7XG4gICAgfTtcblxuICAgIF9wcm90by5pc0RpcnR5ID0gZnVuY3Rpb24gaXNEaXJ0eSgpIHtcbiAgICAgIHZhciBfZmllbGRzID0gdGhpcy5wcm9wcy5fZmllbGRzO1xuICAgICAgcmV0dXJuIE9iamVjdC5rZXlzKF9maWVsZHMpLnNvbWUoZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgICAgcmV0dXJuIF9maWVsZHNbbmFtZV0uZGlydHk7XG4gICAgICB9KTtcbiAgICB9O1xuXG4gICAgX3Byb3RvLmdldFZhbHVlcyA9IGZ1bmN0aW9uIGdldFZhbHVlcygpIHtcbiAgICAgIHZhciBfZmllbGRzID0gdGhpcy5wcm9wcy5fZmllbGRzO1xuICAgICAgcmV0dXJuIE9iamVjdC5rZXlzKF9maWVsZHMpLnJlZHVjZShmdW5jdGlvbiAoYWNjdW11bGF0b3IsIG5hbWUpIHtcbiAgICAgICAgcmV0dXJuIF9wbGFpbltcImRlZmF1bHRcIl0uc2V0SW4oYWNjdW11bGF0b3IsIG5hbWUsIF9maWVsZHNbbmFtZV0udmFsdWUpO1xuICAgICAgfSwge30pO1xuICAgIH07XG5cbiAgICBfcHJvdG8uZ2V0UmVuZGVyZWRDb21wb25lbnQgPSBmdW5jdGlvbiBnZXRSZW5kZXJlZENvbXBvbmVudCgpIHtcbiAgICAgIHJldHVybiB0aGlzLnJlZi5jdXJyZW50O1xuICAgIH07XG5cbiAgICBfcHJvdG8ucmVuZGVyID0gZnVuY3Rpb24gcmVuZGVyKCkge1xuICAgICAgdmFyIF90aGlzNCA9IHRoaXM7XG5cbiAgICAgIHZhciBfdGhpcyRwcm9wczQgPSB0aGlzLnByb3BzLFxuICAgICAgICAgIGNvbXBvbmVudCA9IF90aGlzJHByb3BzNC5jb21wb25lbnQsXG4gICAgICAgICAgZm9yd2FyZFJlZiA9IF90aGlzJHByb3BzNC5mb3J3YXJkUmVmLFxuICAgICAgICAgIF9maWVsZHMgPSBfdGhpcyRwcm9wczQuX2ZpZWxkcyxcbiAgICAgICAgICBfcmVkdXhGb3JtID0gX3RoaXMkcHJvcHM0Ll9yZWR1eEZvcm0sXG4gICAgICAgICAgcmVzdCA9ICgwLCBfb2JqZWN0V2l0aG91dFByb3BlcnRpZXNMb29zZTJbXCJkZWZhdWx0XCJdKShfdGhpcyRwcm9wczQsIFtcImNvbXBvbmVudFwiLCBcImZvcndhcmRSZWZcIiwgXCJfZmllbGRzXCIsIFwiX3JlZHV4Rm9ybVwiXSk7XG4gICAgICB2YXIgc2VjdGlvblByZWZpeCA9IF9yZWR1eEZvcm0uc2VjdGlvblByZWZpeCxcbiAgICAgICAgICBmb3JtID0gX3JlZHV4Rm9ybS5mb3JtO1xuXG4gICAgICB2YXIgX09iamVjdCRrZXlzJHJlZHVjZSA9IE9iamVjdC5rZXlzKF9maWVsZHMpLnJlZHVjZShmdW5jdGlvbiAoYWNjdW11bGF0b3IsIG5hbWUpIHtcbiAgICAgICAgdmFyIGNvbm5lY3RlZFByb3BzID0gX2ZpZWxkc1tuYW1lXTtcblxuICAgICAgICB2YXIgX2NyZWF0ZUZpZWxkUHJvcHMgPSAoMCwgX2NyZWF0ZUZpZWxkUHJvcHMyW1wiZGVmYXVsdFwiXSkoc3RydWN0dXJlLCBuYW1lLCAoMCwgX2V4dGVuZHMyW1wiZGVmYXVsdFwiXSkoe30sIGNvbm5lY3RlZFByb3BzLCB7fSwgcmVzdCwge1xuICAgICAgICAgIGZvcm06IGZvcm0sXG4gICAgICAgICAgb25CbHVyOiBfdGhpczQub25CbHVyRm5zW25hbWVdLFxuICAgICAgICAgIG9uQ2hhbmdlOiBfdGhpczQub25DaGFuZ2VGbnNbbmFtZV0sXG4gICAgICAgICAgb25Gb2N1czogX3RoaXM0Lm9uRm9jdXNGbnNbbmFtZV1cbiAgICAgICAgfSkpLFxuICAgICAgICAgICAgY3VzdG9tID0gX2NyZWF0ZUZpZWxkUHJvcHMuY3VzdG9tLFxuICAgICAgICAgICAgZmllbGRQcm9wcyA9ICgwLCBfb2JqZWN0V2l0aG91dFByb3BlcnRpZXNMb29zZTJbXCJkZWZhdWx0XCJdKShfY3JlYXRlRmllbGRQcm9wcywgW1wiY3VzdG9tXCJdKTtcblxuICAgICAgICBhY2N1bXVsYXRvci5jdXN0b20gPSBjdXN0b207XG4gICAgICAgIHZhciBmaWVsZE5hbWUgPSBzZWN0aW9uUHJlZml4ID8gbmFtZS5yZXBsYWNlKHNlY3Rpb25QcmVmaXggKyBcIi5cIiwgJycpIDogbmFtZTtcbiAgICAgICAgcmV0dXJuIF9wbGFpbltcImRlZmF1bHRcIl0uc2V0SW4oYWNjdW11bGF0b3IsIGZpZWxkTmFtZSwgZmllbGRQcm9wcyk7XG4gICAgICB9LCB7fSksXG4gICAgICAgICAgY3VzdG9tID0gX09iamVjdCRrZXlzJHJlZHVjZS5jdXN0b20sXG4gICAgICAgICAgcHJvcHMgPSAoMCwgX29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzTG9vc2UyW1wiZGVmYXVsdFwiXSkoX09iamVjdCRrZXlzJHJlZHVjZSwgW1wiY3VzdG9tXCJdKTtcblxuICAgICAgaWYgKGZvcndhcmRSZWYpIHtcbiAgICAgICAgcHJvcHMucmVmID0gdGhpcy5yZWY7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBfcmVhY3RbXCJkZWZhdWx0XCJdLmNyZWF0ZUVsZW1lbnQoY29tcG9uZW50LCAoMCwgX2V4dGVuZHMyW1wiZGVmYXVsdFwiXSkoe30sIHByb3BzLCB7fSwgY3VzdG9tKSk7XG4gICAgfTtcblxuICAgIHJldHVybiBDb25uZWN0ZWRGaWVsZHM7XG4gIH0oX3JlYWN0W1wiZGVmYXVsdFwiXS5Db21wb25lbnQpO1xuXG4gIENvbm5lY3RlZEZpZWxkcy5wcm9wVHlwZXMgPSB7XG4gICAgY29tcG9uZW50OiBfdmFsaWRhdGVDb21wb25lbnRQcm9wW1wiZGVmYXVsdFwiXSxcbiAgICBfZmllbGRzOiBfcHJvcFR5cGVzW1wiZGVmYXVsdFwiXS5vYmplY3QuaXNSZXF1aXJlZCxcbiAgICBwcm9wczogX3Byb3BUeXBlc1tcImRlZmF1bHRcIl0ub2JqZWN0XG4gIH07XG4gIHZhciBjb25uZWN0b3IgPSAoMCwgX3JlYWN0UmVkdXguY29ubmVjdCkoZnVuY3Rpb24gKHN0YXRlLCBvd25Qcm9wcykge1xuICAgIHZhciBuYW1lcyA9IG93blByb3BzLm5hbWVzLFxuICAgICAgICBfb3duUHJvcHMkX3JlZHV4Rm9ybSA9IG93blByb3BzLl9yZWR1eEZvcm0sXG4gICAgICAgIGluaXRpYWxWYWx1ZXMgPSBfb3duUHJvcHMkX3JlZHV4Rm9ybS5pbml0aWFsVmFsdWVzLFxuICAgICAgICBnZXRGb3JtU3RhdGUgPSBfb3duUHJvcHMkX3JlZHV4Rm9ybS5nZXRGb3JtU3RhdGU7XG4gICAgdmFyIGZvcm1TdGF0ZSA9IGdldEZvcm1TdGF0ZShzdGF0ZSk7XG4gICAgcmV0dXJuIHtcbiAgICAgIF9maWVsZHM6IG5hbWVzLnJlZHVjZShmdW5jdGlvbiAoYWNjdW11bGF0b3IsIG5hbWUpIHtcbiAgICAgICAgdmFyIGluaXRpYWxTdGF0ZSA9IGdldEluKGZvcm1TdGF0ZSwgXCJpbml0aWFsLlwiICsgbmFtZSk7XG4gICAgICAgIHZhciBpbml0aWFsID0gaW5pdGlhbFN0YXRlICE9PSB1bmRlZmluZWQgPyBpbml0aWFsU3RhdGUgOiBpbml0aWFsVmFsdWVzICYmIGdldEluKGluaXRpYWxWYWx1ZXMsIG5hbWUpO1xuICAgICAgICB2YXIgdmFsdWUgPSBnZXRJbihmb3JtU3RhdGUsIFwidmFsdWVzLlwiICsgbmFtZSk7XG4gICAgICAgIHZhciBzeW5jRXJyb3IgPSBnZXRTeW5jRXJyb3IoZ2V0SW4oZm9ybVN0YXRlLCAnc3luY0Vycm9ycycpLCBuYW1lKTtcbiAgICAgICAgdmFyIHN5bmNXYXJuaW5nID0gZ2V0U3luY1dhcm5pbmcoZ2V0SW4oZm9ybVN0YXRlLCAnc3luY1dhcm5pbmdzJyksIG5hbWUpO1xuICAgICAgICB2YXIgc3VibWl0dGluZyA9IGdldEluKGZvcm1TdGF0ZSwgJ3N1Ym1pdHRpbmcnKTtcbiAgICAgICAgdmFyIHByaXN0aW5lID0gdmFsdWUgPT09IGluaXRpYWw7XG4gICAgICAgIGFjY3VtdWxhdG9yW25hbWVdID0ge1xuICAgICAgICAgIGFzeW5jRXJyb3I6IGdldEluKGZvcm1TdGF0ZSwgXCJhc3luY0Vycm9ycy5cIiArIG5hbWUpLFxuICAgICAgICAgIGFzeW5jVmFsaWRhdGluZzogZ2V0SW4oZm9ybVN0YXRlLCAnYXN5bmNWYWxpZGF0aW5nJykgPT09IG5hbWUsXG4gICAgICAgICAgZGlydHk6ICFwcmlzdGluZSxcbiAgICAgICAgICBpbml0aWFsOiBpbml0aWFsLFxuICAgICAgICAgIHByaXN0aW5lOiBwcmlzdGluZSxcbiAgICAgICAgICBzdGF0ZTogZ2V0SW4oZm9ybVN0YXRlLCBcImZpZWxkcy5cIiArIG5hbWUpLFxuICAgICAgICAgIHN1Ym1pdEVycm9yOiBnZXRJbihmb3JtU3RhdGUsIFwic3VibWl0RXJyb3JzLlwiICsgbmFtZSksXG4gICAgICAgICAgc3VibWl0RmFpbGVkOiBnZXRJbihmb3JtU3RhdGUsICdzdWJtaXRGYWlsZWQnKSxcbiAgICAgICAgICBzdWJtaXR0aW5nOiBzdWJtaXR0aW5nLFxuICAgICAgICAgIHN5bmNFcnJvcjogc3luY0Vycm9yLFxuICAgICAgICAgIHN5bmNXYXJuaW5nOiBzeW5jV2FybmluZyxcbiAgICAgICAgICB2YWx1ZTogdmFsdWUsXG4gICAgICAgICAgX3ZhbHVlOiBvd25Qcm9wcy52YWx1ZSAvLyBzYXZlIHZhbHVlIHBhc3NlZCBpbiAoZm9yIHJhZGlvcylcblxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gYWNjdW11bGF0b3I7XG4gICAgICB9LCB7fSlcbiAgICB9O1xuICB9LCB1bmRlZmluZWQsIHVuZGVmaW5lZCwge1xuICAgIGZvcndhcmRSZWY6IHRydWVcbiAgfSk7XG4gIHJldHVybiBjb25uZWN0b3IoQ29ubmVjdGVkRmllbGRzKTtcbn0iXX0=