a25732f9645e5f7ce52502477befa97d
"use strict";

var __importDefault = this && this.__importDefault || function (mod) {
  return mod && mod.__esModule ? mod : {
    "default": mod
  };
};

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.escapeUTF8 = exports.escape = exports.encodeNonAsciiHTML = exports.encodeHTML = exports.encodeXML = void 0;

var xml_json_1 = __importDefault(require("./maps/xml.json"));

var inverseXML = getInverseObj(xml_json_1.default);
var xmlReplacer = getInverseReplacer(inverseXML);
exports.encodeXML = getASCIIEncoder(inverseXML);

var entities_json_1 = __importDefault(require("./maps/entities.json"));

var inverseHTML = getInverseObj(entities_json_1.default);
var htmlReplacer = getInverseReplacer(inverseHTML);
exports.encodeHTML = getInverse(inverseHTML, htmlReplacer);
exports.encodeNonAsciiHTML = getASCIIEncoder(inverseHTML);

function getInverseObj(obj) {
  return Object.keys(obj).sort().reduce(function (inverse, name) {
    inverse[obj[name]] = "&" + name + ";";
    return inverse;
  }, {});
}

function getInverseReplacer(inverse) {
  var single = [];
  var multiple = [];

  for (var _i = 0, _a = Object.keys(inverse); _i < _a.length; _i++) {
    var k = _a[_i];

    if (k.length === 1) {
      single.push("\\" + k);
    } else {
      multiple.push(k);
    }
  }

  single.sort();

  for (var start = 0; start < single.length - 1; start++) {
    var end = start;

    while (end < single.length - 1 && single[end].charCodeAt(1) + 1 === single[end + 1].charCodeAt(1)) {
      end += 1;
    }

    var count = 1 + end - start;
    if (count < 3) continue;
    single.splice(start, count, single[start] + "-" + single[end]);
  }

  multiple.unshift("[" + single.join("") + "]");
  return new RegExp(multiple.join("|"), "g");
}

var reNonASCII = /(?:[\x80-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])/g;
var getCodePoint = String.prototype.codePointAt != null ? function (str) {
  return str.codePointAt(0);
} : function (c) {
  return (c.charCodeAt(0) - 0xd800) * 0x400 + c.charCodeAt(1) - 0xdc00 + 0x10000;
};

function singleCharReplacer(c) {
  return "&#x" + (c.length > 1 ? getCodePoint(c) : c.charCodeAt(0)).toString(16).toUpperCase() + ";";
}

function getInverse(inverse, re) {
  return function (data) {
    return data.replace(re, function (name) {
      return inverse[name];
    }).replace(reNonASCII, singleCharReplacer);
  };
}

var reEscapeChars = new RegExp(xmlReplacer.source + "|" + reNonASCII.source, "g");

function escape(data) {
  return data.replace(reEscapeChars, singleCharReplacer);
}

exports.escape = escape;

function escapeUTF8(data) {
  return data.replace(xmlReplacer, singleCharReplacer);
}

exports.escapeUTF8 = escapeUTF8;

function getASCIIEncoder(obj) {
  return function (data) {
    return data.replace(reEscapeChars, function (c) {
      return obj[c] || singleCharReplacer(c);
    });
  };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImVuY29kZS5qcyJdLCJuYW1lcyI6WyJfX2ltcG9ydERlZmF1bHQiLCJtb2QiLCJfX2VzTW9kdWxlIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJleHBvcnRzIiwidmFsdWUiLCJlc2NhcGVVVEY4IiwiZXNjYXBlIiwiZW5jb2RlTm9uQXNjaWlIVE1MIiwiZW5jb2RlSFRNTCIsImVuY29kZVhNTCIsInhtbF9qc29uXzEiLCJyZXF1aXJlIiwiaW52ZXJzZVhNTCIsImdldEludmVyc2VPYmoiLCJkZWZhdWx0IiwieG1sUmVwbGFjZXIiLCJnZXRJbnZlcnNlUmVwbGFjZXIiLCJnZXRBU0NJSUVuY29kZXIiLCJlbnRpdGllc19qc29uXzEiLCJpbnZlcnNlSFRNTCIsImh0bWxSZXBsYWNlciIsImdldEludmVyc2UiLCJvYmoiLCJrZXlzIiwic29ydCIsInJlZHVjZSIsImludmVyc2UiLCJuYW1lIiwic2luZ2xlIiwibXVsdGlwbGUiLCJfaSIsIl9hIiwibGVuZ3RoIiwiayIsInB1c2giLCJzdGFydCIsImVuZCIsImNoYXJDb2RlQXQiLCJjb3VudCIsInNwbGljZSIsInVuc2hpZnQiLCJqb2luIiwiUmVnRXhwIiwicmVOb25BU0NJSSIsImdldENvZGVQb2ludCIsIlN0cmluZyIsInByb3RvdHlwZSIsImNvZGVQb2ludEF0Iiwic3RyIiwiYyIsInNpbmdsZUNoYXJSZXBsYWNlciIsInRvU3RyaW5nIiwidG9VcHBlckNhc2UiLCJyZSIsImRhdGEiLCJyZXBsYWNlIiwicmVFc2NhcGVDaGFycyIsInNvdXJjZSJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBQ0EsSUFBSUEsZUFBZSxHQUFJLFFBQVEsS0FBS0EsZUFBZCxJQUFrQyxVQUFVQyxHQUFWLEVBQWU7QUFDbkUsU0FBUUEsR0FBRyxJQUFJQSxHQUFHLENBQUNDLFVBQVosR0FBMEJELEdBQTFCLEdBQWdDO0FBQUUsZUFBV0E7QUFBYixHQUF2QztBQUNILENBRkQ7O0FBR0FFLE1BQU0sQ0FBQ0MsY0FBUCxDQUFzQkMs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QztBQUM3QixTQUFPLFVBQVVDLElBQVYsRUFBZ0I7QUFDbkIsV0FBT0EsSUFBSSxDQUNOQyxPQURFLENBQ01GLEVBRE4sRUFDVSxVQUFVMUIsSUFBVixFQUFnQjtBQUFFLGFBQU9ELE9BQU8sQ0FBQ0MsSUFBRCxDQUFkO0FBQXVCLEtBRG5ELEVBRUY0QixPQUZFLENBRU1aLFVBRk4sRUFFa0JPLGtCQUZsQixDQUFQO0FBR0gsR0FKRDtBQUtIOztBQUNELElBQUlNLGFBQWEsR0FBRyxJQUFJZCxNQUFKLENBQVczQixXQUFXLENBQUMwQyxNQUFaLEdBQXFCLEdBQXJCLEdBQTJCZCxVQUFVLENBQUNjLE1BQWpELEVBQXlELEdBQXpELENBQXBCOztBQVVBLFNBQVNuRCxNQUFULENBQWdCZ0QsSUFBaEIsRUFBc0I7QUFDbEIsU0FBT0EsSUFBSSxDQUFDQyxPQUFMLENBQWFDLGFBQWIsRUFBNEJOLGtCQUE1QixDQUFQO0FBQ0g7O0FBQ0QvQyxPQUFPLENBQUNHLE1BQVIsR0FBaUJBLE1BQWpCOztBQVNBLFNBQVNELFVBQVQsQ0FBb0JpRCxJQUFwQixFQUEwQjtBQUN0QixTQUFPQSxJQUFJLENBQUNDLE9BQUwsQ0FBYXhDLFdBQWIsRUFBMEJtQyxrQkFBMUIsQ0FBUDtBQUNIOztBQUNEL0MsT0FBTyxDQUFDRSxVQUFSLEdBQXFCQSxVQUFyQjs7QUFDQSxTQUFTWSxlQUFULENBQXlCSyxHQUF6QixFQUE4QjtBQUMxQixTQUFPLFVBQVVnQyxJQUFWLEVBQWdCO0FBQ25CLFdBQU9BLElBQUksQ0FBQ0MsT0FBTCxDQUFhQyxhQUFiLEVBQTRCLFVBQVVQLENBQVYsRUFBYTtBQUFFLGFBQU8zQixHQUFHLENBQUMyQixDQUFELENBQUgsSUFBVUMsa0JBQWtCLENBQUNELENBQUQsQ0FBbkM7QUFBeUMsS0FBcEYsQ0FBUDtBQUNILEdBRkQ7QUFHSCIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xudmFyIF9faW1wb3J0RGVmYXVsdCA9ICh0aGlzICYmIHRoaXMuX19pbXBvcnREZWZhdWx0KSB8fCBmdW5jdGlvbiAobW9kKSB7XG4gICAgcmV0dXJuIChtb2QgJiYgbW9kLl9fZXNNb2R1bGUpID8gbW9kIDogeyBcImRlZmF1bHRcIjogbW9kIH07XG59O1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5lc2NhcGVVVEY4ID0gZXhwb3J0cy5lc2NhcGUgPSBleHBvcnRzLmVuY29kZU5vbkFzY2lpSFRNTCA9IGV4cG9ydHMuZW5jb2RlSFRNTCA9IGV4cG9ydHMuZW5jb2RlWE1MID0gdm9pZCAwO1xudmFyIHhtbF9qc29uXzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcIi4vbWFwcy94bWwuanNvblwiKSk7XG52YXIgaW52ZXJzZVhNTCA9IGdldEludmVyc2VPYmooeG1sX2pzb25fMS5kZWZhdWx0KTtcbnZhciB4bWxSZXBsYWNlciA9IGdldEludmVyc2VSZXBsYWNlcihpbnZlcnNlWE1MKTtcbi8qKlxuICogRW5jb2RlcyBhbGwgbm9uLUFTQ0lJIGNoYXJhY3RlcnMsIGFzIHdlbGwgYXMgY2hhcmFjdGVycyBub3QgdmFsaWQgaW4gWE1MXG4gKiBkb2N1bWVudHMgdXNpbmcgWE1MIGVudGl0aWVzLlxuICpcbiAqIElmIGEgY2hhcmFjdGVyIGhhcyBubyBlcXVpdmFsZW50IGVudGl0eSwgYVxuICogbnVtZXJpYyBoZXhhZGVjaW1hbCByZWZlcmVuY2UgKGVnLiBgJiN4ZmM7YCkgd2lsbCBiZSB1c2VkLlxuICovXG5leHBvcnRzLmVuY29kZVhNTCA9IGdldEFTQ0lJRW5jb2RlcihpbnZlcnNlWE1MKTtcbnZhciBlbnRpdGllc19qc29uXzEgPSBfX2ltcG9ydERlZmF1bHQocmVxdWlyZShcIi4vbWFwcy9lbnRpdGllcy5qc29uXCIpKTtcbnZhciBpbnZlcnNlSFRNTCA9IGdldEludmVyc2VPYmooZW50aXRpZXNfanNvbl8xLmRlZmF1bHQpO1xudmFyIGh0bWxSZXBsYWNlciA9IGdldEludmVyc2VSZXBsYWNlcihpbnZlcnNlSFRNTCk7XG4vKipcbiAqIEVuY29kZXMgYWxsIGVudGl0aWVzIGFuZCBub24tQVNDSUkgY2hhcmFjdGVycyBpbiB0aGUgaW5wdXQuXG4gKlxuICogVGhpcyBpbmNsdWRlcyBjaGFyYWN0ZXJzIHRoYXQgYXJlIHZhbGlkIEFTQ0lJIGNoYXJhY3RlcnMgaW4gSFRNTCBkb2N1bWVudHMuXG4gKiBGb3IgZXhhbXBsZSBgI2Agd2lsbCBiZSBlbmNvZGVkIGFzIGAmbnVtO2AuIFRvIGdldCBhIG1vcmUgY29tcGFjdCBvdXRwdXQsXG4gKiBjb25zaWRlciB1c2luZyB0aGUgYGVuY29kZU5vbkFzY2lpSFRNTGAgZnVuY3Rpb24uXG4gKlxuICogSWYgYSBjaGFyYWN0ZXIgaGFzIG5vIGVxdWl2YWxlbnQgZW50aXR5LCBhXG4gKiBudW1lcmljIGhleGFkZWNpbWFsIHJlZmVyZW5jZSAoZWcuIGAmI3hmYztgKSB3aWxsIGJlIHVzZWQuXG4gKi9cbmV4cG9ydHMuZW5jb2RlSFRNTCA9IGdldEludmVyc2UoaW52ZXJzZUhUTUwsIGh0bWxSZXBsYWNlcik7XG4vKipcbiAqIEVuY29kZXMgYWxsIG5vbi1BU0NJSSBjaGFyYWN0ZXJzLCBhcyB3ZWxsIGFzIGNoYXJhY3RlcnMgbm90IHZhbGlkIGluIEhUTUxcbiAqIGRvY3VtZW50cyB1c2luZyBIVE1MIGVudGl0aWVzLlxuICpcbiAqIElmIGEgY2hhcmFjdGVyIGhhcyBubyBlcXVpdmFsZW50IGVudGl0eSwgYVxuICogbnVtZXJpYyBoZXhhZGVjaW1hbCByZWZlcmVuY2UgKGVnLiBgJiN4ZmM7YCkgd2lsbCBiZSB1c2VkLlxuICovXG5leHBvcnRzLmVuY29kZU5vbkFzY2lpSFRNTCA9IGdldEFTQ0lJRW5jb2RlcihpbnZlcnNlSFRNTCk7XG5mdW5jdGlvbiBnZXRJbnZlcnNlT2JqKG9iaikge1xuICAgIHJldHVybiBPYmplY3Qua2V5cyhvYmopXG4gICAgICAgIC5zb3J0KClcbiAgICAgICAgLnJlZHVjZShmdW5jdGlvbiAoaW52ZXJzZSwgbmFtZSkge1xuICAgICAgICBpbnZlcnNlW29ialtuYW1lXV0gPSBcIiZcIiArIG5hbWUgKyBcIjtcIjtcbiAgICAgICAgcmV0dXJuIGludmVyc2U7XG4gICAgfSwge30pO1xufVxuZnVuY3Rpb24gZ2V0SW52ZXJzZVJlcGxhY2VyKGludmVyc2UpIHtcbiAgICB2YXIgc2luZ2xlID0gW107XG4gICAgdmFyIG11bHRpcGxlID0gW107XG4gICAgZm9yICh2YXIgX2kgPSAwLCBfYSA9IE9iamVjdC5rZXlzKGludmVyc2UpOyBfaSA8IF9hLmxlbmd0aDsgX2krKykge1xuICAgICAgICB2YXIgayA9IF9hW19pXTtcbiAgICAgICAgaWYgKGsubGVuZ3RoID09PSAxKSB7XG4gICAgICAgICAgICAvLyBBZGQgdmFsdWUgdG8gc2luZ2xlIGFycmF5XG4gICAgICAgICAgICBzaW5nbGUucHVzaChcIlxcXFxcIiArIGspO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgLy8gQWRkIHZhbHVlIHRvIG11bHRpcGxlIGFycmF5XG4gICAgICAgICAgICBtdWx0aXBsZS5wdXNoKGspO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8vIEFkZCByYW5nZXMgdG8gc2luZ2xlIGNoYXJhY3RlcnMuXG4gICAgc2luZ2xlLnNvcnQoKTtcbiAgICBmb3IgKHZhciBzdGFydCA9IDA7IHN0YXJ0IDwgc2luZ2xlLmxlbmd0aCAtIDE7IHN0YXJ0KyspIHtcbiAgICAgICAgLy8gRmluZCB0aGUgZW5kIG9mIGEgcnVuIG9mIGNoYXJhY3RlcnNcbiAgICAgICAgdmFyIGVuZCA9IHN0YXJ0O1xuICAgICAgICB3aGlsZSAoZW5kIDwgc2luZ2xlLmxlbmd0aCAtIDEgJiZcbiAgICAgICAgICAgIHNpbmdsZVtlbmRdLmNoYXJDb2RlQXQoMSkgKyAxID09PSBzaW5nbGVbZW5kICsgMV0uY2hhckNvZGVBdCgxKSkge1xuICAgICAgICAgICAgZW5kICs9IDE7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGNvdW50ID0gMSArIGVuZCAtIHN0YXJ0O1xuICAgICAgICAvLyBXZSB3YW50IHRvIHJlcGxhY2UgYXQgbGVhc3QgdGhyZWUgY2hhcmFjdGVyc1xuICAgICAgICBpZiAoY291bnQgPCAzKVxuICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgIHNpbmdsZS5zcGxpY2Uoc3RhcnQsIGNvdW50LCBzaW5nbGVbc3RhcnRdICsgXCItXCIgKyBzaW5nbGVbZW5kXSk7XG4gICAgfVxuICAgIG11bHRpcGxlLnVuc2hpZnQoXCJbXCIgKyBzaW5nbGUuam9pbihcIlwiKSArIFwiXVwiKTtcbiAgICByZXR1cm4gbmV3IFJlZ0V4cChtdWx0aXBsZS5qb2luKFwifFwiKSwgXCJnXCIpO1xufVxuLy8gL1teXFwwLVxceDdGXS9ndVxudmFyIHJlTm9uQVNDSUkgPSAvKD86W1xceDgwLVxcdUQ3RkZcXHVFMDAwLVxcdUZGRkZdfFtcXHVEODAwLVxcdURCRkZdW1xcdURDMDAtXFx1REZGRl18W1xcdUQ4MDAtXFx1REJGRl0oPyFbXFx1REMwMC1cXHVERkZGXSl8KD86W15cXHVEODAwLVxcdURCRkZdfF4pW1xcdURDMDAtXFx1REZGRl0pL2c7XG52YXIgZ2V0Q29kZVBvaW50ID0gXG4vLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLXVubmVjZXNzYXJ5LWNvbmRpdGlvblxuU3RyaW5nLnByb3RvdHlwZS5jb2RlUG9pbnRBdCAhPSBudWxsXG4gICAgPyAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLW5vbi1udWxsLWFzc2VydGlvblxuICAgICAgICBmdW5jdGlvbiAoc3RyKSB7IHJldHVybiBzdHIuY29kZVBvaW50QXQoMCk7IH1cbiAgICA6IC8vIGh0dHA6Ly9tYXRoaWFzYnluZW5zLmJlL25vdGVzL2phdmFzY3JpcHQtZW5jb2Rpbmcjc3Vycm9nYXRlLWZvcm11bGFlXG4gICAgICAgIGZ1bmN0aW9uIChjKSB7XG4gICAgICAgICAgICByZXR1cm4gKGMuY2hhckNvZGVBdCgwKSAtIDB4ZDgwMCkgKiAweDQwMCArXG4gICAgICAgICAgICAgICAgYy5jaGFyQ29kZUF0KDEpIC1cbiAgICAgICAgICAgICAgICAweGRjMDAgK1xuICAgICAgICAgICAgICAgIDB4MTAwMDA7XG4gICAgICAgIH07XG5mdW5jdGlvbiBzaW5nbGVDaGFyUmVwbGFjZXIoYykge1xuICAgIHJldHVybiBcIiYjeFwiICsgKGMubGVuZ3RoID4gMSA/IGdldENvZGVQb2ludChjKSA6IGMuY2hhckNvZGVBdCgwKSlcbiAgICAgICAgLnRvU3RyaW5nKDE2KVxuICAgICAgICAudG9VcHBlckNhc2UoKSArIFwiO1wiO1xufVxuZnVuY3Rpb24gZ2V0SW52ZXJzZShpbnZlcnNlLCByZSkge1xuICAgIHJldHVybiBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICByZXR1cm4gZGF0YVxuICAgICAgICAgICAgLnJlcGxhY2UocmUsIGZ1bmN0aW9uIChuYW1lKSB7IHJldHVybiBpbnZlcnNlW25hbWVdOyB9KVxuICAgICAgICAgICAgLnJlcGxhY2UocmVOb25BU0NJSSwgc2luZ2xlQ2hhclJlcGxhY2VyKTtcbiAgICB9O1xufVxudmFyIHJlRXNjYXBlQ2hhcnMgPSBuZXcgUmVnRXhwKHhtbFJlcGxhY2VyLnNvdXJjZSArIFwifFwiICsgcmVOb25BU0NJSS5zb3VyY2UsIFwiZ1wiKTtcbi8qKlxuICogRW5jb2RlcyBhbGwgbm9uLUFTQ0lJIGNoYXJhY3RlcnMsIGFzIHdlbGwgYXMgY2hhcmFjdGVycyBub3QgdmFsaWQgaW4gWE1MXG4gKiBkb2N1bWVudHMgdXNpbmcgbnVtZXJpYyBoZXhhZGVjaW1hbCByZWZlcmVuY2UgKGVnLiBgJiN4ZmM7YCkuXG4gKlxuICogSGF2ZSBhIGxvb2sgYXQgYGVzY2FwZVVURjhgIGlmIHlvdSB3YW50IGEgbW9yZSBjb25jaXNlIG91dHB1dCBhdCB0aGUgZXhwZW5zZVxuICogb2YgcmVkdWNlZCB0cmFuc3BvcnRhYmlsaXR5LlxuICpcbiAqIEBwYXJhbSBkYXRhIFN0cmluZyB0byBlc2NhcGUuXG4gKi9cbmZ1bmN0aW9uIGVzY2FwZShkYXRhKSB7XG4gICAgcmV0dXJuIGRhdGEucmVwbGFjZShyZUVzY2FwZUNoYXJzLCBzaW5nbGVDaGFyUmVwbGFjZXIpO1xufVxuZXhwb3J0cy5lc2NhcGUgPSBlc2NhcGU7XG4vKipcbiAqIEVuY29kZXMgYWxsIGNoYXJhY3RlcnMgbm90IHZhbGlkIGluIFhNTCBkb2N1bWVudHMgdXNpbmcgbnVtZXJpYyBoZXhhZGVjaW1hbFxuICogcmVmZXJlbmNlIChlZy4gYCYjeGZjO2ApLlxuICpcbiAqIE5vdGUgdGhhdCB0aGUgb3V0cHV0IHdpbGwgYmUgY2hhcmFjdGVyLXNldCBkZXBlbmRlbnQuXG4gKlxuICogQHBhcmFtIGRhdGEgU3RyaW5nIHRvIGVzY2FwZS5cbiAqL1xuZnVuY3Rpb24gZXNjYXBlVVRGOChkYXRhKSB7XG4gICAgcmV0dXJuIGRhdGEucmVwbGFjZSh4bWxSZXBsYWNlciwgc2luZ2xlQ2hhclJlcGxhY2VyKTtcbn1cbmV4cG9ydHMuZXNjYXBlVVRGOCA9IGVzY2FwZVVURjg7XG5mdW5jdGlvbiBnZXRBU0NJSUVuY29kZXIob2JqKSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgIHJldHVybiBkYXRhLnJlcGxhY2UocmVFc2NhcGVDaGFycywgZnVuY3Rpb24gKGMpIHsgcmV0dXJuIG9ialtjXSB8fCBzaW5nbGVDaGFyUmVwbGFjZXIoYyk7IH0pO1xuICAgIH07XG59XG4iXX0=