48de348941d1607b1e4a9c0fe89d5f3b
"use strict";

var __extends = this && this.__extends || function () {
  var _extendStatics = function extendStatics(d, b) {
    _extendStatics = Object.setPrototypeOf || {
      __proto__: []
    } instanceof Array && function (d, b) {
      d.__proto__ = b;
    } || function (d, b) {
      for (var p in b) {
        if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p];
      }
    };

    return _extendStatics(d, b);
  };

  return function (d, b) {
    _extendStatics(d, b);

    function __() {
      this.constructor = d;
    }

    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
  };
}();

var __assign = this && this.__assign || function () {
  __assign = Object.assign || function (t) {
    for (var s, i = 1, n = arguments.length; i < n; i++) {
      s = arguments[i];

      for (var p in s) {
        if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];
      }
    }

    return t;
  };

  return __assign.apply(this, arguments);
};

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.cloneNode = exports.Element = exports.Document = exports.NodeWithChildren = exports.ProcessingInstruction = exports.Comment = exports.Text = exports.DataNode = exports.Node = void 0;
var nodeTypes = new Map([["tag", 1], ["script", 1], ["style", 1], ["directive", 1], ["text", 3], ["cdata", 4], ["comment", 8], ["root", 9]]);

var Node = function () {
  function Node(type) {
    this.type = type;
    this.parent = null;
    this.prev = null;
    this.next = null;
    this.startIndex = null;
    this.endIndex = null;
  }

  Object.defineProperty(Node.prototype, "nodeType", {
    get: function get() {
      var _a;

      return (_a = nodeTypes.get(this.type)) !== null && _a !== void 0 ? _a : 1;
    },
    enumerable: false,
    configurable: true
  });
  Object.defineProperty(Node.prototype, "parentNode", {
    get: function get() {
      return this.parent;
    },
    set: function set(parent) {
      this.parent = parent;
    },
    enumerable: false,
    configurable: true
  });
  Object.defineProperty(Node.prototype, "previousSibling", {
    get: function get() {
      return this.prev;
    },
    set: function set(prev) {
      this.prev = prev;
    },
    enumerable: false,
    configurable: true
  });
  Object.defineProperty(Node.prototype, "nextSibling", {
    get: function get() {
      return this.next;
    },
    set: function set(next) {
      this.next = next;
    },
    enumerable: false,
    configurable: true
  });

  Node.prototype.cloneNode = function (recursive) {
    if (recursive === void 0) {
      recursive = false;
    }

    return cloneNode(this, recursive);
  };

  return Node;
}();

exports.Node = Node;

var DataNode = function (_super) {
  __extends(DataNode, _super);

  function DataNode(type, data) {
    var _this = _super.call(this, type) || this;

    _this.data = data;
    return _this;
  }

  Object.defineProperty(DataNode.prototype, "nodeValue", {
    get: function get() {
      return this.data;
    },
    set: function set(data) {
      this.data = data;
    },
    enumerable: false,
    configurable: true
  });
  return DataNode;
}(Node);

exports.DataNode = DataNode;

var Text = function (_super) {
  __extends(Text, _super);

  function Text(data) {
    return _super.call(this, "text", data) || this;
  }

  return Text;
}(DataNode);

exports.Text = Text;

var Comment = function (_super) {
  __extends(Comment, _super);

  function Comment(data) {
    return _super.call(this, "comment", data) || this;
  }

  return Comment;
}(DataNode);

exports.Comment = Comment;

var ProcessingInstruction = function (_super) {
  __extends(ProcessingInstruction, _super);

  function ProcessingInstruction(name, data) {
    var _this = _super.call(this, "directive", data) || this;

    _this.name = name;
    return _this;
  }

  return ProcessingInstruction;
}(DataNode);

exports.ProcessingInstruction = ProcessingInstruction;

var NodeWithChildren = function (_super) {
  __extends(NodeWithChildren, _super);

  function NodeWithChildren(type, children) {
    var _this = _super.call(this, type) || this;

    _this.children = children;
    return _this;
  }

  Object.defineProperty(NodeWithChildren.prototype, "firstChild", {
    get: function get() {
      var _a;

      return (_a = this.children[0]) !== null && _a !== void 0 ? _a : null;
    },
    enumerable: false,
    configurable: true
  });
  Object.defineProperty(NodeWithChildren.prototype, "lastChild", {
    get: function get() {
      return this.children.length > 0 ? this.children[this.children.length - 1] : null;
    },
    enumerable: false,
    configurable: true
  });
  Object.defineProperty(NodeWithChildren.prototype, "childNodes", {
    get: function get() {
      return this.children;
    },
    set: function set(children) {
      this.children = children;
    },
    enumerable: false,
    configurable: true
  });
  return NodeWithChildren;
}(Node);

exports.NodeWithChildren = NodeWithChildren;

var Document = function (_super) {
  __extends(Document, _super);

  function Document(children) {
    return _super.call(this, "root", children) || this;
  }

  return Document;
}(NodeWithChildren);

exports.Document = Document;

var Element = function (_super) {
  __extends(Element, _super);

  function Element(name, attribs, children) {
    if (children === void 0) {
      children = [];
    }

    var _this = _super.call(this, name === "script" ? "script" : name === "style" ? "style" : "tag", children) || this;

    _this.name = name;
    _this.attribs = attribs;
    _this.attribs = attribs;
    return _this;
  }

  Object.defineProperty(Element.prototype, "tagName", {
    get: function get() {
      return this.name;
    },
    set: function set(name) {
      this.name = name;
    },
    enumerable: false,
    configurable: true
  });
  Object.defineProperty(Element.prototype, "attributes", {
    get: function get() {
      var _this = this;

      return Object.keys(this.attribs).map(function (name) {
        var _a, _b;

        return {
          name: name,
          value: _this.attribs[name],
          namespace: (_a = _this["x-attribsNamespace"]) === null || _a === void 0 ? void 0 : _a[name],
          prefix: (_b = _this["x-attribsPrefix"]) === null || _b === void 0 ? void 0 : _b[name]
        };
      });
    },
    enumerable: false,
    configurable: true
  });
  return Element;
}(NodeWithChildren);

exports.Element = Element;

function cloneNode(node, recursive) {
  if (recursive === void 0) {
    recursive = false;
  }

  var result;

  switch (node.type) {
    case "text":
      result = new Text(node.data);
      break;

    case "directive":
      {
        var instr = node;
        result = new ProcessingInstruction(instr.name, instr.data);

        if (instr["x-name"] != null) {
          result["x-name"] = instr["x-name"];
          result["x-publicId"] = instr["x-publicId"];
          result["x-systemId"] = instr["x-systemId"];
        }

        break;
      }

    case "comment":
      result = new Comment(node.data);
      break;

    case "tag":
    case "script":
    case "style":
      {
        var elem = node;
        var children = recursive ? cloneChildren(elem.children) : [];
        var clone_1 = new Element(elem.name, __assign({}, elem.attribs), children);
        children.forEach(function (child) {
          return child.parent = clone_1;
        });

        if (elem["x-attribsNamespace"]) {
          clone_1["x-attribsNamespace"] = __assign({}, elem["x-attribsNamespace"]);
        }

        if (elem["x-attribsPrefix"]) {
          clone_1["x-attribsPrefix"] = __assign({}, elem["x-attribsPrefix"]);
        }

        result = clone_1;
        break;
      }

    case "cdata":
      {
        var cdata = node;
        var children = recursive ? cloneChildren(cdata.children) : [];
        var clone_2 = new NodeWithChildren(node.type, children);
        children.forEach(function (child) {
          return child.parent = clone_2;
        });
        result = clone_2;
        break;
      }

    case "root":
      {
        var doc = node;
        var children = recursive ? cloneChildren(doc.children) : [];
        var clone_3 = new Document(children);
        children.forEach(function (child) {
          return child.parent = clone_3;
        });

        if (doc["x-mode"]) {
          clone_3["x-mode"] = doc["x-mode"];
        }

        result = clone_3;
        break;
      }

    case "doctype":
      {
        throw new Error("Not implemented yet: ElementType.Doctype case");
      }
  }

  result.startIndex = node.startIndex;
  result.endIndex = node.endIndex;
  return result;
}

exports.cloneNode = cloneNode;

function cloneChildren(childs) {
  var children = childs.map(function (child) {
    return cloneNode(child, true);
  });

  for (var i = 1; i < children.length; i++) {
    children[i].prev = children[i - 1];
    children[i - 1].next = children[i];
  }

  return children;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGUuanMiXSwibmFtZXMiOlsiX19leHRlbmRzIiwiZXh0ZW5kU3RhdGljcyIsImQiLCJiIiwiT2JqZWN0Iiwic2V0UHJvdG90eXBlT2YiLCJfX3Byb3RvX18iLCJBcnJheSIsInAiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsImNhbGwiLCJfXyIsImNvbnN0cnVjdG9yIiwiY3JlYXRlIiwiX19hc3NpZ24iLCJhc3NpZ24iLCJ0IiwicyIsImkiLCJuIiwiYXJndW1lbnRzIiwibGVuZ3RoIiwiYXBwbHkiLCJkZWZpbmVQcm9wZXJ0eSIsImV4cG9ydHMiLCJ2YWx1ZSIsImNsb25lTm9kZSIsIkVsZW1lbnQiLCJEb2N1bWVudCIsIk5vZGVXaXRoQ2hpbGRyZW4iLCJQcm9jZXNzaW5nSW5zdHJ1Y3Rpb24iLCJDb21tZW50IiwiVGV4dCIsIkRhdGFOb2RlIiwiTm9kZSIsIm5vZGVUeXBlcyIsIk1hcCIsInR5cGUiLCJwYXJlbnQiLCJwcmV2IiwibmV4dCIsInN0YXJ0SW5kZXgiLCJlbmRJbmRleCIsImdldCIsIl9hIiwiZW51bWVyYWJsZSIsImNvbmZpZ3VyYWJsZSIsInNldCIsInJlY3Vyc2l2ZSIsIl9zdXBlciIsImRhdGEiLCJfdGhpcyIsIm5hbWUiLCJjaGlsZHJlbiIsImF0dHJpYnMiLCJrZXlzIiwibWFwIiwiX2IiLCJuYW1lc3BhY2UiLCJwcmVmaXgiLCJub2RlIiwicmVzdWx0IiwiaW5zdHIiLCJlbGVtIiwiY2xvbmVDaGlsZHJlbiIsImNsb25lXzEiLCJmb3JFYWNoIiwiY2hpbGQiLCJjZGF0YSIsImNsb25lXzIiLCJkb2MiLCJjbG9uZV8zIiwiRXJyb3IiLCJjaGlsZHMiXSwibWFwcGluZ3MiOiJBQUFBOztBQUNBLElBQUlBLFNBQVMsR0FBSSxRQUFRLEtBQUtBLFNBQWQsSUFBNkIsWUFBWTtBQUNyRCxNQUFJQyxjQUFhLEdBQUcsdUJBQVVDLENBQVYsRUFBYUMsQ0FBYixFQUFnQjtBQUNoQ0YsSUFBQUEsY0FBYSxHQUFHRyxNQUFNLENBQUNDLGNBQVAsSUFDWDtBQUFFQyxNQUFBQSxTQUFTLEVBQUU7QUFBYixpQkFBNkJDLEtBQTdCLElBQXNDLFVBQVVMLENBQVYsRUFBYUMsQ0FBYixFQUFnQjtBQUFFRCxNQUFBQSxDQUFDLENBQUNJLFNBQUYsR0FBY0gsQ0FBZDtBQUFrQixLQUQvRCxJQUVaLFVBQVVELENBQVYsRUFBYUMsQ0FBYixFQUFnQjtBQUFFLFdBQUssSUFBSUssQ0FBVCxJQUFjTCxDQUFkO0FBQWlCLFlBQUlDLE1BQU0sQ0FBQ0ssU0FBUCxDQUFpQkMsY0FBakIsQ0FBZ0NDLElBQWhDLENBQXFDUixDQUFyQyxFQUF3Q0ssQ0FBeEMsQ0FBSixFQUFnRE4sQ0FBQyxDQUFDTSxDQUFELENBQUQsR0FBT0wsQ0FBQyxDQUFDSyxDQUFELENBQVI7QUFBakU7QUFBK0UsS0FGckc7O0FBR0EsV0FBT1AsY0FBYSxDQUFDQyxDQUFELEVBQUlDLENBQUosQ0FBcEI7QUFDSCxHQUxEOztBQU1BLFNBQU8sVUFBVUQsQ0FBVixFQUFhQyxDQUFiLEVBQWdCO0FBQ25CRixJQUFBQSxjQUFhLENBQUNDLENBQUQsRUFBSUMsQ0FBSixDQUFiOztBQUNBLGFBQVNTLEVBQVQsR0FBYztBQUFFLFdBQUtDLFdBQUwsR0FBbUJYLENBQW5CO0FBQXVCOztBQUN2Q0EsSUFBQUEsQ0FBQyxDQUFDTyxTQUFGLEdBQWNOLENBQUMsS0FBSyxJQUFOLEdBQWFDLE1BQU0sQ0FBQ1UsTUFBUCxDQUFjWCxDQUFkLENBQWIsSUFBaUNTLEVBQUUsQ0FBQ0gsU0FBSCxHQUFlTixDQUFDLENBQUNNLFNBQWpCLEVBQTRCLElBQUlHLEVBQUosRUFBN0QsQ0FBZDtBQUNILEdBSkQ7QUFLSCxDQVoyQyxFQUE1Qzs7QUFhQSxJQUFJRyxRQUFRLEdBQUksUUFBUSxLQUFLQSxRQUFkLElBQTJCLFlBQVk7QUFDbERBLEVBQUFBLFFBQVEsR0FBR1gsTUFBTSxDQUFDWSxNQUFQLElBQWlCLFVBQVNDLENBQVQsRUFBWTtBQUNwQyxTQUFLLElBQUlDLENBQUosRUFBT0MsQ0FBQyxHQUFHLENBQVgsRUFBY0MsQ0FBQyxHQUFHQyxTQUFTLENBQUNDLE1BQWpDLEVBQXlDSCxDQUFDLEdBQUdDLENBQTdDLEVBQWdERCxDQUFDLEVBQWpELEVBQXFEO0FBQ2pERCxNQUFBQSxDQUFDLEdBQUdHLFNBQVMsQ0FBQ0YsQ0FBRCxDQUFiOztBQUNBLFdBQUssSUFBSVgsQ0FBVCxJQUFjVSxDQUFkO0FBQWlCLFlBQUlkLE1BQU0sQ0FBQ0ssU0FBUCxDQUFpQkMsY0FBakIsQ0FBZ0NDLElBQWhDLENBQXFDTyxDQUFyQyxFQUF3Q1YsQ0FBeEMsQ0FBSixFQUNiUyxDQUFDLENBQUNULENBQUQsQ0FBRCxHQUFPVSxDQUFDLENBQUNWLENBQUQsQ0FBUjtBQURKO0FBRUg7O0FBQ0QsV0FBT1MsQ0FBUDtBQUNILEdBUEQ7O0FBUUEsU0FBT0YsUUFBUSxDQUFDUSxLQUFULENBQWUsSUFBZixFQUFxQkYsU0FBckIsQ0FBUDtBQUNILENBVkQ7O0FBV0FqQixNQUFNLENBQUNvQixjQUFQLENBQXNCQyxPQUF0QixFQUErQixZQUEvQixFQUE2QztBQUFFQyxFQUFBQSxLQUFLLEVBQUU7QUFBVCxDQUE3QztBQUNBRCxPQUFPLENBQUNFLFNBQVIsR0FBb0JGLE9BQU8sQ0FBQ0csT0FBUixHQUFrQkgsT0FBTyxDQUFDSSxRQUFSLEdBQW1CSixPQUFPLENBQUNLLGdCQUFSLEdBQTJCTCxPQUFPLENBQUNNLHFCQUFSLEdBQWdDTixPQUFPLENBQUNPLE9BQVIsR0FBa0JQLE9BQU8sQ0FBQ1EsSUFBUixHQUFlUixPQUFPLENBQUNTLFFBQVIsR0FBbUJULE9BQU8sQ0FBQ1UsSUFBUixHQUFlLEtBQUssQ0FBNUw7QUFDQSxJQUFJQyxTQUFTLEdBQUcsSUFBSUMsR0FBSixDQUFRLENBQ3BCLENBQUMsS0FBRCxFQUFrQixDQUFsQixDQURvQixFQUVwQixDQUFDLFFBQUQsRUFBd0IsQ0FBeEIsQ0FGb0IsRUFHcEIsQ0FBQyxPQUFELEVBQXNCLENBQXRCLENBSG9CLEVBSXBCLENBQUMsV0FBRCxFQUE4QixDQUE5QixDQUpvQixFQUtwQixDQUFDLE1BQUQsRUFBb0IsQ0FBcEIsQ0FMb0IsRUFNcEIsQ0FBQyxPQUFELEVBQXNCLENBQXRCLENBTm9CLEVBT3BCLENBQUMsU0FBRCxFQUEwQixDQUExQixDQVBvQixFQVFwQixDQUFDLE1BQUQsRUFBb0IsQ0FBcEIsQ0FSb0IsQ0FBUixDQUFoQjs7QUFjQSxJQUFJRixJQUFJLEdBQWtCLFlBQVk7QUFLbEMsV0FBU0EsSUFBVCxDQUFjRyxJQUFkLEVBQW9CO0FBQ2hCLFNBQUtBLElBQUwsR0FBWUEsSUFBWjtBQUVBLFNBQUtDLE1BQUwsR0FBYyxJQUFkO0FBRUEsU0FBS0MsSUFBTCxHQUFZLElBQVo7QUFFQSxTQUFLQyxJQUFMLEdBQVksSUFBWjtBQUVBLFNBQUtDLFVBQUwsR0FBa0IsSUFBbEI7QUFFQSxTQUFLQyxRQUFMLEdBQWdCLElBQWhCO0FBQ0g7O0FBQ0R2QyxFQUFBQSxNQUFNLENBQUNvQixjQUFQLENBQXNCVyxJQUFJLENBQUMxQixTQUEzQixFQUFzQyxVQUF0QyxFQUFrRDtBQUU5Q21DLElBQUFBLEdBQUcsRUFBRSxlQUFZO0FBQ2IsVUFBSUMsRUFBSjs7QUFDQSxhQUFPLENBQUNBLEVBQUUsR0FBR1QsU0FBUyxDQUFDUSxHQUFWLENBQWMsS0FBS04sSUFBbkIsQ0FBTixNQUFvQyxJQUFwQyxJQUE0Q08sRUFBRSxLQUFLLEtBQUssQ0FBeEQsR0FBNERBLEVBQTVELEdBQWlFLENBQXhFO0FBQ0gsS0FMNkM7QUFNOUNDLElBQUFBLFVBQVUsRUFBRSxLQU5rQztBQU85Q0MsSUFBQUEsWUFBWSxFQUFFO0FBUGdDLEdBQWxEO0FBU0EzQyxFQUFBQSxNQUFNLENBQUNvQixjQUFQLENBQXNCVyxJQUFJLENBQUMxQixTQUEzQixFQUFzQyxZQUF0QyxFQUFvRDtBQUVoRG1DLElBQUFBLEdBQUcsRUFBRSxlQUFZO0FBQ2IsYUFBTyxLQUFLTCxNQUFaO0FBQ0gsS0FKK0M7QUFLaERTLElBQUFBLEdBQUcsRUFBRSxhQUFVVCxNQUFWLEVBQWtCO0FBQ25CLFdBQUtBLE1BQUwsR0FBY0EsTUFBZDtBQUNILEtBUCtDO0FBUWhETyxJQUFBQSxVQUFVLEVBQUUsS0FSb0M7QUFTaERDLElBQUFBLFlBQVksRUFBRTtBQVRrQyxHQUFwRDtBQVdBM0MsRUFBQUEsTUFBTSxDQUFDb0IsY0FBUCxDQUFzQlcsSUFBSSxDQUFDMUIsU0FBM0IsRUFBc0MsaUJBQXRDLEVBQXlEO0FBQ3JEbUMsSUFBQUEsR0FBRyxFQUFFLGVBQVk7QUFDYixhQUFPLEtBQUtKLElBQVo7QUFDSCxLQUhvRDtBQUlyRFEsSUFBQUEsR0FBRyxFQUFFLGFBQVVSLElBQVYsRUFBZ0I7QUFDakIsV0FBS0EsSUFBTCxHQUFZQSxJQUFaO0FBQ0gsS0FOb0Q7QUFPckRNLElBQUFBLFVBQVUsRUFBRSxLQVB5QztBQVFyREMsSUFBQUEsWUFBWSxFQUFFO0FBUnVDLEdBQXpEO0FBVUEzQyxFQUFBQSxNQUFNLENBQUNvQixjQUFQLENBQXNCVyxJQUFJLENBQUMxQixTQUEzQixFQUFzQyxhQUF0QyxFQUFxRDtBQUNqRG1DLElBQUFBLEdBQUcsRUFBRSxlQUFZO0FBQ2IsYUFBTyxLQUFLSCxJQUFaO0FBQ0gsS0FIZ0Q7QUFJakRPLElBQUFBLEdBQUcsRUFBRSxhQUFVUCxJQUFWLEVBQWdCO0FBQ2pCLFdBQUtBLElBQUwsR0FBWUEsSUFBWjtBQUNILEtBTmdEO0FBT2pESyxJQUFBQSxVQUFVLEVBQUUsS0FQcUM7QUFRakRDLElBQUFBLFlBQVksRUFBRTtBQVJtQyxHQUFyRDs7QUFnQkFaLEVBQUFBLElBQUksQ0FBQzFCLFNBQUwsQ0FBZWtCLFNBQWYsR0FBMkIsVUFBVXNCLFNBQVYsRUFBcUI7QUFDNUMsUUFBSUEsU0FBUyxLQUFLLEtBQUssQ0FBdkIsRUFBMEI7QUFBRUEsTUFBQUEsU0FBUyxHQUFHLEtBQVo7QUFBb0I7O0FBQ2hELFdBQU90QixTQUFTLENBQUMsSUFBRCxFQUFPc0IsU0FBUCxDQUFoQjtBQUNILEdBSEQ7O0FBSUEsU0FBT2QsSUFBUDtBQUNILENBckV5QixFQUExQjs7QUFzRUFWLE9BQU8sQ0FBQ1UsSUFBUixHQUFlQSxJQUFmOztBQUNBLElBQUlELFFBQVEsR0FBa0IsVUFBVWdCLE1BQVYsRUFBa0I7QUFDNUNsRCxFQUFBQSxTQUFTLENBQUNrQyxRQUFELEVBQVdnQixNQUFYLENBQVQ7O0FBS0EsV0FBU2hCLFFBQVQsQ0FBa0JJLElBQWxCLEVBQXdCYSxJQUF4QixFQUE4QjtBQUMxQixRQUFJQyxLQUFLLEdBQUdGLE1BQU0sQ0FBQ3ZDLElBQVAsQ0FBWSxJQUFaLEVBQWtCMkIsSUFBbEIsS0FBMkIsSUFBdkM7O0FBQ0FjLElBQUFBLEtBQUssQ0FBQ0QsSUFBTixHQUFhQSxJQUFiO0FBQ0EsV0FBT0MsS0FBUDtBQUNIOztBQUNEaEQsRUFBQUEsTUFBTSxDQUFDb0IsY0FBUCxDQUFzQlUsUUFBUSxDQUFDekIsU0FBL0IsRUFBMEMsV0FBMUMsRUFBdUQ7QUFDbkRtQyxJQUFBQSxHQUFHLEVBQUUsZUFBWTtBQUNiLGFBQU8sS0FBS08sSUFBWjtBQUNILEtBSGtEO0FBSW5ESCxJQUFBQSxHQUFHLEVBQUUsYUFBVUcsSUFBVixFQUFnQjtBQUNqQixXQUFLQSxJQUFMLEdBQVlBLElBQVo7QUFDSCxLQU5rRDtBQU9uREwsSUFBQUEsVUFBVSxFQUFFLEtBUHVDO0FBUW5EQyxJQUFBQSxZQUFZLEVBQUU7QUFScUMsR0FBdkQ7QUFVQSxTQUFPYixRQUFQO0FBQ0gsQ0F0QjZCLENBc0I1QkMsSUF0QjRCLENBQTlCOztBQXVCQVYsT0FBTyxDQUFDUyxRQUFSLEdBQW1CQSxRQUFuQjs7QUFDQSxJQUFJRCxJQUFJLEdBQWtCLFVBQVVpQixNQUFWLEVBQWtCO0FBQ3hDbEQsRUFBQUEsU0FBUyxDQUFDaUMsSUFBRCxFQUFPaUIsTUFBUCxDQUFUOztBQUNBLFdBQVNqQixJQUFULENBQWNrQixJQUFkLEVBQW9CO0FBQ2hCLFdBQU9ELE1BQU0sQ0FBQ3ZDLElBQVAsQ0FBWSxJQUFaLEVBQWtCLE1BQWxCLEVBQXFDd0MsSUFBckMsS0FBOEMsSUFBckQ7QUFDSDs7QUFDRCxTQUFPbEIsSUFBUDtBQUNILENBTnlCLENBTXhCQyxRQU53QixDQUExQjs7QUFPQVQsT0FBTyxDQUFDUSxJQUFSLEdBQWVBLElBQWY7O0FBQ0EsSUFBSUQsT0FBTyxHQUFrQixVQUFVa0IsTUFBVixFQUFrQjtBQUMzQ2xELEVBQUFBLFNBQVMsQ0FBQ2dDLE9BQUQsRUFBVWtCLE1BQVYsQ0FBVDs7QUFDQSxXQUFTbEIsT0FBVCxDQUFpQm1CLElBQWpCLEVBQXVCO0FBQ25CLFdBQU9ELE1BQU0sQ0FBQ3ZDLElBQVAsQ0FBWSxJQUFaLEVBQWtCLFNBQWxCLEVBQTJDd0MsSUFBM0MsS0FBb0QsSUFBM0Q7QUFDSDs7QUFDRCxTQUFPbkIsT0FBUDtBQUNILENBTjRCLENBTTNCRSxRQU4yQixDQUE3Qjs7QUFPQVQsT0FBTyxDQUFDTyxPQUFSLEdBQWtCQSxPQUFsQjs7QUFDQSxJQUFJRCxxQkFBcUIsR0FBa0IsVUFBVW1CLE1BQVYsRUFBa0I7QUFDekRsRCxFQUFBQSxTQUFTLENBQUMrQixxQkFBRCxFQUF3Qm1CLE1BQXhCLENBQVQ7O0FBQ0EsV0FBU25CLHFCQUFULENBQStCc0IsSUFBL0IsRUFBcUNGLElBQXJDLEVBQTJDO0FBQ3ZDLFFBQUlDLEtBQUssR0FBR0YsTUFBTSxDQUFDdkMsSUFBUCxDQUFZLElBQVosRUFBa0IsV0FBbEIsRUFBK0N3QyxJQUEvQyxLQUF3RCxJQUFwRTs7QUFDQUMsSUFBQUEsS0FBSyxDQUFDQyxJQUFOLEdBQWFBLElBQWI7QUFDQSxXQUFPRCxLQUFQO0FBQ0g7O0FBQ0QsU0FBT3JCLHFCQUFQO0FBQ0gsQ0FSMEMsQ0FRekNHLFFBUnlDLENBQTNDOztBQVNBVCxPQUFPLENBQUNNLHFCQUFSLEdBQWdDQSxxQkFBaEM7O0FBSUEsSUFBSUQsZ0JBQWdCLEdBQWtCLFVBQVVvQixNQUFWLEVBQWtCO0FBQ3BEbEQsRUFBQUEsU0FBUyxDQUFDOEIsZ0JBQUQsRUFBbUJvQixNQUFuQixDQUFUOztBQUtBLFdBQVNwQixnQkFBVCxDQUEwQlEsSUFBMUIsRUFBZ0NnQixRQUFoQyxFQUEwQztBQUN0QyxRQUFJRixLQUFLLEdBQUdGLE1BQU0sQ0FBQ3ZDLElBQVAsQ0FBWSxJQUFaLEVBQWtCMkIsSUFBbEIsS0FBMkIsSUFBdkM7O0FBQ0FjLElBQUFBLEtBQUssQ0FBQ0UsUUFBTixHQUFpQkEsUUFBakI7QUFDQSxXQUFPRixLQUFQO0FBQ0g7O0FBQ0RoRCxFQUFBQSxNQUFNLENBQUNvQixjQUFQLENBQXNCTSxnQkFBZ0IsQ0FBQ3JCLFNBQXZDLEVBQWtELFlBQWxELEVBQWdFO0FBRTVEbUMsSUFBQUEsR0FBRyxFQUFFLGVBQVk7QUFDYixVQUFJQyxFQUFKOztBQUNBLGFBQU8sQ0FBQ0EsRUFBRSxHQUFHLEtBQUtTLFFBQUwsQ0FBYyxDQUFkLENBQU4sTUFBNEIsSUFBNUIsSUFBb0NULEVBQUUsS0FBSyxLQUFLLENBQWhELEdBQW9EQSxFQUFwRCxHQUF5RCxJQUFoRTtBQUNILEtBTDJEO0FBTTVEQyxJQUFBQSxVQUFVLEVBQUUsS0FOZ0Q7QUFPNURDLElBQUFBLFlBQVksRUFBRTtBQVA4QyxHQUFoRTtBQVNBM0MsRUFBQUEsTUFBTSxDQUFDb0IsY0FBUCxDQUFzQk0sZ0JBQWdCLENBQUNyQixTQUF2QyxFQUFrRCxXQUFsRCxFQUErRDtBQUMzRG1DLElBQUFBLEdBQUcsRUFBRSxlQUFZO0FBQ2IsYUFBTyxLQUFLVSxRQUFMLENBQWNoQyxNQUFkLEdBQXVCLENBQXZCLEdBQ0QsS0FBS2dDLFFBQUwsQ0FBYyxLQUFLQSxRQUFMLENBQWNoQyxNQUFkLEdBQXVCLENBQXJDLENBREMsR0FFRCxJQUZOO0FBR0gsS0FMMEQ7QUFNM0R3QixJQUFBQSxVQUFVLEVBQUUsS0FOK0M7QUFPM0RDLElBQUFBLFlBQVksRUFBRTtBQVA2QyxHQUEvRDtBQVNBM0MsRUFBQUEsTUFBTSxDQUFDb0IsY0FBUCxDQUFzQk0sZ0JBQWdCLENBQUNyQixTQUF2QyxFQUFrRCxZQUFsRCxFQUFnRTtBQUM1RG1DLElBQUFBLEdBQUcsRUFBRSxlQUFZO0FBQ2IsYUFBTyxLQUFLVSxRQUFaO0FBQ0gsS0FIMkQ7QUFJNUROLElBQUFBLEdBQUcsRUFBRSxhQUFVTSxRQUFWLEVBQW9CO0FBQ3JCLFdBQUtBLFFBQUwsR0FBZ0JBLFFBQWhCO0FBQ0gsS0FOMkQ7QUFPNURSLElBQUFBLFVBQVUsRUFBRSxLQVBnRDtBQVE1REMsSUFBQUEsWUFBWSxFQUFFO0FBUjhDLEdBQWhFO0FBVUEsU0FBT2pCLGdCQUFQO0FBQ0gsQ0F4Q3FDLENBd0NwQ0ssSUF4Q29DLENBQXRDOztBQXlDQVYsT0FBTyxDQUFDSyxnQkFBUixHQUEyQkEsZ0JBQTNCOztBQUNBLElBQUlELFFBQVEsR0FBa0IsVUFBVXFCLE1BQVYsRUFBa0I7QUFDNUNsRCxFQUFBQSxTQUFTLENBQUM2QixRQUFELEVBQVdxQixNQUFYLENBQVQ7O0FBQ0EsV0FBU3JCLFFBQVQsQ0FBa0J5QixRQUFsQixFQUE0QjtBQUN4QixXQUFPSixNQUFNLENBQUN2QyxJQUFQLENBQVksSUFBWixFQUFrQixNQUFsQixFQUFxQzJDLFFBQXJDLEtBQWtELElBQXpEO0FBQ0g7O0FBQ0QsU0FBT3pCLFFBQVA7QUFDSCxDQU42QixDQU01QkMsZ0JBTjRCLENBQTlCOztBQU9BTCxPQUFPLENBQUNJLFFBQVIsR0FBbUJBLFFBQW5COztBQUNBLElBQUlELE9BQU8sR0FBa0IsVUFBVXNCLE1BQVYsRUFBa0I7QUFDM0NsRCxFQUFBQSxTQUFTLENBQUM0QixPQUFELEVBQVVzQixNQUFWLENBQVQ7O0FBTUEsV0FBU3RCLE9BQVQsQ0FBaUJ5QixJQUFqQixFQUF1QkUsT0FBdkIsRUFBZ0NELFFBQWhDLEVBQTBDO0FBQ3RDLFFBQUlBLFFBQVEsS0FBSyxLQUFLLENBQXRCLEVBQXlCO0FBQUVBLE1BQUFBLFFBQVEsR0FBRyxFQUFYO0FBQWdCOztBQUMzQyxRQUFJRixLQUFLLEdBQUdGLE1BQU0sQ0FBQ3ZDLElBQVAsQ0FBWSxJQUFaLEVBQWtCMEMsSUFBSSxLQUFLLFFBQVQsR0FDeEIsUUFEd0IsR0FFeEJBLElBQUksS0FBSyxPQUFULEdBQ0ksT0FESixHQUVJLEtBSkUsRUFJZUMsUUFKZixLQUk0QixJQUp4Qzs7QUFLQUYsSUFBQUEsS0FBSyxDQUFDQyxJQUFOLEdBQWFBLElBQWI7QUFDQUQsSUFBQUEsS0FBSyxDQUFDRyxPQUFOLEdBQWdCQSxPQUFoQjtBQUNBSCxJQUFBQSxLQUFLLENBQUNHLE9BQU4sR0FBZ0JBLE9BQWhCO0FBQ0EsV0FBT0gsS0FBUDtBQUNIOztBQUNEaEQsRUFBQUEsTUFBTSxDQUFDb0IsY0FBUCxDQUFzQkksT0FBTyxDQUFDbkIsU0FBOUIsRUFBeUMsU0FBekMsRUFBb0Q7QUFFaERtQyxJQUFBQSxHQUFHLEVBQUUsZUFBWTtBQUNiLGFBQU8sS0FBS1MsSUFBWjtBQUNILEtBSitDO0FBS2hETCxJQUFBQSxHQUFHLEVBQUUsYUFBVUssSUFBVixFQUFnQjtBQUNqQixXQUFLQSxJQUFMLEdBQVlBLElBQVo7QUFDSCxLQVArQztBQVFoRFAsSUFBQUEsVUFBVSxFQUFFLEtBUm9DO0FBU2hEQyxJQUFBQSxZQUFZLEVBQUU7QUFUa0MsR0FBcEQ7QUFXQTNDLEVBQUFBLE1BQU0sQ0FBQ29CLGNBQVAsQ0FBc0JJLE9BQU8sQ0FBQ25CLFNBQTlCLEVBQXlDLFlBQXpDLEVBQXVEO0FBQ25EbUMsSUFBQUEsR0FBRyxFQUFFLGVBQVk7QUFDYixVQUFJUSxLQUFLLEdBQUcsSUFBWjs7QUFDQSxhQUFPaEQsTUFBTSxDQUFDb0QsSUFBUCxDQUFZLEtBQUtELE9BQWpCLEVBQTBCRSxHQUExQixDQUE4QixVQUFVSixJQUFWLEVBQWdCO0FBQ2pELFlBQUlSLEVBQUosRUFBUWEsRUFBUjs7QUFDQSxlQUFRO0FBQ0pMLFVBQUFBLElBQUksRUFBRUEsSUFERjtBQUVKM0IsVUFBQUEsS0FBSyxFQUFFMEIsS0FBSyxDQUFDRyxPQUFOLENBQWNGLElBQWQsQ0FGSDtBQUdKTSxVQUFBQSxTQUFTLEVBQUUsQ0FBQ2QsRUFBRSxHQUFHTyxLQUFLLENBQUMsb0JBQUQsQ0FBWCxNQUF1QyxJQUF2QyxJQUErQ1AsRUFBRSxLQUFLLEtBQUssQ0FBM0QsR0FBK0QsS0FBSyxDQUFwRSxHQUF3RUEsRUFBRSxDQUFDUSxJQUFELENBSGpGO0FBSUpPLFVBQUFBLE1BQU0sRUFBRSxDQUFDRixFQUFFLEdBQUdOLEtBQUssQ0FBQyxpQkFBRCxDQUFYLE1BQW9DLElBQXBDLElBQTRDTSxFQUFFLEtBQUssS0FBSyxDQUF4RCxHQUE0RCxLQUFLLENBQWpFLEdBQXFFQSxFQUFFLENBQUNMLElBQUQ7QUFKM0UsU0FBUjtBQU1ILE9BUk0sQ0FBUDtBQVNILEtBWmtEO0FBYW5EUCxJQUFBQSxVQUFVLEVBQUUsS0FidUM7QUFjbkRDLElBQUFBLFlBQVksRUFBRTtBQWRxQyxHQUF2RDtBQWdCQSxTQUFPbkIsT0FBUDtBQUNILENBL0M0QixDQStDM0JFLGdCQS9DMkIsQ0FBN0I7O0FBZ0RBTCxPQUFPLENBQUNHLE9BQVIsR0FBa0JBLE9BQWxCOztBQU9BLFNBQVNELFNBQVQsQ0FBbUJrQyxJQUFuQixFQUF5QlosU0FBekIsRUFBb0M7QUFDaEMsTUFBSUEsU0FBUyxLQUFLLEtBQUssQ0FBdkIsRUFBMEI7QUFBRUEsSUFBQUEsU0FBUyxHQUFHLEtBQVo7QUFBb0I7O0FBQ2hELE1BQUlhLE1BQUo7O0FBQ0EsVUFBUUQsSUFBSSxDQUFDdkIsSUFBYjtBQUNJLFNBQUssTUFBTDtBQUNJd0IsTUFBQUEsTUFBTSxHQUFHLElBQUk3QixJQUFKLENBQVM0QixJQUFJLENBQUNWLElBQWQsQ0FBVDtBQUNBOztBQUNKLFNBQUssV0FBTDtBQUFrQztBQUM5QixZQUFJWSxLQUFLLEdBQUdGLElBQVo7QUFDQUMsUUFBQUEsTUFBTSxHQUFHLElBQUkvQixxQkFBSixDQUEwQmdDLEtBQUssQ0FBQ1YsSUFBaEMsRUFBc0NVLEtBQUssQ0FBQ1osSUFBNUMsQ0FBVDs7QUFDQSxZQUFJWSxLQUFLLENBQUMsUUFBRCxDQUFMLElBQW1CLElBQXZCLEVBQTZCO0FBQ3pCRCxVQUFBQSxNQUFNLENBQUMsUUFBRCxDQUFOLEdBQW1CQyxLQUFLLENBQUMsUUFBRCxDQUF4QjtBQUNBRCxVQUFBQSxNQUFNLENBQUMsWUFBRCxDQUFOLEdBQXVCQyxLQUFLLENBQUMsWUFBRCxDQUE1QjtBQUNBRCxVQUFBQSxNQUFNLENBQUMsWUFBRCxDQUFOLEdBQXVCQyxLQUFLLENBQUMsWUFBRCxDQUE1QjtBQUNIOztBQUNEO0FBQ0g7O0FBQ0QsU0FBSyxTQUFMO0FBQ0lELE1BQUFBLE1BQU0sR0FBRyxJQUFJOUIsT0FBSixDQUFZNkIsSUFBSSxDQUFDVixJQUFqQixDQUFUO0FBQ0E7O0FBQ0osU0FBSyxLQUFMO0FBQ0EsU0FBSyxRQUFMO0FBQ0EsU0FBSyxPQUFMO0FBQTBCO0FBQ3RCLFlBQUlhLElBQUksR0FBR0gsSUFBWDtBQUNBLFlBQUlQLFFBQVEsR0FBR0wsU0FBUyxHQUFHZ0IsYUFBYSxDQUFDRCxJQUFJLENBQUNWLFFBQU4sQ0FBaEIsR0FBa0MsRUFBMUQ7QUFDQSxZQUFJWSxPQUFPLEdBQUcsSUFBSXRDLE9BQUosQ0FBWW9DLElBQUksQ0FBQ1gsSUFBakIsRUFBdUJ0QyxRQUFRLENBQUMsRUFBRCxFQUFLaUQsSUFBSSxDQUFDVCxPQUFWLENBQS9CLEVBQW1ERCxRQUFuRCxDQUFkO0FBQ0FBLFFBQUFBLFFBQVEsQ0FBQ2EsT0FBVCxDQUFpQixVQUFVQyxLQUFWLEVBQWlCO0FBQUUsaUJBQVFBLEtBQUssQ0FBQzdCLE1BQU4sR0FBZTJCLE9BQXZCO0FBQWtDLFNBQXRFOztBQUNBLFlBQUlGLElBQUksQ0FBQyxvQkFBRCxDQUFSLEVBQWdDO0FBQzVCRSxVQUFBQSxPQUFPLENBQUMsb0JBQUQsQ0FBUCxHQUFnQ25ELFFBQVEsQ0FBQyxFQUFELEVBQUtpRCxJQUFJLENBQUMsb0JBQUQsQ0FBVCxDQUF4QztBQUNIOztBQUNELFlBQUlBLElBQUksQ0FBQyxpQkFBRCxDQUFSLEVBQTZCO0FBQ3pCRSxVQUFBQSxPQUFPLENBQUMsaUJBQUQsQ0FBUCxHQUE2Qm5ELFFBQVEsQ0FBQyxFQUFELEVBQUtpRCxJQUFJLENBQUMsaUJBQUQsQ0FBVCxDQUFyQztBQUNIOztBQUNERixRQUFBQSxNQUFNLEdBQUdJLE9BQVQ7QUFDQTtBQUNIOztBQUNELFNBQUssT0FBTDtBQUEwQjtBQUN0QixZQUFJRyxLQUFLLEdBQUdSLElBQVo7QUFDQSxZQUFJUCxRQUFRLEdBQUdMLFNBQVMsR0FBR2dCLGFBQWEsQ0FBQ0ksS0FBSyxDQUFDZixRQUFQLENBQWhCLEdBQW1DLEVBQTNEO0FBQ0EsWUFBSWdCLE9BQU8sR0FBRyxJQUFJeEMsZ0JBQUosQ0FBcUIrQixJQUFJLENBQUN2QixJQUExQixFQUFnQ2dCLFFBQWhDLENBQWQ7QUFDQUEsUUFBQUEsUUFBUSxDQUFDYSxPQUFULENBQWlCLFVBQVVDLEtBQVYsRUFBaUI7QUFBRSxpQkFBUUEsS0FBSyxDQUFDN0IsTUFBTixHQUFlK0IsT0FBdkI7QUFBa0MsU0FBdEU7QUFDQVIsUUFBQUEsTUFBTSxHQUFHUSxPQUFUO0FBQ0E7QUFDSDs7QUFDRCxTQUFLLE1BQUw7QUFBd0I7QUFDcEIsWUFBSUMsR0FBRyxHQUFHVixJQUFWO0FBQ0EsWUFBSVAsUUFBUSxHQUFHTCxTQUFTLEdBQUdnQixhQUFhLENBQUNNLEdBQUcsQ0FBQ2pCLFFBQUwsQ0FBaEIsR0FBaUMsRUFBekQ7QUFDQSxZQUFJa0IsT0FBTyxHQUFHLElBQUkzQyxRQUFKLENBQWF5QixRQUFiLENBQWQ7QUFDQUEsUUFBQUEsUUFBUSxDQUFDYSxPQUFULENBQWlCLFVBQVVDLEtBQVYsRUFBaUI7QUFBRSxpQkFBUUEsS0FBSyxDQUFDN0IsTUFBTixHQUFlaUMsT0FBdkI7QUFBa0MsU0FBdEU7O0FBQ0EsWUFBSUQsR0FBRyxDQUFDLFFBQUQsQ0FBUCxFQUFtQjtBQUNmQyxVQUFBQSxPQUFPLENBQUMsUUFBRCxDQUFQLEdBQW9CRCxHQUFHLENBQUMsUUFBRCxDQUF2QjtBQUNIOztBQUNEVCxRQUFBQSxNQUFNLEdBQUdVLE9BQVQ7QUFDQTtBQUNIOztBQUNELFNBQUssU0FBTDtBQUE4QjtBQUUxQixjQUFNLElBQUlDLEtBQUosQ0FBVSwrQ0FBVixDQUFOO0FBQ0g7QUF2REw7O0FBeURBWCxFQUFBQSxNQUFNLENBQUNwQixVQUFQLEdBQW9CbUIsSUFBSSxDQUFDbkIsVUFBekI7QUFDQW9CLEVBQUFBLE1BQU0sQ0FBQ25CLFFBQVAsR0FBa0JrQixJQUFJLENBQUNsQixRQUF2QjtBQUNBLFNBQU9tQixNQUFQO0FBQ0g7O0FBQ0RyQyxPQUFPLENBQUNFLFNBQVIsR0FBb0JBLFNBQXBCOztBQUNBLFNBQVNzQyxhQUFULENBQXVCUyxNQUF2QixFQUErQjtBQUMzQixNQUFJcEIsUUFBUSxHQUFHb0IsTUFBTSxDQUFDakIsR0FBUCxDQUFXLFVBQVVXLEtBQVYsRUFBaUI7QUFBRSxXQUFPekMsU0FBUyxDQUFDeUMsS0FBRCxFQUFRLElBQVIsQ0FBaEI7QUFBZ0MsR0FBOUQsQ0FBZjs7QUFDQSxPQUFLLElBQUlqRCxDQUFDLEdBQUcsQ0FBYixFQUFnQkEsQ0FBQyxHQUFHbUMsUUFBUSxDQUFDaEMsTUFBN0IsRUFBcUNILENBQUMsRUFBdEMsRUFBMEM7QUFDdENtQyxJQUFBQSxRQUFRLENBQUNuQyxDQUFELENBQVIsQ0FBWXFCLElBQVosR0FBbUJjLFFBQVEsQ0FBQ25DLENBQUMsR0FBRyxDQUFMLENBQTNCO0FBQ0FtQyxJQUFBQSxRQUFRLENBQUNuQyxDQUFDLEdBQUcsQ0FBTCxDQUFSLENBQWdCc0IsSUFBaEIsR0FBdUJhLFFBQVEsQ0FBQ25DLENBQUQsQ0FBL0I7QUFDSDs7QUFDRCxTQUFPbUMsUUFBUDtBQUNIIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19leHRlbmRzID0gKHRoaXMgJiYgdGhpcy5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8XG4gICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8XG4gICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoYiwgcCkpIGRbcF0gPSBiW3BdOyB9O1xuICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICB9O1xuICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cbiAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xuICAgIH07XG59KSgpO1xudmFyIF9fYXNzaWduID0gKHRoaXMgJiYgdGhpcy5fX2Fzc2lnbikgfHwgZnVuY3Rpb24gKCkge1xuICAgIF9fYXNzaWduID0gT2JqZWN0LmFzc2lnbiB8fCBmdW5jdGlvbih0KSB7XG4gICAgICAgIGZvciAodmFyIHMsIGkgPSAxLCBuID0gYXJndW1lbnRzLmxlbmd0aDsgaSA8IG47IGkrKykge1xuICAgICAgICAgICAgcyA9IGFyZ3VtZW50c1tpXTtcbiAgICAgICAgICAgIGZvciAodmFyIHAgaW4gcykgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChzLCBwKSlcbiAgICAgICAgICAgICAgICB0W3BdID0gc1twXTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdDtcbiAgICB9O1xuICAgIHJldHVybiBfX2Fzc2lnbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xufTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuY2xvbmVOb2RlID0gZXhwb3J0cy5FbGVtZW50ID0gZXhwb3J0cy5Eb2N1bWVudCA9IGV4cG9ydHMuTm9kZVdpdGhDaGlsZHJlbiA9IGV4cG9ydHMuUHJvY2Vzc2luZ0luc3RydWN0aW9uID0gZXhwb3J0cy5Db21tZW50ID0gZXhwb3J0cy5UZXh0ID0gZXhwb3J0cy5EYXRhTm9kZSA9IGV4cG9ydHMuTm9kZSA9IHZvaWQgMDtcbnZhciBub2RlVHlwZXMgPSBuZXcgTWFwKFtcbiAgICBbXCJ0YWdcIiAvKiBUYWcgKi8sIDFdLFxuICAgIFtcInNjcmlwdFwiIC8qIFNjcmlwdCAqLywgMV0sXG4gICAgW1wic3R5bGVcIiAvKiBTdHlsZSAqLywgMV0sXG4gICAgW1wiZGlyZWN0aXZlXCIgLyogRGlyZWN0aXZlICovLCAxXSxcbiAgICBbXCJ0ZXh0XCIgLyogVGV4dCAqLywgM10sXG4gICAgW1wiY2RhdGFcIiAvKiBDREFUQSAqLywgNF0sXG4gICAgW1wiY29tbWVudFwiIC8qIENvbW1lbnQgKi8sIDhdLFxuICAgIFtcInJvb3RcIiAvKiBSb290ICovLCA5XSxcbl0pO1xuLyoqXG4gKiBUaGlzIG9iamVjdCB3aWxsIGJlIHVzZWQgYXMgdGhlIHByb3RvdHlwZSBmb3IgTm9kZXMgd2hlbiBjcmVhdGluZyBhXG4gKiBET00tTGV2ZWwtMS1jb21wbGlhbnQgc3RydWN0dXJlLlxuICovXG52YXIgTm9kZSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcbiAgICAvKipcbiAgICAgKlxuICAgICAqIEBwYXJhbSB0eXBlIFRoZSB0eXBlIG9mIHRoZSBub2RlLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIE5vZGUodHlwZSkge1xuICAgICAgICB0aGlzLnR5cGUgPSB0eXBlO1xuICAgICAgICAvKiogUGFyZW50IG9mIHRoZSBub2RlICovXG4gICAgICAgIHRoaXMucGFyZW50ID0gbnVsbDtcbiAgICAgICAgLyoqIFByZXZpb3VzIHNpYmxpbmcgKi9cbiAgICAgICAgdGhpcy5wcmV2ID0gbnVsbDtcbiAgICAgICAgLyoqIE5leHQgc2libGluZyAqL1xuICAgICAgICB0aGlzLm5leHQgPSBudWxsO1xuICAgICAgICAvKiogVGhlIHN0YXJ0IGluZGV4IG9mIHRoZSBub2RlLiBSZXF1aXJlcyBgd2l0aFN0YXJ0SW5kaWNlc2Agb24gdGhlIGhhbmRsZXIgdG8gYmUgYHRydWUuICovXG4gICAgICAgIHRoaXMuc3RhcnRJbmRleCA9IG51bGw7XG4gICAgICAgIC8qKiBUaGUgZW5kIGluZGV4IG9mIHRoZSBub2RlLiBSZXF1aXJlcyBgd2l0aEVuZEluZGljZXNgIG9uIHRoZSBoYW5kbGVyIHRvIGJlIGB0cnVlLiAqL1xuICAgICAgICB0aGlzLmVuZEluZGV4ID0gbnVsbDtcbiAgICB9XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KE5vZGUucHJvdG90eXBlLCBcIm5vZGVUeXBlXCIsIHtcbiAgICAgICAgLy8gUmVhZC1vbmx5IGFsaWFzZXNcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgX2E7XG4gICAgICAgICAgICByZXR1cm4gKF9hID0gbm9kZVR5cGVzLmdldCh0aGlzLnR5cGUpKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiAxO1xuICAgICAgICB9LFxuICAgICAgICBlbnVtZXJhYmxlOiBmYWxzZSxcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXG4gICAgfSk7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KE5vZGUucHJvdG90eXBlLCBcInBhcmVudE5vZGVcIiwge1xuICAgICAgICAvLyBSZWFkLXdyaXRlIGFsaWFzZXMgZm9yIHByb3BlcnRpZXNcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5wYXJlbnQ7XG4gICAgICAgIH0sXG4gICAgICAgIHNldDogZnVuY3Rpb24gKHBhcmVudCkge1xuICAgICAgICAgICAgdGhpcy5wYXJlbnQgPSBwYXJlbnQ7XG4gICAgICAgIH0sXG4gICAgICAgIGVudW1lcmFibGU6IGZhbHNlLFxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcbiAgICB9KTtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoTm9kZS5wcm90b3R5cGUsIFwicHJldmlvdXNTaWJsaW5nXCIsIHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5wcmV2O1xuICAgICAgICB9LFxuICAgICAgICBzZXQ6IGZ1bmN0aW9uIChwcmV2KSB7XG4gICAgICAgICAgICB0aGlzLnByZXYgPSBwcmV2O1xuICAgICAgICB9LFxuICAgICAgICBlbnVtZXJhYmxlOiBmYWxzZSxcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXG4gICAgfSk7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KE5vZGUucHJvdG90eXBlLCBcIm5leHRTaWJsaW5nXCIsIHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5uZXh0O1xuICAgICAgICB9LFxuICAgICAgICBzZXQ6IGZ1bmN0aW9uIChuZXh0KSB7XG4gICAgICAgICAgICB0aGlzLm5leHQgPSBuZXh0O1xuICAgICAgICB9LFxuICAgICAgICBlbnVtZXJhYmxlOiBmYWxzZSxcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXG4gICAgfSk7XG4gICAgLyoqXG4gICAgICogQ2xvbmUgdGhpcyBub2RlLCBhbmQgb3B0aW9uYWxseSBpdHMgY2hpbGRyZW4uXG4gICAgICpcbiAgICAgKiBAcGFyYW0gcmVjdXJzaXZlIENsb25lIGNoaWxkIG5vZGVzIGFzIHdlbGwuXG4gICAgICogQHJldHVybnMgQSBjbG9uZSBvZiB0aGUgbm9kZS5cbiAgICAgKi9cbiAgICBOb2RlLnByb3RvdHlwZS5jbG9uZU5vZGUgPSBmdW5jdGlvbiAocmVjdXJzaXZlKSB7XG4gICAgICAgIGlmIChyZWN1cnNpdmUgPT09IHZvaWQgMCkgeyByZWN1cnNpdmUgPSBmYWxzZTsgfVxuICAgICAgICByZXR1cm4gY2xvbmVOb2RlKHRoaXMsIHJlY3Vyc2l2ZSk7XG4gICAgfTtcbiAgICByZXR1cm4gTm9kZTtcbn0oKSk7XG5leHBvcnRzLk5vZGUgPSBOb2RlO1xudmFyIERhdGFOb2RlID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgIF9fZXh0ZW5kcyhEYXRhTm9kZSwgX3N1cGVyKTtcbiAgICAvKipcbiAgICAgKiBAcGFyYW0gdHlwZSBUaGUgdHlwZSBvZiB0aGUgbm9kZVxuICAgICAqIEBwYXJhbSBkYXRhIFRoZSBjb250ZW50IG9mIHRoZSBkYXRhIG5vZGVcbiAgICAgKi9cbiAgICBmdW5jdGlvbiBEYXRhTm9kZSh0eXBlLCBkYXRhKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMsIHR5cGUpIHx8IHRoaXM7XG4gICAgICAgIF90aGlzLmRhdGEgPSBkYXRhO1xuICAgICAgICByZXR1cm4gX3RoaXM7XG4gICAgfVxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShEYXRhTm9kZS5wcm90b3R5cGUsIFwibm9kZVZhbHVlXCIsIHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5kYXRhO1xuICAgICAgICB9LFxuICAgICAgICBzZXQ6IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICB0aGlzLmRhdGEgPSBkYXRhO1xuICAgICAgICB9LFxuICAgICAgICBlbnVtZXJhYmxlOiBmYWxzZSxcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXG4gICAgfSk7XG4gICAgcmV0dXJuIERhdGFOb2RlO1xufShOb2RlKSk7XG5leHBvcnRzLkRhdGFOb2RlID0gRGF0YU5vZGU7XG52YXIgVGV4dCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoVGV4dCwgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBUZXh0KGRhdGEpIHtcbiAgICAgICAgcmV0dXJuIF9zdXBlci5jYWxsKHRoaXMsIFwidGV4dFwiIC8qIFRleHQgKi8sIGRhdGEpIHx8IHRoaXM7XG4gICAgfVxuICAgIHJldHVybiBUZXh0O1xufShEYXRhTm9kZSkpO1xuZXhwb3J0cy5UZXh0ID0gVGV4dDtcbnZhciBDb21tZW50ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgIF9fZXh0ZW5kcyhDb21tZW50LCBfc3VwZXIpO1xuICAgIGZ1bmN0aW9uIENvbW1lbnQoZGF0YSkge1xuICAgICAgICByZXR1cm4gX3N1cGVyLmNhbGwodGhpcywgXCJjb21tZW50XCIgLyogQ29tbWVudCAqLywgZGF0YSkgfHwgdGhpcztcbiAgICB9XG4gICAgcmV0dXJuIENvbW1lbnQ7XG59KERhdGFOb2RlKSk7XG5leHBvcnRzLkNvbW1lbnQgPSBDb21tZW50O1xudmFyIFByb2Nlc3NpbmdJbnN0cnVjdGlvbiA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoUHJvY2Vzc2luZ0luc3RydWN0aW9uLCBfc3VwZXIpO1xuICAgIGZ1bmN0aW9uIFByb2Nlc3NpbmdJbnN0cnVjdGlvbihuYW1lLCBkYXRhKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMsIFwiZGlyZWN0aXZlXCIgLyogRGlyZWN0aXZlICovLCBkYXRhKSB8fCB0aGlzO1xuICAgICAgICBfdGhpcy5uYW1lID0gbmFtZTtcbiAgICAgICAgcmV0dXJuIF90aGlzO1xuICAgIH1cbiAgICByZXR1cm4gUHJvY2Vzc2luZ0luc3RydWN0aW9uO1xufShEYXRhTm9kZSkpO1xuZXhwb3J0cy5Qcm9jZXNzaW5nSW5zdHJ1Y3Rpb24gPSBQcm9jZXNzaW5nSW5zdHJ1Y3Rpb247XG4vKipcbiAqIEEgYE5vZGVgIHRoYXQgY2FuIGhhdmUgY2hpbGRyZW4uXG4gKi9cbnZhciBOb2RlV2l0aENoaWxkcmVuID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgIF9fZXh0ZW5kcyhOb2RlV2l0aENoaWxkcmVuLCBfc3VwZXIpO1xuICAgIC8qKlxuICAgICAqIEBwYXJhbSB0eXBlIFR5cGUgb2YgdGhlIG5vZGUuXG4gICAgICogQHBhcmFtIGNoaWxkcmVuIENoaWxkcmVuIG9mIHRoZSBub2RlLiBPbmx5IGNlcnRhaW4gbm9kZSB0eXBlcyBjYW4gaGF2ZSBjaGlsZHJlbi5cbiAgICAgKi9cbiAgICBmdW5jdGlvbiBOb2RlV2l0aENoaWxkcmVuKHR5cGUsIGNoaWxkcmVuKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMsIHR5cGUpIHx8IHRoaXM7XG4gICAgICAgIF90aGlzLmNoaWxkcmVuID0gY2hpbGRyZW47XG4gICAgICAgIHJldHVybiBfdGhpcztcbiAgICB9XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KE5vZGVXaXRoQ2hpbGRyZW4ucHJvdG90eXBlLCBcImZpcnN0Q2hpbGRcIiwge1xuICAgICAgICAvLyBBbGlhc2VzXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIF9hO1xuICAgICAgICAgICAgcmV0dXJuIChfYSA9IHRoaXMuY2hpbGRyZW5bMF0pICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IG51bGw7XG4gICAgICAgIH0sXG4gICAgICAgIGVudW1lcmFibGU6IGZhbHNlLFxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcbiAgICB9KTtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoTm9kZVdpdGhDaGlsZHJlbi5wcm90b3R5cGUsIFwibGFzdENoaWxkXCIsIHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5jaGlsZHJlbi5sZW5ndGggPiAwXG4gICAgICAgICAgICAgICAgPyB0aGlzLmNoaWxkcmVuW3RoaXMuY2hpbGRyZW4ubGVuZ3RoIC0gMV1cbiAgICAgICAgICAgICAgICA6IG51bGw7XG4gICAgICAgIH0sXG4gICAgICAgIGVudW1lcmFibGU6IGZhbHNlLFxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcbiAgICB9KTtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoTm9kZVdpdGhDaGlsZHJlbi5wcm90b3R5cGUsIFwiY2hpbGROb2Rlc1wiLCB7XG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuY2hpbGRyZW47XG4gICAgICAgIH0sXG4gICAgICAgIHNldDogZnVuY3Rpb24gKGNoaWxkcmVuKSB7XG4gICAgICAgICAgICB0aGlzLmNoaWxkcmVuID0gY2hpbGRyZW47XG4gICAgICAgIH0sXG4gICAgICAgIGVudW1lcmFibGU6IGZhbHNlLFxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcbiAgICB9KTtcbiAgICByZXR1cm4gTm9kZVdpdGhDaGlsZHJlbjtcbn0oTm9kZSkpO1xuZXhwb3J0cy5Ob2RlV2l0aENoaWxkcmVuID0gTm9kZVdpdGhDaGlsZHJlbjtcbnZhciBEb2N1bWVudCA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoRG9jdW1lbnQsIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gRG9jdW1lbnQoY2hpbGRyZW4pIHtcbiAgICAgICAgcmV0dXJuIF9zdXBlci5jYWxsKHRoaXMsIFwicm9vdFwiIC8qIFJvb3QgKi8sIGNoaWxkcmVuKSB8fCB0aGlzO1xuICAgIH1cbiAgICByZXR1cm4gRG9jdW1lbnQ7XG59KE5vZGVXaXRoQ2hpbGRyZW4pKTtcbmV4cG9ydHMuRG9jdW1lbnQgPSBEb2N1bWVudDtcbnZhciBFbGVtZW50ID0gLyoqIEBjbGFzcyAqLyAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgIF9fZXh0ZW5kcyhFbGVtZW50LCBfc3VwZXIpO1xuICAgIC8qKlxuICAgICAqIEBwYXJhbSBuYW1lIE5hbWUgb2YgdGhlIHRhZywgZWcuIGBkaXZgLCBgc3BhbmAuXG4gICAgICogQHBhcmFtIGF0dHJpYnMgT2JqZWN0IG1hcHBpbmcgYXR0cmlidXRlIG5hbWVzIHRvIGF0dHJpYnV0ZSB2YWx1ZXMuXG4gICAgICogQHBhcmFtIGNoaWxkcmVuIENoaWxkcmVuIG9mIHRoZSBub2RlLlxuICAgICAqL1xuICAgIGZ1bmN0aW9uIEVsZW1lbnQobmFtZSwgYXR0cmlicywgY2hpbGRyZW4pIHtcbiAgICAgICAgaWYgKGNoaWxkcmVuID09PSB2b2lkIDApIHsgY2hpbGRyZW4gPSBbXTsgfVxuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCBuYW1lID09PSBcInNjcmlwdFwiXG4gICAgICAgICAgICA/IFwic2NyaXB0XCIgLyogU2NyaXB0ICovXG4gICAgICAgICAgICA6IG5hbWUgPT09IFwic3R5bGVcIlxuICAgICAgICAgICAgICAgID8gXCJzdHlsZVwiIC8qIFN0eWxlICovXG4gICAgICAgICAgICAgICAgOiBcInRhZ1wiIC8qIFRhZyAqLywgY2hpbGRyZW4pIHx8IHRoaXM7XG4gICAgICAgIF90aGlzLm5hbWUgPSBuYW1lO1xuICAgICAgICBfdGhpcy5hdHRyaWJzID0gYXR0cmlicztcbiAgICAgICAgX3RoaXMuYXR0cmlicyA9IGF0dHJpYnM7XG4gICAgICAgIHJldHVybiBfdGhpcztcbiAgICB9XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KEVsZW1lbnQucHJvdG90eXBlLCBcInRhZ05hbWVcIiwge1xuICAgICAgICAvLyBET00gTGV2ZWwgMSBhbGlhc2VzXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMubmFtZTtcbiAgICAgICAgfSxcbiAgICAgICAgc2V0OiBmdW5jdGlvbiAobmFtZSkge1xuICAgICAgICAgICAgdGhpcy5uYW1lID0gbmFtZTtcbiAgICAgICAgfSxcbiAgICAgICAgZW51bWVyYWJsZTogZmFsc2UsXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxuICAgIH0pO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShFbGVtZW50LnByb3RvdHlwZSwgXCJhdHRyaWJ1dGVzXCIsIHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICAgICAgcmV0dXJuIE9iamVjdC5rZXlzKHRoaXMuYXR0cmlicykubWFwKGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICAgICAgICAgICAgdmFyIF9hLCBfYjtcbiAgICAgICAgICAgICAgICByZXR1cm4gKHtcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogbmFtZSxcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IF90aGlzLmF0dHJpYnNbbmFtZV0sXG4gICAgICAgICAgICAgICAgICAgIG5hbWVzcGFjZTogKF9hID0gX3RoaXNbXCJ4LWF0dHJpYnNOYW1lc3BhY2VcIl0pID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYVtuYW1lXSxcbiAgICAgICAgICAgICAgICAgICAgcHJlZml4OiAoX2IgPSBfdGhpc1tcIngtYXR0cmlic1ByZWZpeFwiXSkgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iW25hbWVdLFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIGVudW1lcmFibGU6IGZhbHNlLFxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcbiAgICB9KTtcbiAgICByZXR1cm4gRWxlbWVudDtcbn0oTm9kZVdpdGhDaGlsZHJlbikpO1xuZXhwb3J0cy5FbGVtZW50ID0gRWxlbWVudDtcbi8qKlxuICogQ2xvbmUgYSBub2RlLCBhbmQgb3B0aW9uYWxseSBpdHMgY2hpbGRyZW4uXG4gKlxuICogQHBhcmFtIHJlY3Vyc2l2ZSBDbG9uZSBjaGlsZCBub2RlcyBhcyB3ZWxsLlxuICogQHJldHVybnMgQSBjbG9uZSBvZiB0aGUgbm9kZS5cbiAqL1xuZnVuY3Rpb24gY2xvbmVOb2RlKG5vZGUsIHJlY3Vyc2l2ZSkge1xuICAgIGlmIChyZWN1cnNpdmUgPT09IHZvaWQgMCkgeyByZWN1cnNpdmUgPSBmYWxzZTsgfVxuICAgIHZhciByZXN1bHQ7XG4gICAgc3dpdGNoIChub2RlLnR5cGUpIHtcbiAgICAgICAgY2FzZSBcInRleHRcIiAvKiBUZXh0ICovOlxuICAgICAgICAgICAgcmVzdWx0ID0gbmV3IFRleHQobm9kZS5kYXRhKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwiZGlyZWN0aXZlXCIgLyogRGlyZWN0aXZlICovOiB7XG4gICAgICAgICAgICB2YXIgaW5zdHIgPSBub2RlO1xuICAgICAgICAgICAgcmVzdWx0ID0gbmV3IFByb2Nlc3NpbmdJbnN0cnVjdGlvbihpbnN0ci5uYW1lLCBpbnN0ci5kYXRhKTtcbiAgICAgICAgICAgIGlmIChpbnN0cltcIngtbmFtZVwiXSAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0W1wieC1uYW1lXCJdID0gaW5zdHJbXCJ4LW5hbWVcIl07XG4gICAgICAgICAgICAgICAgcmVzdWx0W1wieC1wdWJsaWNJZFwiXSA9IGluc3RyW1wieC1wdWJsaWNJZFwiXTtcbiAgICAgICAgICAgICAgICByZXN1bHRbXCJ4LXN5c3RlbUlkXCJdID0gaW5zdHJbXCJ4LXN5c3RlbUlkXCJdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSBcImNvbW1lbnRcIiAvKiBDb21tZW50ICovOlxuICAgICAgICAgICAgcmVzdWx0ID0gbmV3IENvbW1lbnQobm9kZS5kYXRhKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwidGFnXCIgLyogVGFnICovOlxuICAgICAgICBjYXNlIFwic2NyaXB0XCIgLyogU2NyaXB0ICovOlxuICAgICAgICBjYXNlIFwic3R5bGVcIiAvKiBTdHlsZSAqLzoge1xuICAgICAgICAgICAgdmFyIGVsZW0gPSBub2RlO1xuICAgICAgICAgICAgdmFyIGNoaWxkcmVuID0gcmVjdXJzaXZlID8gY2xvbmVDaGlsZHJlbihlbGVtLmNoaWxkcmVuKSA6IFtdO1xuICAgICAgICAgICAgdmFyIGNsb25lXzEgPSBuZXcgRWxlbWVudChlbGVtLm5hbWUsIF9fYXNzaWduKHt9LCBlbGVtLmF0dHJpYnMpLCBjaGlsZHJlbik7XG4gICAgICAgICAgICBjaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uIChjaGlsZCkgeyByZXR1cm4gKGNoaWxkLnBhcmVudCA9IGNsb25lXzEpOyB9KTtcbiAgICAgICAgICAgIGlmIChlbGVtW1wieC1hdHRyaWJzTmFtZXNwYWNlXCJdKSB7XG4gICAgICAgICAgICAgICAgY2xvbmVfMVtcIngtYXR0cmlic05hbWVzcGFjZVwiXSA9IF9fYXNzaWduKHt9LCBlbGVtW1wieC1hdHRyaWJzTmFtZXNwYWNlXCJdKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChlbGVtW1wieC1hdHRyaWJzUHJlZml4XCJdKSB7XG4gICAgICAgICAgICAgICAgY2xvbmVfMVtcIngtYXR0cmlic1ByZWZpeFwiXSA9IF9fYXNzaWduKHt9LCBlbGVtW1wieC1hdHRyaWJzUHJlZml4XCJdKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJlc3VsdCA9IGNsb25lXzE7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICBjYXNlIFwiY2RhdGFcIiAvKiBDREFUQSAqLzoge1xuICAgICAgICAgICAgdmFyIGNkYXRhID0gbm9kZTtcbiAgICAgICAgICAgIHZhciBjaGlsZHJlbiA9IHJlY3Vyc2l2ZSA/IGNsb25lQ2hpbGRyZW4oY2RhdGEuY2hpbGRyZW4pIDogW107XG4gICAgICAgICAgICB2YXIgY2xvbmVfMiA9IG5ldyBOb2RlV2l0aENoaWxkcmVuKG5vZGUudHlwZSwgY2hpbGRyZW4pO1xuICAgICAgICAgICAgY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbiAoY2hpbGQpIHsgcmV0dXJuIChjaGlsZC5wYXJlbnQgPSBjbG9uZV8yKTsgfSk7XG4gICAgICAgICAgICByZXN1bHQgPSBjbG9uZV8yO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgY2FzZSBcInJvb3RcIiAvKiBSb290ICovOiB7XG4gICAgICAgICAgICB2YXIgZG9jID0gbm9kZTtcbiAgICAgICAgICAgIHZhciBjaGlsZHJlbiA9IHJlY3Vyc2l2ZSA/IGNsb25lQ2hpbGRyZW4oZG9jLmNoaWxkcmVuKSA6IFtdO1xuICAgICAgICAgICAgdmFyIGNsb25lXzMgPSBuZXcgRG9jdW1lbnQoY2hpbGRyZW4pO1xuICAgICAgICAgICAgY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbiAoY2hpbGQpIHsgcmV0dXJuIChjaGlsZC5wYXJlbnQgPSBjbG9uZV8zKTsgfSk7XG4gICAgICAgICAgICBpZiAoZG9jW1wieC1tb2RlXCJdKSB7XG4gICAgICAgICAgICAgICAgY2xvbmVfM1tcIngtbW9kZVwiXSA9IGRvY1tcIngtbW9kZVwiXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJlc3VsdCA9IGNsb25lXzM7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICBjYXNlIFwiZG9jdHlwZVwiIC8qIERvY3R5cGUgKi86IHtcbiAgICAgICAgICAgIC8vIFRoaXMgdHlwZSBpc24ndCB1c2VkIHlldC5cbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIk5vdCBpbXBsZW1lbnRlZCB5ZXQ6IEVsZW1lbnRUeXBlLkRvY3R5cGUgY2FzZVwiKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXN1bHQuc3RhcnRJbmRleCA9IG5vZGUuc3RhcnRJbmRleDtcbiAgICByZXN1bHQuZW5kSW5kZXggPSBub2RlLmVuZEluZGV4O1xuICAgIHJldHVybiByZXN1bHQ7XG59XG5leHBvcnRzLmNsb25lTm9kZSA9IGNsb25lTm9kZTtcbmZ1bmN0aW9uIGNsb25lQ2hpbGRyZW4oY2hpbGRzKSB7XG4gICAgdmFyIGNoaWxkcmVuID0gY2hpbGRzLm1hcChmdW5jdGlvbiAoY2hpbGQpIHsgcmV0dXJuIGNsb25lTm9kZShjaGlsZCwgdHJ1ZSk7IH0pO1xuICAgIGZvciAodmFyIGkgPSAxOyBpIDwgY2hpbGRyZW4ubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgY2hpbGRyZW5baV0ucHJldiA9IGNoaWxkcmVuW2kgLSAxXTtcbiAgICAgICAgY2hpbGRyZW5baSAtIDFdLm5leHQgPSBjaGlsZHJlbltpXTtcbiAgICB9XG4gICAgcmV0dXJuIGNoaWxkcmVuO1xufVxuIl19