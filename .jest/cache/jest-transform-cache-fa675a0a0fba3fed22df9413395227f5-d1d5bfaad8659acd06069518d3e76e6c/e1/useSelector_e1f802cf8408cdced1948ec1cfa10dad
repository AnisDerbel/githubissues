3a0a8cce8cb552b50967e15f4585b27f
"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

exports.__esModule = true;
exports.createSelectorHook = createSelectorHook;
exports.useSelector = void 0;

var _react = require("react");

var _useReduxContext2 = require("./useReduxContext");

var _Subscription = _interopRequireDefault(require("../utils/Subscription"));

var _useIsomorphicLayoutEffect = require("../utils/useIsomorphicLayoutEffect");

var _Context = require("../components/Context");

var refEquality = function refEquality(a, b) {
  return a === b;
};

function useSelectorWithStoreAndSubscription(selector, equalityFn, store, contextSub) {
  var _useReducer = (0, _react.useReducer)(function (s) {
    return s + 1;
  }, 0),
      forceRender = _useReducer[1];

  var subscription = (0, _react.useMemo)(function () {
    return new _Subscription["default"](store, contextSub);
  }, [store, contextSub]);
  var latestSubscriptionCallbackError = (0, _react.useRef)();
  var latestSelector = (0, _react.useRef)();
  var latestStoreState = (0, _react.useRef)();
  var latestSelectedState = (0, _react.useRef)();
  var storeState = store.getState();
  var selectedState;

  try {
    if (selector !== latestSelector.current || storeState !== latestStoreState.current || latestSubscriptionCallbackError.current) {
      var newSelectedState = selector(storeState);

      if (latestSelectedState.current === undefined || !equalityFn(newSelectedState, latestSelectedState.current)) {
        selectedState = newSelectedState;
      } else {
        selectedState = latestSelectedState.current;
      }
    } else {
      selectedState = latestSelectedState.current;
    }
  } catch (err) {
    if (latestSubscriptionCallbackError.current) {
      err.message += "\nThe error may be correlated with this previous error:\n" + latestSubscriptionCallbackError.current.stack + "\n\n";
    }

    throw err;
  }

  (0, _useIsomorphicLayoutEffect.useIsomorphicLayoutEffect)(function () {
    latestSelector.current = selector;
    latestStoreState.current = storeState;
    latestSelectedState.current = selectedState;
    latestSubscriptionCallbackError.current = undefined;
  });
  (0, _useIsomorphicLayoutEffect.useIsomorphicLayoutEffect)(function () {
    function checkForUpdates() {
      try {
        var _newSelectedState = latestSelector.current(store.getState());

        if (equalityFn(_newSelectedState, latestSelectedState.current)) {
          return;
        }

        latestSelectedState.current = _newSelectedState;
      } catch (err) {
        latestSubscriptionCallbackError.current = err;
      }

      forceRender();
    }

    subscription.onStateChange = checkForUpdates;
    subscription.trySubscribe();
    checkForUpdates();
    return function () {
      return subscription.tryUnsubscribe();
    };
  }, [store, subscription]);
  return selectedState;
}

function createSelectorHook(context) {
  if (context === void 0) {
    context = _Context.ReactReduxContext;
  }

  var useReduxContext = context === _Context.ReactReduxContext ? _useReduxContext2.useReduxContext : function () {
    return (0, _react.useContext)(context);
  };
  return function useSelector(selector, equalityFn) {
    if (equalityFn === void 0) {
      equalityFn = refEquality;
    }

    if (process.env.NODE_ENV !== 'production' && !selector) {
      throw new Error("You must pass a selector to useSelector");
    }

    var _useReduxContext = useReduxContext(),
        store = _useReduxContext.store,
        contextSub = _useReduxContext.subscription;

    var selectedState = useSelectorWithStoreAndSubscription(selector, equalityFn, store, contextSub);
    (0, _react.useDebugValue)(selectedState);
    return selectedState;
  };
}

var useSelector = createSelectorHook();
exports.useSelector = useSelector;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInVzZVNlbGVjdG9yLmpzIl0sIm5hbWVzIjpbIl9pbnRlcm9wUmVxdWlyZURlZmF1bHQiLCJyZXF1aXJlIiwiZXhwb3J0cyIsIl9fZXNNb2R1bGUiLCJjcmVhdGVTZWxlY3Rvckhvb2siLCJ1c2VTZWxlY3RvciIsIl9yZWFjdCIsIl91c2VSZWR1eENvbnRleHQyIiwiX1N1YnNjcmlwdGlvbiIsIl91c2VJc29tb3JwaGljTGF5b3V0RWZmZWN0IiwiX0NvbnRleHQiLCJyZWZFcXVhbGl0eSIsImEiLCJiIiwidXNlU2VsZWN0b3JXaXRoU3RvcmVBbmRTdWJzY3JpcHRpb24iLCJzZWxlY3RvciIsImVxdWFsaXR5Rm4iLCJzdG9yZSIsImNvbnRleHRTdWIiLCJfdXNlUmVkdWNlciIsInVzZVJlZHVjZXIiLCJzIiwiZm9yY2VSZW5kZXIiLCJzdWJzY3JpcHRpb24iLCJ1c2VNZW1vIiwibGF0ZXN0U3Vic2NyaXB0aW9uQ2FsbGJhY2tFcnJvciIsInVzZVJlZiIsImxhdGVzdFNlbGVjdG9yIiwibGF0ZXN0U3RvcmVTdGF0ZSIsImxhdGVzdFNlbGVjdGVkU3RhdGUiLCJzdG9yZVN0YXRlIiwiZ2V0U3RhdGUiLCJzZWxlY3RlZFN0YXRlIiwiY3VycmVudCIsIm5ld1NlbGVjdGVkU3RhdGUiLCJ1bmRlZmluZWQiLCJlcnIiLCJtZXNzYWdlIiwic3RhY2siLCJ1c2VJc29tb3JwaGljTGF5b3V0RWZmZWN0IiwiY2hlY2tGb3JVcGRhdGVzIiwiX25ld1NlbGVjdGVkU3RhdGUiLCJvblN0YXRlQ2hhbmdlIiwidHJ5U3Vic2NyaWJlIiwidHJ5VW5zdWJzY3JpYmUiLCJjb250ZXh0IiwiUmVhY3RSZWR1eENvbnRleHQiLCJ1c2VSZWR1eENvbnRleHQiLCJ1c2VDb250ZXh0IiwicHJvY2VzcyIsImVudiIsIk5PREVfRU5WIiwiRXJyb3IiLCJfdXNlUmVkdXhDb250ZXh0IiwidXNlRGVidWdWYWx1ZSJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUEsSUFBSUEsc0JBQXNCLEdBQUdDLE9BQU8sQ0FBQyw4Q0FBRCxDQUFwQzs7QUFFQUMsT0FBTyxDQUFDQyxVQUFSLEdBQXFCLElBQXJCO0FBQ0FELE9BQU8sQ0FBQ0Usa0JBQVIsR0FBNkJBLGtCQUE3QjtBQUNBRixPQUFPLENBQUNHLFdBQVIsR0FBc0IsS0FBSyxDQUEzQjs7QUFFQSxJQUFJQyxNQUFNLEdBQUdMLE9BQU8sQ0FBQyxPQUFELENBQXBCOztBQUVBLElBQUlNLGlCQUFpQixHQUFHTixPQUFPLENBQUMsbUJBQUQsQ0FBL0I7O0FBRUEsSUFBSU8sYUFBYSxHQUFHUixzQkFBc0IsQ0FBQ0MsT0FBTyxDQUFDLHVCQUFELENBQVIsQ0FBMUM7O0FBRUEsSUFBSVEsMEJBQTBCLEdBQUdSLE9BQU8sQ0FBQyxvQ0FBRCxDQUF4Qzs7QUFFQSxJQUFJUyxRQUFRLEdBQUdULE9BQU8sQ0FBQyx1QkFBRCxDQUF0Qjs7QUFFQSxJQUFJVSxXQUFXLEdBQUcsU0FBU0EsV0FBVCxDQUFxQkMsQ0FBckIsRUFBd0JDLENBQXhCLEVBQTJCO0FBQzNDLFNBQU9ELENBQUMsS0FBS0MsQ0FBYjtBQUNELENBRkQ7O0FBSUEsU0FBU0MsbUNBQVQsQ0FBNkNDLFFBQTdDLEVBQXVEQyxVQUF2RCxFQUFtRUMsS0FBbkUsRUFBMEVDLFVBQTFFLEVBQXNGO0FBQ3BGLE1BQUlDLFdBQVcsR0FBRyxDQUFDLEdBQUdiLE1BQU0sQ0FBQ2MsVUFBWCxFQUF1QixVQUFVQyxDQUFWLEVBQWE7QUFDcEQsV0FBT0EsQ0FBQyxHQUFHLENBQVg7QUFDRCxHQUZpQixFQUVmLENBRmUsQ0FBbEI7QUFBQSxNQUdJQyxXQUFXLEdBQUdILFdBQVcsQ0FBQyxDQUFELENBSDdCOztBQUtBLE1BQUlJLFlBQVksR0FBRyxDQUFDLEdBQUdqQixNQUFNLENBQUNrQixPQUFYLEVBQW9CLFlBQVk7QUFDakQsV0FBTyxJQUFJaEIsYUFBYSxDQUFDLFNBQUQsQ0FBakIsQ0FBNkJTLEtBQTdCLEVBQW9DQyxVQUFwQyxDQUFQO0FBQ0QsR0FGa0IsRUFFaEIsQ0FBQ0QsS0FBRCxFQUFRQyxVQUFSLENBRmdCLENBQW5CO0FBR0EsTUFBSU8sK0JBQStCLEdBQUcsQ0FBQyxHQUFHbkIsTUFBTSxDQUFDb0IsTUFBWCxHQUF0QztBQUNBLE1BQUlDLGNBQWMsR0FBRyxDQUFDLEdBQUdyQixNQUFNLENBQUNvQixNQUFYLEdBQXJCO0FBQ0EsTUFBSUUsZ0JBQWdCLEdBQUcsQ0FBQyxHQUFHdEIsTUFBTSxDQUFDb0IsTUFBWCxHQUF2QjtBQUNBLE1BQUlHLG1CQUFtQixHQUFHLENBQUMsR0FBR3ZCLE1BQU0sQ0FBQ29CLE1BQVgsR0FBMUI7QUFDQSxNQUFJSSxVQUFVLEdBQUdiLEtBQUssQ0FBQ2MsUUFBTixFQUFqQjtBQUNBLE1BQUlDLGFBQUo7O0FBRUEsTUFBSTtBQUNGLFFBQUlqQixRQUFRLEtBQUtZLGNBQWMsQ0FBQ00sT0FBNUIsSUFBdUNILFVBQVUsS0FBS0YsZ0JBQWdCLENBQUNLLE9BQXZFLElBQWtGUiwrQkFBK0IsQ0FBQ1EsT0FBdEgsRUFBK0g7QUFDN0gsVUFBSUMsZ0JBQWdCLEdBQUduQixRQUFRLENBQUNlLFVBQUQsQ0FBL0I7O0FBRUEsVUFBSUQsbUJBQW1CLENBQUNJLE9BQXBCLEtBQWdDRSxTQUFoQyxJQUE2QyxDQUFDbkIsVUFBVSxDQUFDa0IsZ0JBQUQsRUFBbUJMLG1CQUFtQixDQUFDSSxPQUF2QyxDQUE1RCxFQUE2RztBQUMzR0QsUUFBQUEsYUFBYSxHQUFHRSxnQkFBaEI7QUFDRCxPQUZELE1BRU87QUFDTEYsUUFBQUEsYUFBYSxHQUFHSCxtQkFBbUIsQ0FBQ0ksT0FBcEM7QUFDRDtBQUNGLEtBUkQsTUFRTztBQUNMRCxNQUFBQSxhQUFhLEdBQUdILG1CQUFtQixDQUFDSSxPQUFwQztBQUNEO0FBQ0YsR0FaRCxDQVlFLE9BQU9HLEdBQVAsRUFBWTtBQUNaLFFBQUlYLCtCQUErQixDQUFDUSxPQUFwQyxFQUE2QztBQUMzQ0csTUFBQUEsR0FBRyxDQUFDQyxPQUFKLElBQWUsOERBQThEWiwrQkFBK0IsQ0FBQ1EsT0FBaEMsQ0FBd0NLLEtBQXRHLEdBQThHLE1BQTdIO0FBQ0Q7O0FBRUQsVUFBTUYsR0FBTjtBQUNEOztBQUVELEdBQUMsR0FBRzNCLDBCQUEwQixDQUFDOEIseUJBQS9CLEVBQTBELFlBQVk7QUFDcEVaLElBQUFBLGNBQWMsQ0FBQ00sT0FBZixHQUF5QmxCLFFBQXpCO0FBQ0FhLElBQUFBLGdCQUFnQixDQUFDSyxPQUFqQixHQUEyQkgsVUFBM0I7QUFDQUQsSUFBQUEsbUJBQW1CLENBQUNJLE9BQXBCLEdBQThCRCxhQUE5QjtBQUNBUCxJQUFBQSwrQkFBK0IsQ0FBQ1EsT0FBaEMsR0FBMENFLFNBQTFDO0FBQ0QsR0FMRDtBQU1BLEdBQUMsR0FBRzFCLDBCQUEwQixDQUFDOEIseUJBQS9CLEVBQTBELFlBQVk7QUFDcEUsYUFBU0MsZUFBVCxHQUEyQjtBQUN6QixVQUFJO0FBQ0YsWUFBSUMsaUJBQWlCLEdBQUdkLGNBQWMsQ0FBQ00sT0FBZixDQUF1QmhCLEtBQUssQ0FBQ2MsUUFBTixFQUF2QixDQUF4Qjs7QUFFQSxZQUFJZixVQUFVLENBQUN5QixpQkFBRCxFQUFvQlosbUJBQW1CLENBQUNJLE9BQXhDLENBQWQsRUFBZ0U7QUFDOUQ7QUFDRDs7QUFFREosUUFBQUEsbUJBQW1CLENBQUNJLE9BQXBCLEdBQThCUSxpQkFBOUI7QUFDRCxPQVJELENBUUUsT0FBT0wsR0FBUCxFQUFZO0FBS1pYLFFBQUFBLCtCQUErQixDQUFDUSxPQUFoQyxHQUEwQ0csR0FBMUM7QUFDRDs7QUFFRGQsTUFBQUEsV0FBVztBQUNaOztBQUVEQyxJQUFBQSxZQUFZLENBQUNtQixhQUFiLEdBQTZCRixlQUE3QjtBQUNBakIsSUFBQUEsWUFBWSxDQUFDb0IsWUFBYjtBQUNBSCxJQUFBQSxlQUFlO0FBQ2YsV0FBTyxZQUFZO0FBQ2pCLGFBQU9qQixZQUFZLENBQUNxQixjQUFiLEVBQVA7QUFDRCxLQUZEO0FBR0QsR0EzQkQsRUEyQkcsQ0FBQzNCLEtBQUQsRUFBUU0sWUFBUixDQTNCSDtBQTRCQSxTQUFPUyxhQUFQO0FBQ0Q7O0FBU0QsU0FBUzVCLGtCQUFULENBQTRCeUMsT0FBNUIsRUFBcUM7QUFDbkMsTUFBSUEsT0FBTyxLQUFLLEtBQUssQ0FBckIsRUFBd0I7QUFDdEJBLElBQUFBLE9BQU8sR0FBR25DLFFBQVEsQ0FBQ29DLGlCQUFuQjtBQUNEOztBQUVELE1BQUlDLGVBQWUsR0FBR0YsT0FBTyxLQUFLbkMsUUFBUSxDQUFDb0MsaUJBQXJCLEdBQXlDdkMsaUJBQWlCLENBQUN3QyxlQUEzRCxHQUE2RSxZQUFZO0FBQzdHLFdBQU8sQ0FBQyxHQUFHekMsTUFBTSxDQUFDMEMsVUFBWCxFQUF1QkgsT0FBdkIsQ0FBUDtBQUNELEdBRkQ7QUFHQSxTQUFPLFNBQVN4QyxXQUFULENBQXFCVSxRQUFyQixFQUErQkMsVUFBL0IsRUFBMkM7QUFDaEQsUUFBSUEsVUFBVSxLQUFLLEtBQUssQ0FBeEIsRUFBMkI7QUFDekJBLE1BQUFBLFVBQVUsR0FBR0wsV0FBYjtBQUNEOztBQUVELFFBQUlzQyxPQUFPLENBQUNDLEdBQVIsQ0FBWUMsUUFBWixLQUF5QixZQUF6QixJQUF5QyxDQUFDcEMsUUFBOUMsRUFBd0Q7QUFDdEQsWUFBTSxJQUFJcUMsS0FBSixDQUFVLHlDQUFWLENBQU47QUFDRDs7QUFFRCxRQUFJQyxnQkFBZ0IsR0FBR04sZUFBZSxFQUF0QztBQUFBLFFBQ0k5QixLQUFLLEdBQUdvQyxnQkFBZ0IsQ0FBQ3BDLEtBRDdCO0FBQUEsUUFFSUMsVUFBVSxHQUFHbUMsZ0JBQWdCLENBQUM5QixZQUZsQzs7QUFJQSxRQUFJUyxhQUFhLEdBQUdsQixtQ0FBbUMsQ0FBQ0MsUUFBRCxFQUFXQyxVQUFYLEVBQXVCQyxLQUF2QixFQUE4QkMsVUFBOUIsQ0FBdkQ7QUFDQSxLQUFDLEdBQUdaLE1BQU0sQ0FBQ2dELGFBQVgsRUFBMEJ0QixhQUExQjtBQUNBLFdBQU9BLGFBQVA7QUFDRCxHQWhCRDtBQWlCRDs7QUEwQkQsSUFBSTNCLFdBQVcsR0FBZ0JELGtCQUFrQixFQUFqRDtBQUNBRixPQUFPLENBQUNHLFdBQVIsR0FBc0JBLFdBQXRCIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5cbnZhciBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0ID0gcmVxdWlyZShcIkBiYWJlbC9ydW50aW1lL2hlbHBlcnMvaW50ZXJvcFJlcXVpcmVEZWZhdWx0XCIpO1xuXG5leHBvcnRzLl9fZXNNb2R1bGUgPSB0cnVlO1xuZXhwb3J0cy5jcmVhdGVTZWxlY3Rvckhvb2sgPSBjcmVhdGVTZWxlY3Rvckhvb2s7XG5leHBvcnRzLnVzZVNlbGVjdG9yID0gdm9pZCAwO1xuXG52YXIgX3JlYWN0ID0gcmVxdWlyZShcInJlYWN0XCIpO1xuXG52YXIgX3VzZVJlZHV4Q29udGV4dDIgPSByZXF1aXJlKFwiLi91c2VSZWR1eENvbnRleHRcIik7XG5cbnZhciBfU3Vic2NyaXB0aW9uID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKFwiLi4vdXRpbHMvU3Vic2NyaXB0aW9uXCIpKTtcblxudmFyIF91c2VJc29tb3JwaGljTGF5b3V0RWZmZWN0ID0gcmVxdWlyZShcIi4uL3V0aWxzL3VzZUlzb21vcnBoaWNMYXlvdXRFZmZlY3RcIik7XG5cbnZhciBfQ29udGV4dCA9IHJlcXVpcmUoXCIuLi9jb21wb25lbnRzL0NvbnRleHRcIik7XG5cbnZhciByZWZFcXVhbGl0eSA9IGZ1bmN0aW9uIHJlZkVxdWFsaXR5KGEsIGIpIHtcbiAgcmV0dXJuIGEgPT09IGI7XG59O1xuXG5mdW5jdGlvbiB1c2VTZWxlY3RvcldpdGhTdG9yZUFuZFN1YnNjcmlwdGlvbihzZWxlY3RvciwgZXF1YWxpdHlGbiwgc3RvcmUsIGNvbnRleHRTdWIpIHtcbiAgdmFyIF91c2VSZWR1Y2VyID0gKDAsIF9yZWFjdC51c2VSZWR1Y2VyKShmdW5jdGlvbiAocykge1xuICAgIHJldHVybiBzICsgMTtcbiAgfSwgMCksXG4gICAgICBmb3JjZVJlbmRlciA9IF91c2VSZWR1Y2VyWzFdO1xuXG4gIHZhciBzdWJzY3JpcHRpb24gPSAoMCwgX3JlYWN0LnVzZU1lbW8pKGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gbmV3IF9TdWJzY3JpcHRpb25bXCJkZWZhdWx0XCJdKHN0b3JlLCBjb250ZXh0U3ViKTtcbiAgfSwgW3N0b3JlLCBjb250ZXh0U3ViXSk7XG4gIHZhciBsYXRlc3RTdWJzY3JpcHRpb25DYWxsYmFja0Vycm9yID0gKDAsIF9yZWFjdC51c2VSZWYpKCk7XG4gIHZhciBsYXRlc3RTZWxlY3RvciA9ICgwLCBfcmVhY3QudXNlUmVmKSgpO1xuICB2YXIgbGF0ZXN0U3RvcmVTdGF0ZSA9ICgwLCBfcmVhY3QudXNlUmVmKSgpO1xuICB2YXIgbGF0ZXN0U2VsZWN0ZWRTdGF0ZSA9ICgwLCBfcmVhY3QudXNlUmVmKSgpO1xuICB2YXIgc3RvcmVTdGF0ZSA9IHN0b3JlLmdldFN0YXRlKCk7XG4gIHZhciBzZWxlY3RlZFN0YXRlO1xuXG4gIHRyeSB7XG4gICAgaWYgKHNlbGVjdG9yICE9PSBsYXRlc3RTZWxlY3Rvci5jdXJyZW50IHx8IHN0b3JlU3RhdGUgIT09IGxhdGVzdFN0b3JlU3RhdGUuY3VycmVudCB8fCBsYXRlc3RTdWJzY3JpcHRpb25DYWxsYmFja0Vycm9yLmN1cnJlbnQpIHtcbiAgICAgIHZhciBuZXdTZWxlY3RlZFN0YXRlID0gc2VsZWN0b3Ioc3RvcmVTdGF0ZSk7IC8vIGVuc3VyZSBsYXRlc3Qgc2VsZWN0ZWQgc3RhdGUgaXMgcmV1c2VkIHNvIHRoYXQgYSBjdXN0b20gZXF1YWxpdHkgZnVuY3Rpb24gY2FuIHJlc3VsdCBpbiBpZGVudGljYWwgcmVmZXJlbmNlc1xuXG4gICAgICBpZiAobGF0ZXN0U2VsZWN0ZWRTdGF0ZS5jdXJyZW50ID09PSB1bmRlZmluZWQgfHwgIWVxdWFsaXR5Rm4obmV3U2VsZWN0ZWRTdGF0ZSwgbGF0ZXN0U2VsZWN0ZWRTdGF0ZS5jdXJyZW50KSkge1xuICAgICAgICBzZWxlY3RlZFN0YXRlID0gbmV3U2VsZWN0ZWRTdGF0ZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHNlbGVjdGVkU3RhdGUgPSBsYXRlc3RTZWxlY3RlZFN0YXRlLmN1cnJlbnQ7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHNlbGVjdGVkU3RhdGUgPSBsYXRlc3RTZWxlY3RlZFN0YXRlLmN1cnJlbnQ7XG4gICAgfVxuICB9IGNhdGNoIChlcnIpIHtcbiAgICBpZiAobGF0ZXN0U3Vic2NyaXB0aW9uQ2FsbGJhY2tFcnJvci5jdXJyZW50KSB7XG4gICAgICBlcnIubWVzc2FnZSArPSBcIlxcblRoZSBlcnJvciBtYXkgYmUgY29ycmVsYXRlZCB3aXRoIHRoaXMgcHJldmlvdXMgZXJyb3I6XFxuXCIgKyBsYXRlc3RTdWJzY3JpcHRpb25DYWxsYmFja0Vycm9yLmN1cnJlbnQuc3RhY2sgKyBcIlxcblxcblwiO1xuICAgIH1cblxuICAgIHRocm93IGVycjtcbiAgfVxuXG4gICgwLCBfdXNlSXNvbW9ycGhpY0xheW91dEVmZmVjdC51c2VJc29tb3JwaGljTGF5b3V0RWZmZWN0KShmdW5jdGlvbiAoKSB7XG4gICAgbGF0ZXN0U2VsZWN0b3IuY3VycmVudCA9IHNlbGVjdG9yO1xuICAgIGxhdGVzdFN0b3JlU3RhdGUuY3VycmVudCA9IHN0b3JlU3RhdGU7XG4gICAgbGF0ZXN0U2VsZWN0ZWRTdGF0ZS5jdXJyZW50ID0gc2VsZWN0ZWRTdGF0ZTtcbiAgICBsYXRlc3RTdWJzY3JpcHRpb25DYWxsYmFja0Vycm9yLmN1cnJlbnQgPSB1bmRlZmluZWQ7XG4gIH0pO1xuICAoMCwgX3VzZUlzb21vcnBoaWNMYXlvdXRFZmZlY3QudXNlSXNvbW9ycGhpY0xheW91dEVmZmVjdCkoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIGNoZWNrRm9yVXBkYXRlcygpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIHZhciBfbmV3U2VsZWN0ZWRTdGF0ZSA9IGxhdGVzdFNlbGVjdG9yLmN1cnJlbnQoc3RvcmUuZ2V0U3RhdGUoKSk7XG5cbiAgICAgICAgaWYgKGVxdWFsaXR5Rm4oX25ld1NlbGVjdGVkU3RhdGUsIGxhdGVzdFNlbGVjdGVkU3RhdGUuY3VycmVudCkpIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICBsYXRlc3RTZWxlY3RlZFN0YXRlLmN1cnJlbnQgPSBfbmV3U2VsZWN0ZWRTdGF0ZTtcbiAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAvLyB3ZSBpZ25vcmUgYWxsIGVycm9ycyBoZXJlLCBzaW5jZSB3aGVuIHRoZSBjb21wb25lbnRcbiAgICAgICAgLy8gaXMgcmUtcmVuZGVyZWQsIHRoZSBzZWxlY3RvcnMgYXJlIGNhbGxlZCBhZ2FpbiwgYW5kXG4gICAgICAgIC8vIHdpbGwgdGhyb3cgYWdhaW4sIGlmIG5laXRoZXIgcHJvcHMgbm9yIHN0b3JlIHN0YXRlXG4gICAgICAgIC8vIGNoYW5nZWRcbiAgICAgICAgbGF0ZXN0U3Vic2NyaXB0aW9uQ2FsbGJhY2tFcnJvci5jdXJyZW50ID0gZXJyO1xuICAgICAgfVxuXG4gICAgICBmb3JjZVJlbmRlcigpO1xuICAgIH1cblxuICAgIHN1YnNjcmlwdGlvbi5vblN0YXRlQ2hhbmdlID0gY2hlY2tGb3JVcGRhdGVzO1xuICAgIHN1YnNjcmlwdGlvbi50cnlTdWJzY3JpYmUoKTtcbiAgICBjaGVja0ZvclVwZGF0ZXMoKTtcbiAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHN1YnNjcmlwdGlvbi50cnlVbnN1YnNjcmliZSgpO1xuICAgIH07XG4gIH0sIFtzdG9yZSwgc3Vic2NyaXB0aW9uXSk7XG4gIHJldHVybiBzZWxlY3RlZFN0YXRlO1xufVxuLyoqXHJcbiAqIEhvb2sgZmFjdG9yeSwgd2hpY2ggY3JlYXRlcyBhIGB1c2VTZWxlY3RvcmAgaG9vayBib3VuZCB0byBhIGdpdmVuIGNvbnRleHQuXHJcbiAqXHJcbiAqIEBwYXJhbSB7UmVhY3QuQ29udGV4dH0gW2NvbnRleHQ9UmVhY3RSZWR1eENvbnRleHRdIENvbnRleHQgcGFzc2VkIHRvIHlvdXIgYDxQcm92aWRlcj5gLlxyXG4gKiBAcmV0dXJucyB7RnVuY3Rpb259IEEgYHVzZVNlbGVjdG9yYCBob29rIGJvdW5kIHRvIHRoZSBzcGVjaWZpZWQgY29udGV4dC5cclxuICovXG5cblxuZnVuY3Rpb24gY3JlYXRlU2VsZWN0b3JIb29rKGNvbnRleHQpIHtcbiAgaWYgKGNvbnRleHQgPT09IHZvaWQgMCkge1xuICAgIGNvbnRleHQgPSBfQ29udGV4dC5SZWFjdFJlZHV4Q29udGV4dDtcbiAgfVxuXG4gIHZhciB1c2VSZWR1eENvbnRleHQgPSBjb250ZXh0ID09PSBfQ29udGV4dC5SZWFjdFJlZHV4Q29udGV4dCA/IF91c2VSZWR1eENvbnRleHQyLnVzZVJlZHV4Q29udGV4dCA6IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gKDAsIF9yZWFjdC51c2VDb250ZXh0KShjb250ZXh0KTtcbiAgfTtcbiAgcmV0dXJuIGZ1bmN0aW9uIHVzZVNlbGVjdG9yKHNlbGVjdG9yLCBlcXVhbGl0eUZuKSB7XG4gICAgaWYgKGVxdWFsaXR5Rm4gPT09IHZvaWQgMCkge1xuICAgICAgZXF1YWxpdHlGbiA9IHJlZkVxdWFsaXR5O1xuICAgIH1cblxuICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nICYmICFzZWxlY3Rvcikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiWW91IG11c3QgcGFzcyBhIHNlbGVjdG9yIHRvIHVzZVNlbGVjdG9yXCIpO1xuICAgIH1cblxuICAgIHZhciBfdXNlUmVkdXhDb250ZXh0ID0gdXNlUmVkdXhDb250ZXh0KCksXG4gICAgICAgIHN0b3JlID0gX3VzZVJlZHV4Q29udGV4dC5zdG9yZSxcbiAgICAgICAgY29udGV4dFN1YiA9IF91c2VSZWR1eENvbnRleHQuc3Vic2NyaXB0aW9uO1xuXG4gICAgdmFyIHNlbGVjdGVkU3RhdGUgPSB1c2VTZWxlY3RvcldpdGhTdG9yZUFuZFN1YnNjcmlwdGlvbihzZWxlY3RvciwgZXF1YWxpdHlGbiwgc3RvcmUsIGNvbnRleHRTdWIpO1xuICAgICgwLCBfcmVhY3QudXNlRGVidWdWYWx1ZSkoc2VsZWN0ZWRTdGF0ZSk7XG4gICAgcmV0dXJuIHNlbGVjdGVkU3RhdGU7XG4gIH07XG59XG4vKipcclxuICogQSBob29rIHRvIGFjY2VzcyB0aGUgcmVkdXggc3RvcmUncyBzdGF0ZS4gVGhpcyBob29rIHRha2VzIGEgc2VsZWN0b3IgZnVuY3Rpb25cclxuICogYXMgYW4gYXJndW1lbnQuIFRoZSBzZWxlY3RvciBpcyBjYWxsZWQgd2l0aCB0aGUgc3RvcmUgc3RhdGUuXHJcbiAqXHJcbiAqIFRoaXMgaG9vayB0YWtlcyBhbiBvcHRpb25hbCBlcXVhbGl0eSBjb21wYXJpc29uIGZ1bmN0aW9uIGFzIHRoZSBzZWNvbmQgcGFyYW1ldGVyXHJcbiAqIHRoYXQgYWxsb3dzIHlvdSB0byBjdXN0b21pemUgdGhlIHdheSB0aGUgc2VsZWN0ZWQgc3RhdGUgaXMgY29tcGFyZWQgdG8gZGV0ZXJtaW5lXHJcbiAqIHdoZXRoZXIgdGhlIGNvbXBvbmVudCBuZWVkcyB0byBiZSByZS1yZW5kZXJlZC5cclxuICpcclxuICogQHBhcmFtIHtGdW5jdGlvbn0gc2VsZWN0b3IgdGhlIHNlbGVjdG9yIGZ1bmN0aW9uXHJcbiAqIEBwYXJhbSB7RnVuY3Rpb249fSBlcXVhbGl0eUZuIHRoZSBmdW5jdGlvbiB0aGF0IHdpbGwgYmUgdXNlZCB0byBkZXRlcm1pbmUgZXF1YWxpdHlcclxuICpcclxuICogQHJldHVybnMge2FueX0gdGhlIHNlbGVjdGVkIHN0YXRlXHJcbiAqXHJcbiAqIEBleGFtcGxlXHJcbiAqXHJcbiAqIGltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCdcclxuICogaW1wb3J0IHsgdXNlU2VsZWN0b3IgfSBmcm9tICdyZWFjdC1yZWR1eCdcclxuICpcclxuICogZXhwb3J0IGNvbnN0IENvdW50ZXJDb21wb25lbnQgPSAoKSA9PiB7XHJcbiAqICAgY29uc3QgY291bnRlciA9IHVzZVNlbGVjdG9yKHN0YXRlID0+IHN0YXRlLmNvdW50ZXIpXHJcbiAqICAgcmV0dXJuIDxkaXY+e2NvdW50ZXJ9PC9kaXY+XHJcbiAqIH1cclxuICovXG5cblxudmFyIHVzZVNlbGVjdG9yID0gLyojX19QVVJFX18qL2NyZWF0ZVNlbGVjdG9ySG9vaygpO1xuZXhwb3J0cy51c2VTZWxlY3RvciA9IHVzZVNlbGVjdG9yOyJdfQ==