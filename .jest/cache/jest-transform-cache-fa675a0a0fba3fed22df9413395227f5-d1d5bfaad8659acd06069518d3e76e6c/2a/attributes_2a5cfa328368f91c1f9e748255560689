e74fc511bf81361c33aa907364149898
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.attributeRules = void 0;

var boolbase_1 = require("boolbase");

var reChars = /[-[\]{}()*+?.,\\^$|#\s]/g;

function escapeRegex(value) {
  return value.replace(reChars, "\\$&");
}

exports.attributeRules = {
  equals: function equals(next, data, _a) {
    var adapter = _a.adapter;
    var name = data.name;
    var value = data.value;

    if (data.ignoreCase) {
      value = value.toLowerCase();
      return function (elem) {
        var _a;

        return ((_a = adapter.getAttributeValue(elem, name)) === null || _a === void 0 ? void 0 : _a.toLowerCase()) === value && next(elem);
      };
    }

    return function (elem) {
      return adapter.getAttributeValue(elem, name) === value && next(elem);
    };
  },
  hyphen: function hyphen(next, data, _a) {
    var adapter = _a.adapter;
    var name = data.name;
    var value = data.value;
    var len = value.length;

    if (data.ignoreCase) {
      value = value.toLowerCase();
      return function hyphenIC(elem) {
        var attr = adapter.getAttributeValue(elem, name);
        return attr != null && (attr.length === len || attr.charAt(len) === "-") && attr.substr(0, len).toLowerCase() === value && next(elem);
      };
    }

    return function hyphen(elem) {
      var attr = adapter.getAttributeValue(elem, name);
      return attr != null && attr.substr(0, len) === value && (attr.length === len || attr.charAt(len) === "-") && next(elem);
    };
  },
  element: function element(next, _a, _b) {
    var name = _a.name,
        value = _a.value,
        ignoreCase = _a.ignoreCase;
    var adapter = _b.adapter;

    if (/\s/.test(value)) {
      return boolbase_1.falseFunc;
    }

    var regex = new RegExp("(?:^|\\s)" + escapeRegex(value) + "(?:$|\\s)", ignoreCase ? "i" : "");
    return function element(elem) {
      var attr = adapter.getAttributeValue(elem, name);
      return attr != null && regex.test(attr) && next(elem);
    };
  },
  exists: function exists(next, _a, _b) {
    var name = _a.name;
    var adapter = _b.adapter;
    return function (elem) {
      return adapter.hasAttrib(elem, name) && next(elem);
    };
  },
  start: function start(next, data, _a) {
    var adapter = _a.adapter;
    var name = data.name;
    var value = data.value;
    var len = value.length;

    if (len === 0) {
      return boolbase_1.falseFunc;
    }

    if (data.ignoreCase) {
      value = value.toLowerCase();
      return function (elem) {
        var _a;

        return ((_a = adapter.getAttributeValue(elem, name)) === null || _a === void 0 ? void 0 : _a.substr(0, len).toLowerCase()) === value && next(elem);
      };
    }

    return function (elem) {
      var _a;

      return !!((_a = adapter.getAttributeValue(elem, name)) === null || _a === void 0 ? void 0 : _a.startsWith(value)) && next(elem);
    };
  },
  end: function end(next, data, _a) {
    var adapter = _a.adapter;
    var name = data.name;
    var value = data.value;
    var len = -value.length;

    if (len === 0) {
      return boolbase_1.falseFunc;
    }

    if (data.ignoreCase) {
      value = value.toLowerCase();
      return function (elem) {
        var _a;

        return ((_a = adapter.getAttributeValue(elem, name)) === null || _a === void 0 ? void 0 : _a.substr(len).toLowerCase()) === value && next(elem);
      };
    }

    return function (elem) {
      var _a;

      return !!((_a = adapter.getAttributeValue(elem, name)) === null || _a === void 0 ? void 0 : _a.endsWith(value)) && next(elem);
    };
  },
  any: function any(next, data, _a) {
    var adapter = _a.adapter;
    var name = data.name,
        value = data.value;

    if (value === "") {
      return boolbase_1.falseFunc;
    }

    if (data.ignoreCase) {
      var regex_1 = new RegExp(escapeRegex(value), "i");
      return function anyIC(elem) {
        var attr = adapter.getAttributeValue(elem, name);
        return attr != null && regex_1.test(attr) && next(elem);
      };
    }

    return function (elem) {
      var _a;

      return !!((_a = adapter.getAttributeValue(elem, name)) === null || _a === void 0 ? void 0 : _a.includes(value)) && next(elem);
    };
  },
  not: function not(next, data, _a) {
    var adapter = _a.adapter;
    var name = data.name;
    var value = data.value;

    if (value === "") {
      return function (elem) {
        return !!adapter.getAttributeValue(elem, name) && next(elem);
      };
    } else if (data.ignoreCase) {
      value = value.toLowerCase();
      return function (elem) {
        var attr = adapter.getAttributeValue(elem, name);
        return attr != null && attr.toLocaleLowerCase() !== value && next(elem);
      };
    }

    return function (elem) {
      return adapter.getAttributeValue(elem, name) !== value && next(elem);
    };
  }
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF0dHJpYnV0ZXMuanMiXSwibmFtZXMiOlsiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJleHBvcnRzIiwidmFsdWUiLCJhdHRyaWJ1dGVSdWxlcyIsImJvb2xiYXNlXzEiLCJyZXF1aXJlIiwicmVDaGFycyIsImVzY2FwZVJlZ2V4IiwicmVwbGFjZSIsImVxdWFscyIsIm5leHQiLCJkYXRhIiwiX2EiLCJhZGFwdGVyIiwibmFtZSIsImlnbm9yZUNhc2UiLCJ0b0xvd2VyQ2FzZSIsImVsZW0iLCJnZXRBdHRyaWJ1dGVWYWx1ZSIsImh5cGhlbiIsImxlbiIsImxlbmd0aCIsImh5cGhlbklDIiwiYXR0ciIsImNoYXJBdCIsInN1YnN0ciIsImVsZW1lbnQiLCJfYiIsInRlc3QiLCJmYWxzZUZ1bmMiLCJyZWdleCIsIlJlZ0V4cCIsImV4aXN0cyIsImhhc0F0dHJpYiIsInN0YXJ0Iiwic3RhcnRzV2l0aCIsImVuZCIsImVuZHNXaXRoIiwiYW55IiwicmVnZXhfMSIsImFueUlDIiwiaW5jbHVkZXMiLCJub3QiLCJ0b0xvY2FsZUxvd2VyQ2FzZSJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBQ0FBLE1BQU0sQ0FBQ0MsY0FBUCxDQUFzQkMsT0FBdEIsRUFBK0IsWUFBL0IsRUFBNkM7QUFBRUMsRUFBQUEsS0FBSyxFQUFFO0FBQVQsQ0FBN0M7QUFDQUQsT0FBTyxDQUFDRSxjQUFSLEdBQXlCLEtBQUssQ0FBOUI7O0FBQ0EsSUFBSUMsVUFBVSxHQUFHQyxPQUFPLENBQUMsVUFBRCxDQUF4Qjs7QUFPQSxJQUFJQyxPQUFPLEdBQUcsMEJBQWQ7O0FBQ0EsU0FBU0MsV0FBVCxDQUFxQkwsS0FBckIsRUFBNEI7QUFDeEIsU0FBT0EsS0FBSyxDQUFDTSxPQUFOLENBQWNGLE9BQWQsRUFBdUIsTUFBdkIsQ0FBUDtBQUNIOztBQUlETCxPQUFPLENBQUNFLGNBQVIsR0FBeUI7QUFDckJNLEVBQUFBLE1BQU0sRUFBRSxnQkFBVUMsSUFBVixFQUFnQkMsSUFBaEIsRUFBc0JDLEVBQXRC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QyxPQUFqQjtBQUNBLFFBQUlDLElBQUksR0FBR0gsSUFBSSxDQUFDRyxJQUFoQjtBQUNBLFFBQUlaLEtBQUssR0FBR1MsSUFBSSxDQUFDVCxLQUFqQjs7QUFDQSxRQUFJQSxLQUFLLEtBQUssRUFBZCxFQUFrQjtBQUNkLGFBQU8sVUFBVWUsSUFBVixFQUFnQjtBQUNuQixlQUFPLENBQUMsQ0FBQ0osT0FBTyxDQUFDSyxpQkFBUixDQUEwQkQsSUFBMUIsRUFBZ0NILElBQWhDLENBQUYsSUFBMkNKLElBQUksQ0FBQ08sSUFBRCxDQUF0RDtBQUNILE9BRkQ7QUFHSCxLQUpELE1BS0ssSUFBSU4sSUFBSSxDQUFDSSxVQUFULEVBQXFCO0FBQ3RCYixNQUFBQSxLQUFLLEdBQUdBLEtBQUssQ0FBQ2MsV0FBTixFQUFSO0FBQ0EsYUFBTyxVQUFVQyxJQUFWLEVBQWdCO0FBQ25CLFlBQUlNLElBQUksR0FBR1YsT0FBTyxDQUFDSyxpQkFBUixDQUEwQkQsSUFBMUIsRUFBZ0NILElBQWhDLENBQVg7QUFDQSxlQUFRUyxJQUFJLElBQUksSUFBUixJQUNKQSxJQUFJLENBQUNvQixpQkFBTCxPQUE2QnpDLEtBRHpCLElBRUpRLElBQUksQ0FBQ08sSUFBRCxDQUZSO0FBR0gsT0FMRDtBQU1IOztBQUNELFdBQU8sVUFBVUEsSUFBVixFQUFnQjtBQUNuQixhQUFPSixPQUFPLENBQUNLLGlCQUFSLENBQTBCRCxJQUExQixFQUFnQ0gsSUFBaEMsTUFBMENaLEtBQTFDLElBQW1EUSxJQUFJLENBQUNPLElBQUQsQ0FBOUQ7QUFDSCxLQUZEO0FBR0g7QUE3SW9CLENBQXpCIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLmF0dHJpYnV0ZVJ1bGVzID0gdm9pZCAwO1xudmFyIGJvb2xiYXNlXzEgPSByZXF1aXJlKFwiYm9vbGJhc2VcIik7XG4vKipcbiAqIEFsbCByZXNlcnZlZCBjaGFyYWN0ZXJzIGluIGEgcmVnZXgsIHVzZWQgZm9yIGVzY2FwaW5nLlxuICpcbiAqIFRha2VuIGZyb20gWFJlZ0V4cCwgKGMpIDIwMDctMjAyMCBTdGV2ZW4gTGV2aXRoYW4gdW5kZXIgdGhlIE1JVCBsaWNlbnNlXG4gKiBodHRwczovL2dpdGh1Yi5jb20vc2xldml0aGFuL3hyZWdleHAvYmxvYi85NWVlZWJlYjhmYWM4NzU0ZDU0ZWFmZTJiNDc0MzY2MWFjMWNmMDI4L3NyYy94cmVnZXhwLmpzI0w3OTRcbiAqL1xudmFyIHJlQ2hhcnMgPSAvWy1bXFxde30oKSorPy4sXFxcXF4kfCNcXHNdL2c7XG5mdW5jdGlvbiBlc2NhcGVSZWdleCh2YWx1ZSkge1xuICAgIHJldHVybiB2YWx1ZS5yZXBsYWNlKHJlQ2hhcnMsIFwiXFxcXCQmXCIpO1xufVxuLyoqXG4gKiBBdHRyaWJ1dGUgc2VsZWN0b3JzXG4gKi9cbmV4cG9ydHMuYXR0cmlidXRlUnVsZXMgPSB7XG4gICAgZXF1YWxzOiBmdW5jdGlvbiAobmV4dCwgZGF0YSwgX2EpIHtcbiAgICAgICAgdmFyIGFkYXB0ZXIgPSBfYS5hZGFwdGVyO1xuICAgICAgICB2YXIgbmFtZSA9IGRhdGEubmFtZTtcbiAgICAgICAgdmFyIHZhbHVlID0gZGF0YS52YWx1ZTtcbiAgICAgICAgaWYgKGRhdGEuaWdub3JlQ2FzZSkge1xuICAgICAgICAgICAgdmFsdWUgPSB2YWx1ZS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChlbGVtKSB7XG4gICAgICAgICAgICAgICAgdmFyIF9hO1xuICAgICAgICAgICAgICAgIHJldHVybiAoKF9hID0gYWRhcHRlci5nZXRBdHRyaWJ1dGVWYWx1ZShlbGVtLCBuYW1lKSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnRvTG93ZXJDYXNlKCkpID09PVxuICAgICAgICAgICAgICAgICAgICB2YWx1ZSAmJiBuZXh0KGVsZW0pO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGVsZW0pIHtcbiAgICAgICAgICAgIHJldHVybiBhZGFwdGVyLmdldEF0dHJpYnV0ZVZhbHVlKGVsZW0sIG5hbWUpID09PSB2YWx1ZSAmJiBuZXh0KGVsZW0pO1xuICAgICAgICB9O1xuICAgIH0sXG4gICAgaHlwaGVuOiBmdW5jdGlvbiAobmV4dCwgZGF0YSwgX2EpIHtcbiAgICAgICAgdmFyIGFkYXB0ZXIgPSBfYS5hZGFwdGVyO1xuICAgICAgICB2YXIgbmFtZSA9IGRhdGEubmFtZTtcbiAgICAgICAgdmFyIHZhbHVlID0gZGF0YS52YWx1ZTtcbiAgICAgICAgdmFyIGxlbiA9IHZhbHVlLmxlbmd0aDtcbiAgICAgICAgaWYgKGRhdGEuaWdub3JlQ2FzZSkge1xuICAgICAgICAgICAgdmFsdWUgPSB2YWx1ZS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIGh5cGhlbklDKGVsZW0pIHtcbiAgICAgICAgICAgICAgICB2YXIgYXR0ciA9IGFkYXB0ZXIuZ2V0QXR0cmlidXRlVmFsdWUoZWxlbSwgbmFtZSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIChhdHRyICE9IG51bGwgJiZcbiAgICAgICAgICAgICAgICAgICAgKGF0dHIubGVuZ3RoID09PSBsZW4gfHwgYXR0ci5jaGFyQXQobGVuKSA9PT0gXCItXCIpICYmXG4gICAgICAgICAgICAgICAgICAgIGF0dHIuc3Vic3RyKDAsIGxlbikudG9Mb3dlckNhc2UoKSA9PT0gdmFsdWUgJiZcbiAgICAgICAgICAgICAgICAgICAgbmV4dChlbGVtKSk7XG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiBoeXBoZW4oZWxlbSkge1xuICAgICAgICAgICAgdmFyIGF0dHIgPSBhZGFwdGVyLmdldEF0dHJpYnV0ZVZhbHVlKGVsZW0sIG5hbWUpO1xuICAgICAgICAgICAgcmV0dXJuIChhdHRyICE9IG51bGwgJiZcbiAgICAgICAgICAgICAgICBhdHRyLnN1YnN0cigwLCBsZW4pID09PSB2YWx1ZSAmJlxuICAgICAgICAgICAgICAgIChhdHRyLmxlbmd0aCA9PT0gbGVuIHx8IGF0dHIuY2hhckF0KGxlbikgPT09IFwiLVwiKSAmJlxuICAgICAgICAgICAgICAgIG5leHQoZWxlbSkpO1xuICAgICAgICB9O1xuICAgIH0sXG4gICAgZWxlbWVudDogZnVuY3Rpb24gKG5leHQsIF9hLCBfYikge1xuICAgICAgICB2YXIgbmFtZSA9IF9hLm5hbWUsIHZhbHVlID0gX2EudmFsdWUsIGlnbm9yZUNhc2UgPSBfYS5pZ25vcmVDYXNlO1xuICAgICAgICB2YXIgYWRhcHRlciA9IF9iLmFkYXB0ZXI7XG4gICAgICAgIGlmICgvXFxzLy50ZXN0KHZhbHVlKSkge1xuICAgICAgICAgICAgcmV0dXJuIGJvb2xiYXNlXzEuZmFsc2VGdW5jO1xuICAgICAgICB9XG4gICAgICAgIHZhciByZWdleCA9IG5ldyBSZWdFeHAoXCIoPzpefFxcXFxzKVwiICsgZXNjYXBlUmVnZXgodmFsdWUpICsgXCIoPzokfFxcXFxzKVwiLCBpZ25vcmVDYXNlID8gXCJpXCIgOiBcIlwiKTtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIGVsZW1lbnQoZWxlbSkge1xuICAgICAgICAgICAgdmFyIGF0dHIgPSBhZGFwdGVyLmdldEF0dHJpYnV0ZVZhbHVlKGVsZW0sIG5hbWUpO1xuICAgICAgICAgICAgcmV0dXJuIGF0dHIgIT0gbnVsbCAmJiByZWdleC50ZXN0KGF0dHIpICYmIG5leHQoZWxlbSk7XG4gICAgICAgIH07XG4gICAgfSxcbiAgICBleGlzdHM6IGZ1bmN0aW9uIChuZXh0LCBfYSwgX2IpIHtcbiAgICAgICAgdmFyIG5hbWUgPSBfYS5uYW1lO1xuICAgICAgICB2YXIgYWRhcHRlciA9IF9iLmFkYXB0ZXI7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAoZWxlbSkgeyByZXR1cm4gYWRhcHRlci5oYXNBdHRyaWIoZWxlbSwgbmFtZSkgJiYgbmV4dChlbGVtKTsgfTtcbiAgICB9LFxuICAgIHN0YXJ0OiBmdW5jdGlvbiAobmV4dCwgZGF0YSwgX2EpIHtcbiAgICAgICAgdmFyIGFkYXB0ZXIgPSBfYS5hZGFwdGVyO1xuICAgICAgICB2YXIgbmFtZSA9IGRhdGEubmFtZTtcbiAgICAgICAgdmFyIHZhbHVlID0gZGF0YS52YWx1ZTtcbiAgICAgICAgdmFyIGxlbiA9IHZhbHVlLmxlbmd0aDtcbiAgICAgICAgaWYgKGxlbiA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIGJvb2xiYXNlXzEuZmFsc2VGdW5jO1xuICAgICAgICB9XG4gICAgICAgIGlmIChkYXRhLmlnbm9yZUNhc2UpIHtcbiAgICAgICAgICAgIHZhbHVlID0gdmFsdWUudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoZWxlbSkge1xuICAgICAgICAgICAgICAgIHZhciBfYTtcbiAgICAgICAgICAgICAgICByZXR1cm4gKChfYSA9IGFkYXB0ZXJcbiAgICAgICAgICAgICAgICAgICAgLmdldEF0dHJpYnV0ZVZhbHVlKGVsZW0sIG5hbWUpKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2Euc3Vic3RyKDAsIGxlbikudG9Mb3dlckNhc2UoKSkgPT09IHZhbHVlICYmIG5leHQoZWxlbSk7XG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAoZWxlbSkge1xuICAgICAgICAgICAgdmFyIF9hO1xuICAgICAgICAgICAgcmV0dXJuICEhKChfYSA9IGFkYXB0ZXIuZ2V0QXR0cmlidXRlVmFsdWUoZWxlbSwgbmFtZSkpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5zdGFydHNXaXRoKHZhbHVlKSkgJiZcbiAgICAgICAgICAgICAgICBuZXh0KGVsZW0pO1xuICAgICAgICB9O1xuICAgIH0sXG4gICAgZW5kOiBmdW5jdGlvbiAobmV4dCwgZGF0YSwgX2EpIHtcbiAgICAgICAgdmFyIGFkYXB0ZXIgPSBfYS5hZGFwdGVyO1xuICAgICAgICB2YXIgbmFtZSA9IGRhdGEubmFtZTtcbiAgICAgICAgdmFyIHZhbHVlID0gZGF0YS52YWx1ZTtcbiAgICAgICAgdmFyIGxlbiA9IC12YWx1ZS5sZW5ndGg7XG4gICAgICAgIGlmIChsZW4gPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiBib29sYmFzZV8xLmZhbHNlRnVuYztcbiAgICAgICAgfVxuICAgICAgICBpZiAoZGF0YS5pZ25vcmVDYXNlKSB7XG4gICAgICAgICAgICB2YWx1ZSA9IHZhbHVlLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGVsZW0pIHtcbiAgICAgICAgICAgICAgICB2YXIgX2E7XG4gICAgICAgICAgICAgICAgcmV0dXJuICgoX2EgPSBhZGFwdGVyXG4gICAgICAgICAgICAgICAgICAgIC5nZXRBdHRyaWJ1dGVWYWx1ZShlbGVtLCBuYW1lKSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnN1YnN0cihsZW4pLnRvTG93ZXJDYXNlKCkpID09PSB2YWx1ZSAmJiBuZXh0KGVsZW0pO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGVsZW0pIHtcbiAgICAgICAgICAgIHZhciBfYTtcbiAgICAgICAgICAgIHJldHVybiAhISgoX2EgPSBhZGFwdGVyLmdldEF0dHJpYnV0ZVZhbHVlKGVsZW0sIG5hbWUpKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZW5kc1dpdGgodmFsdWUpKSAmJlxuICAgICAgICAgICAgICAgIG5leHQoZWxlbSk7XG4gICAgICAgIH07XG4gICAgfSxcbiAgICBhbnk6IGZ1bmN0aW9uIChuZXh0LCBkYXRhLCBfYSkge1xuICAgICAgICB2YXIgYWRhcHRlciA9IF9hLmFkYXB0ZXI7XG4gICAgICAgIHZhciBuYW1lID0gZGF0YS5uYW1lLCB2YWx1ZSA9IGRhdGEudmFsdWU7XG4gICAgICAgIGlmICh2YWx1ZSA9PT0gXCJcIikge1xuICAgICAgICAgICAgcmV0dXJuIGJvb2xiYXNlXzEuZmFsc2VGdW5jO1xuICAgICAgICB9XG4gICAgICAgIGlmIChkYXRhLmlnbm9yZUNhc2UpIHtcbiAgICAgICAgICAgIHZhciByZWdleF8xID0gbmV3IFJlZ0V4cChlc2NhcGVSZWdleCh2YWx1ZSksIFwiaVwiKTtcbiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiBhbnlJQyhlbGVtKSB7XG4gICAgICAgICAgICAgICAgdmFyIGF0dHIgPSBhZGFwdGVyLmdldEF0dHJpYnV0ZVZhbHVlKGVsZW0sIG5hbWUpO1xuICAgICAgICAgICAgICAgIHJldHVybiBhdHRyICE9IG51bGwgJiYgcmVnZXhfMS50ZXN0KGF0dHIpICYmIG5leHQoZWxlbSk7XG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAoZWxlbSkge1xuICAgICAgICAgICAgdmFyIF9hO1xuICAgICAgICAgICAgcmV0dXJuICEhKChfYSA9IGFkYXB0ZXIuZ2V0QXR0cmlidXRlVmFsdWUoZWxlbSwgbmFtZSkpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5pbmNsdWRlcyh2YWx1ZSkpICYmXG4gICAgICAgICAgICAgICAgbmV4dChlbGVtKTtcbiAgICAgICAgfTtcbiAgICB9LFxuICAgIG5vdDogZnVuY3Rpb24gKG5leHQsIGRhdGEsIF9hKSB7XG4gICAgICAgIHZhciBhZGFwdGVyID0gX2EuYWRhcHRlcjtcbiAgICAgICAgdmFyIG5hbWUgPSBkYXRhLm5hbWU7XG4gICAgICAgIHZhciB2YWx1ZSA9IGRhdGEudmFsdWU7XG4gICAgICAgIGlmICh2YWx1ZSA9PT0gXCJcIikge1xuICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChlbGVtKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICEhYWRhcHRlci5nZXRBdHRyaWJ1dGVWYWx1ZShlbGVtLCBuYW1lKSAmJiBuZXh0KGVsZW0pO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChkYXRhLmlnbm9yZUNhc2UpIHtcbiAgICAgICAgICAgIHZhbHVlID0gdmFsdWUudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbiAoZWxlbSkge1xuICAgICAgICAgICAgICAgIHZhciBhdHRyID0gYWRhcHRlci5nZXRBdHRyaWJ1dGVWYWx1ZShlbGVtLCBuYW1lKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gKGF0dHIgIT0gbnVsbCAmJlxuICAgICAgICAgICAgICAgICAgICBhdHRyLnRvTG9jYWxlTG93ZXJDYXNlKCkgIT09IHZhbHVlICYmXG4gICAgICAgICAgICAgICAgICAgIG5leHQoZWxlbSkpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGVsZW0pIHtcbiAgICAgICAgICAgIHJldHVybiBhZGFwdGVyLmdldEF0dHJpYnV0ZVZhbHVlKGVsZW0sIG5hbWUpICE9PSB2YWx1ZSAmJiBuZXh0KGVsZW0pO1xuICAgICAgICB9O1xuICAgIH0sXG59O1xuIl19