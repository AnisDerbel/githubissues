ce6300dae67f2d283a136ea0d254efd0
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) {
  return typeof obj;
} : function (obj) {
  return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;
};

exports.typeName = typeName;
exports.spaces = spaces;
exports.indent = indent;
exports.debugNode = debugNode;
exports.debugNodes = debugNodes;

var _lodash = require('lodash.escape');

var _lodash2 = _interopRequireDefault(_lodash);

var _functionPrototype = require('function.prototype.name');

var _functionPrototype2 = _interopRequireDefault(_functionPrototype);

var _isString = require('is-string');

var _isString2 = _interopRequireDefault(_isString);

var _isNumberObject = require('is-number-object');

var _isNumberObject2 = _interopRequireDefault(_isNumberObject);

var _isCallable = require('is-callable');

var _isCallable2 = _interopRequireDefault(_isCallable);

var _isBooleanObject = require('is-boolean-object');

var _isBooleanObject2 = _interopRequireDefault(_isBooleanObject);

var _objectInspect = require('object-inspect');

var _objectInspect2 = _interopRequireDefault(_objectInspect);

var _has = require('has');

var _has2 = _interopRequireDefault(_has);

var _RSTTraversal = require('./RSTTraversal');

var _getAdapter = require('./getAdapter');

var _getAdapter2 = _interopRequireDefault(_getAdapter);

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : {
    'default': obj
  };
}

var booleanValue = Function.bind.call(Function.call, Boolean.prototype.valueOf);

function typeName(node) {
  var adapter = (0, _getAdapter2['default'])();

  if (adapter.displayNameOfNode) {
    return (0, _getAdapter2['default'])().displayNameOfNode(node) || 'Component';
  }

  return typeof node.type === 'function' ? node.type.displayName || (0, _functionPrototype2['default'])(node.type) || 'Component' : node.type;
}

function spaces(n) {
  return Array(n + 1).join(' ');
}

function indent(depth, string) {
  return string.split('\n').map(function (x) {
    return '' + String(spaces(depth)) + String(x);
  }).join('\n');
}

function propString(prop, options) {
  if ((0, _isString2['default'])(prop)) {
    return (0, _objectInspect2['default'])(String(prop), {
      quoteStyle: 'double'
    });
  }

  if ((0, _isNumberObject2['default'])(prop)) {
    return '{' + String((0, _objectInspect2['default'])(Number(prop))) + '}';
  }

  if ((0, _isBooleanObject2['default'])(prop)) {
    return '{' + String((0, _objectInspect2['default'])(booleanValue(prop))) + '}';
  }

  if ((0, _isCallable2['default'])(prop)) {
    return '{' + String((0, _objectInspect2['default'])(prop)) + '}';
  }

  if ((typeof prop === 'undefined' ? 'undefined' : _typeof(prop)) === 'object') {
    if (options.verbose) {
      return '{' + String((0, _objectInspect2['default'])(prop)) + '}';
    }

    return '{{...}}';
  }

  return '{[' + (typeof prop === 'undefined' ? 'undefined' : _typeof(prop)) + ']}';
}

function propsString(node, options) {
  var props = (0, _RSTTraversal.propsOfNode)(node);
  var keys = Object.keys(props).filter(function (x) {
    return x !== 'children';
  });
  return keys.map(function (key) {
    return String(key) + '=' + String(propString(props[key], options));
  }).join(' ');
}

function indentChildren(childrenStrs, indentLength) {
  return childrenStrs.length ? '\n' + String(childrenStrs.map(function (x) {
    return indent(indentLength, x);
  }).join('\n')) + '\n' : '';
}

function isRSTNodeLike(node) {
  return (0, _has2['default'])(node, 'nodeType') && typeof node.nodeType === 'string' && (0, _has2['default'])(node, 'type') && (0, _has2['default'])(node, 'key') && (0, _has2['default'])(node, 'ref') && (0, _has2['default'])(node, 'instance') && (0, _has2['default'])(node, 'rendered');
}

function debugNode(node) {
  var indentLength = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 2;
  var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};
  if (typeof node === 'string' || typeof node === 'number') return (0, _lodash2['default'])(node);

  if (typeof node === 'function') {
    var name = (0, _functionPrototype2['default'])(node);
    return '[function' + (name ? ' ' + String(name) : '') + ']';
  }

  if (!node) return '';
  var adapter = (0, _getAdapter2['default'])();

  if (!adapter.isValidElement(node) && !isRSTNodeLike(node)) {
    return '{' + String((0, _objectInspect2['default'])(node)) + '}';
  }

  var childrenStrs = (0, _RSTTraversal.childrenOfNode)(node).map(function (n) {
    return debugNode(n, indentLength, options);
  }).filter(Boolean);
  var type = typeName(node);
  var props = options.ignoreProps ? '' : propsString(node, options);
  var beforeProps = props ? ' ' : '';
  var afterProps = childrenStrs.length ? '>' : ' ';
  var childrenIndented = indentChildren(childrenStrs, indentLength);
  var nodeClose = childrenStrs.length ? '</' + String(type) + '>' : '/>';
  return '<' + String(type) + beforeProps + String(props) + afterProps + String(childrenIndented) + nodeClose;
}

function debugNodes(nodes) {
  var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
  return nodes.map(function (node) {
    return debugNode(node, undefined, options);
  }).join('\n\n\n');
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9EZWJ1Zy5qcyJdLCJuYW1lcyI6WyJib29sZWFuVmFsdWUiLCJGdW5jdGlvbiIsIkJvb2xlYW4iLCJ0eXBlTmFtZSIsImFkYXB0ZXIiLCJub2RlIiwic3BhY2VzIiwiQXJyYXkiLCJuIiwiaW5kZW50IiwiU3RyaW5nIiwicXVvdGVTdHlsZSIsIk51bWJlciIsIm9wdGlvbnMiLCJwcm9wcyIsImtleXMiLCJ4IiwicHJvcFN0cmluZyIsImNoaWxkcmVuU3RycyIsImRlYnVnTm9kZSIsImluZGVudExlbmd0aCIsIm5hbWUiLCJpc1JTVE5vZGVMaWtlIiwidHlwZSIsInByb3BzU3RyaW5nIiwiYmVmb3JlUHJvcHMiLCJhZnRlclByb3BzIiwiY2hpbGRyZW5JbmRlbnRlZCIsImluZGVudENoaWxkcmVuIiwibm9kZUNsb3NlIiwiZGVidWdOb2RlcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7O1FBaUJnQkcsUSxHQUFBQSxRO1FBVUFHLE0sR0FBQUEsTTtRQUlBRyxNLEdBQUFBLE07UUFpREFVLFMsR0FBQUEsUztRQTRCQVcsVSxHQUFBQSxVOztBQTVHaEIsSUFBQSxPQUFBLEdBQUEsT0FBQSxDQUFBLGVBQUEsQ0FBQTs7OztBQUNBLElBQUEsa0JBQUEsR0FBQSxPQUFBLENBQUEseUJBQUEsQ0FBQTs7OztBQUNBLElBQUEsU0FBQSxHQUFBLE9BQUEsQ0FBQSxXQUFBLENBQUE7Ozs7QUFDQSxJQUFBLGVBQUEsR0FBQSxPQUFBLENBQUEsa0JBQUEsQ0FBQTs7OztBQUNBLElBQUEsV0FBQSxHQUFBLE9BQUEsQ0FBQSxhQUFBLENBQUE7Ozs7QUFDQSxJQUFBLGdCQUFBLEdBQUEsT0FBQSxDQUFBLG1CQUFBLENBQUE7Ozs7QUFDQSxJQUFBLGNBQUEsR0FBQSxPQUFBLENBQUEsZ0JBQUEsQ0FBQTs7OztBQUNBLElBQUEsSUFBQSxHQUFBLE9BQUEsQ0FBQSxLQUFBLENBQUE7Ozs7QUFFQSxJQUFBLGFBQUEsR0FBQSxPQUFBLENBQUEsZ0JBQUEsQ0FBQTs7QUFJ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R0FBQUEsR0FBbEIsSUFBQTtBQUNBLFNBQUEsTUFBQSxNQUFBLENBQUEsSUFBQSxDQUFBLEdBQUEsV0FBQSxHQUFBLE1BQUEsQ0FBQSxLQUFBLENBQUEsR0FBQSxVQUFBLEdBQUEsTUFBQSxDQUFBLGdCQUFBLENBQUEsR0FBQSxTQUFBO0FBQ0Q7O0FBRU0sU0FBQSxVQUFBLENBQUEsS0FBQSxFQUF5QztBQUFBLE1BQWRMLE9BQWMsR0FBQSxTQUFBLENBQUEsTUFBQSxHQUFBLENBQUEsSUFBQSxTQUFBLENBQUEsQ0FBQSxDQUFBLEtBQUEsU0FBQSxHQUFBLFNBQUEsQ0FBQSxDQUFBLENBQUEsR0FBSixFQUFJO0FBQzlDLFNBQU8sS0FBQSxDQUFBLEdBQUEsQ0FBVSxVQUFBLElBQUEsRUFBQTtBQUFBLFdBQVVNLFNBQUFBLENBQUFBLElBQUFBLEVBQUFBLFNBQUFBLEVBQVYsT0FBVUEsQ0FBVjtBQUFWLEdBQUEsRUFBQSxJQUFBLENBQVAsUUFBTyxDQUFQO0FBQ0QiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgZXNjYXBlIGZyb20gJ2xvZGFzaC5lc2NhcGUnO1xuaW1wb3J0IGZ1bmN0aW9uTmFtZSBmcm9tICdmdW5jdGlvbi5wcm90b3R5cGUubmFtZSc7XG5pbXBvcnQgaXNTdHJpbmcgZnJvbSAnaXMtc3RyaW5nJztcbmltcG9ydCBpc051bWJlciBmcm9tICdpcy1udW1iZXItb2JqZWN0JztcbmltcG9ydCBpc0NhbGxhYmxlIGZyb20gJ2lzLWNhbGxhYmxlJztcbmltcG9ydCBpc0Jvb2xlYW4gZnJvbSAnaXMtYm9vbGVhbi1vYmplY3QnO1xuaW1wb3J0IGluc3BlY3QgZnJvbSAnb2JqZWN0LWluc3BlY3QnO1xuaW1wb3J0IGhhcyBmcm9tICdoYXMnO1xuXG5pbXBvcnQge1xuICBwcm9wc09mTm9kZSxcbiAgY2hpbGRyZW5PZk5vZGUsXG59IGZyb20gJy4vUlNUVHJhdmVyc2FsJztcbmltcG9ydCBnZXRBZGFwdGVyIGZyb20gJy4vZ2V0QWRhcHRlcic7XG5cbmNvbnN0IGJvb2xlYW5WYWx1ZSA9IEZ1bmN0aW9uLmJpbmQuY2FsbChGdW5jdGlvbi5jYWxsLCBCb29sZWFuLnByb3RvdHlwZS52YWx1ZU9mKTtcblxuZXhwb3J0IGZ1bmN0aW9uIHR5cGVOYW1lKG5vZGUpIHtcbiAgY29uc3QgYWRhcHRlciA9IGdldEFkYXB0ZXIoKTtcbiAgaWYgKGFkYXB0ZXIuZGlzcGxheU5hbWVPZk5vZGUpIHtcbiAgICByZXR1cm4gZ2V0QWRhcHRlcigpLmRpc3BsYXlOYW1lT2ZOb2RlKG5vZGUpIHx8ICdDb21wb25lbnQnO1xuICB9XG4gIHJldHVybiB0eXBlb2Ygbm9kZS50eXBlID09PSAnZnVuY3Rpb24nXG4gICAgPyAobm9kZS50eXBlLmRpc3BsYXlOYW1lIHx8IGZ1bmN0aW9uTmFtZShub2RlLnR5cGUpIHx8ICdDb21wb25lbnQnKVxuICAgIDogbm9kZS50eXBlO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gc3BhY2VzKG4pIHtcbiAgcmV0dXJuIEFycmF5KG4gKyAxKS5qb2luKCcgJyk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBpbmRlbnQoZGVwdGgsIHN0cmluZykge1xuICByZXR1cm4gc3RyaW5nLnNwbGl0KCdcXG4nKS5tYXAoKHgpID0+IGAke3NwYWNlcyhkZXB0aCl9JHt4fWApLmpvaW4oJ1xcbicpO1xufVxuXG5mdW5jdGlvbiBwcm9wU3RyaW5nKHByb3AsIG9wdGlvbnMpIHtcbiAgaWYgKGlzU3RyaW5nKHByb3ApKSB7XG4gICAgcmV0dXJuIGluc3BlY3QoU3RyaW5nKHByb3ApLCB7IHF1b3RlU3R5bGU6ICdkb3VibGUnIH0pO1xuICB9XG4gIGlmIChpc051bWJlcihwcm9wKSkge1xuICAgIHJldHVybiBgeyR7aW5zcGVjdChOdW1iZXIocHJvcCkpfX1gO1xuICB9XG4gIGlmIChpc0Jvb2xlYW4ocHJvcCkpIHtcbiAgICByZXR1cm4gYHske2luc3BlY3QoYm9vbGVhblZhbHVlKHByb3ApKX19YDtcbiAgfVxuICBpZiAoaXNDYWxsYWJsZShwcm9wKSkge1xuICAgIHJldHVybiBgeyR7aW5zcGVjdChwcm9wKX19YDtcbiAgfVxuICBpZiAodHlwZW9mIHByb3AgPT09ICdvYmplY3QnKSB7XG4gICAgaWYgKG9wdGlvbnMudmVyYm9zZSkge1xuICAgICAgcmV0dXJuIGB7JHtpbnNwZWN0KHByb3ApfX1gO1xuICAgIH1cblxuICAgIHJldHVybiAne3suLi59fSc7XG4gIH1cbiAgcmV0dXJuIGB7WyR7dHlwZW9mIHByb3B9XX1gO1xufVxuXG5mdW5jdGlvbiBwcm9wc1N0cmluZyhub2RlLCBvcHRpb25zKSB7XG4gIGNvbnN0IHByb3BzID0gcHJvcHNPZk5vZGUobm9kZSk7XG4gIGNvbnN0IGtleXMgPSBPYmplY3Qua2V5cyhwcm9wcykuZmlsdGVyKCh4KSA9PiB4ICE9PSAnY2hpbGRyZW4nKTtcbiAgcmV0dXJuIGtleXMubWFwKChrZXkpID0+IGAke2tleX09JHtwcm9wU3RyaW5nKHByb3BzW2tleV0sIG9wdGlvbnMpfWApLmpvaW4oJyAnKTtcbn1cblxuZnVuY3Rpb24gaW5kZW50Q2hpbGRyZW4oY2hpbGRyZW5TdHJzLCBpbmRlbnRMZW5ndGgpIHtcbiAgcmV0dXJuIGNoaWxkcmVuU3Rycy5sZW5ndGhcbiAgICA/IGBcXG4ke2NoaWxkcmVuU3Rycy5tYXAoKHgpID0+IGluZGVudChpbmRlbnRMZW5ndGgsIHgpKS5qb2luKCdcXG4nKX1cXG5gXG4gICAgOiAnJztcbn1cblxuZnVuY3Rpb24gaXNSU1ROb2RlTGlrZShub2RlKSB7XG4gIHJldHVybiBoYXMobm9kZSwgJ25vZGVUeXBlJylcbiAgICAmJiB0eXBlb2Ygbm9kZS5ub2RlVHlwZSA9PT0gJ3N0cmluZydcbiAgICAmJiBoYXMobm9kZSwgJ3R5cGUnKVxuICAgICYmIGhhcyhub2RlLCAna2V5JylcbiAgICAmJiBoYXMobm9kZSwgJ3JlZicpXG4gICAgJiYgaGFzKG5vZGUsICdpbnN0YW5jZScpXG4gICAgJiYgaGFzKG5vZGUsICdyZW5kZXJlZCcpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZGVidWdOb2RlKG5vZGUsIGluZGVudExlbmd0aCA9IDIsIG9wdGlvbnMgPSB7fSkge1xuICBpZiAodHlwZW9mIG5vZGUgPT09ICdzdHJpbmcnIHx8IHR5cGVvZiBub2RlID09PSAnbnVtYmVyJykgcmV0dXJuIGVzY2FwZShub2RlKTtcbiAgaWYgKHR5cGVvZiBub2RlID09PSAnZnVuY3Rpb24nKSB7XG4gICAgY29uc3QgbmFtZSA9IGZ1bmN0aW9uTmFtZShub2RlKTtcbiAgICByZXR1cm4gYFtmdW5jdGlvbiR7bmFtZSA/IGAgJHtuYW1lfWAgOiAnJ31dYDtcbiAgfVxuICBpZiAoIW5vZGUpIHJldHVybiAnJztcblxuICBjb25zdCBhZGFwdGVyID0gZ2V0QWRhcHRlcigpO1xuICBpZiAoIWFkYXB0ZXIuaXNWYWxpZEVsZW1lbnQobm9kZSkgJiYgIWlzUlNUTm9kZUxpa2Uobm9kZSkpIHtcbiAgICByZXR1cm4gYHske2luc3BlY3Qobm9kZSl9fWA7XG4gIH1cblxuICBjb25zdCBjaGlsZHJlblN0cnMgPSBjaGlsZHJlbk9mTm9kZShub2RlKVxuICAgIC5tYXAoKG4pID0+IGRlYnVnTm9kZShuLCBpbmRlbnRMZW5ndGgsIG9wdGlvbnMpKVxuICAgIC5maWx0ZXIoQm9vbGVhbik7XG4gIGNvbnN0IHR5cGUgPSB0eXBlTmFtZShub2RlKTtcblxuICBjb25zdCBwcm9wcyA9IG9wdGlvbnMuaWdub3JlUHJvcHMgPyAnJyA6IHByb3BzU3RyaW5nKG5vZGUsIG9wdGlvbnMpO1xuICBjb25zdCBiZWZvcmVQcm9wcyA9IHByb3BzID8gJyAnIDogJyc7XG4gIGNvbnN0IGFmdGVyUHJvcHMgPSBjaGlsZHJlblN0cnMubGVuZ3RoXG4gICAgPyAnPidcbiAgICA6ICcgJztcbiAgY29uc3QgY2hpbGRyZW5JbmRlbnRlZCA9IGluZGVudENoaWxkcmVuKGNoaWxkcmVuU3RycywgaW5kZW50TGVuZ3RoKTtcbiAgY29uc3Qgbm9kZUNsb3NlID0gY2hpbGRyZW5TdHJzLmxlbmd0aCA/IGA8LyR7dHlwZX0+YCA6ICcvPic7XG4gIHJldHVybiBgPCR7dHlwZX0ke2JlZm9yZVByb3BzfSR7cHJvcHN9JHthZnRlclByb3BzfSR7Y2hpbGRyZW5JbmRlbnRlZH0ke25vZGVDbG9zZX1gO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZGVidWdOb2Rlcyhub2Rlcywgb3B0aW9ucyA9IHt9KSB7XG4gIHJldHVybiBub2Rlcy5tYXAoKG5vZGUpID0+IGRlYnVnTm9kZShub2RlLCB1bmRlZmluZWQsIG9wdGlvbnMpKS5qb2luKCdcXG5cXG5cXG4nKTtcbn1cbiJdfQ==